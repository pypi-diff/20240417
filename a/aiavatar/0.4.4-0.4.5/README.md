# Comparing `tmp/aiavatar-0.4.4-py3-none-any.whl.zip` & `tmp/aiavatar-0.4.5-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,28 @@
-Zip file size: 25527 bytes, number of entries: 23
--rw-r--r--  2.0 unx      438 b- defN 24-Feb-26 03:37 aiavatar/__init__.py
--rw-r--r--  2.0 unx     3407 b- defN 24-Apr-07 17:32 aiavatar/avatar.py
--rw-r--r--  2.0 unx     6841 b- defN 24-Apr-13 11:34 aiavatar/bot.py
--rw-r--r--  2.0 unx     1771 b- defN 24-Apr-07 09:53 aiavatar/animation/__init__.py
--rw-r--r--  2.0 unx     1448 b- defN 24-Apr-12 20:35 aiavatar/animation/vrchat.py
--rw-r--r--  2.0 unx       31 b- defN 23-May-27 03:48 aiavatar/device/__init__.py
--rw-r--r--  2.0 unx     2344 b- defN 24-Apr-11 11:13 aiavatar/device/audio.py
--rw-r--r--  2.0 unx     1650 b- defN 23-Jun-04 16:30 aiavatar/face/__init__.py
--rw-r--r--  2.0 unx     1556 b- defN 23-Jun-04 16:30 aiavatar/face/vrchat.py
--rw-r--r--  2.0 unx     6342 b- defN 24-Apr-13 08:25 aiavatar/listeners/__init__.py
--rw-r--r--  2.0 unx     2522 b- defN 24-Apr-13 08:55 aiavatar/listeners/azurevoicerequest.py
--rw-r--r--  2.0 unx     2849 b- defN 24-Apr-13 10:44 aiavatar/listeners/azurewakeword.py
--rw-r--r--  2.0 unx      977 b- defN 24-Feb-26 00:10 aiavatar/listeners/voicerequest.py
--rw-r--r--  2.0 unx     1078 b- defN 24-Feb-26 03:54 aiavatar/listeners/wakeword.py
--rw-r--r--  2.0 unx      178 b- defN 23-May-27 08:55 aiavatar/processors/__init__.py
--rw-r--r--  2.0 unx     6162 b- defN 24-Apr-13 01:31 aiavatar/processors/chatgpt.py
--rw-r--r--  2.0 unx      275 b- defN 24-Apr-12 01:48 aiavatar/speech/__init__.py
--rw-r--r--  2.0 unx     2483 b- defN 24-Apr-12 01:48 aiavatar/speech/voicevox.py
--rw-r--r--  2.0 unx    11324 b- defN 24-Apr-13 11:36 aiavatar-0.4.4.dist-info/LICENSE
--rw-r--r--  2.0 unx    12628 b- defN 24-Apr-13 11:36 aiavatar-0.4.4.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-13 11:36 aiavatar-0.4.4.dist-info/WHEEL
--rw-r--r--  2.0 unx        9 b- defN 24-Apr-13 11:36 aiavatar-0.4.4.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1905 b- defN 24-Apr-13 11:36 aiavatar-0.4.4.dist-info/RECORD
-23 files, 68310 bytes uncompressed, 22443 bytes compressed:  67.1%
+Zip file size: 28640 bytes, number of entries: 26
+-rw-r--r--  2.0 unx      438 b- defN 24-Apr-14 09:42 aiavatar/__init__.py
+-rw-r--r--  2.0 unx     3407 b- defN 24-Apr-14 09:42 aiavatar/avatar.py
+-rw-r--r--  2.0 unx     6841 b- defN 24-Apr-16 23:38 aiavatar/bot.py
+-rw-r--r--  2.0 unx     1771 b- defN 24-Apr-14 09:42 aiavatar/animation/__init__.py
+-rw-r--r--  2.0 unx     1448 b- defN 24-Apr-14 09:42 aiavatar/animation/vrchat.py
+-rw-r--r--  2.0 unx       31 b- defN 24-Apr-14 09:42 aiavatar/device/__init__.py
+-rw-r--r--  2.0 unx     2344 b- defN 24-Apr-14 09:42 aiavatar/device/audio.py
+-rw-r--r--  2.0 unx     1650 b- defN 24-Apr-14 09:42 aiavatar/face/__init__.py
+-rw-r--r--  2.0 unx     1556 b- defN 24-Apr-14 09:42 aiavatar/face/vrchat.py
+-rw-r--r--  2.0 unx     6342 b- defN 24-Apr-14 09:42 aiavatar/listeners/__init__.py
+-rw-r--r--  2.0 unx     2522 b- defN 24-Apr-14 09:42 aiavatar/listeners/azurevoicerequest.py
+-rw-r--r--  2.0 unx     2849 b- defN 24-Apr-14 09:42 aiavatar/listeners/azurewakeword.py
+-rw-r--r--  2.0 unx      977 b- defN 24-Apr-14 09:42 aiavatar/listeners/voicerequest.py
+-rw-r--r--  2.0 unx     1078 b- defN 24-Apr-14 09:42 aiavatar/listeners/wakeword.py
+-rw-r--r--  2.0 unx      178 b- defN 24-Apr-14 09:42 aiavatar/processors/__init__.py
+-rw-r--r--  2.0 unx     6162 b- defN 24-Apr-14 09:42 aiavatar/processors/chatgpt.py
+-rw-r--r--  2.0 unx     2550 b- defN 24-Apr-16 15:07 aiavatar/speech/__init__.py
+-rw-r--r--  2.0 unx     1887 b- defN 24-Apr-16 15:34 aiavatar/speech/azurespeech.py
+-rw-r--r--  2.0 unx     3656 b- defN 24-Apr-16 15:07 aiavatar/speech/voicevox.py
+-rw-r--r--  2.0 unx      220 b- defN 24-Apr-16 15:07 aiavatar/speech/soundplayers/__init__.py
+-rw-r--r--  2.0 unx     2319 b- defN 24-Apr-16 15:07 aiavatar/speech/soundplayers/sounddevice_player.py
+-rw-r--r--  2.0 unx    11324 b- defN 24-Apr-16 23:41 aiavatar-0.4.5.dist-info/LICENSE
+-rw-r--r--  2.0 unx    12620 b- defN 24-Apr-16 23:41 aiavatar-0.4.5.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-16 23:41 aiavatar-0.4.5.dist-info/WHEEL
+-rw-r--r--  2.0 unx        9 b- defN 24-Apr-16 23:41 aiavatar-0.4.5.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2196 b- defN 24-Apr-16 23:41 aiavatar-0.4.5.dist-info/RECORD
+26 files, 76467 bytes uncompressed, 25088 bytes compressed:  67.2%
```

## zipnote {}

```diff
@@ -45,26 +45,35 @@
 
 Filename: aiavatar/processors/chatgpt.py
 Comment: 
 
 Filename: aiavatar/speech/__init__.py
 Comment: 
 
+Filename: aiavatar/speech/azurespeech.py
+Comment: 
+
 Filename: aiavatar/speech/voicevox.py
 Comment: 
 
-Filename: aiavatar-0.4.4.dist-info/LICENSE
+Filename: aiavatar/speech/soundplayers/__init__.py
+Comment: 
+
+Filename: aiavatar/speech/soundplayers/sounddevice_player.py
+Comment: 
+
+Filename: aiavatar-0.4.5.dist-info/LICENSE
 Comment: 
 
-Filename: aiavatar-0.4.4.dist-info/METADATA
+Filename: aiavatar-0.4.5.dist-info/METADATA
 Comment: 
 
-Filename: aiavatar-0.4.4.dist-info/WHEEL
+Filename: aiavatar-0.4.5.dist-info/WHEEL
 Comment: 
 
-Filename: aiavatar-0.4.4.dist-info/top_level.txt
+Filename: aiavatar-0.4.5.dist-info/top_level.txt
 Comment: 
 
-Filename: aiavatar-0.4.4.dist-info/RECORD
+Filename: aiavatar-0.4.5.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## aiavatar/speech/__init__.py

```diff
@@ -1,14 +1,87 @@
 from abc import ABC, abstractmethod
+import asyncio
+from logging import getLogger, NullHandler
+import traceback
+from .soundplayers import SoundPlayerBase
+from .soundplayers.sounddevice_player import SoundDevicePlayer
+
 
 class SpeechController(ABC):
     @abstractmethod
     def prefetch(self, text: str):
         pass
 
     @abstractmethod
     async def speak(self, text: str):
         pass
 
     @abstractmethod
     def is_speaking(self) -> bool:
         pass
+
+
+class VoiceClip:
+    def __init__(self, text: str):
+        self.text = text
+        self.download_task = None
+        self.audio_clip = None
+
+
+class SpeechControllerBase(SpeechController):
+    def __init__(self, *, base_url: str, device_index: int=-1, playback_margin: float=0.1, use_subprocess=False, subprocess_timeout: float=0.5, sound_player: SoundPlayerBase=None):
+        self.logger = getLogger(__name__)
+        self.logger.addHandler(NullHandler())
+
+        self.base_url = base_url
+        self.device_index = device_index
+        self.playback_margin = playback_margin
+        self.subprocess_timeout = subprocess_timeout
+        self.use_subprocess = use_subprocess
+
+        if sound_player:
+            self.sound_player = sound_player
+        else:
+            self.sound_player = SoundDevicePlayer(
+                device_index=self.device_index,
+                playback_margin=self.playback_margin,
+                subprocess_timeout=self.subprocess_timeout
+            )
+
+        self.voice_clips = {}
+        self._is_speaking = False
+
+    async def download(self, voice: VoiceClip):
+        raise NotImplementedError("`download` is not implemented")
+
+    def prefetch(self, text: str):
+        v = self.voice_clips.get(text)
+        if v:
+            return v
+
+        v = VoiceClip(text)
+        v.download_task = asyncio.create_task(self.download(v))
+        self.voice_clips[text] = v
+        return v
+
+    async def speak(self, text: str):
+        voice = self.prefetch(text)
+        
+        if not voice.audio_clip:
+            await voice.download_task
+        
+        try:
+            self._is_speaking = True
+
+            if self.use_subprocess:
+                await self.sound_player.play_wave_on_subprocess(voice.audio_clip)
+            else:
+                await self.sound_player.play_wave(voice.audio_clip)
+
+        except Exception as ex:
+            self.logger.error(f"Error at speaking: {str(ex)}\n{traceback.format_exc()}")
+
+        finally:
+            self._is_speaking = False
+
+    def is_speaking(self) -> bool:
+        return self._is_speaking
```

## aiavatar/speech/voicevox.py

```diff
@@ -2,15 +2,17 @@
 import asyncio
 import io
 from logging import getLogger, NullHandler
 import traceback
 import wave
 import numpy
 import sounddevice
-from . import SpeechController
+from . import SpeechController, SpeechControllerBase
+from .soundplayers import SoundPlayerBase
+
 
 class VoiceClip:
     def __init__(self, text: str):
         self.text = text
         self.download_task = None
         self.audio_clip = None
 
@@ -66,7 +68,28 @@
                 self.logger.error(f"Error at speaking: {str(ex)}\n{traceback.format_exc()}")
 
             finally:
                 self._is_speaking = False
 
     def is_speaking(self) -> bool:
         return self._is_speaking
+
+
+class VoicevoxSpeechControllerSubProcess(SpeechControllerBase):
+    def __init__(self, *, base_url: str, speaker_id: int, device_index: int=-1, playback_margin: float=0.1, use_subprocess=True, subprocess_timeout: float=5.0, sound_player: SoundPlayerBase=None):
+        super().__init__(
+            base_url=base_url,
+            device_index=device_index,
+            playback_margin=playback_margin,
+            use_subprocess=use_subprocess,
+            subprocess_timeout=subprocess_timeout,
+            sound_player=sound_player
+        )
+        self.speaker_id = speaker_id
+
+    async def download(self, voice: VoiceClip):
+        params = {"speaker": self.speaker_id, "text": voice.text}
+        async with aiohttp.ClientSession() as session:
+            async with session.post(self.base_url + "/audio_query", params=params) as query_resp:
+                audio_query = await query_resp.json()
+                async with session.post(self.base_url + "/synthesis", params={"speaker": self.speaker_id}, json=audio_query) as audio_resp:
+                    voice.audio_clip = await audio_resp.read()
```

## Comparing `aiavatar-0.4.4.dist-info/LICENSE` & `aiavatar-0.4.5.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `aiavatar-0.4.4.dist-info/METADATA` & `aiavatar-0.4.5.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 Metadata-Version: 2.1
 Name: aiavatar
-Version: 0.4.4
+Version: 0.4.5
 Summary: 🥰 Building AI-based conversational avatars lightning fast ⚡️💬
 Home-page: https://github.com/uezo/aiavatar
 Author: uezo
 Author-email: uezo@uezo.net
 Maintainer: uezo
 Maintainer-email: uezo@uezo.net
 License: Apache v2
 Classifier: Programming Language :: Python :: 3
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: aiohttp (==3.9.3)
-Requires-Dist: numpy (==1.24.3)
-Requires-Dist: openai (==1.12.0)
-Requires-Dist: sounddevice (==0.4.6)
+Requires-Dist: aiohttp ==3.9.3
+Requires-Dist: numpy ==1.24.3
+Requires-Dist: openai ==1.12.0
+Requires-Dist: sounddevice ==0.4.6
 
 # AIAvatarKit
 
 🥰 Building AI-based conversational avatars lightning fast ⚡️💬
 
 ![AIAvatarKit Architecture Overview](documents/images/aiavatarkit_overview.png)
```

## Comparing `aiavatar-0.4.4.dist-info/RECORD` & `aiavatar-0.4.5.dist-info/RECORD`

 * *Files 18% similar despite different names*

```diff
@@ -10,14 +10,17 @@
 aiavatar/listeners/__init__.py,sha256=-dLrr-HV2xdRaVgxv6tkohKSmHe9REKw4sriReRbv1Y,6342
 aiavatar/listeners/azurevoicerequest.py,sha256=7m7xRmkWfTgL8JjFbFOPqZvzydTllAnFipTcM1Ru7nE,2522
 aiavatar/listeners/azurewakeword.py,sha256=Z6cjUUoeXDwVaodg4I5NUNQMY1qVRpJ7Y8_ibQKx_7E,2849
 aiavatar/listeners/voicerequest.py,sha256=cvq9IN_VA0idRzC4UFwkQZ-92IYjll94-ZaijVlLTco,977
 aiavatar/listeners/wakeword.py,sha256=EyG99lS9TKblRs4gni5UwbrfBvrVRfJSOa8QtVHHcO0,1078
 aiavatar/processors/__init__.py,sha256=k6qF1_UopWpaxQ89OxP7-dSVLgnrDCuuZH0Gom0JLLU,178
 aiavatar/processors/chatgpt.py,sha256=CyMpH_Nq-HtM50eFMFmOF7cJezk5x6VOHq9OxeTYFBU,6162
-aiavatar/speech/__init__.py,sha256=yiveD86ikoWYYVnpdi1r_6ou5bXr-SOkmnri6ry_qHI,275
-aiavatar/speech/voicevox.py,sha256=kYKwOMysyrZiTvQQlV30MmzqvuYMQvZZiVHLxDUm_bc,2483
-aiavatar-0.4.4.dist-info/LICENSE,sha256=UOZ1F5fFDe3XXvG4oNnkL1-Ecun7zpHzRxjp-XsMeAo,11324
-aiavatar-0.4.4.dist-info/METADATA,sha256=nFwqShdinmio0LE7lzRAhzhfF97zCCCgmPaw681lqM4,12628
-aiavatar-0.4.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-aiavatar-0.4.4.dist-info/top_level.txt,sha256=B14WVaakM_kKuOkCeI-WRP83BJ6APkOyQrn6EXxs8kg,9
-aiavatar-0.4.4.dist-info/RECORD,,
+aiavatar/speech/__init__.py,sha256=u013ElPBHqQ1wrh6UUxV80QyNz57BDai7IuXwU1CKcU,2550
+aiavatar/speech/azurespeech.py,sha256=P8lnUMj4j8BRnasxCxCb-xkkFA13BvHUG03aZ04RXNU,1887
+aiavatar/speech/voicevox.py,sha256=5_TIqJyymEyqG8awR5I_Tg0iq0eWwVqYW4FsFM2f75M,3656
+aiavatar/speech/soundplayers/__init__.py,sha256=71xYi-8qaInz_Um8wV5zDaHpAB5sTJG9osn17aQAUKQ,220
+aiavatar/speech/soundplayers/sounddevice_player.py,sha256=sppGR11l7ENsDE3qQ_spo7RnVj6D3tLEK350dt8JhVs,2319
+aiavatar-0.4.5.dist-info/LICENSE,sha256=UOZ1F5fFDe3XXvG4oNnkL1-Ecun7zpHzRxjp-XsMeAo,11324
+aiavatar-0.4.5.dist-info/METADATA,sha256=4RPq83eYzVkfcwefj9bCj6ggWNwLT2122I8sHfNs_tk,12620
+aiavatar-0.4.5.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+aiavatar-0.4.5.dist-info/top_level.txt,sha256=B14WVaakM_kKuOkCeI-WRP83BJ6APkOyQrn6EXxs8kg,9
+aiavatar-0.4.5.dist-info/RECORD,,
```

