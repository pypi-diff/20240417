# Comparing `tmp/NEMO_billing-2.8.1-py3-none-any.whl.zip` & `tmp/NEMO_billing-2.9.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,156 +1,156 @@
-Zip file size: 204350 bytes, number of entries: 154
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/__init__.py
--rw-r--r--  2.0 unx    14452 b- defN 24-Mar-22 04:01 NEMO_billing/admin.py
--rw-r--r--  2.0 unx     2638 b- defN 24-Mar-22 04:01 NEMO_billing/api.py
--rw-r--r--  2.0 unx      285 b- defN 24-Mar-22 04:01 NEMO_billing/app_settings.py
--rw-r--r--  2.0 unx      426 b- defN 24-Mar-22 04:01 NEMO_billing/apps.py
--rw-r--r--  2.0 unx      122 b- defN 24-Mar-22 04:01 NEMO_billing/exceptions.py
--rw-r--r--  2.0 unx     5784 b- defN 24-Mar-22 04:01 NEMO_billing/models.py
--rw-r--r--  2.0 unx     1443 b- defN 24-Mar-22 04:01 NEMO_billing/urls.py
--rw-r--r--  2.0 unx     3257 b- defN 24-Mar-22 04:01 NEMO_billing/utilities.py
--rw-r--r--  2.0 unx     6371 b- defN 24-Mar-22 04:01 NEMO_billing/views.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/__init__.py
--rw-r--r--  2.0 unx     5622 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/admin.py
--rw-r--r--  2.0 unx      102 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/app_settings.py
--rw-r--r--  2.0 unx      444 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/apps.py
--rw-r--r--  2.0 unx     2991 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/customization.py
--rw-r--r--  2.0 unx      892 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/exceptions.py
--rw-r--r--  2.0 unx    19861 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/models.py
--rw-r--r--  2.0 unx    22141 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/processors.py
--rw-r--r--  2.0 unx      690 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/urls.py
--rw-r--r--  2.0 unx     4306 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/views.py
--rw-rw-rw-  2.0 unx     7568 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/0001_initial.py
--rw-rw-rw-  2.0 unx     1665 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py
--rw-rw-rw-  2.0 unx     4815 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py
--rw-rw-rw-  2.0 unx     3163 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py
--rw-rw-rw-  2.0 unx     3653 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/0005_cap_multi_core_facilities.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/migrations/__init__.py
--rw-rw-rw-  2.0 unx     2383 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html
--rw-rw-rw-  2.0 unx     1772 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html
--rw-rw-rw-  2.0 unx     4097 b- defN 24-Mar-22 04:01 NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/__init__.py
--rw-r--r--  2.0 unx    11133 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/admin.py
--rw-r--r--  2.0 unx    10414 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/api.py
--rw-r--r--  2.0 unx      176 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/app_settings.py
--rw-r--r--  2.0 unx      445 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/apps.py
--rw-r--r--  2.0 unx     4496 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/customization.py
--rw-r--r--  2.0 unx     2642 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/exceptions.py
--rw-r--r--  2.0 unx    24267 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/models.py
--rw-r--r--  2.0 unx    12477 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/pdf_utilities.py
--rw-r--r--  2.0 unx    30308 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/processors.py
--rw-r--r--  2.0 unx    26513 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/renderers.py
--rw-r--r--  2.0 unx     3489 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/urls.py
--rw-r--r--  2.0 unx     4293 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/utilities.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/management/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/management/commands/__init__.py
--rw-r--r--  2.0 unx      298 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py
--rw-r--r--  2.0 unx      318 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py
--rw-rw-rw-  2.0 unx     9795 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0001_initial.py
--rw-rw-rw-  2.0 unx     2794 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0002_version_1_2_0.py
--rw-rw-rw-  2.0 unx     1063 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0003_version_1_4_0.py
--rw-rw-rw-  2.0 unx      467 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0004_version_1_6_0.py
--rw-rw-rw-  2.0 unx      485 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0005_version_1_6_1.py
--rw-rw-rw-  2.0 unx      518 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0006_version_1_7_1.py
--rw-rw-rw-  2.0 unx      458 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0007_version_1_8_0.py
--rw-rw-rw-  2.0 unx      437 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0008_version_1_10_0.py
--rw-rw-rw-  2.0 unx     1183 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0009_version_1_23_0.py
--rw-rw-rw-  2.0 unx      439 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0010_version_2_0_0.py
--rw-rw-rw-  2.0 unx     1280 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/0011_version_2_4_0.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/migrations/__init__.py
--rw-rw-rw-  2.0 unx     1072 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/static/invoices/invoices.css
--rw-rw-rw-  2.0 unx     5770 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/customizations/customizations_billing.html
--rw-rw-rw-  2.0 unx     8934 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/customizations/customizations_invoices.html
--rw-rw-rw-  2.0 unx      212 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/base.html
--rw-rw-rw-  2.0 unx    14099 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/invoice.html
--rw-rw-rw-  2.0 unx     3375 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/invoice_details.html
--rw-rw-rw-  2.0 unx    13185 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/invoices.html
--rw-rw-rw-  2.0 unx    16199 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/usage.html
--rw-rw-rw-  2.0 unx     2024 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html
--rw-rw-rw-  2.0 unx      302 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt
--rw-rw-rw-  2.0 unx     1330 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html
--rw-rw-rw-  2.0 unx     1344 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html
--rw-rw-rw-  2.0 unx      155 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt
--rw-rw-rw-  2.0 unx      155 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt
--rw-rw-rw-  2.0 unx    15409 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/project/edit_project.html
--rw-rw-rw-  2.0 unx     3668 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/views/__init__.py
--rw-r--r--  2.0 unx    20161 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/views/invoices.py
--rw-r--r--  2.0 unx     7175 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/views/project.py
--rw-r--r--  2.0 unx    11483 b- defN 24-Mar-22 04:01 NEMO_billing/invoices/views/usage.py
--rw-rw-rw-  2.0 unx     3156 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/0001_initial.py
--rw-rw-rw-  2.0 unx      573 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/0002_version_1_2_0.py
--rw-rw-rw-  2.0 unx      466 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/0003_version_2_0_0.py
--rw-rw-rw-  2.0 unx     7722 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/0004_version_2_4_0.py
--rw-rw-rw-  2.0 unx      351 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/0005_version_2_5_6.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/migrations/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/__init__.py
--rw-r--r--  2.0 unx     3045 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/admin.py
--rw-r--r--  2.0 unx     1680 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/api.py
--rw-r--r--  2.0 unx       71 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/app_settings.py
--rw-r--r--  2.0 unx      559 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/apps.py
--rw-r--r--  2.0 unx     1876 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/exceptions.py
--rw-r--r--  2.0 unx    18892 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/models.py
--rw-r--r--  2.0 unx     5492 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/policy.py
--rw-r--r--  2.0 unx      650 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/urls.py
--rw-rw-rw-  2.0 unx     4314 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/migrations/0001_initial.py
--rw-rw-rw-  2.0 unx      584 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/migrations/0002_projectprepaymentdetail_overdraft_amount_allowed.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/migrations/__init__.py
--rw-rw-rw-  2.0 unx     1021 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/templates/prepayments/prepaid_project_status.html
--rw-rw-rw-  2.0 unx     4344 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/templates/prepayments/prepaid_project_status_table.html
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/views/__init__.py
--rw-r--r--  2.0 unx     4716 b- defN 24-Mar-22 04:01 NEMO_billing/prepayments/views/prepayments.py
--rw-r--r--  2.0 unx        1 b- defN 24-Mar-22 04:01 NEMO_billing/rates/__init__.py
--rw-r--r--  2.0 unx     8271 b- defN 24-Mar-22 04:01 NEMO_billing/rates/admin.py
--rw-r--r--  2.0 unx     2318 b- defN 24-Mar-22 04:01 NEMO_billing/rates/api.py
--rw-r--r--  2.0 unx      151 b- defN 24-Mar-22 04:01 NEMO_billing/rates/app_settings.py
--rw-r--r--  2.0 unx      715 b- defN 24-Mar-22 04:01 NEMO_billing/rates/apps.py
--rw-r--r--  2.0 unx     2768 b- defN 24-Mar-22 04:01 NEMO_billing/rates/customization.py
--rw-r--r--  2.0 unx     1913 b- defN 24-Mar-22 04:01 NEMO_billing/rates/model_diff.py
--rw-r--r--  2.0 unx    22906 b- defN 24-Mar-22 04:01 NEMO_billing/rates/models.py
--rw-r--r--  2.0 unx     5504 b- defN 24-Mar-22 04:01 NEMO_billing/rates/rates_class.py
--rw-r--r--  2.0 unx     1115 b- defN 24-Mar-22 04:01 NEMO_billing/rates/urls.py
--rw-r--r--  2.0 unx    22155 b- defN 24-Mar-22 04:01 NEMO_billing/rates/views.py
--rw-rw-rw-  2.0 unx     5101 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/0001_initial.py
--rw-rw-rw-  2.0 unx      602 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/0002_version_1_15_0.py
--rw-rw-rw-  2.0 unx     1999 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/0003_version_1_17_0.py
--rw-rw-rw-  2.0 unx      421 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/0004_version_2_0_0.py
--rw-rw-rw-  2.0 unx      448 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/0005_version_2_3_0.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/rates/migrations/__init__.py
--rw-rw-rw-  2.0 unx       81 b- defN 24-Mar-22 04:01 NEMO_billing/rates/static/rates/rates.css
--rw-rw-rw-  2.0 unx     7476 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/customizations/customizations_billing_rates.html
--rw-rw-rw-  2.0 unx      160 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/rates/base.html
--rw-rw-rw-  2.0 unx     6047 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/rates/rate.html
--rw-rw-rw-  2.0 unx     5591 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/rates/rate_form_details.html
--rw-rw-rw-  2.0 unx     5339 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/rates/rate_list.html
--rw-rw-rw-  2.0 unx     4602 b- defN 24-Mar-22 04:01 NEMO_billing/rates/templates/rates/rates.html
--rw-rw-rw-  2.0 unx      192 b- defN 24-Mar-22 04:01 NEMO_billing/templates/base/navbar.html
--rw-rw-rw-  2.0 unx     1179 b- defN 24-Mar-22 04:01 NEMO_billing/templates/base/navbar_billing.html
--rw-rw-rw-  2.0 unx     1162 b- defN 24-Mar-22 04:01 NEMO_billing/templates/billing/cap_and_prepaid_base.html
--rw-rw-rw-  2.0 unx     8882 b- defN 24-Mar-22 04:01 NEMO_billing/templates/billing/custom_charge.html
--rw-rw-rw-  2.0 unx     2074 b- defN 24-Mar-22 04:01 NEMO_billing/templates/billing/custom_charges.html
--rw-rw-rw-  2.0 unx     1368 b- defN 24-Mar-22 04:01 NEMO_billing/templates/staff_charges/choose_project.html
--rw-rw-rw-  2.0 unx     1979 b- defN 24-Mar-22 04:01 NEMO_billing/templates/staff_charges/new_custom_staff_charge.html
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/templatetags/__init__.py
--rw-r--r--  2.0 unx     1014 b- defN 24-Mar-22 04:01 NEMO_billing/templatetags/billing_tags.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/tests/__init__.py
--rw-r--r--  2.0 unx     2653 b- defN 24-Mar-22 04:01 NEMO_billing/tests/test_project_expiration.py
--rw-r--r--  2.0 unx     3079 b- defN 24-Mar-22 04:01 NEMO_billing/tests/test_settings.py
--rw-r--r--  2.0 unx     1472 b- defN 24-Mar-22 04:01 NEMO_billing/tests/test_urls.py
--rw-r--r--  2.0 unx     1094 b- defN 24-Mar-22 04:01 NEMO_billing/tests/test_utilities.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/tests/cap/__init__.py
--rw-r--r--  2.0 unx    20368 b- defN 24-Mar-22 04:01 NEMO_billing/tests/cap/test_cap_discount.py
--rw-r--r--  2.0 unx    32818 b- defN 24-Mar-22 04:01 NEMO_billing/tests/cap/test_cap_invoicing.py
--rw-r--r--  2.0 unx     4271 b- defN 24-Mar-22 04:01 NEMO_billing/tests/cap/test_cap_utilities.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/tests/prepayments/__init__.py
--rw-r--r--  2.0 unx    16024 b- defN 24-Mar-22 04:01 NEMO_billing/tests/prepayments/test_prepayments.py
--rw-r--r--  2.0 unx        0 b- defN 24-Mar-22 04:01 NEMO_billing/tests/rates/__init__.py
--rw-r--r--  2.0 unx    33260 b- defN 24-Mar-22 04:01 NEMO_billing/tests/rates/test_rate_amount.py
--rw-r--r--  2.0 unx    20895 b- defN 24-Mar-22 04:01 NEMO_billing/tests/rates/test_rate_time.py
--rw-r--r--  2.0 unx     6164 b- defN 24-Mar-22 04:01 NEMO_billing/tests/rates/test_rate_uniqueness.py
--rw-r--r--  2.0 unx    27008 b- defN 24-Mar-22 04:01 NEMO_billing/tests/rates/test_split_billables.py
--rw-rw-rw-  2.0 unx     1074 b- defN 24-Mar-22 04:01 NEMO_billing-2.8.1.dist-info/LICENSE
--rw-r--r--  2.0 unx     6097 b- defN 24-Mar-22 04:01 NEMO_billing-2.8.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Mar-22 04:01 NEMO_billing-2.8.1.dist-info/WHEEL
--rw-r--r--  2.0 unx       13 b- defN 24-Mar-22 04:01 NEMO_billing-2.8.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    15684 b- defN 24-Mar-22 04:01 NEMO_billing-2.8.1.dist-info/RECORD
-154 files, 772295 bytes uncompressed, 178554 bytes compressed:  76.9%
+Zip file size: 207638 bytes, number of entries: 154
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/__init__.py
+-rw-r--r--  2.0 unx    14452 b- defN 24-Apr-17 18:46 NEMO_billing/admin.py
+-rw-r--r--  2.0 unx     2638 b- defN 24-Apr-17 18:46 NEMO_billing/api.py
+-rw-r--r--  2.0 unx      285 b- defN 24-Apr-17 18:46 NEMO_billing/app_settings.py
+-rw-r--r--  2.0 unx      426 b- defN 24-Apr-17 18:46 NEMO_billing/apps.py
+-rw-r--r--  2.0 unx      126 b- defN 24-Apr-17 18:46 NEMO_billing/exceptions.py
+-rw-r--r--  2.0 unx     5786 b- defN 24-Apr-17 18:46 NEMO_billing/models.py
+-rw-r--r--  2.0 unx     1443 b- defN 24-Apr-17 18:46 NEMO_billing/urls.py
+-rw-r--r--  2.0 unx     3313 b- defN 24-Apr-17 18:46 NEMO_billing/utilities.py
+-rw-r--r--  2.0 unx     6371 b- defN 24-Apr-17 18:46 NEMO_billing/views.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/__init__.py
+-rw-r--r--  2.0 unx     5622 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/admin.py
+-rw-r--r--  2.0 unx      102 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/app_settings.py
+-rw-r--r--  2.0 unx      444 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/apps.py
+-rw-r--r--  2.0 unx     2991 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/customization.py
+-rw-r--r--  2.0 unx      892 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/exceptions.py
+-rw-r--r--  2.0 unx    19861 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/models.py
+-rw-r--r--  2.0 unx    22141 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/processors.py
+-rw-r--r--  2.0 unx      721 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/urls.py
+-rw-r--r--  2.0 unx     4306 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/views.py
+-rw-rw-rw-  2.0 unx    13797 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/0001_initial.py
+-rw-rw-rw-  2.0 unx     1900 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py
+-rw-rw-rw-  2.0 unx     6220 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py
+-rw-rw-rw-  2.0 unx     3185 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py
+-rw-rw-rw-  2.0 unx     3977 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/0005_cap_multi_core_facilities.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     2945 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html
+-rw-rw-rw-  2.0 unx     2071 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html
+-rw-rw-rw-  2.0 unx     5086 b- defN 24-Apr-17 18:46 NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/__init__.py
+-rw-r--r--  2.0 unx    11133 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/admin.py
+-rw-r--r--  2.0 unx    10414 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/api.py
+-rw-r--r--  2.0 unx      176 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/app_settings.py
+-rw-r--r--  2.0 unx      445 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/apps.py
+-rw-r--r--  2.0 unx     4496 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/customization.py
+-rw-r--r--  2.0 unx     2642 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/exceptions.py
+-rw-r--r--  2.0 unx    24296 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/models.py
+-rw-r--r--  2.0 unx    12477 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/pdf_utilities.py
+-rw-r--r--  2.0 unx    30284 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/processors.py
+-rw-r--r--  2.0 unx    26585 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/renderers.py
+-rw-r--r--  2.0 unx     3791 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/urls.py
+-rw-r--r--  2.0 unx     4277 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/management/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/management/commands/__init__.py
+-rw-r--r--  2.0 unx      298 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py
+-rw-r--r--  2.0 unx      318 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py
+-rw-rw-rw-  2.0 unx    13593 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0001_initial.py
+-rw-rw-rw-  2.0 unx     3431 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0002_version_1_2_0.py
+-rw-rw-rw-  2.0 unx     1123 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0003_version_1_4_0.py
+-rw-rw-rw-  2.0 unx      466 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0004_version_1_6_0.py
+-rw-rw-rw-  2.0 unx      485 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0005_version_1_6_1.py
+-rw-rw-rw-  2.0 unx      598 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0006_version_1_7_1.py
+-rw-rw-rw-  2.0 unx      458 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0007_version_1_8_0.py
+-rw-rw-rw-  2.0 unx      437 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0008_version_1_10_0.py
+-rw-rw-rw-  2.0 unx     1213 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0009_version_1_23_0.py
+-rw-rw-rw-  2.0 unx      439 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0010_version_2_0_0.py
+-rw-rw-rw-  2.0 unx     1565 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/0011_version_2_4_0.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     1072 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/static/invoices/invoices.css
+-rw-rw-rw-  2.0 unx     6615 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/customizations/customizations_billing.html
+-rw-rw-rw-  2.0 unx    11457 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/customizations/customizations_invoices.html
+-rw-rw-rw-  2.0 unx      222 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/base.html
+-rw-rw-rw-  2.0 unx    20434 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/invoice.html
+-rw-rw-rw-  2.0 unx     4715 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/invoice_details.html
+-rw-rw-rw-  2.0 unx    17965 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/invoices.html
+-rw-rw-rw-  2.0 unx    26762 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/usage.html
+-rw-rw-rw-  2.0 unx     2531 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html
+-rw-rw-rw-  2.0 unx      302 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt
+-rw-rw-rw-  2.0 unx     1804 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html
+-rw-rw-rw-  2.0 unx     1818 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html
+-rw-rw-rw-  2.0 unx      155 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt
+-rw-rw-rw-  2.0 unx      155 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt
+-rw-rw-rw-  2.0 unx    21260 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/project/edit_project.html
+-rw-rw-rw-  2.0 unx     4728 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/views/__init__.py
+-rw-r--r--  2.0 unx    20163 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/views/invoices.py
+-rw-r--r--  2.0 unx     7175 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/views/project.py
+-rw-r--r--  2.0 unx    11589 b- defN 24-Apr-17 18:46 NEMO_billing/invoices/views/usage.py
+-rw-rw-rw-  2.0 unx     4768 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/0001_initial.py
+-rw-rw-rw-  2.0 unx      668 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/0002_version_1_2_0.py
+-rw-rw-rw-  2.0 unx      466 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/0003_version_2_0_0.py
+-rw-rw-rw-  2.0 unx    15298 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/0004_version_2_4_0.py
+-rw-rw-rw-  2.0 unx      351 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/0005_version_2_5_6.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/migrations/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/__init__.py
+-rw-r--r--  2.0 unx     3045 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/admin.py
+-rw-r--r--  2.0 unx     1680 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/api.py
+-rw-r--r--  2.0 unx       71 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/app_settings.py
+-rw-r--r--  2.0 unx      559 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/apps.py
+-rw-r--r--  2.0 unx     1876 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/exceptions.py
+-rw-r--r--  2.0 unx    18892 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/models.py
+-rw-r--r--  2.0 unx     5493 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/policy.py
+-rw-r--r--  2.0 unx      650 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/urls.py
+-rw-rw-rw-  2.0 unx     7016 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/migrations/0001_initial.py
+-rw-rw-rw-  2.0 unx      647 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/migrations/0002_projectprepaymentdetail_overdraft_amount_allowed.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     1153 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/templates/prepayments/prepaid_project_status.html
+-rw-rw-rw-  2.0 unx     6399 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/templates/prepayments/prepaid_project_status_table.html
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/views/__init__.py
+-rw-r--r--  2.0 unx     4716 b- defN 24-Apr-17 18:46 NEMO_billing/prepayments/views/prepayments.py
+-rw-r--r--  2.0 unx        1 b- defN 24-Apr-17 18:46 NEMO_billing/rates/__init__.py
+-rw-r--r--  2.0 unx     8271 b- defN 24-Apr-17 18:46 NEMO_billing/rates/admin.py
+-rw-r--r--  2.0 unx     2318 b- defN 24-Apr-17 18:46 NEMO_billing/rates/api.py
+-rw-r--r--  2.0 unx      151 b- defN 24-Apr-17 18:46 NEMO_billing/rates/app_settings.py
+-rw-r--r--  2.0 unx      716 b- defN 24-Apr-17 18:46 NEMO_billing/rates/apps.py
+-rw-r--r--  2.0 unx     2768 b- defN 24-Apr-17 18:46 NEMO_billing/rates/customization.py
+-rw-r--r--  2.0 unx     1913 b- defN 24-Apr-17 18:46 NEMO_billing/rates/model_diff.py
+-rw-r--r--  2.0 unx    22858 b- defN 24-Apr-17 18:46 NEMO_billing/rates/models.py
+-rw-r--r--  2.0 unx     5504 b- defN 24-Apr-17 18:46 NEMO_billing/rates/rates_class.py
+-rw-r--r--  2.0 unx     1115 b- defN 24-Apr-17 18:46 NEMO_billing/rates/urls.py
+-rw-r--r--  2.0 unx    22155 b- defN 24-Apr-17 18:46 NEMO_billing/rates/views.py
+-rw-rw-rw-  2.0 unx     6958 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/0001_initial.py
+-rw-rw-rw-  2.0 unx      624 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/0002_version_1_15_0.py
+-rw-rw-rw-  2.0 unx     2382 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/0003_version_1_17_0.py
+-rw-rw-rw-  2.0 unx      421 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/0004_version_2_0_0.py
+-rw-rw-rw-  2.0 unx      478 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/0005_version_2_3_0.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/rates/migrations/__init__.py
+-rw-rw-rw-  2.0 unx       81 b- defN 24-Apr-17 18:46 NEMO_billing/rates/static/rates/rates.css
+-rw-rw-rw-  2.0 unx    10562 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/customizations/customizations_billing_rates.html
+-rw-rw-rw-  2.0 unx      169 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/rates/base.html
+-rw-rw-rw-  2.0 unx     7358 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/rates/rate.html
+-rw-rw-rw-  2.0 unx     8244 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/rates/rate_form_details.html
+-rw-rw-rw-  2.0 unx     7440 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/rates/rate_list.html
+-rw-rw-rw-  2.0 unx     5731 b- defN 24-Apr-17 18:46 NEMO_billing/rates/templates/rates/rates.html
+-rw-rw-rw-  2.0 unx      198 b- defN 24-Apr-17 18:46 NEMO_billing/templates/base/navbar.html
+-rw-rw-rw-  2.0 unx     1218 b- defN 24-Apr-17 18:46 NEMO_billing/templates/base/navbar_billing.html
+-rw-rw-rw-  2.0 unx     1345 b- defN 24-Apr-17 18:46 NEMO_billing/templates/billing/cap_and_prepaid_base.html
+-rw-rw-rw-  2.0 unx    12303 b- defN 24-Apr-17 18:46 NEMO_billing/templates/billing/custom_charge.html
+-rw-rw-rw-  2.0 unx     2467 b- defN 24-Apr-17 18:46 NEMO_billing/templates/billing/custom_charges.html
+-rw-rw-rw-  2.0 unx     1825 b- defN 24-Apr-17 18:46 NEMO_billing/templates/staff_charges/choose_project.html
+-rw-rw-rw-  2.0 unx     2492 b- defN 24-Apr-17 18:46 NEMO_billing/templates/staff_charges/new_custom_staff_charge.html
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/templatetags/__init__.py
+-rw-r--r--  2.0 unx     1014 b- defN 24-Apr-17 18:46 NEMO_billing/templatetags/billing_tags.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/tests/__init__.py
+-rw-r--r--  2.0 unx     2653 b- defN 24-Apr-17 18:46 NEMO_billing/tests/test_project_expiration.py
+-rw-r--r--  2.0 unx     3085 b- defN 24-Apr-17 18:46 NEMO_billing/tests/test_settings.py
+-rw-r--r--  2.0 unx     1475 b- defN 24-Apr-17 18:46 NEMO_billing/tests/test_urls.py
+-rw-r--r--  2.0 unx     1094 b- defN 24-Apr-17 18:46 NEMO_billing/tests/test_utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/tests/cap/__init__.py
+-rw-r--r--  2.0 unx    20368 b- defN 24-Apr-17 18:46 NEMO_billing/tests/cap/test_cap_discount.py
+-rw-r--r--  2.0 unx    32818 b- defN 24-Apr-17 18:46 NEMO_billing/tests/cap/test_cap_invoicing.py
+-rw-r--r--  2.0 unx     4293 b- defN 24-Apr-17 18:46 NEMO_billing/tests/cap/test_cap_utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/tests/prepayments/__init__.py
+-rw-r--r--  2.0 unx    16024 b- defN 24-Apr-17 18:46 NEMO_billing/tests/prepayments/test_prepayments.py
+-rw-r--r--  2.0 unx        0 b- defN 24-Apr-17 18:46 NEMO_billing/tests/rates/__init__.py
+-rw-r--r--  2.0 unx    33260 b- defN 24-Apr-17 18:46 NEMO_billing/tests/rates/test_rate_amount.py
+-rw-r--r--  2.0 unx    20895 b- defN 24-Apr-17 18:46 NEMO_billing/tests/rates/test_rate_time.py
+-rw-r--r--  2.0 unx     6164 b- defN 24-Apr-17 18:46 NEMO_billing/tests/rates/test_rate_uniqueness.py
+-rw-r--r--  2.0 unx    27008 b- defN 24-Apr-17 18:46 NEMO_billing/tests/rates/test_split_billables.py
+-rw-rw-rw-  2.0 unx     1074 b- defN 24-Apr-17 18:47 NEMO_billing-2.9.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     6140 b- defN 24-Apr-17 18:47 NEMO_billing-2.9.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-17 18:47 NEMO_billing-2.9.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       13 b- defN 24-Apr-17 18:47 NEMO_billing-2.9.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    15690 b- defN 24-Apr-17 18:47 NEMO_billing-2.9.0.dist-info/RECORD
+154 files, 854437 bytes uncompressed, 181842 bytes compressed:  78.7%
```

## zipnote {}

```diff
@@ -441,23 +441,23 @@
 
 Filename: NEMO_billing/tests/rates/test_rate_uniqueness.py
 Comment: 
 
 Filename: NEMO_billing/tests/rates/test_split_billables.py
 Comment: 
 
-Filename: NEMO_billing-2.8.1.dist-info/LICENSE
+Filename: NEMO_billing-2.9.0.dist-info/LICENSE
 Comment: 
 
-Filename: NEMO_billing-2.8.1.dist-info/METADATA
+Filename: NEMO_billing-2.9.0.dist-info/METADATA
 Comment: 
 
-Filename: NEMO_billing-2.8.1.dist-info/WHEEL
+Filename: NEMO_billing-2.9.0.dist-info/WHEEL
 Comment: 
 
-Filename: NEMO_billing-2.8.1.dist-info/top_level.txt
+Filename: NEMO_billing-2.9.0.dist-info/top_level.txt
 Comment: 
 
-Filename: NEMO_billing-2.8.1.dist-info/RECORD
+Filename: NEMO_billing-2.9.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## NEMO_billing/exceptions.py

```diff
@@ -1,6 +1,6 @@
 from NEMO.exceptions import NEMOException
 
 
 # General billing exception class
 class BillingException(NEMOException):
-	pass
+    pass
```

## NEMO_billing/models.py

```diff
@@ -93,17 +93,17 @@
                         charge_types__contains=BillableItemType.CUSTOM_CHARGE.value,
                     )
                     if self.core_facility:
                         cap_filter = cap_filter.filter(core_facilities__in=[self.core_facility])
                     else:
                         cap_filter = cap_filter.filter(core_facilities__isnull=True)
                     if not cap_filter.exists():
-                        errors[
-                            "cap_eligible"
-                        ] = f"No CAP configuration accepting Custom charges exists for this rate category ({rate_category})"
+                        errors["cap_eligible"] = (
+                            f"No CAP configuration accepting Custom charges exists for this rate category ({rate_category})"
+                        )
         if errors:
             raise ValidationError(errors)
 
     def __str__(self):
         return self.name
```

## NEMO_billing/utilities.py

```diff
@@ -62,24 +62,32 @@
     if field_name in form.fields:
         disable_form_field(form, field_name)
         form.fields[field_name].widget = HiddenInput()
 
 
 # Utility functions to compare dates that are stored in month/year format
 def filter_date_year_month_gte(field_name: str, date_to_compare: datetime.date) -> Q:
-    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gte": date_to_compare.month})
+    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(
+        **{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gte": date_to_compare.month}
+    )
 
 
 def filter_date_year_month_gt(field_name: str, date_to_compare: datetime.date) -> Q:
-    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gt": date_to_compare.month})
+    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(
+        **{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gt": date_to_compare.month}
+    )
 
 
 def filter_date_year_month_lt(field_name: str, date_to_compare: datetime.date) -> Q:
-    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lt": date_to_compare.month})
+    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(
+        **{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lt": date_to_compare.month}
+    )
 
 
 def filter_date_year_month_lte(field_name: str, date_to_compare: datetime.date) -> Q:
-    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lte": date_to_compare.month})
+    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(
+        **{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lte": date_to_compare.month}
+    )
 
 
 def number_of_months_between_dates(end_date, start_date):
     return (end_date.year - start_date.year) * 12 + end_date.month - start_date.month
```

## NEMO_billing/cap_discount/urls.py

```diff
@@ -7,9 +7,13 @@
     path("usage_cap_discounts_user/<int:user_id>/", views.usage_cap_discounts_user, name="usage_cap_discounts_user"),
     path(
         "usage_cap_discounts_account/<int:account_id>/",
         views.usage_cap_discounts_account,
         name="usage_cap_discounts_account",
     ),
     path("cap_discount_status/", views.cap_discount_status, name="cap_discount_status"),
-    path("cap_discount_status/configuration/<int:configuration_id>/", views.cap_discount_status, name="cap_discount_status_configuration"),
+    path(
+        "cap_discount_status/configuration/<int:configuration_id>/",
+        views.cap_discount_status,
+        name="cap_discount_status_configuration",
+    ),
 ]
```

## NEMO_billing/cap_discount/migrations/0001_initial.py

```diff
@@ -9,75 +9,337 @@
 
 
 class Migration(migrations.Migration):
 
     initial = True
 
     dependencies = [
-        ('NEMO_billing', '0002_version_1_2_0'),
-        ('rates', '0003_version_1_17_0'),
+        ("NEMO_billing", "0002_version_1_2_0"),
+        ("rates", "0003_version_1_17_0"),
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('NEMO', '0042_version_4_3_0'),
+        ("NEMO", "0042_version_4_3_0"),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='CAPDiscountConfiguration',
+            name="CAPDiscountConfiguration",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('amount', models.DecimalField(decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)])),
-                ('discount', models.DecimalField(decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)])),
-                ('charge_types', models.CharField(help_text='List of charge type this CAP applies to', max_length=100, validators=[django.core.validators.RegexValidator(re.compile('^\\d+(?:,\\d+)*\\Z'), code='invalid', message='Enter only digits separated by commas.')])),
-                ('start_on_first_charge', models.BooleanField(default=True, help_text='Automatically set CAP start date to the month of the first eligible charge')),
-                ('start_month', models.PositiveIntegerField(blank=True, choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')], help_text='Start month of the CAP discount', null=True)),
-                ('start_year', models.PositiveIntegerField(blank=True, help_text='Start year of the CAP discount', null=True, validators=[django.core.validators.MinValueValidator(1900), django.core.validators.MaxValueValidator(9999)])),
-                ('reset_interval', models.PositiveIntegerField(default=1, help_text='Recurring interval, i.e. every 5 days.', validators=[django.core.validators.MinValueValidator(1)])),
-                ('reset_frequency', models.PositiveIntegerField(choices=[(5, 'Month(s)'), (6, 'Year(s)')], help_text='The CAP reset frequency.')),
-                ('core_facility', models.ForeignKey(blank=True, help_text='The core facility this CAP applies to', null=True, on_delete=django.db.models.deletion.CASCADE, to='NEMO_billing.corefacility')),
-                ('rate_category', models.ForeignKey(help_text='The rate category this CAP applies to', on_delete=django.db.models.deletion.CASCADE, to='rates.ratecategory')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "amount",
+                    models.DecimalField(
+                        decimal_places=2,
+                        help_text="Amount after which the discount will be applied",
+                        max_digits=14,
+                        validators=[django.core.validators.MinValueValidator(1)],
+                    ),
+                ),
+                (
+                    "discount",
+                    models.DecimalField(
+                        decimal_places=3,
+                        help_text="Discount in percent. Ex 20.5%",
+                        max_digits=6,
+                        validators=[
+                            django.core.validators.MinValueValidator(1),
+                            django.core.validators.MaxValueValidator(100),
+                        ],
+                    ),
+                ),
+                (
+                    "charge_types",
+                    models.CharField(
+                        help_text="List of charge type this CAP applies to",
+                        max_length=100,
+                        validators=[
+                            django.core.validators.RegexValidator(
+                                re.compile("^\\d+(?:,\\d+)*\\Z"),
+                                code="invalid",
+                                message="Enter only digits separated by commas.",
+                            )
+                        ],
+                    ),
+                ),
+                (
+                    "start_on_first_charge",
+                    models.BooleanField(
+                        default=True,
+                        help_text="Automatically set CAP start date to the month of the first eligible charge",
+                    ),
+                ),
+                (
+                    "start_month",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ],
+                        help_text="Start month of the CAP discount",
+                        null=True,
+                    ),
+                ),
+                (
+                    "start_year",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        help_text="Start year of the CAP discount",
+                        null=True,
+                        validators=[
+                            django.core.validators.MinValueValidator(1900),
+                            django.core.validators.MaxValueValidator(9999),
+                        ],
+                    ),
+                ),
+                (
+                    "reset_interval",
+                    models.PositiveIntegerField(
+                        default=1,
+                        help_text="Recurring interval, i.e. every 5 days.",
+                        validators=[django.core.validators.MinValueValidator(1)],
+                    ),
+                ),
+                (
+                    "reset_frequency",
+                    models.PositiveIntegerField(
+                        choices=[(5, "Month(s)"), (6, "Year(s)")], help_text="The CAP reset frequency."
+                    ),
+                ),
+                (
+                    "core_facility",
+                    models.ForeignKey(
+                        blank=True,
+                        help_text="The core facility this CAP applies to",
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="NEMO_billing.corefacility",
+                    ),
+                ),
+                (
+                    "rate_category",
+                    models.ForeignKey(
+                        help_text="The rate category this CAP applies to",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="rates.ratecategory",
+                    ),
+                ),
             ],
         ),
         migrations.CreateModel(
-            name='CAPDiscount',
+            name="CAPDiscount",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('amount', models.DecimalField(decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)])),
-                ('discount', models.DecimalField(decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)])),
-                ('charge_types', models.CharField(help_text='List of charge type this CAP applies to', max_length=100, validators=[django.core.validators.RegexValidator(re.compile('^\\d+(?:,\\d+)*\\Z'), code='invalid', message='Enter only digits separated by commas.')])),
-                ('start_month', models.PositiveIntegerField(blank=True, choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')], help_text='Start month of the CAP discount', null=True)),
-                ('start_year', models.PositiveIntegerField(blank=True, help_text='Start year of the CAP discount', null=True, validators=[django.core.validators.MinValueValidator(1900), django.core.validators.MaxValueValidator(9999)])),
-                ('next_reset_override_month', models.PositiveIntegerField(blank=True, choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')], help_text='Temporary one-time reset override month', null=True)),
-                ('next_reset_override_year', models.PositiveIntegerField(blank=True, help_text='Temporary one-time reset override year', null=True, validators=[django.core.validators.MinValueValidator(1900), django.core.validators.MaxValueValidator(9999)])),
-                ('reset_interval', models.PositiveIntegerField(default=1, help_text='Recurring interval, i.e. every 5 days.', validators=[django.core.validators.MinValueValidator(1)])),
-                ('reset_frequency', models.PositiveIntegerField(choices=[(5, 'Month(s)'), (6, 'Year(s)')], help_text='The CAP reset frequency.')),
-                ('account', models.ForeignKey(help_text='The account this CAP applies to', on_delete=django.db.models.deletion.CASCADE, to='NEMO.account')),
-                ('user', models.ForeignKey(help_text='The user this CAP applies to', on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
-                ('configuration', models.ForeignKey(help_text='The configuration for this CAP', on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscountconfiguration')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "amount",
+                    models.DecimalField(
+                        decimal_places=2,
+                        help_text="Amount after which the discount will be applied",
+                        max_digits=14,
+                        validators=[django.core.validators.MinValueValidator(1)],
+                    ),
+                ),
+                (
+                    "discount",
+                    models.DecimalField(
+                        decimal_places=3,
+                        help_text="Discount in percent. Ex 20.5%",
+                        max_digits=6,
+                        validators=[
+                            django.core.validators.MinValueValidator(1),
+                            django.core.validators.MaxValueValidator(100),
+                        ],
+                    ),
+                ),
+                (
+                    "charge_types",
+                    models.CharField(
+                        help_text="List of charge type this CAP applies to",
+                        max_length=100,
+                        validators=[
+                            django.core.validators.RegexValidator(
+                                re.compile("^\\d+(?:,\\d+)*\\Z"),
+                                code="invalid",
+                                message="Enter only digits separated by commas.",
+                            )
+                        ],
+                    ),
+                ),
+                (
+                    "start_month",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ],
+                        help_text="Start month of the CAP discount",
+                        null=True,
+                    ),
+                ),
+                (
+                    "start_year",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        help_text="Start year of the CAP discount",
+                        null=True,
+                        validators=[
+                            django.core.validators.MinValueValidator(1900),
+                            django.core.validators.MaxValueValidator(9999),
+                        ],
+                    ),
+                ),
+                (
+                    "next_reset_override_month",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ],
+                        help_text="Temporary one-time reset override month",
+                        null=True,
+                    ),
+                ),
+                (
+                    "next_reset_override_year",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        help_text="Temporary one-time reset override year",
+                        null=True,
+                        validators=[
+                            django.core.validators.MinValueValidator(1900),
+                            django.core.validators.MaxValueValidator(9999),
+                        ],
+                    ),
+                ),
+                (
+                    "reset_interval",
+                    models.PositiveIntegerField(
+                        default=1,
+                        help_text="Recurring interval, i.e. every 5 days.",
+                        validators=[django.core.validators.MinValueValidator(1)],
+                    ),
+                ),
+                (
+                    "reset_frequency",
+                    models.PositiveIntegerField(
+                        choices=[(5, "Month(s)"), (6, "Year(s)")], help_text="The CAP reset frequency."
+                    ),
+                ),
+                (
+                    "account",
+                    models.ForeignKey(
+                        help_text="The account this CAP applies to",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="NEMO.account",
+                    ),
+                ),
+                (
+                    "user",
+                    models.ForeignKey(
+                        help_text="The user this CAP applies to",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                (
+                    "configuration",
+                    models.ForeignKey(
+                        help_text="The configuration for this CAP",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="cap_discount.capdiscountconfiguration",
+                    ),
+                ),
             ],
             options={
-                'unique_together': {('configuration', 'user', 'account')},
-            }
+                "unique_together": {("configuration", "user", "account")},
+            },
         ),
         migrations.CreateModel(
-            name='CAPDiscountAmount',
+            name="CAPDiscountAmount",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('month', models.PositiveIntegerField(choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')])),
-                ('year', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(9999)])),
-                ('start', models.DecimalField(decimal_places=2, max_digits=14)),
-                ('end', models.DecimalField(decimal_places=2, max_digits=14)),
-                ('cap_discount', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscount')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "month",
+                    models.PositiveIntegerField(
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ]
+                    ),
+                ),
+                (
+                    "year",
+                    models.PositiveIntegerField(
+                        validators=[
+                            django.core.validators.MinValueValidator(1),
+                            django.core.validators.MaxValueValidator(9999),
+                        ]
+                    ),
+                ),
+                ("start", models.DecimalField(decimal_places=2, max_digits=14)),
+                ("end", models.DecimalField(decimal_places=2, max_digits=14)),
+                (
+                    "cap_discount",
+                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="cap_discount.capdiscount"),
+                ),
             ],
             options={
-                'ordering': ['-year', '-month'],
-                'unique_together': {('cap_discount', 'month', 'year')},
+                "ordering": ["-year", "-month"],
+                "unique_together": {("cap_discount", "month", "year")},
             },
         ),
         migrations.AddConstraint(
-            model_name='capdiscountconfiguration',
-            constraint=models.UniqueConstraint(fields=('rate_category', 'core_facility'), name='capdiscountconfiguration_unique_rate_category_facility'),
+            model_name="capdiscountconfiguration",
+            constraint=models.UniqueConstraint(
+                fields=("rate_category", "core_facility"), name="capdiscountconfiguration_unique_rate_category_facility"
+            ),
         ),
         migrations.AddConstraint(
-            model_name='capdiscountconfiguration',
-            constraint=models.UniqueConstraint(condition=models.Q(('core_facility', None)), fields=('rate_category',), name='capdiscountconfiguration_unique_rate_category_null_facility'),
+            model_name="capdiscountconfiguration",
+            constraint=models.UniqueConstraint(
+                condition=models.Q(("core_facility", None)),
+                fields=("rate_category",),
+                name="capdiscountconfiguration_unique_rate_category_null_facility",
+            ),
         ),
     ]
```

## NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py

```diff
@@ -4,36 +4,51 @@
 from django.conf import settings
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0003_version_2_0_0'),
+        ("NEMO_billing", "0003_version_2_0_0"),
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('cap_discount', '0001_initial'),
+        ("cap_discount", "0001_initial"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='capdiscountconfiguration',
-            name='split_by_user',
-            field=models.BooleanField(default=True, help_text='Check this box to have a separate CAP amount per each user/account. If unchecked, the CAP will be per account only (all user charges count towards the same CAP)'),
+            model_name="capdiscountconfiguration",
+            name="split_by_user",
+            field=models.BooleanField(
+                default=True,
+                help_text="Check this box to have a separate CAP amount per each user/account. If unchecked, the CAP will be per account only (all user charges count towards the same CAP)",
+            ),
         ),
         migrations.AlterField(
-            model_name='capdiscount',
-            name='user',
-            field=models.ForeignKey(blank=True, help_text='The user this CAP applies to', null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
+            model_name="capdiscount",
+            name="user",
+            field=models.ForeignKey(
+                blank=True,
+                help_text="The user this CAP applies to",
+                null=True,
+                on_delete=django.db.models.deletion.CASCADE,
+                to=settings.AUTH_USER_MODEL,
+            ),
         ),
         migrations.AlterUniqueTogether(
-            name='capdiscount',
+            name="capdiscount",
             unique_together=set(),
         ),
         migrations.AddConstraint(
-            model_name='capdiscount',
-            constraint=models.UniqueConstraint(fields=('configuration', 'account', 'user'), name='cap_discount_capdiscount_unique_config_account_user'),
+            model_name="capdiscount",
+            constraint=models.UniqueConstraint(
+                fields=("configuration", "account", "user"), name="cap_discount_capdiscount_unique_config_account_user"
+            ),
         ),
         migrations.AddConstraint(
-            model_name='capdiscount',
-            constraint=models.UniqueConstraint(condition=models.Q(('user', None)), fields=('configuration', 'account'), name='cap_discount_capdiscount_unique_config_account_null_user'),
+            model_name="capdiscount",
+            constraint=models.UniqueConstraint(
+                condition=models.Q(("user", None)),
+                fields=("configuration", "account"),
+                name="cap_discount_capdiscount_unique_config_account_null_user",
+            ),
         ),
     ]
```

## NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py

```diff
@@ -1,28 +1,40 @@
 # Generated by Django 3.2.18 on 2023-05-09 23:55
 
 import django.core.validators
-from django.db import migrations, models
 import django.db.models.deletion
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('cap_discount', '0002_version_2_0_0'),
+        ("cap_discount", "0002_version_2_0_0"),
     ]
 
     def forwards_migrate_cap_discount(apps, schema_editor):
         CAPDiscountConfiguration = apps.get_model("cap_discount", "CAPDiscountConfiguration")
         CAPDiscount = apps.get_model("cap_discount", "CAPDiscount")
         CAPDiscountTier = apps.get_model("cap_discount", "CAPDiscountTier")
         for config in CAPDiscountConfiguration.objects.all():
-            config.capdiscounttier_set.set([CAPDiscountTier.objects.create(cap_discount_configuration=config, amount=config.amount, discount=config.discount)])
+            config.capdiscounttier_set.set(
+                [
+                    CAPDiscountTier.objects.create(
+                        cap_discount_configuration=config, amount=config.amount, discount=config.discount
+                    )
+                ]
+            )
         for discount in CAPDiscount.objects.all():
-            discount.capdiscounttier_set.set([CAPDiscountTier.objects.create(cap_discount=discount, amount=discount.amount, discount=discount.discount)])
+            discount.capdiscounttier_set.set(
+                [
+                    CAPDiscountTier.objects.create(
+                        cap_discount=discount, amount=discount.amount, discount=discount.discount
+                    )
+                ]
+            )
 
     def reverse_migrate_cap_discount(apps, schema_editor):
         CAPDiscountConfiguration = apps.get_model("cap_discount", "CAPDiscountConfiguration")
         CAPDiscount = apps.get_model("cap_discount", "CAPDiscount")
         for config in CAPDiscountConfiguration.objects.all():
             first_tier = config.capdiscounttier_set.first()
             config.amount = first_tier.amount
@@ -32,59 +44,118 @@
             first_tier = discount.capdiscounttier_set.first()
             discount.amount = first_tier.amount
             discount.discount = first_tier.discount
             discount.save(update_fields=["amount", "discount"])
 
     operations = [
         migrations.CreateModel(
-            name='CAPDiscountTier',
+            name="CAPDiscountTier",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('amount', models.DecimalField(decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)])),
-                ('discount', models.DecimalField(decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
-                ('cap_discount', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscount')),
-                ('cap_discount_configuration', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscountconfiguration')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "amount",
+                    models.DecimalField(
+                        decimal_places=2,
+                        help_text="Amount after which the discount will be applied",
+                        max_digits=14,
+                        validators=[django.core.validators.MinValueValidator(1)],
+                    ),
+                ),
+                (
+                    "discount",
+                    models.DecimalField(
+                        decimal_places=3,
+                        help_text="Discount in percent. Ex 20.5%",
+                        max_digits=6,
+                        validators=[
+                            django.core.validators.MinValueValidator(0),
+                            django.core.validators.MaxValueValidator(100),
+                        ],
+                    ),
+                ),
+                (
+                    "cap_discount",
+                    models.ForeignKey(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="cap_discount.capdiscount",
+                    ),
+                ),
+                (
+                    "cap_discount_configuration",
+                    models.ForeignKey(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="cap_discount.capdiscountconfiguration",
+                    ),
+                ),
             ],
             options={
-                'ordering': ['amount'],
+                "ordering": ["amount"],
             },
         ),
         migrations.RunPython(forwards_migrate_cap_discount, reverse_migrate_cap_discount),
         migrations.AlterField(
-            model_name='capdiscount',
-            name='amount',
-            field=models.DecimalField(default=0, decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)]),
-            preserve_default=True
+            model_name="capdiscount",
+            name="amount",
+            field=models.DecimalField(
+                default=0,
+                decimal_places=2,
+                help_text="Amount after which the discount will be applied",
+                max_digits=14,
+                validators=[django.core.validators.MinValueValidator(1)],
+            ),
+            preserve_default=True,
         ),
         migrations.RemoveField(
-            model_name='capdiscount',
-            name='amount',
+            model_name="capdiscount",
+            name="amount",
         ),
         migrations.AlterField(
-            model_name='capdiscount',
-            name='discount',
-            field=models.DecimalField(default=0, decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)]),
+            model_name="capdiscount",
+            name="discount",
+            field=models.DecimalField(
+                default=0,
+                decimal_places=3,
+                help_text="Discount in percent. Ex 20.5%",
+                max_digits=6,
+                validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)],
+            ),
         ),
         migrations.RemoveField(
-            model_name='capdiscount',
-            name='discount',
+            model_name="capdiscount",
+            name="discount",
         ),
         migrations.AlterField(
-            model_name='capdiscountconfiguration',
-            name='amount',
-            field=models.DecimalField(default=0, decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)]),
+            model_name="capdiscountconfiguration",
+            name="amount",
+            field=models.DecimalField(
+                default=0,
+                decimal_places=2,
+                help_text="Amount after which the discount will be applied",
+                max_digits=14,
+                validators=[django.core.validators.MinValueValidator(1)],
+            ),
         ),
         migrations.RemoveField(
-            model_name='capdiscountconfiguration',
-            name='amount',
+            model_name="capdiscountconfiguration",
+            name="amount",
         ),
         migrations.AlterField(
-            model_name='capdiscountconfiguration',
-            name='discount',
-            field=models.DecimalField(default=0, decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)]),
-            preserve_default=True
+            model_name="capdiscountconfiguration",
+            name="discount",
+            field=models.DecimalField(
+                default=0,
+                decimal_places=3,
+                help_text="Discount in percent. Ex 20.5%",
+                max_digits=6,
+                validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)],
+            ),
+            preserve_default=True,
         ),
         migrations.RemoveField(
-            model_name='capdiscountconfiguration',
-            name='discount',
+            model_name="capdiscountconfiguration",
+            name="discount",
         ),
     ]
```

## NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py

```diff
@@ -5,15 +5,15 @@
 from django.db import DatabaseError, migrations
 from django.db.backends.base.schema import BaseDatabaseSchemaEditor
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('cap_discount', '0003_multi_tier_discount'),
+        ("cap_discount", "0003_multi_tier_discount"),
     ]
 
     operations = []
 
     def apply(self, project_state, schema_editor: BaseDatabaseSchemaEditor, collect_sql=False):
         # Because we changed the initial migration, we need to add/remove the constraints manually
         # We check if the old constraints exist in the DB (case when app was migrated before the change)
@@ -22,15 +22,17 @@
         current_name_of_null_constraint = "capdiscountconfiguration_unique_rate_category_null_facility"
         model_state = project_state.models["cap_discount", "capdiscountconfiguration"]
         unique_constr_definition = model_state.get_constraint_by_name(current_name_of_constraint)
         unique_null_constr_definition = model_state.get_constraint_by_name(current_name_of_null_constraint)
         previous_unique_constr = deepcopy(unique_constr_definition)
         previous_unique_null_constr = deepcopy(unique_null_constr_definition)
         CapDiscountConfiguration = project_state.apps.get_model("cap_discount", "CapDiscountConfiguration")
-        constraints: Dict[str, Dict] = schema_editor.connection.introspection.get_constraints(schema_editor.connection.cursor(), "cap_discount_capdiscountconfiguration")
+        constraints: Dict[str, Dict] = schema_editor.connection.introspection.get_constraints(
+            schema_editor.connection.cursor(), "cap_discount_capdiscountconfiguration"
+        )
         # Here we are just going to remove the unique constraints and re-add them
         db_previous_constr_names = []
         db_previous_null_constr_names = []
         for constraint_name, constraint in constraints.items():
             if "capdiscountconfiguration_unique_rate" in constraint_name and constraint.get("unique") == True:
                 if "_null" in constraint_name:
                     db_previous_null_constr_names.append(constraint_name)
```

## NEMO_billing/cap_discount/migrations/0005_cap_multi_core_facilities.py

```diff
@@ -15,62 +15,83 @@
             return
         super().database_backwards(app_label, schema_editor, from_state, to_state)
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0005_version_2_5_6'),
-        ('cap_discount', '0004_shortened_unique_constraints'),
+        ("NEMO_billing", "0005_version_2_5_6"),
+        ("cap_discount", "0004_shortened_unique_constraints"),
     ]
 
     def migrate_configuration_core_facilities(apps, schema_editor):
         CAPDiscountConfiguration = apps.get_model("cap_discount", "CAPDiscountConfiguration")
-    
+
         for config in CAPDiscountConfiguration.objects.all():
             config.core_facilities.add(config.core_facility)
 
     def migrate_configuration_core_facilities_back(apps, schema_editor):
         CAPDiscountConfiguration = apps.get_model("cap_discount", "CAPDiscountConfiguration")
-    
+
         for config in CAPDiscountConfiguration.objects.all():
             config.core_facility = config.core_facilities.first()
             config.save(update_fields=["core_facility"])
 
     operations = [
         migrations.AlterField(
-            model_name='capdiscountconfiguration',
-            name='core_facility',
-            field=models.ForeignKey(blank=True, help_text='The core facility this CAP applies to', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='cf', to='NEMO_billing.corefacility'),
+            model_name="capdiscountconfiguration",
+            name="core_facility",
+            field=models.ForeignKey(
+                blank=True,
+                help_text="The core facility this CAP applies to",
+                null=True,
+                on_delete=django.db.models.deletion.CASCADE,
+                related_name="cf",
+                to="NEMO_billing.corefacility",
+            ),
         ),
         # We need to drop the index and constraint temporarily so MySQL is happy removing the unique constraint
         # This solves the Cannot drop index '...': needed in a foreign key constraint
         migrations.AlterField(
-            model_name='capdiscountconfiguration',
-            name='rate_category',
-            field=models.ForeignKey(help_text='The rate category this CAP applies to', on_delete=django.db.models.deletion.CASCADE, to='rates.ratecategory', db_index=False, db_constraint=False),
+            model_name="capdiscountconfiguration",
+            name="rate_category",
+            field=models.ForeignKey(
+                help_text="The rate category this CAP applies to",
+                on_delete=django.db.models.deletion.CASCADE,
+                to="rates.ratecategory",
+                db_index=False,
+                db_constraint=False,
+            ),
         ),
         migrations.AddField(
-            model_name='capdiscountconfiguration',
-            name='core_facilities',
-            field=models.ManyToManyField(blank=True, help_text='The core facility(ies) this CAP applies to. If multiple are selected, the CAP is shared between facilities', to='NEMO_billing.CoreFacility'),
+            model_name="capdiscountconfiguration",
+            name="core_facilities",
+            field=models.ManyToManyField(
+                blank=True,
+                help_text="The core facility(ies) this CAP applies to. If multiple are selected, the CAP is shared between facilities",
+                to="NEMO_billing.CoreFacility",
+            ),
         ),
         migrations.RemoveConstraint(
-            model_name='capdiscountconfiguration',
-            name='capdiscountconfiguration_unique_rate_category_facility',
+            model_name="capdiscountconfiguration",
+            name="capdiscountconfiguration_unique_rate_category_facility",
         ),
         MysqlExemptRemoveConstraint(
-            model_name='capdiscountconfiguration',
-            name='capdiscountconfiguration_unique_rate_category_null_facility',
+            model_name="capdiscountconfiguration",
+            name="capdiscountconfiguration_unique_rate_category_null_facility",
         ),
         migrations.RunPython(migrate_configuration_core_facilities, migrate_configuration_core_facilities_back),
         migrations.RemoveField(
-            model_name='capdiscountconfiguration',
-            name='core_facility',
+            model_name="capdiscountconfiguration",
+            name="core_facility",
         ),
         # Put back db index and constraint now
         migrations.AlterField(
-            model_name='capdiscountconfiguration',
-            name='rate_category',
-            field=models.ForeignKey(help_text='The rate category this CAP applies to', on_delete=django.db.models.deletion.CASCADE, to='rates.ratecategory'),
+            model_name="capdiscountconfiguration",
+            name="rate_category",
+            field=models.ForeignKey(
+                help_text="The rate category this CAP applies to",
+                on_delete=django.db.models.deletion.CASCADE,
+                to="rates.ratecategory",
+            ),
         ),
     ]
```

## NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html

```diff
@@ -1,55 +1,58 @@
 {% extends 'billing/cap_and_prepaid_base.html' %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 {% block title %}CAP status{% endblock %}
 {% block tab_title %}CAP status{% endblock %}
 {% block before_pagination %}
-	{% if configurations|length > 1 %}
-		<div class="form-inline">
-			<label class="control-label" for="configuration">Configuration:</label>
-			<select id="configuration" class="form-control" onchange="window.location.href = this.value ? '{% url 'cap_discount_status_configuration' '99999' %}'.replace('99999', this.value) : '{% url 'cap_discount_status' %}'">
-				<option value="" selected>All</option>
-				{% for configuration in configurations %}
-					<option value="{{ configuration.id }}" {% if selected_configuration.id == configuration.id %}selected{% endif %}>{{ configuration }}</option>
-				{% endfor %}
-			</select>
-		</div>
-	{% endif %}
+    {% if configurations|length > 1 %}
+        <div class="form-inline">
+            <label class="control-label" for="configuration">Configuration:</label>
+            <select id="configuration"
+                    class="form-control"
+                    onchange="window.location.href = this.value ? '{% url 'cap_discount_status_configuration' '99999' %}'.replace('99999', this.value) : '{% url 'cap_discount_status' %}'">
+                <option value="" selected>All</option>
+                {% for configuration in configurations %}
+                    <option value="{{ configuration.id }}"
+                            {% if selected_configuration.id == configuration.id %}selected{% endif %}>
+                        {{ configuration }}
+                    </option>
+                {% endfor %}
+            </select>
+        </div>
+    {% endif %}
 {% endblock %}
 {% block pagination_content %}
-	<table class="table table-bordered table-striped table-align-middle thead-light">
-		<thead>
-			<tr>
-				<th>{% include 'pagination/pagination_column.html' with order_by="configuration" name='CAP' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="account" name='Account' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="user" name='User' %}</th>
-				<th>Last reset</th>
-				<th>Current amount</th>
-				<th>Last updated</th>
-				<th>Charges since</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="current_level_reached" name='CAP reached' %}</th>
-				<th>Next reset</th>
-			</tr>
-		</thead>
-		<tbody>
-			{% for cap_discount in page %}
-				<tr>
-					<td>{{ cap_discount.configuration }}</td>
-					<td>{{ cap_discount.account.name }}</td>
-					<td>{{ cap_discount.user|default_if_none:"" }}</td>
-					<td>{{ cap_discount.last_reset|date:"F Y" }}</td>
-					<td>{{ cap_discount.latest_amount.end }}</td>
-					<td>{{ cap_discount.latest_amount.amount_date|date:"F, Y" }}</td>
-					<td>{{ cap_discount.estimated_charges_since_last_update|floatformat:2 }}</td>
-					<td>
-						{% if cap_discount.current_level_reached %}
-							{{ cap_discount.current_level_reached }}
-						{% endif %}
-					</td>
-					<td>{{ cap_discount.next_reset|date:"F, Y" }}</td>
-				</tr>
-			{% endfor %}
-		</tbody>
-	</table>
+    <table class="table table-bordered table-striped table-align-middle thead-light">
+        <thead>
+            <tr>
+                <th>{% include 'pagination/pagination_column.html' with order_by="configuration" name='CAP' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="account" name='Account' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="user" name='User' %}</th>
+                <th>Last reset</th>
+                <th>Current amount</th>
+                <th>Last updated</th>
+                <th>Charges since</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="current_level_reached" name='CAP reached' %}</th>
+                <th>Next reset</th>
+            </tr>
+        </thead>
+        <tbody>
+            {% for cap_discount in page %}
+                <tr>
+                    <td>{{ cap_discount.configuration }}</td>
+                    <td>{{ cap_discount.account.name }}</td>
+                    <td>{{ cap_discount.user|default_if_none:"" }}</td>
+                    <td>{{ cap_discount.last_reset|date:"F Y" }}</td>
+                    <td>{{ cap_discount.latest_amount.end }}</td>
+                    <td>{{ cap_discount.latest_amount.amount_date|date:"F, Y" }}</td>
+                    <td>{{ cap_discount.estimated_charges_since_last_update|floatformat:2 }}</td>
+                    <td>
+                        {% if cap_discount.current_level_reached %}{{ cap_discount.current_level_reached }}{% endif %}
+                    </td>
+                    <td>{{ cap_discount.next_reset|date:"F, Y" }}</td>
+                </tr>
+            {% endfor %}
+        </tbody>
+    </table>
 {% endblock %}
-{% block table_empty_content %}There are no current CAP set{% endblock %}
+{% block table_empty_content %}There are no current CAP set{% endblock %}
```

### html2text {}

```diff
@@ -1,22 +1,22 @@
 {% extends 'billing/cap_and_prepaid_base.html' %} {% load
 custom_tags_and_filters %} {% load billing_tags %} {% block title %}CAP status
 {% endblock %} {% block tab_title %}CAP status{% endblock %} {% block
 before_pagination %} {% if configurations|length > 1 %}
 {% for configuration in configurations %}
-% if selected_configuration.id == configuration.id %}selected{% endif %}>{
+% if selected_configuration.id == configuration.id %}selected{% endif %}> {
 { configuration }}
 {% endfor %}
 {% endif %} {% endblock %} {% block pagination_content %}
 {{%% iinncclluuddee ''ppaaggiinnaattiioonn//    {{%% iinncclluuddee ''ppaaggiinnaattiioonn//                                                                                                                                                                                                              {{%% iinncclluuddee ''ppaaggiinnaattiioonn//
 ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll''    ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll''   {{%% iinncclluuddee ''ppaaggiinnaattiioonn//                                                                                                                                                                                    ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' wwiitthh
 wwiitthh                       wwiitthh oorrddeerr__bbyy==""aaccccoouunntt""   ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' wwiitthh       LLaasstt rreesseett                    CCuurrrreenntt aammoouunntt                 LLaasstt uuppddaatteedd                                 CChhaarrggeess ssiinnccee                                                 oorrddeerr__bbyy==""ccuurrrreenntt__lleevveell__rreeaacchheedd""   NNeexxtt rreesseett
 oorrddeerr__bbyy==""ccoonnffiigguurraattiioonn""   nnaammee==''AAccccoouunntt'' %%}}         oorrddeerr__bbyy==""uusseerr"" nnaammee==''UUsseerr'' %%}}                                                                                                                                                                             nnaammee==''CCAAPP rreeaacchheedd'' %%}}
 nnaammee==''CCAAPP'' %%}}
                                                                                                                                                                                                                                                                 {% if
 {                          {                         {                                  {                             {                              {                                            {                                                             cap_discount.current_level_reached {
-{                          {                         {                                  {                             {                              {                                            {                                                             %} {                               {
+{                          {                         {                                  {                             {                              {                                            {                                                             %}{                                {
 cap_discount.configuration cap_discount.account.name cap_discount.user|default_if_none: cap_discount.last_reset|date: cap_discount.latest_amount.end cap_discount.latest_amount.amount_date|date: cap_discount.estimated_charges_since_last_update|floatformat: {                                  cap_discount.next_reset|date:
 }}                         }}                        "" }}                              "F Y" }}                      }}                             "F, Y" }}                                    2 }}                                                          cap_discount.current_level_reached "F, Y" }}
-                                                                                                                                                                                                                                                                }} {% endif %}
+                                                                                                                                                                                                                                                                }}{% endif %}
 {% endblock %} {% block table_empty_content %}There are no current CAP set{%
 endblock %}
```

## NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html

```diff
@@ -1,21 +1,28 @@
 {% load static %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 <div>
-	<br>
-	{% for cap_discount in cap_discounts %}
-		{% with cap_highest_amount=cap_discount.capdiscounttier_set.last.amount %}
-			{% widthratio .75 1 cap_highest_amount as warn_limit %}
-			<div style="padding: 15px 30px" class="alert {% if cap_discount.latest_amount.end >= cap_highest_amount %}alert-success{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}alert-warning{% else %}alert-danger{% endif %} alert-link">
-				<span style="font-weight:bold">{{ cap_discount }}</span><br>
-				<div>
-					<u>Amount:</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0 }}</span>/{{ cap_highest_amount }}</span><br>
-					<u>Last updated:</u> {{ cap_discount.latest_amount.amount_date|date:"F Y" }}<br>
-					<u>Current estimated amount</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0|add:cap_discount.estimated_charges_since_last_update }}</span>/{{ cap_highest_amount }}</span><br>
-					<u>Started:</u> {{ cap_discount.last_reset.date|date:"F Y" }}<br>
-					<u>Next reset:</u> {{ cap_discount.next_reset.date|date:"F Y" }}<br>
-				</div>
-			</div>
-		{% endwith %}
-	{% endfor %}
-</div>
+    <br>
+    {% for cap_discount in cap_discounts %}
+        {% with cap_highest_amount=cap_discount.capdiscounttier_set.last.amount %}
+            {% widthratio .75 1 cap_highest_amount as warn_limit %}
+            <div style="padding: 15px 30px"
+                 class="alert {% if cap_discount.latest_amount.end >= cap_highest_amount %}alert-success{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}alert-warning{% else %}alert-danger{% endif %} alert-link">
+                <span style="font-weight:bold">{{ cap_discount }}</span>
+                <br>
+                <div>
+                    <u>Amount:</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0 }}</span>/{{ cap_highest_amount }}</span>
+                    <br>
+                    <u>Last updated:</u> {{ cap_discount.latest_amount.amount_date|date:"F Y" }}
+                    <br>
+                    <u>Current estimated amount</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0|add:cap_discount.estimated_charges_since_last_update }}</span>/{{ cap_highest_amount }}</span>
+                    <br>
+                    <u>Started:</u> {{ cap_discount.last_reset.date|date:"F Y" }}
+                    <br>
+                    <u>Next reset:</u> {{ cap_discount.next_reset.date|date:"F Y" }}
+                    <br>
+                </div>
+            </div>
+        {% endwith %}
+    {% endfor %}
+</div>
```

## NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html

```diff
@@ -9,249 +9,310 @@
 00000080: 6833 3e0a 2020 2020 3c66 6f72 6d20 6d65  h3>.    <form me
 00000090: 7468 6f64 3d22 504f 5354 2220 6163 7469  thod="POST" acti
 000000a0: 6f6e 3d22 7b25 2075 726c 2027 6375 7374  on="{% url 'cust
 000000b0: 6f6d 697a 6527 2027 6361 705f 6469 7363  omize' 'cap_disc
 000000c0: 6f75 6e74 2720 257d 2220 636c 6173 733d  ount' %}" class=
 000000d0: 2266 6f72 6d2d 686f 7269 7a6f 6e74 616c  "form-horizontal
 000000e0: 223e 0a20 2020 2020 2020 207b 2520 6373  ">.        {% cs
-000000f0: 7266 5f74 6f6b 656e 2025 7d0a 0909 3c64  rf_token %}...<d
-00000100: 6976 2063 6c61 7373 3d22 666f 726d 2d67  iv class="form-g
-00000110: 726f 7570 207b 2520 6966 2065 7272 6f72  roup {% if error
-00000120: 732e 6361 705f 6269 6c6c 696e 675f 6465  s.cap_billing_de
-00000130: 6661 756c 745f 6269 6c6c 6162 6c65 5f74  fault_billable_t
-00000140: 7970 6573 2025 7d68 6173 2d65 7272 6f72  ypes %}has-error
-00000150: 7b25 2065 6e64 6966 2025 7d22 3e0a 0909  {% endif %}">...
-00000160: 093c 6c61 6265 6c20 636c 6173 733d 2263  .<label class="c
-00000170: 6f6e 7472 6f6c 2d6c 6162 656c 2063 6f6c  ontrol-label col
-00000180: 2d73 6d2d 3322 3e44 6566 6175 6c74 2063  -sm-3">Default c
-00000190: 6861 7267 6573 3a3c 2f6c 6162 656c 3e0a  harges:</label>.
-000001a0: 0909 093c 6469 7620 636c 6173 733d 2263  ...<div class="c
-000001b0: 6f6c 2d73 6d2d 3420 636f 6c2d 6d64 2d33  ol-sm-4 col-md-3
-000001c0: 223e 0a09 0909 093c 6469 7620 636c 6173  ">.....<div clas
-000001d0: 733d 2263 6865 636b 626f 7822 3e0a 0909  s="checkbox">...
-000001e0: 0909 097b 2520 666f 7220 7661 6c75 652c  ...{% for value,
-000001f0: 2064 6973 706c 6179 2069 6e20 6269 6c6c   display in bill
-00000200: 6162 6c65 5f74 7970 6573 2025 7d0a 0909  able_types %}...
-00000210: 0909 0909 3c64 6976 3e0a 0909 0909 0909  ....<div>.......
-00000220: 093c 6c61 6265 6c3e 3c69 6e70 7574 2074  .<label><input t
-00000230: 7970 653d 2263 6865 636b 626f 7822 206e  ype="checkbox" n
-00000240: 616d 653d 2263 6170 5f62 696c 6c69 6e67  ame="cap_billing
-00000250: 5f64 6566 6175 6c74 5f62 696c 6c61 626c  _default_billabl
-00000260: 655f 7479 7065 735f 6c69 7374 2220 7b25  e_types_list" {%
-00000270: 2069 6620 7661 6c75 6520 696e 2073 656c   if value in sel
-00000280: 6563 7465 645f 6269 6c6c 6162 6c65 5f74  ected_billable_t
-00000290: 7970 6573 2025 7d63 6865 636b 6564 7b25  ypes %}checked{%
-000002a0: 2065 6e64 6966 2025 7d20 7661 6c75 653d   endif %} value=
-000002b0: 227b 7b20 7661 6c75 6520 7d7d 223e 207b  "{{ value }}"> {
-000002c0: 7b20 6469 7370 6c61 7920 7d7d 3c2f 6c61  { display }}</la
-000002d0: 6265 6c3e 0a09 0909 0909 093c 2f64 6976  bel>.......</div
-000002e0: 3e0a 0909 0909 097b 2520 656e 6466 6f72  >......{% endfor
-000002f0: 2025 7d0a 0909 0909 3c2f 6469 763e 0a09   %}.....</div>..
-00000300: 0909 3c2f 6469 763e 0a09 0909 3c64 6976  ..</div>....<div
-00000310: 2063 6c61 7373 3d22 636f 6c2d 736d 2d35   class="col-sm-5
-00000320: 2063 6f6c 2d6d 642d 3620 6865 6c70 2d62   col-md-6 help-b
-00000330: 6c6f 636b 206c 6967 6874 2d67 7265 7922  lock light-grey"
-00000340: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00000350: 2020 7b25 2069 6620 6572 726f 7273 2e63    {% if errors.c
-00000360: 6170 5f62 696c 6c69 6e67 5f64 6566 6175  ap_billing_defau
-00000370: 6c74 5f62 696c 6c61 626c 655f 7479 7065  lt_billable_type
-00000380: 7320 257d 0a20 2020 2020 2020 2020 2020  s %}.           
-00000390: 2020 2020 2020 2020 207b 7b20 6572 726f           {{ erro
-000003a0: 7273 2e63 6170 5f62 696c 6c69 6e67 5f64  rs.cap_billing_d
-000003b0: 6566 6175 6c74 5f62 696c 6c61 626c 655f  efault_billable_
-000003c0: 7479 7065 732e 6572 726f 7220 7d7d 0a20  types.error }}. 
-000003d0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-000003e0: 2520 656e 6469 6620 257d 0a20 2020 2020  % endif %}.     
-000003f0: 2020 2020 2020 203c 2f64 6976 3e0a 0909         </div>...
-00000400: 3c2f 6469 763e 0a09 093c 6469 7620 636c  </div>...<div cl
-00000410: 6173 733d 2266 6f72 6d2d 6772 6f75 7020  ass="form-group 
-00000420: 7b25 2069 6620 6572 726f 7273 2e63 6170  {% if errors.cap
-00000430: 5f62 696c 6c69 6e67 5f64 6566 6175 6c74  _billing_default
-00000440: 5f69 6e74 6572 7661 6c20 6f72 2065 7272  _interval or err
-00000450: 6f72 732e 6361 705f 6269 6c6c 696e 675f  ors.cap_billing_
-00000460: 6465 6661 756c 745f 6672 6571 7565 6e63  default_frequenc
-00000470: 7920 257d 6861 732d 6572 726f 727b 2520  y %}has-error{% 
-00000480: 656e 6469 6620 257d 223e 0a09 0909 3c6c  endif %}">....<l
-00000490: 6162 656c 2063 6c61 7373 3d22 636f 6e74  abel class="cont
-000004a0: 726f 6c2d 6c61 6265 6c20 636f 6c2d 736d  rol-label col-sm
-000004b0: 2d33 223e 4465 6661 756c 7420 7265 7365  -3">Default rese
-000004c0: 743a 3c2f 6c61 6265 6c3e 0a09 0909 3c64  t:</label>....<d
-000004d0: 6976 2063 6c61 7373 3d22 636f 6c2d 736d  iv class="col-sm
-000004e0: 2d32 2063 6f6c 2d6d 642d 3222 3e3c 696e  -2 col-md-2"><in
-000004f0: 7075 7420 6172 6961 2d6c 6162 656c 3d22  put aria-label="
-00000500: 5265 7365 7420 696e 7465 7276 616c 2220  Reset interval" 
-00000510: 636c 6173 733d 2266 6f72 6d2d 636f 6e74  class="form-cont
-00000520: 726f 6c22 2074 7970 653d 226e 756d 6265  rol" type="numbe
-00000530: 7222 2069 643d 2263 6170 5f62 696c 6c69  r" id="cap_billi
-00000540: 6e67 5f64 6566 6175 6c74 5f69 6e74 6572  ng_default_inter
-00000550: 7661 6c22 206e 616d 653d 2263 6170 5f62  val" name="cap_b
-00000560: 696c 6c69 6e67 5f64 6566 6175 6c74 5f69  illing_default_i
-00000570: 6e74 6572 7661 6c22 2076 616c 7565 3d22  nterval" value="
-00000580: 7b7b 2063 6170 5f62 696c 6c69 6e67 5f64  {{ cap_billing_d
-00000590: 6566 6175 6c74 5f69 6e74 6572 7661 6c20  efault_interval 
-000005a0: 7d7d 223e 3c2f 6469 763e 0a09 0909 3c64  }}"></div>....<d
-000005b0: 6976 2063 6c61 7373 3d22 636f 6c2d 736d  iv class="col-sm
-000005c0: 2d34 2063 6f6c 2d6d 642d 3322 3e0a 0909  -4 col-md-3">...
-000005d0: 0909 3c73 656c 6563 7420 636c 6173 733d  ..<select class=
-000005e0: 2263 6f6c 2d73 6d2d 3220 666f 726d 2d63  "col-sm-2 form-c
-000005f0: 6f6e 7472 6f6c 2220 7374 796c 653d 2264  ontrol" style="d
-00000600: 6973 706c 6179 3a69 6e6c 696e 652d 626c  isplay:inline-bl
-00000610: 6f63 6b3b 2220 6172 6961 2d6c 6162 656c  ock;" aria-label
-00000620: 3d22 5265 7365 7420 6672 6571 7565 6e63  ="Reset frequenc
-00000630: 7922 206e 616d 653d 2263 6170 5f62 696c  y" name="cap_bil
-00000640: 6c69 6e67 5f64 6566 6175 6c74 5f66 7265  ling_default_fre
-00000650: 7175 656e 6379 2220 6964 3d22 6361 705f  quency" id="cap_
-00000660: 6269 6c6c 696e 675f 6465 6661 756c 745f  billing_default_
-00000670: 6672 6571 7565 6e63 7922 3e0a 0909 0909  frequency">.....
-00000680: 093c 6f70 7469 6f6e 2076 616c 7565 3d22  .<option value="
-00000690: 2220 7365 6c65 6374 6564 3e3c 2f6f 7074  " selected></opt
-000006a0: 696f 6e3e 0a09 0909 0909 7b25 2066 6f72  ion>......{% for
-000006b0: 2076 616c 7565 2c20 6469 7370 6c61 7920   value, display 
-000006c0: 696e 2072 6563 7572 7265 6e63 655f 6672  in recurrence_fr
-000006d0: 6571 7565 6e63 6965 7320 257d 0a09 0909  equencies %}....
-000006e0: 0909 093c 6f70 7469 6f6e 2076 616c 7565  ...<option value
-000006f0: 3d22 7b7b 2076 616c 7565 207d 7d22 207b  ="{{ value }}" {
-00000700: 2520 6966 2063 6170 5f62 696c 6c69 6e67  % if cap_billing
-00000710: 5f64 6566 6175 6c74 5f66 7265 7175 656e  _default_frequen
-00000720: 6379 7c74 6f5f 696e 7420 3d3d 2076 616c  cy|to_int == val
-00000730: 7565 2025 7d73 656c 6563 7465 647b 2520  ue %}selected{% 
-00000740: 656e 6469 6620 257d 3e7b 7b20 6469 7370  endif %}>{{ disp
-00000750: 6c61 7920 7d7d 3c2f 6f70 7469 6f6e 3e0a  lay }}</option>.
-00000760: 0909 0909 097b 2520 656e 6466 6f72 2025  .....{% endfor %
-00000770: 7d0a 0909 0909 3c2f 7365 6c65 6374 3e0a  }.....</select>.
-00000780: 0909 093c 2f64 6976 3e0a 0909 3c2f 6469  ...</div>...</di
-00000790: 763e 0a09 093c 6469 7620 636c 6173 733d  v>...<div class=
-000007a0: 2266 6f72 6d2d 6772 6f75 7022 207b 2520  "form-group" {% 
-000007b0: 6966 206e 6f74 2065 7272 6f72 732e 6361  if not errors.ca
-000007c0: 705f 6269 6c6c 696e 675f 6465 6661 756c  p_billing_defaul
-000007d0: 745f 696e 7465 7276 616c 2061 6e64 206e  t_interval and n
-000007e0: 6f74 2065 7272 6f72 732e 6361 705f 6269  ot errors.cap_bi
-000007f0: 6c6c 696e 675f 6465 6661 756c 745f 6672  lling_default_fr
-00000800: 6571 7565 6e63 7920 257d 7374 796c 653d  equency %}style=
-00000810: 226d 6172 6769 6e2d 626f 7474 6f6d 3a20  "margin-bottom: 
-00000820: 3022 7b25 2065 6e64 6966 2025 7d3e 0a09  0"{% endif %}>..
-00000830: 0909 3c64 6976 2063 6c61 7373 3d22 636f  ..<div class="co
-00000840: 6c2d 736d 2d6f 6666 7365 742d 3320 636f  l-sm-offset-3 co
-00000850: 6c2d 736d 2d35 2063 6f6c 2d6d 642d 3620  l-sm-5 col-md-6 
-00000860: 6865 6c70 2d62 6c6f 636b 206c 6967 6874  help-block light
-00000870: 2d67 7265 7922 207b 2520 6966 206e 6f74  -grey" {% if not
-00000880: 2065 7272 6f72 732e 6361 705f 6269 6c6c   errors.cap_bill
-00000890: 696e 675f 6465 6661 756c 745f 696e 7465  ing_default_inte
-000008a0: 7276 616c 2061 6e64 206e 6f74 2065 7272  rval and not err
-000008b0: 6f72 732e 6361 705f 6269 6c6c 696e 675f  ors.cap_billing_
-000008c0: 6465 6661 756c 745f 6672 6571 7565 6e63  default_frequenc
-000008d0: 7920 257d 7374 796c 653d 226d 6172 6769  y %}style="margi
-000008e0: 6e2d 626f 7474 6f6d 3a20 303b 6d61 7267  n-bottom: 0;marg
-000008f0: 696e 2d74 6f70 3a20 3022 7b25 2065 6e64  in-top: 0"{% end
-00000900: 6966 2025 7d3e 0a09 0909 097b 2520 6966  if %}>.....{% if
-00000910: 2065 7272 6f72 732e 6361 705f 6269 6c6c   errors.cap_bill
-00000920: 696e 675f 6465 6661 756c 745f 696e 7465  ing_default_inte
-00000930: 7276 616c 206f 7220 6572 726f 7273 2e63  rval or errors.c
-00000940: 6170 5f62 696c 6c69 6e67 5f64 6566 6175  ap_billing_defau
-00000950: 6c74 5f66 7265 7175 656e 6379 2025 7d0a  lt_frequency %}.
-00000960: 0909 0909 097b 7b20 6572 726f 7273 2e63  .....{{ errors.c
-00000970: 6170 5f62 696c 6c69 6e67 5f64 6566 6175  ap_billing_defau
-00000980: 6c74 5f69 6e74 6572 7661 6c2e 6572 726f  lt_interval.erro
-00000990: 7220 7d7d 0a09 0909 0909 7b7b 2065 7272  r }}......{{ err
-000009a0: 6f72 732e 6361 705f 6269 6c6c 696e 675f  ors.cap_billing_
-000009b0: 6465 6661 756c 745f 6672 6571 7565 6e63  default_frequenc
-000009c0: 792e 6572 726f 7220 7d7d 0a09 0909 097b  y.error }}.....{
-000009d0: 2520 656e 6469 6620 257d 0a09 0909 3c2f  % endif %}....</
-000009e0: 6469 763e 0a09 093c 2f64 6976 3e0a 0909  div>...</div>...
-000009f0: 3c64 6976 2063 6c61 7373 3d22 666f 726d  <div class="form
-00000a00: 2d67 726f 7570 207b 2520 6966 2065 7272  -group {% if err
-00000a10: 6f72 732e 6361 705f 6269 6c6c 696e 675f  ors.cap_billing_
-00000a20: 6578 636c 7564 655f 746f 6f6c 7320 257d  exclude_tools %}
-00000a30: 6861 732d 6572 726f 727b 2520 656e 6469  has-error{% endi
-00000a40: 6620 257d 223e 0a09 0909 3c6c 6162 656c  f %}">....<label
-00000a50: 2063 6c61 7373 3d22 636f 6e74 726f 6c2d   class="control-
-00000a60: 6c61 6265 6c20 636f 6c2d 736d 2d33 2220  label col-sm-3" 
-00000a70: 666f 723d 2265 7863 6c75 6465 5f74 6f6f  for="exclude_too
-00000a80: 6c22 3e45 7863 6c75 6465 6420 746f 6f6c  l">Excluded tool
-00000a90: 733c 2f6c 6162 656c 3e0a 0909 093c 6469  s</label>....<di
-00000aa0: 7620 636c 6173 733d 2263 6f6c 2d73 6d2d  v class="col-sm-
-00000ab0: 3620 636f 6c2d 6d64 2d35 223e 0a09 0909  6 col-md-5">....
-00000ac0: 093c 696e 7075 7420 6964 3d22 6578 636c  .<input id="excl
-00000ad0: 7564 655f 746f 6f6c 2220 7479 7065 3d22  ude_tool" type="
-00000ae0: 7465 7874 2220 6175 746f 636f 6d70 6c65  text" autocomple
-00000af0: 7465 3d22 6f66 6622 2063 6c61 7373 3d22  te="off" class="
-00000b00: 666f 726d 2d63 6f6e 7472 6f6c 2220 706c  form-control" pl
-00000b10: 6163 6568 6f6c 6465 723d 2253 6561 7263  aceholder="Searc
-00000b20: 6820 666f 7220 6120 746f 6f6c 2074 6f20  h for a tool to 
-00000b30: 6578 636c 7564 6522 3e0a 0909 093c 2f64  exclude">....</d
-00000b40: 6976 3e0a 0909 093c 6469 7620 636c 6173  iv>....<div clas
-00000b50: 733d 2263 6f6c 2d73 6d2d 3320 636f 6c2d  s="col-sm-3 col-
-00000b60: 6d64 2d34 2068 656c 702d 626c 6f63 6b20  md-4 help-block 
-00000b70: 6c69 6768 742d 6772 6579 223e 0a20 2020  light-grey">.   
-00000b80: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
-00000b90: 6966 2065 7272 6f72 732e 6361 705f 6269  if errors.cap_bi
-00000ba0: 6c6c 696e 675f 6578 636c 7564 655f 746f  lling_exclude_to
-00000bb0: 6f6c 7320 257d 0a20 2020 2020 2020 2020  ols %}.         
-00000bc0: 2020 2020 2020 2020 2020 207b 7b20 6572             {{ er
-00000bd0: 726f 7273 2e63 6170 5f62 696c 6c69 6e67  rors.cap_billing
-00000be0: 5f65 7863 6c75 6465 5f74 6f6f 6c73 2e65  _exclude_tools.e
-00000bf0: 7272 6f72 207d 7d0a 2020 2020 2020 2020  rror }}.        
-00000c00: 2020 2020 2020 2020 7b25 2065 6e64 6966          {% endif
-00000c10: 2025 7d0a 2020 2020 2020 2020 2020 2020   %}.            
-00000c20: 3c2f 6469 763e 0a09 093c 2f64 6976 3e0a  </div>...</div>.
-00000c30: 0909 3c64 6976 2063 6c61 7373 3d22 666f  ..<div class="fo
-00000c40: 726d 2d67 726f 7570 223e 0a09 0909 3c64  rm-group">....<d
-00000c50: 6976 2069 643d 2265 7863 6c75 6465 2d6c  iv id="exclude-l
-00000c60: 6973 7422 2063 6c61 7373 3d22 636f 6c2d  ist" class="col-
-00000c70: 736d 2d6f 6666 7365 742d 3320 636f 6c2d  sm-offset-3 col-
-00000c80: 736d 2d34 223e 0a09 0909 094e 6f20 746f  sm-4">.....No to
-00000c90: 6f6c 7320 6172 6520 6578 636c 7564 6564  ols are excluded
-00000ca0: 2e0a 0909 093c 2f64 6976 3e0a 0909 3c2f  .....</div>...</
-00000cb0: 6469 763e 0a09 093c 6469 7620 636c 6173  div>...<div clas
-00000cc0: 733d 2263 7573 746f 6d69 7a61 7469 6f6e  s="customization
-00000cd0: 2d73 6570 6172 6174 696f 6e22 2073 7479  -separation" sty
-00000ce0: 6c65 3d22 6d61 7267 696e 2d62 6f74 746f  le="margin-botto
-00000cf0: 6d3a 2031 3570 7822 3e3c 2f64 6976 3e0a  m: 15px"></div>.
-00000d00: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
-00000d10: 7373 3d22 7465 7874 2d63 656e 7465 7222  ss="text-center"
-00000d20: 3e0a 2020 2020 2020 2020 2020 2020 7b25  >.            {%
-00000d30: 2062 7574 746f 6e20 7479 7065 3d22 7361   button type="sa
-00000d40: 7665 2220 7661 6c75 653d 2253 6176 6520  ve" value="Save 
-00000d50: 7365 7474 696e 6773 2220 257d 0a20 2020  settings" %}.   
-00000d60: 2020 2020 203c 2f64 6976 3e0a 093c 2f66       </div>..</f
-00000d70: 6f72 6d3e 0a3c 2f64 6976 3e0a 3c73 6372  orm>.</div>.<scr
-00000d80: 6970 743e 0a09 6675 6e63 7469 6f6e 2061  ipt>..function a
-00000d90: 6464 5f74 6f6f 6c28 6a71 7565 7279 5f65  dd_tool(jquery_e
-00000da0: 7665 6e74 2c20 7365 6172 6368 5f73 656c  vent, search_sel
-00000db0: 6563 7469 6f6e 2c20 6461 7461 7365 745f  ection, dataset_
-00000dc0: 6e61 6d65 290a 097b 0a20 2020 2020 2020  name)..{.       
-00000dd0: 2024 2874 6869 7329 2e74 7970 6561 6865   $(this).typeahe
-00000de0: 6164 2827 7661 6c27 2c20 2727 292e 666f  ad('val', '').fo
-00000df0: 6375 7328 293b 0a09 0961 6464 5f74 6f5f  cus();...add_to_
-00000e00: 6c69 7374 2822 2365 7863 6c75 6465 2d6c  list("#exclude-l
-00000e10: 6973 7422 2c20 2272 656d 6f76 655f 746f  ist", "remove_to
-00000e20: 6f6c 222c 2073 6561 7263 685f 7365 6c65  ol", search_sele
-00000e30: 6374 696f 6e2e 6964 2c20 7365 6172 6368  ction.id, search
-00000e40: 5f73 656c 6563 7469 6f6e 2e6e 616d 652c  _selection.name,
-00000e50: 2022 5265 6d6f 7665 2022 202b 2073 6561   "Remove " + sea
-00000e60: 7263 685f 7365 6c65 6374 696f 6e2e 6e61  rch_selection.na
-00000e70: 6d65 2c20 2263 6170 5f62 696c 6c69 6e67  me, "cap_billing
-00000e80: 5f65 7863 6c75 6465 5f74 6f6f 6c73 5f6c  _exclude_tools_l
-00000e90: 6973 7422 293b 0a09 7d0a 2020 2020 6675  ist");..}.    fu
-00000ea0: 6e63 7469 6f6e 2072 656d 6f76 655f 746f  nction remove_to
-00000eb0: 6f6c 2874 6f6f 6c5f 6964 290a 097b 0a09  ol(tool_id)..{..
-00000ec0: 0972 656d 6f76 655f 6672 6f6d 5f6c 6973  .remove_from_lis
-00000ed0: 7428 2223 6578 636c 7564 652d 6c69 7374  t("#exclude-list
-00000ee0: 222c 2022 2363 6170 5f62 696c 6c69 6e67  ", "#cap_billing
-00000ef0: 5f65 7863 6c75 6465 5f74 6f6f 6c73 5f6c  _exclude_tools_l
-00000f00: 6973 745f 2220 2b20 746f 6f6c 5f69 642c  ist_" + tool_id,
-00000f10: 2022 4e6f 2074 6f6f 6c73 2061 7265 2065   "No tools are e
-00000f20: 7863 6c75 6465 642e 2229 3b0a 097d 0a09  xcluded.");..}..
-00000f30: 2428 2723 6578 636c 7564 655f 746f 6f6c  $('#exclude_tool
-00000f40: 2729 2e61 7574 6f63 6f6d 706c 6574 6528  ').autocomplete(
-00000f50: 2774 6f6f 6c73 272c 2061 6464 5f74 6f6f  'tools', add_too
-00000f60: 6c2c 207b 7b20 746f 6f6c 737c 6a73 6f6e  l, {{ tools|json
-00000f70: 5f73 6561 7263 685f 6261 7365 207d 7d29  _search_base }})
-00000f80: 3b0a 2020 2020 7b25 2066 6f72 2074 6f6f  ;.    {% for too
-00000f90: 6c20 696e 2073 656c 6563 7465 645f 746f  l in selected_to
-00000fa0: 6f6c 7320 257d 0a09 0961 6464 5f74 6f6f  ols %}...add_too
-00000fb0: 6c28 756e 6465 6669 6e65 642c 207b 6e61  l(undefined, {na
-00000fc0: 6d65 3a27 7b7b 2074 6f6f 6c2e 6e61 6d65  me:'{{ tool.name
-00000fd0: 207d 7d27 2c20 6964 3a7b 7b20 746f 6f6c   }}', id:{{ tool
-00000fe0: 2e69 6420 7d7d 7d29 3b0a 097b 2520 656e  .id }}});..{% en
-00000ff0: 6466 6f72 2025 7d0a 3c2f 7363 7269 7074  dfor %}.</script
-00001000: 3e                                       >
+000000f0: 7266 5f74 6f6b 656e 2025 7d0a 2020 2020  rf_token %}.    
+00000100: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000110: 666f 726d 2d67 726f 7570 207b 2520 6966  form-group {% if
+00000120: 2065 7272 6f72 732e 6361 705f 6269 6c6c   errors.cap_bill
+00000130: 696e 675f 6465 6661 756c 745f 6269 6c6c  ing_default_bill
+00000140: 6162 6c65 5f74 7970 6573 2025 7d68 6173  able_types %}has
+00000150: 2d65 7272 6f72 7b25 2065 6e64 6966 2025  -error{% endif %
+00000160: 7d22 3e0a 2020 2020 2020 2020 2020 2020  }">.            
+00000170: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
+00000180: 6e74 726f 6c2d 6c61 6265 6c20 636f 6c2d  ntrol-label col-
+00000190: 736d 2d33 223e 4465 6661 756c 7420 6368  sm-3">Default ch
+000001a0: 6172 6765 733a 3c2f 6c61 6265 6c3e 0a20  arges:</label>. 
+000001b0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+000001c0: 636c 6173 733d 2263 6f6c 2d73 6d2d 3420  class="col-sm-4 
+000001d0: 636f 6c2d 6d64 2d33 223e 0a20 2020 2020  col-md-3">.     
+000001e0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+000001f0: 636c 6173 733d 2263 6865 636b 626f 7822  class="checkbox"
+00000200: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00000210: 2020 2020 2020 7b25 2066 6f72 2076 616c        {% for val
+00000220: 7565 2c20 6469 7370 6c61 7920 696e 2062  ue, display in b
+00000230: 696c 6c61 626c 655f 7479 7065 7320 257d  illable_types %}
+00000240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000250: 2020 2020 2020 2020 203c 6469 763e 0a20           <div>. 
+00000260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000270: 2020 2020 2020 2020 2020 203c 6c61 6265             <labe
+00000280: 6c3e 0a20 2020 2020 2020 2020 2020 2020  l>.             
+00000290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000002a0: 2020 203c 696e 7075 7420 7479 7065 3d22     <input type="
+000002b0: 6368 6563 6b62 6f78 220a 2020 2020 2020  checkbox".      
+000002c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000002d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000002e0: 206e 616d 653d 2263 6170 5f62 696c 6c69   name="cap_billi
+000002f0: 6e67 5f64 6566 6175 6c74 5f62 696c 6c61  ng_default_billa
+00000300: 626c 655f 7479 7065 735f 6c69 7374 220a  ble_types_list".
+00000310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000330: 2020 2020 2020 207b 2520 6966 2076 616c         {% if val
+00000340: 7565 2069 6e20 7365 6c65 6374 6564 5f62  ue in selected_b
+00000350: 696c 6c61 626c 655f 7479 7065 7320 257d  illable_types %}
+00000360: 6368 6563 6b65 647b 2520 656e 6469 6620  checked{% endif 
+00000370: 257d 0a20 2020 2020 2020 2020 2020 2020  %}.             
+00000380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000390: 2020 2020 2020 2020 2020 7661 6c75 653d            value=
+000003a0: 227b 7b20 7661 6c75 6520 7d7d 223e 0a20  "{{ value }}">. 
+000003b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000003c0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+000003d0: 7b20 6469 7370 6c61 7920 7d7d 0a20 2020  { display }}.   
+000003e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000003f0: 2020 2020 2020 2020 203c 2f6c 6162 656c           </label
+00000400: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00000410: 2020 2020 2020 2020 2020 3c2f 6469 763e            </div>
+00000420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000430: 2020 2020 207b 2520 656e 6466 6f72 2025       {% endfor %
+00000440: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00000450: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+00000460: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
+00000470: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
+00000480: 7373 3d22 636f 6c2d 736d 2d35 2063 6f6c  ss="col-sm-5 col
+00000490: 2d6d 642d 3620 6865 6c70 2d62 6c6f 636b  -md-6 help-block
+000004a0: 206c 6967 6874 2d67 7265 7922 3e0a 2020   light-grey">.  
+000004b0: 2020 2020 2020 2020 2020 2020 2020 7b25                {%
+000004c0: 2069 6620 6572 726f 7273 2e63 6170 5f62   if errors.cap_b
+000004d0: 696c 6c69 6e67 5f64 6566 6175 6c74 5f62  illing_default_b
+000004e0: 696c 6c61 626c 655f 7479 7065 7320 257d  illable_types %}
+000004f0: 7b7b 2065 7272 6f72 732e 6361 705f 6269  {{ errors.cap_bi
+00000500: 6c6c 696e 675f 6465 6661 756c 745f 6269  lling_default_bi
+00000510: 6c6c 6162 6c65 5f74 7970 6573 2e65 7272  llable_types.err
+00000520: 6f72 207d 7d7b 2520 656e 6469 6620 257d  or }}{% endif %}
+00000530: 0a20 2020 2020 2020 2020 2020 203c 2f64  .            </d
+00000540: 6976 3e0a 2020 2020 2020 2020 3c2f 6469  iv>.        </di
+00000550: 763e 0a20 2020 2020 2020 203c 6469 7620  v>.        <div 
+00000560: 636c 6173 733d 2266 6f72 6d2d 6772 6f75  class="form-grou
+00000570: 7020 7b25 2069 6620 6572 726f 7273 2e63  p {% if errors.c
+00000580: 6170 5f62 696c 6c69 6e67 5f64 6566 6175  ap_billing_defau
+00000590: 6c74 5f69 6e74 6572 7661 6c20 6f72 2065  lt_interval or e
+000005a0: 7272 6f72 732e 6361 705f 6269 6c6c 696e  rrors.cap_billin
+000005b0: 675f 6465 6661 756c 745f 6672 6571 7565  g_default_freque
+000005c0: 6e63 7920 257d 6861 732d 6572 726f 727b  ncy %}has-error{
+000005d0: 2520 656e 6469 6620 257d 223e 0a20 2020  % endif %}">.   
+000005e0: 2020 2020 2020 2020 203c 6c61 6265 6c20           <label 
+000005f0: 636c 6173 733d 2263 6f6e 7472 6f6c 2d6c  class="control-l
+00000600: 6162 656c 2063 6f6c 2d73 6d2d 3322 3e44  abel col-sm-3">D
+00000610: 6566 6175 6c74 2072 6573 6574 3a3c 2f6c  efault reset:</l
+00000620: 6162 656c 3e0a 2020 2020 2020 2020 2020  abel>.          
+00000630: 2020 3c64 6976 2063 6c61 7373 3d22 636f    <div class="co
+00000640: 6c2d 736d 2d32 2063 6f6c 2d6d 642d 3222  l-sm-2 col-md-2"
+00000650: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00000660: 2020 3c69 6e70 7574 2061 7269 612d 6c61    <input aria-la
+00000670: 6265 6c3d 2252 6573 6574 2069 6e74 6572  bel="Reset inter
+00000680: 7661 6c22 0a20 2020 2020 2020 2020 2020  val".           
+00000690: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+000006a0: 733d 2266 6f72 6d2d 636f 6e74 726f 6c22  s="form-control"
+000006b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000006c0: 2020 2020 2020 2020 7479 7065 3d22 6e75          type="nu
+000006d0: 6d62 6572 220a 2020 2020 2020 2020 2020  mber".          
+000006e0: 2020 2020 2020 2020 2020 2020 2069 643d               id=
+000006f0: 2263 6170 5f62 696c 6c69 6e67 5f64 6566  "cap_billing_def
+00000700: 6175 6c74 5f69 6e74 6572 7661 6c22 0a20  ault_interval". 
+00000710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000720: 2020 2020 2020 6e61 6d65 3d22 6361 705f        name="cap_
+00000730: 6269 6c6c 696e 675f 6465 6661 756c 745f  billing_default_
+00000740: 696e 7465 7276 616c 220a 2020 2020 2020  interval".      
+00000750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000760: 2076 616c 7565 3d22 7b7b 2063 6170 5f62   value="{{ cap_b
+00000770: 696c 6c69 6e67 5f64 6566 6175 6c74 5f69  illing_default_i
+00000780: 6e74 6572 7661 6c20 7d7d 223e 0a20 2020  nterval }}">.   
+00000790: 2020 2020 2020 2020 203c 2f64 6976 3e0a           </div>.
+000007a0: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+000007b0: 2063 6c61 7373 3d22 636f 6c2d 736d 2d34   class="col-sm-4
+000007c0: 2063 6f6c 2d6d 642d 3322 3e0a 2020 2020   col-md-3">.    
+000007d0: 2020 2020 2020 2020 2020 2020 3c73 656c              <sel
+000007e0: 6563 7420 636c 6173 733d 2263 6f6c 2d73  ect class="col-s
+000007f0: 6d2d 3220 666f 726d 2d63 6f6e 7472 6f6c  m-2 form-control
+00000800: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00000810: 2020 2020 2020 2020 2020 7374 796c 653d            style=
+00000820: 2264 6973 706c 6179 3a69 6e6c 696e 652d  "display:inline-
+00000830: 626c 6f63 6b22 0a20 2020 2020 2020 2020  block".         
+00000840: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00000850: 7269 612d 6c61 6265 6c3d 2252 6573 6574  ria-label="Reset
+00000860: 2066 7265 7175 656e 6379 220a 2020 2020   frequency".    
+00000870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000880: 2020 2020 6e61 6d65 3d22 6361 705f 6269      name="cap_bi
+00000890: 6c6c 696e 675f 6465 6661 756c 745f 6672  lling_default_fr
+000008a0: 6571 7565 6e63 7922 0a20 2020 2020 2020  equency".       
+000008b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000008c0: 2069 643d 2263 6170 5f62 696c 6c69 6e67   id="cap_billing
+000008d0: 5f64 6566 6175 6c74 5f66 7265 7175 656e  _default_frequen
+000008e0: 6379 223e 0a20 2020 2020 2020 2020 2020  cy">.           
+000008f0: 2020 2020 2020 2020 203c 6f70 7469 6f6e           <option
+00000900: 2076 616c 7565 3d22 2220 7365 6c65 6374   value="" select
+00000910: 6564 3e3c 2f6f 7074 696f 6e3e 0a20 2020  ed></option>.   
+00000920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000930: 207b 2520 666f 7220 7661 6c75 652c 2064   {% for value, d
+00000940: 6973 706c 6179 2069 6e20 7265 6375 7272  isplay in recurr
+00000950: 656e 6365 5f66 7265 7175 656e 6369 6573  ence_frequencies
+00000960: 2025 7d0a 2020 2020 2020 2020 2020 2020   %}.            
+00000970: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
+00000980: 696f 6e20 7661 6c75 653d 227b 7b20 7661  ion value="{{ va
+00000990: 6c75 6520 7d7d 2220 7b25 2069 6620 6361  lue }}" {% if ca
+000009a0: 705f 6269 6c6c 696e 675f 6465 6661 756c  p_billing_defaul
+000009b0: 745f 6672 6571 7565 6e63 797c 746f 5f69  t_frequency|to_i
+000009c0: 6e74 203d 3d20 7661 6c75 6520 257d 7365  nt == value %}se
+000009d0: 6c65 6374 6564 7b25 2065 6e64 6966 2025  lected{% endif %
+000009e0: 7d3e 0a20 2020 2020 2020 2020 2020 2020  }>.             
+000009f0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00000a00: 7b20 6469 7370 6c61 7920 7d7d 0a20 2020  { display }}.   
+00000a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a20: 2020 2020 203c 2f6f 7074 696f 6e3e 0a20       </option>. 
+00000a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a40: 2020 207b 2520 656e 6466 6f72 2025 7d0a     {% endfor %}.
+00000a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a60: 3c2f 7365 6c65 6374 3e0a 2020 2020 2020  </select>.      
+00000a70: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000a80: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
+00000a90: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000aa0: 666f 726d 2d67 726f 7570 220a 2020 2020  form-group".    
+00000ab0: 2020 2020 2020 2020 207b 2520 6966 206e           {% if n
+00000ac0: 6f74 2065 7272 6f72 732e 6361 705f 6269  ot errors.cap_bi
+00000ad0: 6c6c 696e 675f 6465 6661 756c 745f 696e  lling_default_in
+00000ae0: 7465 7276 616c 2061 6e64 206e 6f74 2065  terval and not e
+00000af0: 7272 6f72 732e 6361 705f 6269 6c6c 696e  rrors.cap_billin
+00000b00: 675f 6465 6661 756c 745f 6672 6571 7565  g_default_freque
+00000b10: 6e63 7920 257d 7374 796c 653d 226d 6172  ncy %}style="mar
+00000b20: 6769 6e2d 626f 7474 6f6d 3a20 3022 7b25  gin-bottom: 0"{%
+00000b30: 2065 6e64 6966 2025 7d3e 0a20 2020 2020   endif %}>.     
+00000b40: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00000b50: 733d 2263 6f6c 2d73 6d2d 6f66 6673 6574  s="col-sm-offset
+00000b60: 2d33 2063 6f6c 2d73 6d2d 3520 636f 6c2d  -3 col-sm-5 col-
+00000b70: 6d64 2d36 2068 656c 702d 626c 6f63 6b20  md-6 help-block 
+00000b80: 6c69 6768 742d 6772 6579 220a 2020 2020  light-grey".    
+00000b90: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000ba0: 6966 206e 6f74 2065 7272 6f72 732e 6361  if not errors.ca
+00000bb0: 705f 6269 6c6c 696e 675f 6465 6661 756c  p_billing_defaul
+00000bc0: 745f 696e 7465 7276 616c 2061 6e64 206e  t_interval and n
+00000bd0: 6f74 2065 7272 6f72 732e 6361 705f 6269  ot errors.cap_bi
+00000be0: 6c6c 696e 675f 6465 6661 756c 745f 6672  lling_default_fr
+00000bf0: 6571 7565 6e63 7920 257d 7374 796c 653d  equency %}style=
+00000c00: 226d 6172 6769 6e2d 626f 7474 6f6d 3a20  "margin-bottom: 
+00000c10: 303b 6d61 7267 696e 2d74 6f70 3a20 3022  0;margin-top: 0"
+00000c20: 7b25 2065 6e64 6966 2025 7d3e 0a20 2020  {% endif %}>.   
+00000c30: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000c40: 6966 2065 7272 6f72 732e 6361 705f 6269  if errors.cap_bi
+00000c50: 6c6c 696e 675f 6465 6661 756c 745f 696e  lling_default_in
+00000c60: 7465 7276 616c 206f 7220 6572 726f 7273  terval or errors
+00000c70: 2e63 6170 5f62 696c 6c69 6e67 5f64 6566  .cap_billing_def
+00000c80: 6175 6c74 5f66 7265 7175 656e 6379 2025  ault_frequency %
+00000c90: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00000ca0: 2020 2020 2020 7b7b 2065 7272 6f72 732e        {{ errors.
+00000cb0: 6361 705f 6269 6c6c 696e 675f 6465 6661  cap_billing_defa
+00000cc0: 756c 745f 696e 7465 7276 616c 2e65 7272  ult_interval.err
+00000cd0: 6f72 207d 7d0a 2020 2020 2020 2020 2020  or }}.          
+00000ce0: 2020 2020 2020 2020 2020 7b7b 2065 7272            {{ err
+00000cf0: 6f72 732e 6361 705f 6269 6c6c 696e 675f  ors.cap_billing_
+00000d00: 6465 6661 756c 745f 6672 6571 7565 6e63  default_frequenc
+00000d10: 792e 6572 726f 7220 7d7d 0a20 2020 2020  y.error }}.     
+00000d20: 2020 2020 2020 2020 2020 207b 2520 656e             {% en
+00000d30: 6469 6620 257d 0a20 2020 2020 2020 2020  dif %}.         
+00000d40: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00000d50: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+00000d60: 203c 6469 7620 636c 6173 733d 2266 6f72   <div class="for
+00000d70: 6d2d 6772 6f75 7020 7b25 2069 6620 6572  m-group {% if er
+00000d80: 726f 7273 2e63 6170 5f62 696c 6c69 6e67  rors.cap_billing
+00000d90: 5f65 7863 6c75 6465 5f74 6f6f 6c73 2025  _exclude_tools %
+00000da0: 7d68 6173 2d65 7272 6f72 7b25 2065 6e64  }has-error{% end
+00000db0: 6966 2025 7d22 3e0a 2020 2020 2020 2020  if %}">.        
+00000dc0: 2020 2020 3c6c 6162 656c 2063 6c61 7373      <label class
+00000dd0: 3d22 636f 6e74 726f 6c2d 6c61 6265 6c20  ="control-label 
+00000de0: 636f 6c2d 736d 2d33 2220 666f 723d 2265  col-sm-3" for="e
+00000df0: 7863 6c75 6465 5f74 6f6f 6c22 3e45 7863  xclude_tool">Exc
+00000e00: 6c75 6465 6420 746f 6f6c 733c 2f6c 6162  luded tools</lab
+00000e10: 656c 3e0a 2020 2020 2020 2020 2020 2020  el>.            
+00000e20: 3c64 6976 2063 6c61 7373 3d22 636f 6c2d  <div class="col-
+00000e30: 736d 2d36 2063 6f6c 2d6d 642d 3522 3e0a  sm-6 col-md-5">.
+00000e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e50: 3c69 6e70 7574 2069 643d 2265 7863 6c75  <input id="exclu
+00000e60: 6465 5f74 6f6f 6c22 0a20 2020 2020 2020  de_tool".       
+00000e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e80: 7479 7065 3d22 7465 7874 220a 2020 2020  type="text".    
+00000e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ea0: 2020 2061 7574 6f63 6f6d 706c 6574 653d     autocomplete=
+00000eb0: 226f 6666 220a 2020 2020 2020 2020 2020  "off".          
+00000ec0: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
+00000ed0: 7373 3d22 666f 726d 2d63 6f6e 7472 6f6c  ss="form-control
+00000ee0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00000ef0: 2020 2020 2020 2020 2070 6c61 6365 686f           placeho
+00000f00: 6c64 6572 3d22 5365 6172 6368 2066 6f72  lder="Search for
+00000f10: 2061 2074 6f6f 6c20 746f 2065 7863 6c75   a tool to exclu
+00000f20: 6465 223e 0a20 2020 2020 2020 2020 2020  de">.           
+00000f30: 203c 2f64 6976 3e0a 2020 2020 2020 2020   </div>.        
+00000f40: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00000f50: 636f 6c2d 736d 2d33 2063 6f6c 2d6d 642d  col-sm-3 col-md-
+00000f60: 3420 6865 6c70 2d62 6c6f 636b 206c 6967  4 help-block lig
+00000f70: 6874 2d67 7265 7922 3e0a 2020 2020 2020  ht-grey">.      
+00000f80: 2020 2020 2020 2020 2020 7b25 2069 6620            {% if 
+00000f90: 6572 726f 7273 2e63 6170 5f62 696c 6c69  errors.cap_billi
+00000fa0: 6e67 5f65 7863 6c75 6465 5f74 6f6f 6c73  ng_exclude_tools
+00000fb0: 2025 7d7b 7b20 6572 726f 7273 2e63 6170   %}{{ errors.cap
+00000fc0: 5f62 696c 6c69 6e67 5f65 7863 6c75 6465  _billing_exclude
+00000fd0: 5f74 6f6f 6c73 2e65 7272 6f72 207d 7d7b  _tools.error }}{
+00000fe0: 2520 656e 6469 6620 257d 0a20 2020 2020  % endif %}.     
+00000ff0: 2020 2020 2020 203c 2f64 6976 3e0a 2020         </div>.  
+00001000: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00001010: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+00001020: 2266 6f72 6d2d 6772 6f75 7022 3e0a 2020  "form-group">.  
+00001030: 2020 2020 2020 2020 2020 3c64 6976 2069            <div i
+00001040: 643d 2265 7863 6c75 6465 2d6c 6973 7422  d="exclude-list"
+00001050: 2063 6c61 7373 3d22 636f 6c2d 736d 2d6f   class="col-sm-o
+00001060: 6666 7365 742d 3320 636f 6c2d 736d 2d34  ffset-3 col-sm-4
+00001070: 223e 4e6f 2074 6f6f 6c73 2061 7265 2065  ">No tools are e
+00001080: 7863 6c75 6465 642e 3c2f 6469 763e 0a20  xcluded.</div>. 
+00001090: 2020 2020 2020 203c 2f64 6976 3e0a 2020         </div>.  
+000010a0: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
+000010b0: 3d22 6375 7374 6f6d 697a 6174 696f 6e2d  ="customization-
+000010c0: 7365 7061 7261 7469 6f6e 2220 7374 796c  separation" styl
+000010d0: 653d 226d 6172 6769 6e2d 626f 7474 6f6d  e="margin-bottom
+000010e0: 3a20 3135 7078 223e 3c2f 6469 763e 0a20  : 15px"></div>. 
+000010f0: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00001100: 733d 2274 6578 742d 6365 6e74 6572 223e  s="text-center">
+00001110: 7b25 2062 7574 746f 6e20 7479 7065 3d22  {% button type="
+00001120: 7361 7665 2220 7661 6c75 653d 2253 6176  save" value="Sav
+00001130: 6520 7365 7474 696e 6773 2220 257d 3c2f  e settings" %}</
+00001140: 6469 763e 0a20 2020 203c 2f66 6f72 6d3e  div>.    </form>
+00001150: 0a3c 2f64 6976 3e0a 3c73 6372 6970 743e  .</div>.<script>
+00001160: 0a09 6675 6e63 7469 6f6e 2061 6464 5f74  ..function add_t
+00001170: 6f6f 6c28 6a71 7565 7279 5f65 7665 6e74  ool(jquery_event
+00001180: 2c20 7365 6172 6368 5f73 656c 6563 7469  , search_selecti
+00001190: 6f6e 2c20 6461 7461 7365 745f 6e61 6d65  on, dataset_name
+000011a0: 290a 097b 0a20 2020 2020 2020 2024 2874  )..{.        $(t
+000011b0: 6869 7329 2e74 7970 6561 6865 6164 2827  his).typeahead('
+000011c0: 7661 6c27 2c20 2727 292e 666f 6375 7328  val', '').focus(
+000011d0: 293b 0a09 0961 6464 5f74 6f5f 6c69 7374  );...add_to_list
+000011e0: 2822 2365 7863 6c75 6465 2d6c 6973 7422  ("#exclude-list"
+000011f0: 2c20 2272 656d 6f76 655f 746f 6f6c 222c  , "remove_tool",
+00001200: 2073 6561 7263 685f 7365 6c65 6374 696f   search_selectio
+00001210: 6e2e 6964 2c20 7365 6172 6368 5f73 656c  n.id, search_sel
+00001220: 6563 7469 6f6e 2e6e 616d 652c 2022 5265  ection.name, "Re
+00001230: 6d6f 7665 2022 202b 2073 6561 7263 685f  move " + search_
+00001240: 7365 6c65 6374 696f 6e2e 6e61 6d65 2c20  selection.name, 
+00001250: 2263 6170 5f62 696c 6c69 6e67 5f65 7863  "cap_billing_exc
+00001260: 6c75 6465 5f74 6f6f 6c73 5f6c 6973 7422  lude_tools_list"
+00001270: 293b 0a09 7d0a 2020 2020 6675 6e63 7469  );..}.    functi
+00001280: 6f6e 2072 656d 6f76 655f 746f 6f6c 2874  on remove_tool(t
+00001290: 6f6f 6c5f 6964 290a 097b 0a09 0972 656d  ool_id)..{...rem
+000012a0: 6f76 655f 6672 6f6d 5f6c 6973 7428 2223  ove_from_list("#
+000012b0: 6578 636c 7564 652d 6c69 7374 222c 2022  exclude-list", "
+000012c0: 2363 6170 5f62 696c 6c69 6e67 5f65 7863  #cap_billing_exc
+000012d0: 6c75 6465 5f74 6f6f 6c73 5f6c 6973 745f  lude_tools_list_
+000012e0: 2220 2b20 746f 6f6c 5f69 642c 2022 4e6f  " + tool_id, "No
+000012f0: 2074 6f6f 6c73 2061 7265 2065 7863 6c75   tools are exclu
+00001300: 6465 642e 2229 3b0a 097d 0a09 2428 2723  ded.");..}..$('#
+00001310: 6578 636c 7564 655f 746f 6f6c 2729 2e61  exclude_tool').a
+00001320: 7574 6f63 6f6d 706c 6574 6528 2774 6f6f  utocomplete('too
+00001330: 6c73 272c 2061 6464 5f74 6f6f 6c2c 207b  ls', add_tool, {
+00001340: 7b20 746f 6f6c 737c 6a73 6f6e 5f73 6561  { tools|json_sea
+00001350: 7263 685f 6261 7365 207d 7d29 3b0a 2020  rch_base }});.  
+00001360: 2020 7b25 2066 6f72 2074 6f6f 6c20 696e    {% for tool in
+00001370: 2073 656c 6563 7465 645f 746f 6f6c 7320   selected_tools 
+00001380: 257d 0a09 0961 6464 5f74 6f6f 6c28 756e  %}...add_tool(un
+00001390: 6465 6669 6e65 642c 207b 6e61 6d65 3a27  defined, {name:'
+000013a0: 7b7b 2074 6f6f 6c2e 6e61 6d65 207d 7d27  {{ tool.name }}'
+000013b0: 2c20 6964 3a7b 7b20 746f 6f6c 2e69 6420  , id:{{ tool.id 
+000013c0: 7d7d 7d29 3b0a 097b 2520 656e 6466 6f72  }}});..{% endfor
+000013d0: 2025 7d0a 3c2f 7363 7269 7074 3e0a        %}.</script>.
```

## NEMO_billing/invoices/models.py

```diff
@@ -97,16 +97,20 @@
         blank=True,
         help_text="Email to send the invoice to. A comma-separated list can be used. Leave blank to use project managers/PIs emails",
     )
     expires_on = models.DateField(
         null=True, blank=True, help_text="Date after which this project will be automatically deactivated."
     )
     addressee = models.TextField(null=True, blank=True, help_text="The addressee details to be included in the invoice")
-    institution = models.ForeignKey(Institution, null=True, blank=True, help_text="The project institution", on_delete=models.SET_NULL)
-    department = models.ForeignKey(Department, null=True, blank=True, help_text="The project department", on_delete=models.SET_NULL)
+    institution = models.ForeignKey(
+        Institution, null=True, blank=True, help_text="The project institution", on_delete=models.SET_NULL
+    )
+    department = models.ForeignKey(
+        Department, null=True, blank=True, help_text="The project department", on_delete=models.SET_NULL
+    )
     staff_host = models.ForeignKey(User, null=True, blank=True, help_text="The project host", on_delete=models.SET_NULL)
     comments = models.TextField(null=True, blank=True)
     no_charge = models.BooleanField(
         default=False, help_text="Check this box if invoices should not be created for this project."
     )
     no_tax = models.BooleanField(default=False, help_text="Check this box if this project is tax exempt.")
 
@@ -449,15 +453,15 @@
         return InvoicePayment.objects.create(
             invoice=self,
             created_by=user,
             updated_by=user,
             payment_received=received,
             payment_processed=processed,
             amount=amount,
-            note=note
+            note=note,
         )
 
     def tax_display(self) -> str:
         return display_amount(
             self.invoicesummaryitem_set.aggregate(
                 total_tax=Coalesce(
                     Sum(
```

## NEMO_billing/invoices/processors.py

```diff
@@ -471,17 +471,15 @@
                 summary_items.append(summary_item)
         return summary_items
 
     def category_name_for_item_type(self, item_type: Optional[Union[BillableItemType, int]]) -> str:
         billable_item_type = (
             item_type
             if isinstance(item_type, BillableItemType)
-            else BillableItemType(item_type)
-            if isinstance(item_type, int)
-            else None
+            else BillableItemType(item_type) if isinstance(item_type, int) else None
         )
         if not billable_item_type:
             return ""
         if billable_item_type == BillableItemType.TOOL_USAGE:
             return "Tool Usage"
         elif billable_item_type == BillableItemType.AREA_ACCESS:
             return "Area Access"
```

## NEMO_billing/invoices/renderers.py

```diff
@@ -101,15 +101,18 @@
         pdf.add_title("Invoice")
         key_value_col_width = [65, None]
         pdf.add_space(1, 30)
         details_data = [
             ("Date:", self.format_date_time(invoice.created_date, date_only=True)),
             ("Invoice:", invoice.invoice_number),
             ("Project:", invoice.project_details.name),
-            (ProjectsAccountsCustomization.get("project_application_identifier_name")+":", invoice.project_details.project.application_identifier),
+            (
+                ProjectsAccountsCustomization.get("project_application_identifier_name") + ":",
+                invoice.project_details.project.application_identifier,
+            ),
         ]
         pdf.add_table_key_value(details_data, key_value_col_width, details_key_style, default_style)
         pdf.add_space(1, 15)
         if invoice.project_details.addressee:
             pdf.add_table_key_value(
                 [("To:", invoice.project_details.addressee)], key_value_col_width, details_key_style, default_style
             )
@@ -259,15 +262,15 @@
         fund_items = invoice.invoicesummaryitem_set.filter(
             summary_item_type=InvoiceSummaryItem.InvoiceSummaryItemType.FUND
         )
         for fund_summary in fund_items:
             table_data.append(
                 [
                     (fund_summary.name, category_name_style),
-                    "", # Don't show details for Fund (it contains the id)
+                    "",  # Don't show details for Fund (it contains the id)
                     (display_amount(fund_summary.amount, invoice.configuration), category_amount_style),
                 ]
             )
 
         table_data.append(
             [
                 ("Grand Total", category_name_style),
@@ -465,15 +468,17 @@
         super().__init__()
 
     def get_file_extension(self):
         return "csv"
 
     def init_document(self, invoice: Invoice, file_bytes) -> Any:
         document = BasicDisplayTable()
-        document.add_header((self.PROJECT_ID_KEY, ProjectsAccountsCustomization.get("project_application_identifier_name")))
+        document.add_header(
+            (self.PROJECT_ID_KEY, ProjectsAccountsCustomization.get("project_application_identifier_name"))
+        )
         if invoice.project_details.project.account.type:
             document.add_header((self.ACCOUNT_TYPE_KEY, "Account type"))
         if invoice.invoicedetailitem_set.filter(core_facility__isempty=False).exists():
             document.add_header((self.FACILITY_KEY, "Facility"))
         document.add_header((self.USER_KEY, "User"))
         document.add_header((self.ITEM_TYPE_KEY, "Item Type"))
         document.add_header((self.ITEM_KEY, "Item"))
```

## NEMO_billing/invoices/urls.py

```diff
@@ -1,17 +1,26 @@
 from NEMO.urls import router, sort_urls
 from django.urls import path, re_path
 
 from NEMO_billing.invoices import api
 from NEMO_billing.invoices.views import invoices, project, usage
 
+
+def replace_api_url(url_to_replace, new_config):
+    for reg in router.registry:
+        if reg[0] == url_to_replace:
+            router.registry.remove(reg)
+    router.register(*new_config)
+
+
 # Rest API URLs
-router.register(r"billing/projects", api.ProjectWithDetailsViewSet)
+router.register(r"billing/projects", api.ProjectWithDetailsViewSet, basename="projects_with_details")
 router.register(r"billing/invoice_payments", api.InvoicePaymentViewSet)
 router.register(r"billing/billing_data", api.BillingDataViewSet, basename="billingdata")
+replace_api_url("projects", (r"projects", api.ProjectWithDetailsViewSet))
 router.registry.sort(key=sort_urls)
 
 urlpatterns = [
     path("invoices/", invoices.invoices, name="invoices"),
     path("invoices/filter/<int:year>/", invoices.invoices, name="invoices_year"),
     path("invoices/filter/<int:year>/<int:month>/", invoices.invoices, name="invoices_month"),
     path("invoices/search/", invoices.search_invoices, name="search_invoices"),
```

## NEMO_billing/invoices/utilities.py

```diff
@@ -51,17 +51,15 @@
     # We need to specifically check for None since amount = 0 will evaluate to False
     if amount is None:
         return ""
     rounded_amount = round(amount, 2)
     currency = (
         f"{configuration.currency_symbol}"
         if configuration and configuration.currency_symbol
-        else f"{configuration.currency} "
-        if configuration and configuration.currency
-        else ""
+        else f"{configuration.currency} " if configuration and configuration.currency else ""
     )
     if amount < 0:
         return f"({currency}{number_format(abs(rounded_amount), decimal_pos=2)})"
     else:
         return f"{currency}{number_format(rounded_amount, decimal_pos=2)}"
```

## NEMO_billing/invoices/migrations/0001_initial.py

```diff
@@ -1,134 +1,305 @@
 # Generated by Django 2.2.13 on 2021-03-13 12:49
 
-import datetime
-from django.conf import settings
-from django.db import migrations, models
 import NEMO.fields
 import django.db.models.deletion
+from django.conf import settings
+from django.db import migrations, models
 
 import NEMO_billing.invoices.utilities
 
 
 class Migration(migrations.Migration):
 
     initial = True
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('rates', '0001_initial'),
-        ('NEMO', '0028_version_3_9_0'),
+        ("rates", "0001_initial"),
+        ("NEMO", "0028_version_3_9_0"),
     ]
 
     def create_invoice_customizations(apps, schema_editor):
         CustomizationModel = apps.get_model("NEMO", "Customization")
-        CustomizationModel.objects.update_or_create(name="invoice_number_format", defaults={'value': "{:04d}"})
-        CustomizationModel.objects.update_or_create(name="invoice_number_current", defaults={'value': "0"})
+        CustomizationModel.objects.update_or_create(name="invoice_number_format", defaults={"value": "{:04d}"})
+        CustomizationModel.objects.update_or_create(name="invoice_number_current", defaults={"value": "0"})
 
     operations = [
         migrations.CreateModel(
-            name='InvoiceConfiguration',
+            name="InvoiceConfiguration",
+            fields=[
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "name",
+                    models.CharField(help_text="The name of this invoice configuration", max_length=200, unique=True),
+                ),
+                (
+                    "invoice_due_in",
+                    models.PositiveIntegerField(
+                        default=30, help_text="The default number of days invoices are due after"
+                    ),
+                ),
+                (
+                    "reminder_frequency",
+                    models.PositiveIntegerField(
+                        null=True,
+                        blank=True,
+                        default=7,
+                        help_text="How often to send a reminder. Default value is 7, meaning every week after past due invoice",
+                    ),
+                ),
+                ("email_from", models.EmailField(help_text="The email address used to send invoices and reminders")),
+                (
+                    "email_cc",
+                    NEMO.fields.MultiEmailField(
+                        null=True,
+                        blank=True,
+                        help_text="Email to cc the invoice to. A comma-separated list can be used",
+                        max_length=2000,
+                    ),
+                ),
+                (
+                    "terms",
+                    models.TextField(
+                        null=True, blank=True, help_text="Terms and conditions to be included in the invoice"
+                    ),
+                ),
+                ("merchant_name", models.CharField(max_length=255)),
+                (
+                    "merchant_details",
+                    models.TextField(
+                        blank=True,
+                        help_text="The merchant details to be included in the invoice (address, phone number etc.)",
+                        null=True,
+                    ),
+                ),
+                (
+                    "merchant_logo",
+                    models.ImageField(
+                        blank=True, null=True, upload_to=NEMO_billing.invoices.utilities.get_merchant_logo_filename
+                    ),
+                ),
+                ("currency", models.CharField(default="USD", max_length=4)),
+                ("currency_symbol", models.CharField(null=True, blank=True, max_length=4, default="$")),
+                (
+                    "tax",
+                    models.DecimalField(
+                        null=True,
+                        blank=True,
+                        decimal_places=3,
+                        max_digits=5,
+                        help_text="Tax in percent. For 20.5% enter 20.5",
+                    ),
+                ),
+                ("tax_name", models.CharField(max_length=50, null=True, blank=True, default="VAT")),
+                (
+                    "detailed_invoice",
+                    models.BooleanField(
+                        default=True, help_text="Check this box if customers should receive a detailed invoice."
+                    ),
+                ),
+            ],
+        ),
+        migrations.CreateModel(
+            name="ProjectBillingDetails",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The name of this invoice configuration', max_length=200, unique=True)),
-                ('invoice_due_in', models.PositiveIntegerField(default=30, help_text='The default number of days invoices are due after')),
-                ('reminder_frequency', models.PositiveIntegerField(null=True, blank=True, default=7, help_text="How often to send a reminder. Default value is 7, meaning every week after past due invoice")),
-                ('email_from', models.EmailField(help_text="The email address used to send invoices and reminders")),
-                ('email_cc', NEMO.fields.MultiEmailField(null=True, blank=True, help_text='Email to cc the invoice to. A comma-separated list can be used', max_length=2000)),
-                ('terms', models.TextField(null=True, blank=True, help_text="Terms and conditions to be included in the invoice")),
-                ('merchant_name', models.CharField(max_length=255)),
-                ('merchant_details', models.TextField(blank=True, help_text='The merchant details to be included in the invoice (address, phone number etc.)', null=True)),
-                ('merchant_logo', models.ImageField(blank=True, null=True, upload_to=NEMO_billing.invoices.utilities.get_merchant_logo_filename)),
-                ('currency', models.CharField(default='USD', max_length=4)),
-                ('currency_symbol', models.CharField(null=True, blank=True, max_length=4, default="$")),
-                ('tax', models.DecimalField(null=True, blank=True, decimal_places=3, max_digits=5, help_text="Tax in percent. For 20.5% enter 20.5")),
-                ('tax_name', models.CharField(max_length=50, null=True, blank=True, default="VAT")),
-                ('detailed_invoice', models.BooleanField(default=True, help_text='Check this box if customers should receive a detailed invoice.')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "category",
+                    models.ForeignKey(null=True, blank=True, on_delete=models.SET_NULL, to="rates.RateCategory"),
+                ),
+                (
+                    "project_name",
+                    models.CharField(
+                        blank=True,
+                        help_text="The project name that will appear on the invoices. Leave blank to use NEMO project name",
+                        max_length=200,
+                        null=True,
+                    ),
+                ),
+                (
+                    "contact_name",
+                    models.CharField(
+                        blank=True, help_text="The contact name to use in the invoice email", max_length=255, null=True
+                    ),
+                ),
+                (
+                    "contact_email",
+                    NEMO.fields.MultiEmailField(
+                        null=True,
+                        blank=True,
+                        help_text="Email to send the invoice to. A comma-separated list can be used. Leave blank to use project managers/PIs emails",
+                        max_length=2000,
+                    ),
+                ),
+                (
+                    "details",
+                    models.TextField(
+                        blank=True,
+                        help_text="The project details to be included in the invoice (address, etc.)",
+                        null=True,
+                    ),
+                ),
+                (
+                    "no_charge",
+                    models.BooleanField(
+                        default=False, help_text="Check this box if invoices should not be created for this project."
+                    ),
+                ),
+                ("project", models.OneToOneField(on_delete=django.db.models.deletion.PROTECT, to="NEMO.Project")),
             ],
+            options={"verbose_name_plural": "Project details"},
         ),
         migrations.CreateModel(
-            name='ProjectBillingDetails',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('category', models.ForeignKey(null=True, blank=True, on_delete=models.SET_NULL, to='rates.RateCategory')),
-                ('project_name', models.CharField(blank=True, help_text='The project name that will appear on the invoices. Leave blank to use NEMO project name', max_length=200, null=True)),
-                ('contact_name', models.CharField(blank=True, help_text='The contact name to use in the invoice email', max_length=255, null=True)),
-                ('contact_email', NEMO.fields.MultiEmailField(null=True, blank=True, help_text='Email to send the invoice to. A comma-separated list can be used. Leave blank to use project managers/PIs emails', max_length=2000)),
-                ('details', models.TextField(blank=True, help_text='The project details to be included in the invoice (address, etc.)', null=True)),
-                ('no_charge', models.BooleanField(default=False, help_text="Check this box if invoices should not be created for this project.")),
-                ('project', models.OneToOneField(on_delete=django.db.models.deletion.PROTECT, to='NEMO.Project')),
-            ],
-            options={'verbose_name_plural': 'Project details'}
-        ),
-        migrations.CreateModel(
-            name='Invoice',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('invoice_number', models.CharField(blank=True, help_text='Leave blank to be assigned automatically', max_length=100, unique=True)),
-                ('start', models.DateTimeField()),
-                ('end', models.DateTimeField()),
-                ('due_date', models.DateField(null=True, blank=True)),
-                ('sent_date', models.DateTimeField(null=True, blank=True)),
-                ('last_sent_date', models.DateTimeField(null=True, blank=True)),
-                ('last_reminder_sent_date', models.DateTimeField(null=True, blank=True)),
-                ('reviewed_date', models.DateTimeField(null=True, blank=True)),
-                ('created_date', models.DateTimeField(auto_now_add=True)),
-                ('voided_date', models.DateTimeField(null=True, blank=True)),
-                ('total_amount', models.DecimalField(decimal_places=2, max_digits=14)),
-                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='invoices.InvoiceConfiguration')),
-                ('reviewed_by', models.ForeignKey(null=True, blank=True, related_name="reviewed_invoice_set", on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
-                ('voided_by', models.ForeignKey(null=True, blank=True, related_name="voided_invoice_set", on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
-                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
-                ('file', models.FileField(null=True, blank=True, upload_to=NEMO_billing.invoices.utilities.get_invoice_document_filename)),
-                ('project_details', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='invoices.ProjectBillingDetails')),
+            name="Invoice",
+            fields=[
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "invoice_number",
+                    models.CharField(
+                        blank=True, help_text="Leave blank to be assigned automatically", max_length=100, unique=True
+                    ),
+                ),
+                ("start", models.DateTimeField()),
+                ("end", models.DateTimeField()),
+                ("due_date", models.DateField(null=True, blank=True)),
+                ("sent_date", models.DateTimeField(null=True, blank=True)),
+                ("last_sent_date", models.DateTimeField(null=True, blank=True)),
+                ("last_reminder_sent_date", models.DateTimeField(null=True, blank=True)),
+                ("reviewed_date", models.DateTimeField(null=True, blank=True)),
+                ("created_date", models.DateTimeField(auto_now_add=True)),
+                ("voided_date", models.DateTimeField(null=True, blank=True)),
+                ("total_amount", models.DecimalField(decimal_places=2, max_digits=14)),
+                (
+                    "configuration",
+                    models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to="invoices.InvoiceConfiguration"),
+                ),
+                (
+                    "reviewed_by",
+                    models.ForeignKey(
+                        null=True,
+                        blank=True,
+                        related_name="reviewed_invoice_set",
+                        on_delete=django.db.models.deletion.PROTECT,
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                (
+                    "voided_by",
+                    models.ForeignKey(
+                        null=True,
+                        blank=True,
+                        related_name="voided_invoice_set",
+                        on_delete=django.db.models.deletion.PROTECT,
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                (
+                    "created_by",
+                    models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL),
+                ),
+                (
+                    "file",
+                    models.FileField(
+                        null=True, blank=True, upload_to=NEMO_billing.invoices.utilities.get_invoice_document_filename
+                    ),
+                ),
+                (
+                    "project_details",
+                    models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to="invoices.ProjectBillingDetails"),
+                ),
             ],
             options={
-                'ordering': ['-created_date', '-invoice_number'],
+                "ordering": ["-created_date", "-invoice_number"],
             },
         ),
         migrations.CreateModel(
-            name='InvoicePayment',
+            name="InvoicePayment",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('payment_received', models.DateField(help_text='Date when payment was received')),
-                ('payment_processed', models.DateField(blank=True, help_text='Date when payment was processed', null=True)),
-                ('amount', models.DecimalField(decimal_places=2, max_digits=14, help_text="Amount received")),
-                ('created_date', models.DateTimeField(auto_now_add=True)),
-                ('updated_date', models.DateTimeField(auto_now=True)),
-                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payment_created_by_set', to=settings.AUTH_USER_MODEL)),
-                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='invoices.Invoice')),
-                ('updated_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payment_updated_by_set', to=settings.AUTH_USER_MODEL)),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("payment_received", models.DateField(help_text="Date when payment was received")),
+                (
+                    "payment_processed",
+                    models.DateField(blank=True, help_text="Date when payment was processed", null=True),
+                ),
+                ("amount", models.DecimalField(decimal_places=2, max_digits=14, help_text="Amount received")),
+                ("created_date", models.DateTimeField(auto_now_add=True)),
+                ("updated_date", models.DateTimeField(auto_now=True)),
+                (
+                    "created_by",
+                    models.ForeignKey(
+                        on_delete=django.db.models.deletion.PROTECT,
+                        related_name="payment_created_by_set",
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                ("invoice", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="invoices.Invoice")),
+                (
+                    "updated_by",
+                    models.ForeignKey(
+                        on_delete=django.db.models.deletion.PROTECT,
+                        related_name="payment_updated_by_set",
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
             ],
             options={
-                'ordering': ['-payment_received'],
+                "ordering": ["-payment_received"],
             },
         ),
         migrations.CreateModel(
-            name='InvoiceSummaryItem',
+            name="InvoiceSummaryItem",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('summary_item_type', models.IntegerField(choices=[(1, 'item'), (2, 'category'), (3, 'small_category'), (4, 'sub_total'), (5, 'discount'), (6, 'facility_discount'), (7, 'tax'), (8, 'other')])),
-                ('core_facility', models.CharField(blank=True, max_length=255, null=True)),
-                ('name', models.CharField(max_length=255)),
-                ('details', models.CharField(blank=True, max_length=100, null=True)),
-                ('amount', models.DecimalField(null=True, blank=True, decimal_places=2, max_digits=14)),
-                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='invoices.Invoice')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "summary_item_type",
+                    models.IntegerField(
+                        choices=[
+                            (1, "item"),
+                            (2, "category"),
+                            (3, "small_category"),
+                            (4, "sub_total"),
+                            (5, "discount"),
+                            (6, "facility_discount"),
+                            (7, "tax"),
+                            (8, "other"),
+                        ]
+                    ),
+                ),
+                ("core_facility", models.CharField(blank=True, max_length=255, null=True)),
+                ("name", models.CharField(max_length=255)),
+                ("details", models.CharField(blank=True, max_length=100, null=True)),
+                ("amount", models.DecimalField(null=True, blank=True, decimal_places=2, max_digits=14)),
+                ("invoice", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="invoices.Invoice")),
             ],
         ),
         migrations.CreateModel(
-            name='InvoiceDetailItem',
-            fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('core_facility', models.CharField(blank=True, max_length=255, null=True)),
-                ('item_type', models.IntegerField(choices=[(1, 'tool_usage'), (2, 'area_access'), (3, 'consumable'), (4, 'missed_reservation'), (5, 'staff_charge'), (6, 'training_session'), (7, 'custom_charge')])),
-                ('name', models.CharField(max_length=255)),
-                ('quantity', models.DecimalField(decimal_places=2, max_digits=8)),
-                ('start', models.DateTimeField()),
-                ('end', models.DateTimeField()),
-                ('user', models.CharField(max_length=200)),
-                ('rate', models.CharField(blank=True, max_length=100, null=True)),
-                ('amount', models.DecimalField(decimal_places=2, max_digits=14)),
-                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='invoices.Invoice')),
+            name="InvoiceDetailItem",
+            fields=[
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("core_facility", models.CharField(blank=True, max_length=255, null=True)),
+                (
+                    "item_type",
+                    models.IntegerField(
+                        choices=[
+                            (1, "tool_usage"),
+                            (2, "area_access"),
+                            (3, "consumable"),
+                            (4, "missed_reservation"),
+                            (5, "staff_charge"),
+                            (6, "training_session"),
+                            (7, "custom_charge"),
+                        ]
+                    ),
+                ),
+                ("name", models.CharField(max_length=255)),
+                ("quantity", models.DecimalField(decimal_places=2, max_digits=8)),
+                ("start", models.DateTimeField()),
+                ("end", models.DateTimeField()),
+                ("user", models.CharField(max_length=200)),
+                ("rate", models.CharField(blank=True, max_length=100, null=True)),
+                ("amount", models.DecimalField(decimal_places=2, max_digits=14)),
+                ("invoice", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="invoices.Invoice")),
             ],
         ),
-        migrations.RunPython(create_invoice_customizations)
+        migrations.RunPython(create_invoice_customizations),
     ]
```

## NEMO_billing/invoices/migrations/0002_version_1_2_0.py

```diff
@@ -2,57 +2,94 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0001_initial'),
+        ("invoices", "0001_initial"),
     ]
 
     operations = [
-         migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_area_access_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display area access charges as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_tool_usage_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display tool usage charges as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_consumable_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display supplies/material as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_custom_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display custom charges as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_missed_reservation_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display missed reservation charges as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_staff_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display staff charges as a separate invoice category'),
-        ),
-        migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='separate_training_charges',
-            field=models.BooleanField(default=False, help_text='Check this box to display training charges as a separate invoice category'),
-        ),
         migrations.AddField(
-            model_name='invoicesummaryitem',
-            name='item_type',
-            field=models.IntegerField(blank=True, choices=[(1, 'tool_usage'), (2, 'area_access'), (3, 'consumable'), (4, 'missed_reservation'), (5, 'staff_charge'), (6, 'training_session'), (7, 'custom_charge')], null=True),
+            model_name="invoiceconfiguration",
+            name="separate_area_access_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display area access charges as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_tool_usage_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display tool usage charges as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_consumable_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display supplies/material as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_custom_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display custom charges as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_missed_reservation_charges",
+            field=models.BooleanField(
+                default=False,
+                help_text="Check this box to display missed reservation charges as a separate invoice category",
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_staff_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display staff charges as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoiceconfiguration",
+            name="separate_training_charges",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to display training charges as a separate invoice category"
+            ),
+        ),
+        migrations.AddField(
+            model_name="invoicesummaryitem",
+            name="item_type",
+            field=models.IntegerField(
+                blank=True,
+                choices=[
+                    (1, "tool_usage"),
+                    (2, "area_access"),
+                    (3, "consumable"),
+                    (4, "missed_reservation"),
+                    (5, "staff_charge"),
+                    (6, "training_session"),
+                    (7, "custom_charge"),
+                ],
+                null=True,
+            ),
         ),
         migrations.AlterField(
-            model_name='invoicesummaryitem',
-            name='summary_item_type',
-            field=models.IntegerField(choices=[(1, 'item'), (2, 'sub_total'), (3, 'discount_sub_total'), (4, 'discount'), (5, 'tax'), (6, 'other'), (7, 'fund')]),
+            model_name="invoicesummaryitem",
+            name="summary_item_type",
+            field=models.IntegerField(
+                choices=[
+                    (1, "item"),
+                    (2, "sub_total"),
+                    (3, "discount_sub_total"),
+                    (4, "discount"),
+                    (5, "tax"),
+                    (6, "other"),
+                    (7, "fund"),
+                ]
+            ),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0003_version_1_4_0.py

```diff
@@ -2,32 +2,36 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0002_version_1_2_0'),
+        ("invoices", "0002_version_1_2_0"),
     ]
 
     operations = [
         migrations.RenameField(
-            model_name='projectbillingdetails',
-            old_name='details',
-            new_name='addressee',
+            model_name="projectbillingdetails",
+            old_name="details",
+            new_name="addressee",
         ),
         migrations.AlterField(
-            model_name='projectbillingdetails',
-            name='addressee',
-            field=models.TextField(blank=True, help_text='The addressee details to be included in the invoice', null=True),
+            model_name="projectbillingdetails",
+            name="addressee",
+            field=models.TextField(
+                blank=True, help_text="The addressee details to be included in the invoice", null=True
+            ),
         ),
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='comments',
+            model_name="projectbillingdetails",
+            name="comments",
             field=models.TextField(blank=True, null=True),
         ),
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='expires_on',
-            field=models.DateField(blank=True, help_text='Date after which this project will be automatically deactivated.', null=True),
+            model_name="projectbillingdetails",
+            name="expires_on",
+            field=models.DateField(
+                blank=True, help_text="Date after which this project will be automatically deactivated.", null=True
+            ),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0004_version_1_6_0.py

```diff
@@ -2,17 +2,17 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0003_version_1_4_0'),
+        ("invoices", "0003_version_1_4_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='contact_phone',
-            field=models.CharField(blank=True, help_text='The contact\'s phone number', max_length=40, null=True),
+            model_name="projectbillingdetails",
+            name="contact_phone",
+            field=models.CharField(blank=True, help_text="The contact's phone number", max_length=40, null=True),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0005_version_1_6_1.py

```diff
@@ -1,19 +1,19 @@
 # Generated by Django 2.2.24 on 2021-07-30 17:53
 
-from django.db import migrations, models
 import django.db.models.deletion
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0004_version_1_6_0'),
+        ("invoices", "0004_version_1_6_0"),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='projectbillingdetails',
-            name='project',
-            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to='NEMO.Project'),
+            model_name="projectbillingdetails",
+            name="project",
+            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to="NEMO.Project"),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0006_version_1_7_1.py

```diff
@@ -1,19 +1,25 @@
 # Generated by Django 2.2.24 on 2021-09-02 17:42
 
-import NEMO_billing.invoices.utilities
 from django.db import migrations, models
 
+import NEMO_billing.invoices.utilities
+
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0005_version_1_6_1'),
+        ("invoices", "0005_version_1_6_1"),
     ]
 
     operations = [
         migrations.AlterField(
-            model_name='invoice',
-            name='file',
-            field=models.FileField(blank=True, max_length=255, null=True, upload_to=NEMO_billing.invoices.utilities.get_invoice_document_filename),
+            model_name="invoice",
+            name="file",
+            field=models.FileField(
+                blank=True,
+                max_length=255,
+                null=True,
+                upload_to=NEMO_billing.invoices.utilities.get_invoice_document_filename,
+            ),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0007_version_1_8_0.py

```diff
@@ -2,17 +2,17 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0006_version_1_7_1'),
+        ("invoices", "0006_version_1_7_1"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='no_tax',
-            field=models.BooleanField(default=False, help_text='Check this box if this project is tax exempt.'),
+            model_name="projectbillingdetails",
+            name="no_tax",
+            field=models.BooleanField(default=False, help_text="Check this box if this project is tax exempt."),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0008_version_1_10_0.py

```diff
@@ -2,17 +2,17 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0007_version_1_8_0'),
+        ("invoices", "0007_version_1_8_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='invoicepayment',
-            name='note',
-            field=models.CharField(blank=True, help_text='Payment note', max_length=255, null=True),
+            model_name="invoicepayment",
+            name="note",
+            field=models.CharField(blank=True, help_text="Payment note", max_length=255, null=True),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0009_version_1_23_0.py

```diff
@@ -3,32 +3,34 @@
 import django.db.models.deletion
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('contenttypes', '0002_remove_content_type_name'),
-        ('invoices', '0008_version_1_10_0'),
+        ("contenttypes", "0002_remove_content_type_name"),
+        ("invoices", "0008_version_1_10_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='invoicedetailitem',
-            name='content_type',
-            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='contenttypes.contenttype'),
+            model_name="invoicedetailitem",
+            name="content_type",
+            field=models.ForeignKey(
+                blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="contenttypes.contenttype"
+            ),
         ),
         migrations.AddField(
-            model_name='invoicedetailitem',
-            name='object_id',
+            model_name="invoicedetailitem",
+            name="object_id",
             field=models.PositiveIntegerField(blank=True, null=True),
         ),
         migrations.AddIndex(
-            model_name='invoicedetailitem',
-            index=models.Index(fields=['content_type', 'object_id'], name='invoices_in_content_622541_idx'),
+            model_name="invoicedetailitem",
+            index=models.Index(fields=["content_type", "object_id"], name="invoices_in_content_622541_idx"),
         ),
         migrations.AddField(
-            model_name='invoiceconfiguration',
-            name='hide_zero_charge',
-            field=models.BooleanField(default=True, help_text='Hide charges with an amount equal to 0.'),
+            model_name="invoiceconfiguration",
+            name="hide_zero_charge",
+            field=models.BooleanField(default=True, help_text="Hide charges with an amount equal to 0."),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0010_version_2_0_0.py

```diff
@@ -2,17 +2,17 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('invoices', '0009_version_1_23_0'),
+        ("invoices", "0009_version_1_23_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='invoicedetailitem',
-            name='discount',
+            model_name="invoicedetailitem",
+            name="discount",
             field=models.DecimalField(blank=True, decimal_places=2, max_digits=14, null=True),
         ),
     ]
```

## NEMO_billing/invoices/migrations/0011_version_2_4_0.py

```diff
@@ -1,32 +1,50 @@
 # Generated by Django 3.2.19 on 2023-06-04 18:53
 
+import django.db.models.deletion
 from django.conf import settings
 from django.db import migrations, models
-import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0004_version_2_4_0'),
+        ("NEMO_billing", "0004_version_2_4_0"),
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('invoices', '0010_version_2_0_0'),
+        ("invoices", "0010_version_2_0_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='department',
-            field=models.ForeignKey(blank=True, help_text='The project department', null=True, on_delete=django.db.models.deletion.SET_NULL, to='NEMO_billing.department'),
+            model_name="projectbillingdetails",
+            name="department",
+            field=models.ForeignKey(
+                blank=True,
+                help_text="The project department",
+                null=True,
+                on_delete=django.db.models.deletion.SET_NULL,
+                to="NEMO_billing.department",
+            ),
         ),
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='institution',
-            field=models.ForeignKey(blank=True, help_text='The project institution', null=True, on_delete=django.db.models.deletion.SET_NULL, to='NEMO_billing.institution'),
+            model_name="projectbillingdetails",
+            name="institution",
+            field=models.ForeignKey(
+                blank=True,
+                help_text="The project institution",
+                null=True,
+                on_delete=django.db.models.deletion.SET_NULL,
+                to="NEMO_billing.institution",
+            ),
         ),
         migrations.AddField(
-            model_name='projectbillingdetails',
-            name='staff_host',
-            field=models.ForeignKey(blank=True, help_text='The project host', null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
+            model_name="projectbillingdetails",
+            name="staff_host",
+            field=models.ForeignKey(
+                blank=True,
+                help_text="The project host",
+                null=True,
+                on_delete=django.db.models.deletion.SET_NULL,
+                to=settings.AUTH_USER_MODEL,
+            ),
         ),
     ]
```

## NEMO_billing/invoices/templates/customizations/customizations_billing.html

```diff
@@ -2,77 +2,108 @@
 <div class="panel-body" style="padding-bottom: 0">
     <h3 class="customization-section-title">Billing/Accounting settings</h3>
     <form method="POST" action="{% url 'customize' 'billing' %}" class="form-horizontal">
         {% csrf_token %}
         <div class="form-group {% if errors.billing_accounting_email_address %}has-error{% endif %}">
             <label class="control-label col-md-2" for="billing_accounting_email_address">Billing/Accounting email</label>
             <div class="col-md-5">
-                <input type="email" id="billing_accounting_email_address" name="billing_accounting_email_address" class="form-control" value="{% if errors.billing_accounting_email_address %}{{ errors.billing_accounting_email_address.value }}{% else %}{{ billing_accounting_email_address }}{% endif %}" placeholder="accounting@example.org">
+                <input type="email"
+                       id="billing_accounting_email_address"
+                       name="billing_accounting_email_address"
+                       class="form-control"
+                       value="{% if errors.billing_accounting_email_address %}{{ errors.billing_accounting_email_address.value }}{% else %}{{ billing_accounting_email_address }}{% endif %}"
+                       placeholder="accounting@example.org">
             </div>
             <div class="col-md-5 help-block light-grey">
                 {% if errors.billing_accounting_email_address %}
                     {{ errors.billing_accounting_email_address.error }}
                 {% else %}
                     The accounting/billing point of contact for the {{ facility_name }}. Accounting/billing emails sent from {{ site_title }} are typically 'from' this address.
                 {% endif %}
             </div>
         </div>
-		<div class="form-group {% if errors.billing_project_expiration_reminder_days %}has-error{% endif %}">
-            <label class="control-label col-md-2" for="billing_project_expiration_reminder_days">Project expiration reminder days</label>
+        <div class="form-group {% if errors.billing_project_expiration_reminder_days %}has-error{% endif %}">
+            <label class="control-label col-md-2" for="billing_project_expiration_reminder_days">
+                Project expiration reminder days
+            </label>
             <div class="col-md-5">
-                <input type="text" id="billing_project_expiration_reminder_days" name="billing_project_expiration_reminder_days" class="form-control" value="{% if errors.billing_project_expiration_reminder_days %}{{ errors.billing_project_expiration_reminder_days.value }}{% else %}{{ billing_project_expiration_reminder_days }}{% endif %}"/>
+                <input type="text"
+                       id="billing_project_expiration_reminder_days"
+                       name="billing_project_expiration_reminder_days"
+                       class="form-control"
+                       value="{% if errors.billing_project_expiration_reminder_days %}{{ errors.billing_project_expiration_reminder_days.value }}{% else %}{{ billing_project_expiration_reminder_days }}{% endif %}" />
             </div>
             <div class="col-md-5 help-block light-grey">
                 {% if errors.billing_project_expiration_reminder_days %}
                     {{ errors.billing_project_expiration_reminder_days.error }}
                 {% else %}
                     The numbers of days to send a reminder prior to a project expiration. A comma-separated list can be used for multiple reminders.
                 {% endif %}
             </div>
         </div>
-		<div class="form-group {% if errors.billing_project_expiration_reminder_cc %}has-error{% endif %}">
-            <label class="control-label col-md-2" for="billing_project_expiration_reminder_cc">Project expiration reminder CC</label>
+        <div class="form-group {% if errors.billing_project_expiration_reminder_cc %}has-error{% endif %}">
+            <label class="control-label col-md-2" for="billing_project_expiration_reminder_cc">
+                Project expiration reminder CC
+            </label>
             <div class="col-md-5">
-                <input type="text" id="billing_project_expiration_reminder_cc" name="billing_project_expiration_reminder_cc" class="form-control" value="{% if errors.billing_project_expiration_reminder_cc %}{{ errors.billing_project_expiration_reminder_cc.value }}{% else %}{{ billing_project_expiration_reminder_cc }}{% endif %}" placeholder="accounting@example.org"/>
+                <input type="text"
+                       id="billing_project_expiration_reminder_cc"
+                       name="billing_project_expiration_reminder_cc"
+                       class="form-control"
+                       value="{% if errors.billing_project_expiration_reminder_cc %}{{ errors.billing_project_expiration_reminder_cc.value }}{% else %}{{ billing_project_expiration_reminder_cc }}{% endif %}"
+                       placeholder="accounting@example.org" />
             </div>
             <div class="col-md-5 help-block light-grey">
                 {% if errors.billing_project_expiration_reminder_cc %}
                     {{ errors.billing_project_expiration_reminder_cc.error }}
                 {% else %}
                     The email address to copy when a project expiration reminder is sent. A comma-separated list can be used.
                 {% endif %}
             </div>
         </div>
-		<div class="form-group {% if errors.billing_usage_show_pending_vs_final %}has-error{% endif %}">
+        <div class="form-group {% if errors.billing_usage_show_pending_vs_final %}has-error{% endif %}">
             <label class="control-label col-md-2">Usage pending charges</label>
             <div class="col-md-10">
-				<div class="checkbox">
-					<label><input type="checkbox" name="billing_usage_show_pending_vs_final" {% if billing_usage_show_pending_vs_final %}checked{% endif %} value="enabled">In the usage page, display "pending" for charges not invoiced yet</label><br/>
-				</div>
-			</div>
-			{% if errors.billing_usage_show_pending_vs_final %}
-            	<div class="col-md-offset-2 col-md-10 help-block light-grey">
+                <div class="checkbox">
+                    <label>
+                        <input type="checkbox"
+                               name="billing_usage_show_pending_vs_final"
+                               {% if billing_usage_show_pending_vs_final %}checked{% endif %}
+                               value="enabled">
+                        In the usage page, display "pending" for charges not invoiced yet
+                    </label>
+                    <br />
+                </div>
+            </div>
+            {% if errors.billing_usage_show_pending_vs_final %}
+                <div class="col-md-offset-2 col-md-10 help-block light-grey">
                     {{ errors.billing_usage_show_pending_vs_final.error }}
-            	</div>
-			{% endif %}
+                </div>
+            {% endif %}
+        </div>
+        <div class="customization-separation" style="margin-bottom: 15px"></div>
+        <div class="text-center" style="margin-bottom: 15px">{% button type="save" value="Save settings" %}</div>
+    </form>
+    <div class="customization-separation"></div>
+    <div class="form-group form-horizontal" style="margin-top: 15px">
+        <h3 class="customization-section-title" id="billing_project_expiration_reminder_email_message_id">
+            Project expiration reminder email subject & message
+        </h3>
+        <p>
+            This is the email the project contacts (or project PIs if left blank) will receive as a reminder when they have projects about to expire. The following context variables are provided when the email is rendered:
+        </p>
+        <ul style="margin-bottom: 25px">
+            <li>
+                <b>projects</b> - the project(s) about to expire
+            </li>
+            <li>
+                <b>today</b> - today's date used to display time until expiration
+            </li>
+        </ul>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=billing_project_expiration_reminder_email_subject name='billing project expiration reminder email subject' button_name='Upload project expiration reminder subject' extension='txt' key='billing' %}
+        </div>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=billing_project_expiration_reminder_email_message name='billing project expiration reminder email message' button_name='Upload project expiration reminder email' key='billing' %}
         </div>
-		<div class="customization-separation" style="margin-bottom: 15px"></div>
-        <div class="text-center" style="margin-bottom: 15px">
-            {% button type="save" value="Save settings" %}
-        </div>
-	</form>
-	<div class="customization-separation"></div>
-	<div class="form-group form-horizontal" style="margin-top: 15px">
-		<h3 class="customization-section-title" id="billing_project_expiration_reminder_email_message_id">Project expiration reminder email subject & message</h3>
-		<p>This is the email the project contacts (or project PIs if left blank) will receive as a reminder when they have projects about to expire. The following context variables are provided when the email is rendered:</p>
-		<ul style="margin-bottom: 25px">
-			<li><b>projects</b> - the project(s) about to expire</li>
-			<li><b>today</b> - today's date used to display time until expiration</li>
-		</ul>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=billing_project_expiration_reminder_email_subject name='billing project expiration reminder email subject' button_name='Upload project expiration reminder subject' extension='txt' key='billing' %}
-		</div>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=billing_project_expiration_reminder_email_message name='billing project expiration reminder email message' button_name='Upload project expiration reminder email' key='billing' %}
-		</div>
-	</div>
-</div>
+    </div>
+</div>
```

## NEMO_billing/invoices/templates/customizations/customizations_invoices.html

```diff
@@ -1,128 +1,212 @@
 {% load custom_tags_and_filters %}
 <div class="panel-body" style="padding-bottom: 0">
     <h3 class="customization-section-title">Invoices settings</h3>
     <form method="POST" action="{% url 'customize' 'invoices' %}" class="form-horizontal">
         {% csrf_token %}
-		<div class="form-group {% if errors.invoice_month_list_since %}has-error{% endif %}">
+        <div class="form-group {% if errors.invoice_month_list_since %}has-error{% endif %}">
             <label class="control-label col-md-4 col-lg-3" for="invoice_month_list_since">Invoice generation</label>
             <div class="col-md-5">
-                <input type="text" id="invoice_month_list_since" name="invoice_month_list_since" class="form-control" value="{% if errors.invoice_month_list_since %}{{ errors.invoice_month_list_since.value }}{% else %}{{ invoice_month_list_since }}{% endif %}">
+                <input type="text"
+                       id="invoice_month_list_since"
+                       name="invoice_month_list_since"
+                       class="form-control"
+                       value="{% if errors.invoice_month_list_since %}{{ errors.invoice_month_list_since.value }}{% else %}{{ invoice_month_list_since }}{% endif %}">
             </div>
             <div class="col-lg-offset-3 col-md-offset-4 col-md-8 col-lg-9 help-block light-grey">
                 {% if errors.invoice_month_list_since %}
                     {{ errors.invoice_month_list_since.error }}
                 {% else %}
                     Only allow generating invoices from this date forward.
                 {% endif %}
             </div>
         </div>
         <div class="form-group {% if errors.invoice_number_format %}has-error{% endif %}">
             <label class="control-label col-md-4 col-lg-3" for="invoice_number_format">Invoice number format</label>
             <div class="col-md-5">
-                <input type="text" id="invoice_number_format" name="invoice_number_format" class="form-control" value="{% if errors.invoice_number_format %}{{ errors.invoice_number_format.value }}{% else %}{{ invoice_number_format }}{% endif %}"/>
+                <input type="text"
+                       id="invoice_number_format"
+                       name="invoice_number_format"
+                       class="form-control"
+                       value="{% if errors.invoice_number_format %}{{ errors.invoice_number_format.value }}{% else %}{{ invoice_number_format }}{% endif %}" />
             </div>
             <div class="col-lg-offset-3 col-md-offset-4 col-md-8 col-lg-9 help-block light-grey">
                 {% if errors.invoice_number_format %}
                     {{ errors.invoice_number_format.error }}
                 {% else %}
                     The format to use when creating invoice numbers. See <a href="https://docs.python.org/3/library/string.html#formatstrings">Python Format String Syntax</a> for more details.
                 {% endif %}
             </div>
         </div>
-		<div class="form-group">
+        <div class="form-group">
             <label class="control-label col-md-4 col-lg-3" for="invoice_number_current">Current invoice number</label>
             <div class="col-md-5">
-                <input type="number" min="0" step="1" id="invoice_number_current" name="invoice_number_current" class="form-control" value="{{ invoice_number_current }}">
-            </div>
-            <div class="col-lg-offset-3 col-md-offset-4 col-md-8 col-lg-9 help-block light-grey">
-                The current invoice number.
+                <input type="number"
+                       min="0"
+                       step="1"
+                       id="invoice_number_current"
+                       name="invoice_number_current"
+                       class="form-control"
+                       value="{{ invoice_number_current }}">
             </div>
+            <div class="col-lg-offset-3 col-md-offset-4 col-md-8 col-lg-9 help-block light-grey">The current invoice number.</div>
         </div>
-		<div class="form-group">
-			<label class="control-label col-md-4 col-lg-3">Formatted result</label>
+        <div class="form-group">
+            <label class="control-label col-md-4 col-lg-3">Formatted result</label>
             <div class="col-md-5">
                 <div class="form-control-static">{{ invoice_number_formatted }}</div>
             </div>
-		</div>
-		<div class="form-group {% if errors.invoice_zip_export_template %}has-error{% endif %}">
+        </div>
+        <div class="form-group {% if errors.invoice_zip_export_template %}has-error{% endif %}">
             <label class="control-label col-md-4 col-lg-3" for="invoice_zip_export_template">Zip filename template</label>
             <div class="col-md-8 col-lg-9">
-                <textarea oninput="auto_size_textarea(this);" id="invoice_zip_export_template" name="invoice_zip_export_template" class="form-control">{% if errors.invoice_zip_export_template %}{{ errors.invoice_zip_export_template.value }}{% else %}{{ invoice_zip_export_template }}{% endif %}</textarea>
+                <textarea oninput="auto_size_textarea(this);"
+                          id="invoice_zip_export_template"
+                          name="invoice_zip_export_template"
+                          class="form-control">{% if errors.invoice_zip_export_template %}{{ errors.invoice_zip_export_template.value }}{% else %}{{ invoice_zip_export_template }}{% endif %}</textarea>
             </div>
             <div class="col-lg-offset-3 col-md-offset-4 col-md-8 col-lg-9 help-block light-grey">
                 {% if errors.invoice_zip_export_template %}
                     {{ errors.invoice_zip_export_template.error }}
                 {% else %}
                     The django template used in the zip file when downloading invoices. Use '/' to organize into subfolders. The context variables <b>invoice</b>, <b>project_name</b>, <b>account_name</b> are provided.
                 {% endif %}
             </div>
         </div>
-		<div class="form-group">
-			<label class="control-label col-md-4 col-lg-3">Formatted result</label>
+        <div class="form-group">
+            <label class="control-label col-md-4 col-lg-3">Formatted result</label>
             <div class="col-md-8 col-lg-9">
                 <div class="form-control-static">{{ invoice_zip_template_formatted }}</div>
             </div>
-		</div>
-		<div class="form-group">
+        </div>
+        <div class="form-group">
             <label class="control-label col-md-4 col-lg-3">Invoice list hide columns</label>
-			<div class="col-md-8 col-lg-9">
-				<div class="checkbox">
-                    <label><input type="checkbox" name="invoice_list_hide_created_date" {% if invoice_list_hide_created_date %}checked{% endif %} value="enabled">Created date</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_month" {% if invoice_list_hide_month %}checked{% endif %} value="enabled">Month</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_sent_date" {% if invoice_list_hide_sent_date %}checked{% endif %} value="enabled">Sent date</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_due_date" {% if invoice_list_hide_due_date %}checked{% endif %} value="enabled">Due date</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_review_date" {% if invoice_list_hide_review_date %}checked{% endif %} value="enabled">Review date</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_tax" {% if invoice_list_hide_tax %}checked{% endif %} value="enabled">Tax</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_outstanding" {% if invoice_list_hide_outstanding %}checked{% endif %} value="enabled">Outstanding</label><br/>
-                    <label><input type="checkbox" name="invoice_list_hide_actions" {% if invoice_list_hide_actions %}checked{% endif %} value="enabled">Actions</label>
+            <div class="col-md-8 col-lg-9">
+                <div class="checkbox">
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_created_date"
+                               {% if invoice_list_hide_created_date %}checked{% endif %}
+                               value="enabled">
+                        Created date
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_month"
+                               {% if invoice_list_hide_month %}checked{% endif %}
+                               value="enabled">
+                        Month
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_sent_date"
+                               {% if invoice_list_hide_sent_date %}checked{% endif %}
+                               value="enabled">
+                        Sent date
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_due_date"
+                               {% if invoice_list_hide_due_date %}checked{% endif %}
+                               value="enabled">
+                        Due date
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_review_date"
+                               {% if invoice_list_hide_review_date %}checked{% endif %}
+                               value="enabled">
+                        Review date
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_tax"
+                               {% if invoice_list_hide_tax %}checked{% endif %}
+                               value="enabled">
+                        Tax
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_outstanding"
+                               {% if invoice_list_hide_outstanding %}checked{% endif %}
+                               value="enabled">
+                        Outstanding
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="invoice_list_hide_actions"
+                               {% if invoice_list_hide_actions %}checked{% endif %}
+                               value="enabled">
+                        Actions
+                    </label>
                 </div>
-			</div>
-		</div>
-		{% if "NEMO_billing.prepayments"|app_installed %}
-			<div class="form-group">
-				<label class="control-label col-md-4 col-lg-3">Invoice funds</label>
-				<div class="col-md-8 col-lg-9">
-					<div class="checkbox">
-						<label><input type="checkbox" name="invoice_funds_show_total_balance" {% if invoice_funds_show_total_balance %}checked{% endif %} value="enabled">Show total funds remaining in invoice summary</label>
-					</div>
-				</div>
-			</div>
-		{% endif %}
-		<div class="customization-separation" style="margin-bottom: 15px"></div>
-        <div class="text-center" style="margin-bottom: 15px">
-            {% button type="save" value="Save settings" %}
-        </div>
-	</form>
-	<div class="customization-separation" style="clear: both"></div>
-	<div class="form-group form-horizontal" style="margin-top: 15px">
-		<h3 class="customization-section-title" id="email_send_invoice_message_id">Invoice email subject & message</h3>
-		<p>This is the email the project contact will receive with his invoice. The following context variables are provided when the email is rendered:</p>
-		<ul style="margin-bottom: 25px">
-			<li><b>invoice</b> - the project's invoice</li>
-		</ul>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=email_send_invoice_subject name='email send invoice subject' button_name='Upload invoice email subject' extension='txt' key='invoices' %}
-		</div>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=email_send_invoice_message name='email send invoice message' button_name='Upload invoice email' key='invoices' %}
-		</div>
-	</div>
-	<div class="customization-separation" style="clear: both"></div>
-	<div class="form-group form-horizontal" style="margin-top: 15px;">
-		<h3 class="customization-section-title" id="email_send_invoice_reminder_message_id">Invoice reminder email subject & message</h3>
-		<p>This is the email the project contact will receive as a reminder when his invoice has an outstanding balance. The following context variables are provided when the email is rendered:</p>
-		<ul style="margin-bottom: 25px">
-			<li><b>invoice</b> - the project's invoice</li>
-		</ul>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=email_send_invoice_reminder_subject name='email send invoice reminder subject' button_name='Upload invoice reminder email subject' extension='txt' key='invoices' %}
-		</div>
-		<div class="col-md-6">
-			{% include 'customizations/customizations_upload.html' with element=email_send_invoice_reminder_message name='email send invoice reminder message' button_name='Upload invoice reminder email' key='invoices' %}
-		</div>
-	</div>
+            </div>
+        </div>
+        {% if "NEMO_billing.prepayments"|app_installed %}
+            <div class="form-group">
+                <label class="control-label col-md-4 col-lg-3">Invoice funds</label>
+                <div class="col-md-8 col-lg-9">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox"
+                                   name="invoice_funds_show_total_balance"
+                                   {% if invoice_funds_show_total_balance %}checked{% endif %}
+                                   value="enabled">
+                            Show total funds remaining in invoice summary
+                        </label>
+                    </div>
+                </div>
+            </div>
+        {% endif %}
+        <div class="customization-separation" style="margin-bottom: 15px"></div>
+        <div class="text-center" style="margin-bottom: 15px">{% button type="save" value="Save settings" %}</div>
+    </form>
+    <div class="customization-separation" style="clear: both"></div>
+    <div class="form-group form-horizontal" style="margin-top: 15px">
+        <h3 class="customization-section-title" id="email_send_invoice_message_id">Invoice email subject & message</h3>
+        <p>
+            This is the email the project contact will receive with his invoice. The following context variables are provided when the email is rendered:
+        </p>
+        <ul style="margin-bottom: 25px">
+            <li>
+                <b>invoice</b> - the project's invoice
+            </li>
+        </ul>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=email_send_invoice_subject name='email send invoice subject' button_name='Upload invoice email subject' extension='txt' key='invoices' %}
+        </div>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=email_send_invoice_message name='email send invoice message' button_name='Upload invoice email' key='invoices' %}
+        </div>
+    </div>
+    <div class="customization-separation" style="clear: both"></div>
+    <div class="form-group form-horizontal" style="margin-top: 15px;">
+        <h3 class="customization-section-title" id="email_send_invoice_reminder_message_id">
+            Invoice reminder email subject & message
+        </h3>
+        <p>
+            This is the email the project contact will receive as a reminder when his invoice has an outstanding balance. The following context variables are provided when the email is rendered:
+        </p>
+        <ul style="margin-bottom: 25px">
+            <li>
+                <b>invoice</b> - the project's invoice
+            </li>
+        </ul>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=email_send_invoice_reminder_subject name='email send invoice reminder subject' button_name='Upload invoice reminder email subject' extension='txt' key='invoices' %}
+        </div>
+        <div class="col-md-6">
+            {% include 'customizations/customizations_upload.html' with element=email_send_invoice_reminder_message name='email send invoice reminder message' button_name='Upload invoice reminder email' key='invoices' %}
+        </div>
+    </div>
 </div>
 <script type="text/javascript">
 	auto_size_textarea(document.getElementById("invoice_zip_export_template"));
     $("#invoice_month_list_since").datetimepicker({format: "{{ date_input_js_format }}"});
-</script>
+</script>
```

### html2text {}

```diff
@@ -27,29 +27,30 @@
 { errors.invoice_zip_export_template.error }} {% else %} The django template
 used in the zip file when downloading invoices. Use '/' to organize into
 subfolders. The context variables iinnvvooiiccee, pprroojjeecctt__nnaammee, aaccccoouunntt__nnaammee are
 provided. {% endif %}
 Formatted result
 {{ invoice_zip_template_formatted }}
 Invoice list hide columns
-% if invoice_list_hide_created_date %}checked{% endif %}
-value="enabled">Created date
-% if invoice_list_hide_month %}checked{% endif %} value="enabled">Month
-% if invoice_list_hide_sent_date %}checked{% endif %} value="enabled">Sent date
-% if invoice_list_hide_due_date %}checked{% endif %} value="enabled">Due date
-% if invoice_list_hide_review_date %}checked{% endif %} value="enabled">Review
+% if invoice_list_hide_created_date %}checked{% endif %} value="enabled">
+Created date
+% if invoice_list_hide_month %}checked{% endif %} value="enabled"> Month
+% if invoice_list_hide_sent_date %}checked{% endif %} value="enabled"> Sent
 date
-% if invoice_list_hide_tax %}checked{% endif %} value="enabled">Tax
-% if invoice_list_hide_outstanding %}checked{% endif %}
-value="enabled">Outstanding
-% if invoice_list_hide_actions %}checked{% endif %} value="enabled">Actions
+% if invoice_list_hide_due_date %}checked{% endif %} value="enabled"> Due date
+% if invoice_list_hide_review_date %}checked{% endif %} value="enabled"> Review
+date
+% if invoice_list_hide_tax %}checked{% endif %} value="enabled"> Tax
+% if invoice_list_hide_outstanding %}checked{% endif %} value="enabled">
+Outstanding
+% if invoice_list_hide_actions %}checked{% endif %} value="enabled"> Actions
 {% if "NEMO_billing.prepayments"|app_installed %}
 Invoice funds
-% if invoice_funds_show_total_balance %}checked{% endif %} value="enabled">Show
-total funds remaining in invoice summary
+% if invoice_funds_show_total_balance %}checked{% endif %} value="enabled">
+Show total funds remaining in invoice summary
 {% endif %}
 {% button type="save" value="Save settings" %}
 ******** IInnvvooiiccee eemmaaiill ssuubbjjeecctt && mmeessssaaggee ********
 This is the email the project contact will receive with his invoice. The
 following context variables are provided when the email is rendered:
     * iinnvvooiiccee - the project's invoice
 {% include 'customizations/customizations_upload.html' with
```

## NEMO_billing/invoices/templates/invoices/base.html

```diff
@@ -1,7 +1,6 @@
 {% extends 'base.html' %}
 {% block extrahead %}
-	{% load static %}
-	<link rel="stylesheet" type="text/css" href="{% static "invoices/invoices.css" %}"/>
-
-	{% block invoiceextrahead %}{% endblock %}
-{% endblock %}
+    {% load static %}
+    <link rel="stylesheet" type="text/css" href="{% static "invoices/invoices.css" %}" />
+    {% block invoiceextrahead %}{% endblock %}
+{% endblock %}
```

## NEMO_billing/invoices/templates/invoices/invoice.html

```diff
@@ -1,270 +1,351 @@
 {% extends 'invoices/base.html' %}
 {% load custom_tags_and_filters %}
 {% block title %}Invoice{% endblock %}
 {% block invoiceextrahead %}
-	{% load static %}
-	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
-	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
+    {% load static %}
+    <script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
+    <link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}" />
 {% endblock %}
 {% block content %}
-	<div class="col-lg-offset-1 col-lg-10 col-sm-12" style="margin-bottom: 15px">
-		<div style="margin-left: -15px;margin-right: -15px">{% button type="default" url="invoices" value="Back to list" %}</div>
-	</div>
-
-	{% if previous_id or next_id %}
-		<div class="col-lg-offset-1 col-lg-10 col-sm-12">
-			<div style="margin-left: -15px;margin-right: -15px">
-				{% if previous_id %}
-					{% url 'view_invoice' previous_id as view_previous_invoice %}
-					{% button type="default" url=view_previous_invoice value="previous" style="float: left;" %}
-				{% endif %}
-				{% if next_id %}
-					{% url 'view_invoice' next_id as view_next_invoice %}
-					{% button type="default" url=view_next_invoice value="next" style="float: right;" %}
-				{% endif %}
-			</div>
-		</div>
-	{% endif %}
-
-	<div class="col-lg-offset-1 col-lg-10 col-sm-12">
-		<h1>{% if invoice.voided_date %}<s>{% endif %}
-			Invoice {{ invoice.invoice_number }} for {{ invoice.project_details.name }} {% if invoice.project_details.category %}({{ invoice.project_details.category }}){% endif %}
-			{% if invoice.voided_date %}</s> (Void){% endif %}
-		</h1>
-		<h3><i>From {{ invoice.start|date:'F jS, Y' }} to {{ invoice.end|date:'F jS, Y' }}</i></h3>
-	</div>
-
-	<div class="row" style="margin-left: 0;margin-right: 0">
-		<div class="panel panel-default col-lg-offset-1 col-lg-10 col-sm-12" style="margin-top: 30px">
-			<div class="form-horizontal">
-				<div class="form-group" style="margin-top: 15px">
-					<div class="control-label col-sm-2"><strong>Created:</strong></div>
-					<div class="col-sm-4">
-						<p class="form-control-static">{{ invoice.created_date|date:'F jS, Y @ g:i A' }} ({{ invoice.created_by.username }})</p>
-					</div>
-					{% if invoice.project_details.project.application_identifier %}
-						<div class="control-label col-sm-2"><strong>{{ "projects_and_accounts"|customization:"project_application_identifier_name" }}</strong></div>
-						<div class="col-sm-4">
-							<p class="form-control-static">{{ invoice.project_details.project.application_identifier|default_if_none:'' }}</p>
-						</div>
-					{% endif %}
-				</div>
-				<div class="form-group">
-					<div class="control-label col-sm-2"><strong>Total</strong></div>
-					<div class="col-sm-4">
-						<p class="form-control-static">{{ invoice.total_amount_display }}</p>
-					</div>
-					<div class="control-label col-sm-2"><strong>Outstanding</strong></div>
-					<div class="col-sm-4">
-						<p class="form-control-static">{{ invoice.total_payments_display }}</p>
-					</div>
-				</div>
-				{% if user.is_accouting_officer or user.is_facility_manager or user.is_superuser %}
-					<div class="form-group">
-						<div class="control-label col-sm-2"><strong>Reviewed</strong></div>
-						<div class="col-sm-4">
-							{% if invoice.reviewed_date %}
-								<p class="form-control-static">{{ invoice.reviewed_date|date:'F jS, Y @ g:i A' }} ({{ invoice.reviewed_by.username }})</p>
-							{% else %}
-								<form action="{% url 'review_invoice' invoice.id %}" method="post">
-									{% csrf_token %}
-									{% button type="info" submit=True size="small" value="Mark as reviewed" onclick="show_spinner();" icon="glyphicon-ok-circle" %}
-								</form>
-							{% endif %}
-						</div>
-						<div class="control-label col-sm-2"><strong>Void</strong></div>
-						<div class="col-sm-4">
-							{% if invoice.voided_date %}
-								<p class="form-control-static">{{ invoice.voided_date|date:'F jS, Y @ g:i A' }} ({{ invoice.voided_by.username }})</p>
-							{% else %}
-								<form action="{% url 'void_invoice' invoice.id %}" method="post">
-									{% csrf_token %}
-									{% button type="delete" submit=True size="small" value="Void invoice" onclick="show_spinner();" icon="glyphicon-ban-circle" %}
-								</form>
-							{% endif %}
-						</div>
-					</div>
-				{% endif %}
-				<div class="form-group">
-					{% if user.is_accouting_officer or user.is_facility_manager or user.is_superuser %}
-						<div class="control-label col-sm-2"><strong>Last sent</strong></div>
-						<div class="col-sm-4">
-							{% if invoice.last_sent_date %}
-								<div class="form-control-static" style="display: inline-block;vertical-align: sub;">{{ invoice.last_sent_date|date:'F jS, Y @ g:i A' }}</div>
-							{% elif not invoice.reviewed_date %}
-								<p class="form-control-static">Invoice hasn't been reviewed</p>
-							{% endif %}
-							{% if invoice.reviewed_date %}
-								<form action="{% url 'send_invoice' invoice.id %}" method="post" style="display: inline-block">
-									{% csrf_token %}
-									{% button type="save" size="small" value=invoice.last_sent_date|yesno:"Re-send,Send invoice" onclick="show_spinner();" icon="glyphicon-send" %}
-								</form>
-							{% endif %}
-						</div>
-					{% endif %}
-					<div class="control-label col-sm-2"><strong>File</strong></div>
-					<div class="col-sm-4">
-						{% if invoice.file %}
-							<p class="form-control-static"><a href="{{ invoice.file.url }}" target="_blank">{{ invoice.filename }}</a></p>
-						{% else %}
-							{% url 're_render_invoice' invoice.id as re_render_url %}
-							{% button type="warn" size="small" value="Re-render invoice file" onclick="show_spinner();" url=re_render_url icon="glyphicon-refresh" %}
-						{% endif %}
-					</div>
-				</div>
-			</div>
-		</div>
-	</div>
-
-	<div class="row" style="margin-top:30px">
-		<div class="col-xs-7 col-lg-offset-1">
-			<ul class="nav nav-pills" id="tabs">
-				<li class="active"><a href="#summary">Summary</a></li>
-				<li><a href="#details">Details</a></li>
-				<li><a href="#payments">Payments</a></li>
-			</ul>
-		</div>
-		<div class="col-lg-3 col-xs-5 text-right">
-			{% url 'csv_invoice' invoice.id as export_csv_url %}
-			{% button type="export" value="Export data in CSV" url=export_csv_url %}
-		</div>
-	</div>
-
-	<div class="tab-content" style="margin-top: 15px">
-		<div id="summary" class="tab-pane active col-lg-offset-1 col-lg-10 col-sm-12" style="padding: 0">
-			<table class="invoice-summary-table table table-hover">
-				<thead>
-					<tr>
-						<th>Item</th>
-						<th>Details</th>
-						<th class="button-column-minimum">Amount</th>
-					</tr>
-				</thead>
-				<tbody>
-				{% for facility in invoice.sorted_core_facilities %}
-					<tr class="invoice-summary-{% if facility %}facility{% else %}general{% endif %} invoice-summary-category">
-						<td class="summary-item-name">{{ facility|default_if_none:'General Charges' }}</td>
-						<td></td>
-						<td class="summary-item-amount"></td>
-					</tr>
-					{% for summary_item in invoice.summary_dict|get_item:facility %}
-						<tr class="invoice-summary-{% if facility %}facility{% else %}general{% endif %} invoice-summary-{{ summary_item.get_summary_item_type_display }}">
-							<td class="summary-item-name">{% if summary_item.category_name_for_item_type %}{{ summary_item.category_name_for_item_type }} - {% endif %}{{ summary_item.name|default_if_none:'' }}</td>
-							<td>{% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}</td>
-							<td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
-						</tr>
-					{% endfor %}
-				{% endfor %}
-				{# Add general summary items here if there were not added before as part of facility summary items #}
-				{% if None not in invoice.sorted_core_facilities %}
-					{% for summary_item in invoice.summary_dict|get_item:None %}
-						<tr class="invoice-summary-{{ summary_item.get_summary_item_type_display }}">
-							<td class="summary-item-name">{{ summary_item.name|default_if_none:'' }}</td>
-							<td>{% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}</td>
-							<td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
-						</tr>
-					{% endfor %}
-				{% endif %}
-				<tr class="invoice-summary-category">
-					<td class="summary-item-name">Grand Total</td>
-					<td></td>
-					<td class="summary-item-amount">{{ invoice.total_amount_display }}</td>
-				</tr>
-				</tbody>
-			</table>
-		</div>
-		<div id="details" class="tab-pane col-lg-offset-1 col-lg-10 col-sm-12">
-			{% for core_facility, items in invoice.details_dict.items %}
-				<div class="h2 text-center panel panel-default" style="margin-top: 30px;padding: 15px">{{ core_facility|default_if_none:"General charges" }}</div>
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'tool_usage' key='tool_usage' title=tool_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'area_access' key='area_access' title=area_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'staff_charges' key='staff_charges' title=staff_charge_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'consumable_withdrawals' key='consumable_withdrawals' title=consumable_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'trainings' key='trainings' title=training_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'missed_reservations' key='missed_reservations' title=missed_reservation_title %}
-				{% include 'invoices/invoice_details.html' with items=items|get_item:'custom_charges' key='custom_charges' title=custom_charge_title %}
-			{% endfor %}
-		</div>
-		<div id="payments" class="tab-pane col-lg-offset-1 col-lg-10 col-sm-12">
-			<ul class="invoice-payment-list">
-				{% for payment in invoice.invoicepayment_set.all %}
-					<li>
-						<div class="form-inline" style="display:inline-block;">
-							<div class="form-control-static">
-								{{ payment.amount_display }} {% if payment.note %}({{ payment.note }}){% endif %} received on {{ payment.payment_received|date:'F jS, Y' }}
-							</div>
-						</div>
-						{% if payment.payment_processed %}
-							<div class="form-inline" style="display:inline-block;"><div class="form-control-static">- processed on {{ payment.payment_processed|date:'F jS, Y' }}</div></div>
-						{% else %}
-							<button class="btn btn-sm btn-info" onclick="$(this).hide();$('#form_payment_processed_{{ payment.id }}').css('display','inline');$('#payment_processed_date_{{ payment.id }}').datetimepicker({ format: '{{ date_input_js_format }}', useCurrent: false });">Mark as processed</button>
-							<form id="form_payment_processed_{{ payment.id }}" style="display: none;position: relative" action="{% url 'invoice_payment_processed' payment.id %}" method="post" class="form-inline">
-								{% csrf_token %}
-								<div class="form-group">
-									<label style="vertical-align: text-bottom" class="form-control-static" for="payment_processed_date_{{ payment.id }}">- processed on:</label>
-								</div>
-								<div class="form-group extra-side-padding">
-									<input id="payment_processed_date_{{ payment.id }}" name="payment_processed_date" autocomplete="off" class="form-control input-sm" type="text" required>
-								</div>
-								<div class="form-group extra-side-padding">
-									<input type="submit" class="btn btn-sm btn-success" value="Confirm" onclick="show_spinner(this.form);">
-								</div>
-							</form>
-						{% endif %}
-					</li>
-				{% empty %}
-					<i style="padding-left: 5px;">No payment have been received for this invoice.</i>
-				{% endfor %}
-			</ul>
-			<button class="btn btn-success btn-sm" style="margin-top: 15px" onclick="show_add_payment_modal()">Record new payment</button>
-			{% if invoice.total_outstanding_amount > 0 %}
-				<button class="btn btn-success btn-sm" style="margin-top: 15px" onclick="location.href = '{% url 'mark_invoice_as_paid_in_full' invoice.id %}'">Mark paid in full</button>
-			{% endif %}
-		</div>
-	</div>
-	<div class="modal fade" id="new-payment-dialog" tabindex="-1" role="dialog">
-		<div class="modal-dialog">
-			<div class="modal-content" style="width: 90%">
-				<div class="container-fluid" style="margin: 35px;padding: 0;">
-					<h3 style="margin-top: 0">Payment received form</h3>
-					<form action="{% url 'invoice_payment_received' invoice.id %}" class="form-horizontal" method="post" style="margin-top: 25px">
-						{% csrf_token %}
-						<div class="form-group">
-							<label for="payment_received_date" class="control-label col-sm-3">Received on:</label>
-							<div class="col-sm-4">
-								<input id="payment_received_date" name="payment_received_date" autocomplete="off" class="form-control input-sm" type="text" required>
-							</div>
-						</div>
-						<div class="form-group">
-							<label for="payment_received_amount" class="control-label col-sm-3">Amount:</label>
-							<div class="col-sm-4">
-								<input id="payment_received_amount" name="payment_received_amount" autocomplete="off" class="form-control input-sm" type="number" step=".01" min="1" required>
-							</div>
-						</div>
-						<div class="form-group" style="margin-bottom: 0">
-							<label for="payment_note" class="control-label col-sm-3">Note:</label>
-							<div class="col-sm-4">
-								<input id="payment_note" name="payment_note" autocomplete="off" class="form-control input-sm">
-							</div>
-							<div class="col-sm-5">
-								<input class="btn btn-sm btn-success pull-right" type="submit" value="Confirm">
-							</div>
-						</div>
-					</form>
-				</div>
-			</div>
-		</div>
-	</div>
-	<script>
+    <div class="col-lg-offset-1 col-lg-10 col-sm-12" style="margin-bottom: 15px">
+        <div style="margin-left: -15px;margin-right: -15px">
+            {% button type="default" url="invoices" value="Back to list" %}
+        </div>
+    </div>
+    {% if previous_id or next_id %}
+        <div class="col-lg-offset-1 col-lg-10 col-sm-12">
+            <div style="margin-left: -15px;margin-right: -15px">
+                {% if previous_id %}
+                    {% url 'view_invoice' previous_id as view_previous_invoice %}
+                    {% button type="default" url=view_previous_invoice value="previous" style="float: left;" %}
+                {% endif %}
+                {% if next_id %}
+                    {% url 'view_invoice' next_id as view_next_invoice %}
+                    {% button type="default" url=view_next_invoice value="next" style="float: right;" %}
+                {% endif %}
+            </div>
+        </div>
+    {% endif %}
+    <div class="col-lg-offset-1 col-lg-10 col-sm-12">
+        <h1>
+            {% if invoice.voided_date %}<s>{% endif %}
+                Invoice {{ invoice.invoice_number }} for {{ invoice.project_details.name }}
+                {% if invoice.project_details.category %}({{ invoice.project_details.category }}){% endif %}
+                {% if invoice.voided_date %}</s> (Void){% endif %}
+        </h1>
+        <h3>
+            <i>From {{ invoice.start|date:'F jS, Y' }} to {{ invoice.end|date:'F jS, Y' }}</i>
+        </h3>
+    </div>
+    <div class="row" style="margin-left: 0;margin-right: 0">
+        <div class="panel panel-default col-lg-offset-1 col-lg-10 col-sm-12" style="margin-top: 30px">
+            <div class="form-horizontal">
+                <div class="form-group" style="margin-top: 15px">
+                    <div class="control-label col-sm-2">
+                        <strong>Created:</strong>
+                    </div>
+                    <div class="col-sm-4">
+                        <p class="form-control-static">
+                            {{ invoice.created_date|date:'F jS, Y @ g:i A' }} ({{ invoice.created_by.username }})
+                        </p>
+                    </div>
+                    {% if invoice.project_details.project.application_identifier %}
+                        <div class="control-label col-sm-2">
+                            <strong>{{ "projects_and_accounts"|customization:"project_application_identifier_name" }}</strong>
+                        </div>
+                        <div class="col-sm-4">
+                            <p class="form-control-static">{{ invoice.project_details.project.application_identifier|default_if_none:'' }}</p>
+                        </div>
+                    {% endif %}
+                </div>
+                <div class="form-group">
+                    <div class="control-label col-sm-2">
+                        <strong>Total</strong>
+                    </div>
+                    <div class="col-sm-4">
+                        <p class="form-control-static">{{ invoice.total_amount_display }}</p>
+                    </div>
+                    <div class="control-label col-sm-2">
+                        <strong>Outstanding</strong>
+                    </div>
+                    <div class="col-sm-4">
+                        <p class="form-control-static">{{ invoice.total_payments_display }}</p>
+                    </div>
+                </div>
+                {% if user.is_accouting_officer or user.is_facility_manager or user.is_superuser %}
+                    <div class="form-group">
+                        <div class="control-label col-sm-2">
+                            <strong>Reviewed</strong>
+                        </div>
+                        <div class="col-sm-4">
+                            {% if invoice.reviewed_date %}
+                                <p class="form-control-static">
+                                    {{ invoice.reviewed_date|date:'F jS, Y @ g:i A' }} ({{ invoice.reviewed_by.username }})
+                                </p>
+                            {% else %}
+                                <form action="{% url 'review_invoice' invoice.id %}" method="post">
+                                    {% csrf_token %}
+                                    {% button type="info" submit=True size="small" value="Mark as reviewed" onclick="show_spinner();" icon="glyphicon-ok-circle" %}
+                                </form>
+                            {% endif %}
+                        </div>
+                        <div class="control-label col-sm-2">
+                            <strong>Void</strong>
+                        </div>
+                        <div class="col-sm-4">
+                            {% if invoice.voided_date %}
+                                <p class="form-control-static">{{ invoice.voided_date|date:'F jS, Y @ g:i A' }} ({{ invoice.voided_by.username }})</p>
+                            {% else %}
+                                <form action="{% url 'void_invoice' invoice.id %}" method="post">
+                                    {% csrf_token %}
+                                    {% button type="delete" submit=True size="small" value="Void invoice" onclick="show_spinner();" icon="glyphicon-ban-circle" %}
+                                </form>
+                            {% endif %}
+                        </div>
+                    </div>
+                {% endif %}
+                <div class="form-group">
+                    {% if user.is_accouting_officer or user.is_facility_manager or user.is_superuser %}
+                        <div class="control-label col-sm-2">
+                            <strong>Last sent</strong>
+                        </div>
+                        <div class="col-sm-4">
+                            {% if invoice.last_sent_date %}
+                                <div class="form-control-static" style="display: inline-block;vertical-align: sub;">
+                                    {{ invoice.last_sent_date|date:'F jS, Y @ g:i A' }}
+                                </div>
+                            {% elif not invoice.reviewed_date %}
+                                <p class="form-control-static">Invoice hasn't been reviewed</p>
+                            {% endif %}
+                            {% if invoice.reviewed_date %}
+                                <form action="{% url 'send_invoice' invoice.id %}" method="post" style="display: inline-block">
+                                    {% csrf_token %}
+                                    {% button type="save" size="small" value=invoice.last_sent_date|yesno:"Re-send,Send invoice" onclick="show_spinner();" icon="glyphicon-send" %}
+                                </form>
+                            {% endif %}
+                        </div>
+                    {% endif %}
+                    <div class="control-label col-sm-2">
+                        <strong>File</strong>
+                    </div>
+                    <div class="col-sm-4">
+                        {% if invoice.file %}
+                            <p class="form-control-static">
+                                <a href="{{ invoice.file.url }}" target="_blank">{{ invoice.filename }}</a>
+                            </p>
+                        {% else %}
+                            {% url 're_render_invoice' invoice.id as re_render_url %}
+                            {% button type="warn" size="small" value="Re-render invoice file" onclick="show_spinner();" url=re_render_url icon="glyphicon-refresh" %}
+                        {% endif %}
+                    </div>
+                </div>
+            </div>
+        </div>
+    </div>
+    <div class="row" style="margin-top:30px">
+        <div class="col-xs-7 col-lg-offset-1">
+            <ul class="nav nav-pills" id="tabs">
+                <li class="active">
+                    <a href="#summary">Summary</a>
+                </li>
+                <li>
+                    <a href="#details">Details</a>
+                </li>
+                <li>
+                    <a href="#payments">Payments</a>
+                </li>
+            </ul>
+        </div>
+        <div class="col-lg-3 col-xs-5 text-right">
+            {% url 'csv_invoice' invoice.id as export_csv_url %}
+            {% button type="export" value="Export data in CSV" url=export_csv_url %}
+        </div>
+    </div>
+    <div class="tab-content" style="margin-top: 15px">
+        <div id="summary" class="tab-pane active col-lg-offset-1 col-lg-10 col-sm-12" style="padding: 0">
+            <table class="invoice-summary-table table table-hover">
+                <thead>
+                    <tr>
+                        <th>Item</th>
+                        <th>Details</th>
+                        <th class="button-column-minimum">Amount</th>
+                    </tr>
+                </thead>
+                <tbody>
+                    {% for facility in invoice.sorted_core_facilities %}
+                        <tr class="invoice-summary-{% if facility %}facility{% else %}general{% endif %} invoice-summary-category">
+                            <td class="summary-item-name">{{ facility|default_if_none:'General Charges' }}</td>
+                            <td></td>
+                            <td class="summary-item-amount"></td>
+                        </tr>
+                        {% for summary_item in invoice.summary_dict|get_item:facility %}
+                            <tr class="invoice-summary-{% if facility %}facility{% else %}general{% endif %} invoice-summary-{{ summary_item.get_summary_item_type_display }}">
+                                <td class="summary-item-name">
+                                    {% if summary_item.category_name_for_item_type %}{{ summary_item.category_name_for_item_type }} -{% endif %}
+                                    {{ summary_item.name|default_if_none:'' }}
+                                </td>
+                                <td>
+                                    {% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}
+                                </td>
+                                <td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
+                            </tr>
+                        {% endfor %}
+                    {% endfor %}
+                    {# Add general summary items here if there were not added before as part of facility summary items #}
+                    {% if None not in invoice.sorted_core_facilities %}
+                        {% for summary_item in invoice.summary_dict|get_item:None %}
+                            <tr class="invoice-summary-{{ summary_item.get_summary_item_type_display }}">
+                                <td class="summary-item-name">{{ summary_item.name|default_if_none:'' }}</td>
+                                <td>
+                                    {% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}
+                                </td>
+                                <td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
+                            </tr>
+                        {% endfor %}
+                    {% endif %}
+                    <tr class="invoice-summary-category">
+                        <td class="summary-item-name">Grand Total</td>
+                        <td></td>
+                        <td class="summary-item-amount">{{ invoice.total_amount_display }}</td>
+                    </tr>
+                </tbody>
+            </table>
+        </div>
+        <div id="details" class="tab-pane col-lg-offset-1 col-lg-10 col-sm-12">
+            {% for core_facility, items in invoice.details_dict.items %}
+                <div class="h2 text-center panel panel-default" style="margin-top: 30px;padding: 15px">
+                    {{ core_facility|default_if_none:"General charges" }}
+                </div>
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'tool_usage' key='tool_usage' title=tool_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'area_access' key='area_access' title=area_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'staff_charges' key='staff_charges' title=staff_charge_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'consumable_withdrawals' key='consumable_withdrawals' title=consumable_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'trainings' key='trainings' title=training_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'missed_reservations' key='missed_reservations' title=missed_reservation_title %}
+                {% include 'invoices/invoice_details.html' with items=items|get_item:'custom_charges' key='custom_charges' title=custom_charge_title %}
+            {% endfor %}
+        </div>
+        <div id="payments" class="tab-pane col-lg-offset-1 col-lg-10 col-sm-12">
+            <ul class="invoice-payment-list">
+                {% for payment in invoice.invoicepayment_set.all %}
+                    <li>
+                        <div class="form-inline" style="display:inline-block;">
+                            <div class="form-control-static">
+                                {{ payment.amount_display }}
+                                {% if payment.note %}({{ payment.note }}){% endif %}
+                                received on {{ payment.payment_received|date:'F jS, Y' }}
+                            </div>
+                        </div>
+                        {% if payment.payment_processed %}
+                            <div class="form-inline" style="display:inline-block;">
+                                <div class="form-control-static">- processed on {{ payment.payment_processed|date:'F jS, Y' }}</div>
+                            </div>
+                        {% else %}
+                            <button class="btn btn-sm btn-info"
+                                    onclick="$(this).hide();$('#form_payment_processed_{{ payment.id }}').css('display','inline');$('#payment_processed_date_{{ payment.id }}').datetimepicker({ format: '{{ date_input_js_format }}', useCurrent: false });">
+                                Mark as processed
+                            </button>
+                            <form id="form_payment_processed_{{ payment.id }}"
+                                  style="display: none;
+                                         position: relative"
+                                  action="{% url 'invoice_payment_processed' payment.id %}"
+                                  method="post"
+                                  class="form-inline">
+                                {% csrf_token %}
+                                <div class="form-group">
+                                    <label style="vertical-align: text-bottom"
+                                           class="form-control-static"
+                                           for="payment_processed_date_{{ payment.id }}">- processed on:</label>
+                                </div>
+                                <div class="form-group extra-side-padding">
+                                    <input id="payment_processed_date_{{ payment.id }}"
+                                           name="payment_processed_date"
+                                           autocomplete="off"
+                                           class="form-control input-sm"
+                                           type="text"
+                                           required>
+                                </div>
+                                <div class="form-group extra-side-padding">
+                                    <input type="submit" class="btn btn-sm btn-success" value="Confirm" onclick="show_spinner(this.form);">
+                                </div>
+                            </form>
+                        {% endif %}
+                    </li>
+                {% empty %}
+                    <i style="padding-left: 5px;">No payment have been received for this invoice.</i>
+                {% endfor %}
+            </ul>
+            <button class="btn btn-success btn-sm" style="margin-top: 15px" onclick="show_add_payment_modal()">
+                Record new payment
+            </button>
+            {% if invoice.total_outstanding_amount > 0 %}
+                <button class="btn btn-success btn-sm"
+                        style="margin-top: 15px"
+                        onclick="location.href = '{% url 'mark_invoice_as_paid_in_full' invoice.id %}'">
+                    Mark paid in full
+                </button>
+            {% endif %}
+        </div>
+    </div>
+    <div class="modal fade" id="new-payment-dialog" tabindex="-1" role="dialog">
+        <div class="modal-dialog">
+            <div class="modal-content" style="width: 90%">
+                <div class="container-fluid" style="margin: 35px;padding: 0;">
+                    <h3 style="margin-top: 0">Payment received form</h3>
+                    <form action="{% url 'invoice_payment_received' invoice.id %}"
+                          class="form-horizontal"
+                          method="post"
+                          style="margin-top: 25px">
+                        {% csrf_token %}
+                        <div class="form-group">
+                            <label for="payment_received_date" class="control-label col-sm-3">Received on:</label>
+                            <div class="col-sm-4">
+                                <input id="payment_received_date"
+                                       name="payment_received_date"
+                                       autocomplete="off"
+                                       class="form-control input-sm"
+                                       type="text"
+                                       required>
+                            </div>
+                        </div>
+                        <div class="form-group">
+                            <label for="payment_received_amount" class="control-label col-sm-3">Amount:</label>
+                            <div class="col-sm-4">
+                                <input id="payment_received_amount"
+                                       name="payment_received_amount"
+                                       autocomplete="off"
+                                       class="form-control input-sm"
+                                       type="number"
+                                       step=".01"
+                                       min="1"
+                                       required>
+                            </div>
+                        </div>
+                        <div class="form-group" style="margin-bottom: 0">
+                            <label for="payment_note" class="control-label col-sm-3">Note:</label>
+                            <div class="col-sm-4">
+                                <input id="payment_note" name="payment_note" autocomplete="off" class="form-control input-sm">
+                            </div>
+                            <div class="col-sm-5">
+                                <input class="btn btn-sm btn-success pull-right" type="submit" value="Confirm">
+                            </div>
+                        </div>
+                    </form>
+                </div>
+            </div>
+        </div>
+    </div>
+    <script>
 		function show_add_payment_modal()
 		{
 		    $("#new-payment-dialog .modal-content").html($('#form_add_payment_content').html());
 			$("#new-payment-dialog").modal('show');
 			$("#payment_received_date").datetimepicker({ format: '{{ date_input_js_format }}', useCurrent: false });
 		}
 		window.addEventListener('load', function ()
 		{
 			$("#tabs").find("a").click(switch_tab);
 		});
-	</script>
-{% endblock %}
+	
+    </script>
+{% endblock %}
```

### html2text {}

```diff
@@ -1,11 +1,11 @@
 {% extends 'invoices/base.html' %} {% load custom_tags_and_filters %} {% block
 title %}Invoice{% endblock %} {% block invoiceextrahead %} {% load static %}
 }">
-}"/> {% endblock %} {% block content %}
+}" /> {% endblock %} {% block content %}
 {% button type="default" url="invoices" value="Back to list" %}
 {% if previous_id or next_id %}
 {% if previous_id %} {% url 'view_invoice' previous_id as view_previous_invoice
 %} {% button type="default" url=view_previous_invoice value="previous"
 style="float: left;" %} {% endif %} {% if next_id %} {% url 'view_invoice'
 next_id as view_next_invoice %} {% button type="default" url=view_next_invoice
 value="next" style="float: right;" %} {% endif %}
@@ -75,15 +75,15 @@
 {{ facility|default_if_none:'General
 Charges' }}
 {% if
 summary_item.category_name_for_item_type {% if
 %}{                                      summary_item.get_summary_item_type_display {
 {                                        != 'fund' %}{                              {
 summary_item.category_name_for_item_type { summary_item.details|default_if_none:''  summary_item.amount_display|default_if_none:
-}} - {% endif %}{                        }}{% endif %}                              '' }}
+}} -{% endif %} {                        }}{% endif %}                              '' }}
 { summary_item.name|default_if_none:''
 }}
                                          {% if                                      {
 {{ summary_item.name|default_if_none:''  summary_item.get_summary_item_type_display {
 }}                                       != 'fund' %}{                              summary_item.amount_display|default_if_none:
                                          { summary_item.details|default_if_none:''  '' }}
                                          }}{% endif %}
```

## NEMO_billing/invoices/templates/invoices/invoice_details.html

```diff
@@ -1,81 +1,93 @@
 {% if items %}
-	<h4>{{ title }}</h4>
-	{% if key == 'tool_usage' or key == 'area_access' or key == 'staff_charges' or key == 'trainings' or key == 'missed_reservations' %}
-		<table class="invoice-details-table table table-hover">
-			<thead>
-				<tr>
-					<th>User</th>
-					<th>{% if key == 'tool_usage' or key == 'trainings' %}Tool{% elif key == 'area_access' %}Area{% elif key == 'missed_reservations' %}Reservation{% elif key == 'staff_charge' %}Item{% endif %}</th>
-					<th>Rate</th>
-					{% if key != 'missed_reservation' %}<th>Quantity</th>{% endif %}
-					{% if key == 'trainings' %}
-						<th>Date</th>
-					{% else %}
-						<th>Start</th>
-						<th>End</th>
-					{% endif %}
-					<th class="button-column-minimum">Amount</th>
-				</tr>
-			</thead>
-			<tbody>
-				{% for detail_item in items %}
-					<tr class="detail-item-{{ detail_item.get_item_type_display }}">
-						<td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
-						<td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
-						<td class="detail-item-rate">{{ detail_item.rate|default_if_none:'' }}</td>
-						{% if key != 'missed_reservation' %}<td class="detail-item-quantity">{{ detail_item.quantity_display|default_if_none:'' }}</td>{% endif %}
-						<td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
-						{% if key != 'trainings' %}<td class="detail-item-end">{{ detail_item.end|default_if_none:'' }}</td>{% endif %}
-						<td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
-					</tr>
-				{% endfor %}
-			</tbody>
-		</table>
-	{% elif key == 'consumable_withdrawals' %}
-		<table class="invoice-details-table table table-hover">
-			<thead>
-				<tr>
-					<th>User</th>
-					<th>Supply</th>
-					<th>Rate</th>
-					<th>Quantity</th>
-					<th>Date</th>
-					<th class="button-column-minimum">Amount</th>
-				</tr>
-			</thead>
-			<tbody>
-				{% for detail_item in items %}
-					<tr class="detail-item-{{ detail_item.get_item_type_display }}">
-						<td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
-						<td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
-						<td class="detail-item-rate">{{ detail_item.rate|default_if_none:'' }}</td>
-						<td class="detail-item-quantity">{{ detail_item.quantity_display|default_if_none:'' }}</td>
-						<td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
-						<td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
-					</tr>
-				{% endfor %}
-			</tbody>
-		</table>
-	{% elif key == 'custom_charges' %}
-		<table class="invoice-details-table table table-hover">
-			<thead>
-				<tr>
-					<th>User</th>
-					<th>Charge</th>
-					<th>Date</th>
-					<th class="button-column-minimum">Amount</th>
-				</tr>
-			</thead>
-			<tbody>
-				{% for detail_item in items %}
-					<tr class="detail-item-{{ detail_item.get_item_type_display }}">
-						<td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
-						<td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
-						<td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
-						<td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
-					</tr>
-				{% endfor %}
-			</tbody>
-		</table>
-	{% endif %}
-{% endif %}
+    <h4>{{ title }}</h4>
+    {% if key == 'tool_usage' or key == 'area_access' or key == 'staff_charges' or key == 'trainings' or key == 'missed_reservations' %}
+        <table class="invoice-details-table table table-hover">
+            <thead>
+                <tr>
+                    <th>User</th>
+                    <th>
+                        {% if key == 'tool_usage' or key == 'trainings' %}
+                            Tool
+                        {% elif key == 'area_access' %}
+                            Area
+                        {% elif key == 'missed_reservations' %}
+                            Reservation
+                        {% elif key == 'staff_charge' %}
+                            Item
+                        {% endif %}
+                    </th>
+                    <th>Rate</th>
+                    {% if key != 'missed_reservation' %}<th>Quantity</th>{% endif %}
+                    {% if key == 'trainings' %}
+                        <th>Date</th>
+                    {% else %}
+                        <th>Start</th>
+                        <th>End</th>
+                    {% endif %}
+                    <th class="button-column-minimum">Amount</th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for detail_item in items %}
+                    <tr class="detail-item-{{ detail_item.get_item_type_display }}">
+                        <td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
+                        <td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
+                        <td class="detail-item-rate">{{ detail_item.rate|default_if_none:'' }}</td>
+                        {% if key != 'missed_reservation' %}
+                            <td class="detail-item-quantity">{{ detail_item.quantity_display|default_if_none:'' }}</td>
+                        {% endif %}
+                        <td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
+                        {% if key != 'trainings' %}<td class="detail-item-end">{{ detail_item.end|default_if_none:'' }}</td>{% endif %}
+                        <td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% elif key == 'consumable_withdrawals' %}
+        <table class="invoice-details-table table table-hover">
+            <thead>
+                <tr>
+                    <th>User</th>
+                    <th>Supply</th>
+                    <th>Rate</th>
+                    <th>Quantity</th>
+                    <th>Date</th>
+                    <th class="button-column-minimum">Amount</th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for detail_item in items %}
+                    <tr class="detail-item-{{ detail_item.get_item_type_display }}">
+                        <td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
+                        <td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
+                        <td class="detail-item-rate">{{ detail_item.rate|default_if_none:'' }}</td>
+                        <td class="detail-item-quantity">{{ detail_item.quantity_display|default_if_none:'' }}</td>
+                        <td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
+                        <td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% elif key == 'custom_charges' %}
+        <table class="invoice-details-table table table-hover">
+            <thead>
+                <tr>
+                    <th>User</th>
+                    <th>Charge</th>
+                    <th>Date</th>
+                    <th class="button-column-minimum">Amount</th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for detail_item in items %}
+                    <tr class="detail-item-{{ detail_item.get_item_type_display }}">
+                        <td class="detail-item-user">{{ detail_item.user|default_if_none:'' }}</td>
+                        <td class="detail-item-name">{{ detail_item.name|default_if_none:'' }}</td>
+                        <td class="detail-item-start">{{ detail_item.start|default_if_none:'' }}</td>
+                        <td class="detail-item-amount">{{ detail_item.amount_display|default_if_none:'' }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% endif %}
+{% endif %}
```

### html2text {}

```diff
@@ -1,17 +1,18 @@
 {% if items %}
 ****** {{{{ ttiittllee }}}} ******
 {% if key == 'tool_usage' or key == 'area_access' or key == 'staff_charges' or
 key == 'trainings' or key == 'missed_reservations' %}
                                   {{%% iiff kkeeyy ==== ''ttooooll__uussaaggee'' oorr kkeeyy
-                                  ==== ''ttrraaiinniinnggss'' %%}}TTooooll{{%% eelliiff kkeeyy
-UUsseerr                              ==== ''aarreeaa__aacccceessss'' %%}}AArreeaa{{%% eelliiff    RRaattee                              QQuuaannttiittyy                                      DDaattee                               SSttaarrtt                            EEnndd                                         AAmmoouunntt
-                                  kkeeyy ==== ''mmiisssseedd__rreesseerrvvaattiioonnss''
-                                  %%}}RReesseerrvvaattiioonn{{%% eelliiff kkeeyy ====
-                                  ''ssttaaffff__cchhaarrggee'' %%}}IItteemm{{%% eennddiiff %%}}
+                                  ==== ''ttrraaiinniinnggss'' %%}} TTooooll {{%% eelliiff
+                                  kkeeyy ==== ''aarreeaa__aacccceessss'' %%}} AArreeaa {{%%
+UUsseerr                              eelliiff kkeeyy ==== ''mmiisssseedd__rreesseerrvvaattiioonnss'' RRaattee                              QQuuaannttiittyy                                      DDaattee                               SSttaarrtt                            EEnndd                                         AAmmoouunntt
+                                  %%}} RReesseerrvvaattiioonn {{%% eelliiff kkeeyy ====
+                                  ''ssttaaffff__cchhaarrggee'' %%}} IItteemm {{%% eennddiiff
+                                  %%}}
 {                                 {                                 {                                 {                                             {                                  {                                {
 {                                 {                                 {                                 {                                             {                                  {                                {
 detail_item.user|default_if_none: detail_item.name|default_if_none: detail_item.rate|default_if_none: detail_item.quantity_display|default_if_none: detail_item.start|default_if_none: detail_item.end|default_if_none: detail_item.amount_display|default_if_none:
 '' }}                             '' }}                             '' }}                             '' }}                                         '' }}                              '' }}                            '' }}
 {% elif key == 'consumable_withdrawals' %}
 UUsseerr                              SSuuppppllyy                            RRaattee                              QQuuaannttiittyy                                      DDaattee                               AAmmoouunntt
 {                                 {                                 {                                 {                                             {                                  {
```

## NEMO_billing/invoices/templates/invoices/invoices.html

```diff
@@ -1,195 +1,274 @@
 {% extends 'pagination/pagination_base.html' %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 {% block title %}Invoices{% endblock %}
 {% block before_pagination %}
-	<h1>
-		Invoices
-	</h1>
-	{% if not configuration_list and user.is_superuser %}
-		<h3 style="margin-bottom: 30px">There are no invoice configurations set</h3>
-		<h3>
-			You can change that in the <a href="{% url 'admin:invoices_invoiceconfiguration_changelist' %}">Invoice Configuration section of 'Detailed Administration'</a>.
-		</h3>
-	{% else %}
-		<div class="row" style="margin-bottom: 40px">
-			<div class="col-sm-4">
-				<input id="search" type="text" placeholder="Search for an invoice" class="form-control" autofocus>
-			</div>
-		</div>
-		{% if user.is_accounting_officer or user.is_facility_manager or user.is_superuser %}
-			<form id="generate-invoice-form" action="{% url 'generate_monthly_invoices' %}" class="form-horizontal" method="post">
-				{% csrf_token %}
-				<div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-4{% else %}col-md-3{% endif %}" style="margin-bottom: 15px; padding: 0;">
-					<label for="month" class="col-xs-2 col-sm-3 control-label">Month</label>
-					<div class="col-xs-10 col-sm-9" style="padding-right:0;">
-						<select name="month" id="month" class="form-control" required>
-							<option selected disabled value=""></option>
-							{% for month in month_list %}
-								<option>{{ month|date:"F, Y" }}</option>
-							{% endfor %}
-						</select>
-					</div>
-				</div>
-				<div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-5{% else %}col-md-5{% endif %}" style="margin-bottom: 15px; padding: 0">
-					{% cap_discount_installed as cap_discount_installed %}
-					<label for="project_id" class="col-xs-2 col-sm-3 control-label">{% if cap_discount_installed %}Account{% else %}Project{% endif %}</label>
-					<div class="col-xs-10 col-sm-9" style="padding-right:0;">
-						<select name="project_id" id="project_id" class="form-control" required>
-							<option selected disabled value=""></option>
-							<option value="All">All</option>
-							{% regroup projects by account as projects_by_account %}
-							{% for account in projects_by_account %}
-								<option value="account:{{ account.grouper.id }}">{{ account.grouper.name }}</option>
-								{% if not cap_discount_installed %}
-									{# Don't allow single project invoice generation if we have account caps #}
-									{% for project in account.list %}
-										<option value="{{ project.id }}">&nbsp;&nbsp;&nbsp;&nbsp;{{ project.name }}</option>
-									{% endfor %}
-								{% endif %}
-							{% endfor %}
-						</select>
-					</div>
-				</div>
-				{% if configuration_list|length_is:1 %}
-					<input type="hidden" name="configuration_id" value="{{ configuration_list.0.id }}">
-				{% else %}
-					<div class="col-xs-12 col-sm-6 col-md-4" style="margin-bottom: 15px; padding: 0">
-						<label for="configuration_id" class="col-xs-2 col-sm-3 control-label">Config</label>
-						<div class="col-xs-10 col-sm-9" style="padding-right:0;">
-							<select class="form-control" name="configuration_id" id="configuration_id" required>
-								<option disabled selected value="">Select a configuration</option>
-								{% for configuration in configuration_list %}
-									<option value="{{ configuration.id }}">{{ configuration.name }}</option>
-								{% endfor %}
-							</select>
-						</div>
-					</div>
-				{% endif %}
-				<div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-3 col-sm-offset-6 col-md-offset-0{% else %}col-md-4 col-md-offset-8{% endif %} text-right" style="margin-bottom: 15px; padding-right:0;">
-					{% button type="save" onclick="show_spinner(this.form);" value="Generate invoice(s)" icon="glyphicon-list-alt" %}
-				</div>
-			</form>
-		{% endif %}
-		<div id="download_invoices" class="row" style="display: none; margin-top: 15px; margin-right: 0">
-			<div class="form-group">
-				{% url 'mark_invoices_as_paid_in_full' as mark_paid_in_full_url %}
-				{% url 'review_and_send_invoices' as review_and_send_url %}
-				{% url 'zip_invoices' 'csv' as zip_csv_url %}
-				{% url 'zip_invoices' as zip_url %}
-				{% button type="export" style="margin-left: 10px; float: right;" value="Mark paid in full" onclick="$('#selected-invoices').attr('action', '"|concat:mark_paid_in_full_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
-				{% button type="export" style="margin-left: 10px; float: right;" value="Review and send" onclick="$('#selected-invoices').attr('action', '"|concat:review_and_send_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
-				{% button type="export" style="margin-left: 10px; float: right;" value="Export (CSV)" onclick="$('#selected-invoices').attr('action', '"|concat:zip_csv_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
-				{% button type="export" style="float: right;" value="Export" onclick="$('#selected-invoices').attr('action', '"|concat:zip_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
-				<label class="pull-right control-label form-control-static" style="margin-right: 10px;">Selected invoices: </label>
-			</div>
-		</div>
-	{% endif %}
+    <h1>Invoices</h1>
+    {% if not configuration_list and user.is_superuser %}
+        <h3 style="margin-bottom: 30px">There are no invoice configurations set</h3>
+        <h3>
+            You can change that in the <a href="{% url 'admin:invoices_invoiceconfiguration_changelist' %}">Invoice Configuration section of 'Detailed Administration'</a>.
+        </h3>
+    {% else %}
+        <div class="row" style="margin-bottom: 40px">
+            <div class="col-sm-4">
+                <input id="search" type="text" placeholder="Search for an invoice" class="form-control" autofocus>
+            </div>
+        </div>
+        {% if user.is_accounting_officer or user.is_facility_manager or user.is_superuser %}
+            <form id="generate-invoice-form"
+                  action="{% url 'generate_monthly_invoices' %}"
+                  class="form-horizontal"
+                  method="post">
+                {% csrf_token %}
+                <div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-4{% else %}col-md-3{% endif %}"
+                     style="margin-bottom: 15px;
+                            padding: 0">
+                    <label for="month" class="col-xs-2 col-sm-3 control-label">Month</label>
+                    <div class="col-xs-10 col-sm-9" style="padding-right:0;">
+                        <select name="month" id="month" class="form-control" required>
+                            <option selected disabled value=""></option>
+                            {% for month in month_list %}<option>{{ month|date:"F, Y" }}</option>{% endfor %}
+                        </select>
+                    </div>
+                </div>
+                <div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-5{% else %}col-md-5{% endif %}"
+                     style="margin-bottom: 15px;
+                            padding: 0">
+                    {% cap_discount_installed as cap_discount_installed %}
+                    <label for="project_id" class="col-xs-2 col-sm-3 control-label">
+                        {% if cap_discount_installed %}
+                            Account
+                        {% else %}
+                            Project
+                        {% endif %}
+                    </label>
+                    <div class="col-xs-10 col-sm-9" style="padding-right:0;">
+                        <select name="project_id" id="project_id" class="form-control" required>
+                            <option selected disabled value=""></option>
+                            <option value="All">All</option>
+                            {% regroup projects by account as projects_by_account %}
+                            {% for account in projects_by_account %}
+                                <option value="account:{{ account.grouper.id }}">{{ account.grouper.name }}</option>
+                                {% if not cap_discount_installed %}
+                                    {# Don't allow single project invoice generation if we have account caps #}
+                                    {% for project in account.list %}
+                                        <option value="{{ project.id }}">&nbsp;&nbsp;&nbsp;&nbsp;{{ project.name }}</option>
+                                    {% endfor %}
+                                {% endif %}
+                            {% endfor %}
+                        </select>
+                    </div>
+                </div>
+                {% if configuration_list|length_is:1 %}
+                    <input type="hidden" name="configuration_id" value="{{ configuration_list.0.id }}">
+                {% else %}
+                    <div class="col-xs-12 col-sm-6 col-md-4" style="margin-bottom: 15px; padding: 0">
+                        <label for="configuration_id" class="col-xs-2 col-sm-3 control-label">Config</label>
+                        <div class="col-xs-10 col-sm-9" style="padding-right:0;">
+                            <select class="form-control" name="configuration_id" id="configuration_id" required>
+                                <option disabled selected value="">Select a configuration</option>
+                                {% for configuration in configuration_list %}
+                                    <option value="{{ configuration.id }}">{{ configuration.name }}</option>
+                                {% endfor %}
+                            </select>
+                        </div>
+                    </div>
+                {% endif %}
+                <div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-3 col-sm-offset-6 col-md-offset-0{% else %}col-md-4 col-md-offset-8{% endif %} text-right"
+                     style="margin-bottom: 15px;
+                            padding-right:0">
+                    {% button type="save" onclick="show_spinner(this.form);" value="Generate invoice(s)" icon="glyphicon-list-alt" %}
+                </div>
+            </form>
+        {% endif %}
+        <div id="download_invoices" class="row" style="display: none; margin-top: 15px; margin-right: 0">
+            <div class="form-group">
+                {% url 'mark_invoices_as_paid_in_full' as mark_paid_in_full_url %}
+                {% url 'review_and_send_invoices' as review_and_send_url %}
+                {% url 'zip_invoices' 'csv' as zip_csv_url %}
+                {% url 'zip_invoices' as zip_url %}
+                {% button type="export" style="margin-left: 10px; float: right;" value="Mark paid in full" onclick="$('#selected-invoices').attr('action', '"|concat:mark_paid_in_full_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+                {% button type="export" style="margin-left: 10px; float: right;" value="Review and send" onclick="$('#selected-invoices').attr('action', '"|concat:review_and_send_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+                {% button type="export" style="margin-left: 10px; float: right;" value="Export (CSV)" onclick="$('#selected-invoices').attr('action', '"|concat:zip_csv_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+                {% button type="export" style="float: right;" value="Export" onclick="$('#selected-invoices').attr('action', '"|concat:zip_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+                <label class="pull-right control-label form-control-static" style="margin-right: 10px;">Selected invoices:</label>
+            </div>
+        </div>
+    {% endif %}
 {% endblock %}
 {% block pagination_header %}
-	<div class="row" style="width: 100%; margin: 20px 0;">
-		{% regroup filter_month_list by year as filter_by_year %}
-		{% if filter_month_list %}
-			<div class="col-sm-12" style="padding-left: 0">
-				{% for year in filter_by_year %}
-					<button style="margin-right: 2px" class="year-button btn btn-sm btn-default {% if filter_year and filter_year == year.grouper %}focus{% endif %}" type="button" onclick="$('.year-button').removeClass('focus');$('.filter_year').hide();$('#filter_year_{{ year.grouper }}').show();">{{ year.grouper }}</button>
-				{% endfor %}
-				{% if filter_month %}<a class="btn btn-sm btn-default" type="button" href="{% url 'invoices' %}"><i class="glyphicon glyphicon-remove"></i> Clear</a>{% endif %}
-			</div>
-			<div class="col-xs-7 col-sm-8 col-lg-10" style="padding-left: 0">
-				{% for year in filter_by_year %}
-					<div id="filter_year_{{ year.grouper }}" class="filter_year" style="margin-top:10px; {% if not filter_year or filter_year != year.grouper %}display: none;{% endif %}">
-						{% for month in year.list %}
-							<a style="margin-right: 10px" href="{% url 'invoices_month' month.year month.month %}">{{ month|date:"F" }}</a>
-						{% endfor %}
-					</div>
-				{% endfor %}
-			</div>
-		{% endif %}
-		<div class="col-xs-5 col-sm-4 col-lg-2 text-right" style="padding-right: 0">
-			{% include "pagination/pagination_selector.html" %}
-		</div>
-	</div>
+    <div class="row" style="width: 100%; margin: 20px 0;">
+        {% regroup filter_month_list by year as filter_by_year %}
+        {% if filter_month_list %}
+            <div class="col-sm-12" style="padding-left: 0">
+                {% for year in filter_by_year %}
+                    <button style="margin-right: 2px"
+                            class="year-button btn btn-sm btn-default {% if filter_year and filter_year == year.grouper %}focus{% endif %}"
+                            type="button"
+                            onclick="$('.year-button').removeClass('focus');$('.filter_year').hide();$('#filter_year_{{ year.grouper }}').show();">
+                        {{ year.grouper }}
+                    </button>
+                {% endfor %}
+                {% if filter_month %}
+                    <a class="btn btn-sm btn-default" type="button" href="{% url 'invoices' %}"><i class="glyphicon glyphicon-remove"></i> Clear</a>
+                {% endif %}
+            </div>
+            <div class="col-xs-7 col-sm-8 col-lg-10" style="padding-left: 0">
+                {% for year in filter_by_year %}
+                    <div id="filter_year_{{ year.grouper }}"
+                         class="filter_year"
+                         style="margin-top:10px;
+                                {% if not filter_year or filter_year != year.grouper %}display: none;{% endif %}">
+                        {% for month in year.list %}
+                            <a style="margin-right: 10px" href="{% url 'invoices_month' month.year month.month %}">{{ month|date:"F" }}</a>
+                        {% endfor %}
+                    </div>
+                {% endfor %}
+            </div>
+        {% endif %}
+        <div class="col-xs-5 col-sm-4 col-lg-2 text-right" style="padding-right: 0">
+            {% include "pagination/pagination_selector.html" %}
+        </div>
+    </div>
 {% endblock %}
 {% block pagination_content %}
-	<form id="selected-invoices" action="{% url 'zip_invoices' %}" method="post">
-		{% csrf_token %}
-		<table class="table table-bordered table-condensed table-striped table-hover thead-light">
-			<thead>
-				<tr>
-					<th class="button-column-minimum"><input type="checkbox" onchange="$('#selected-invoices :checkbox').prop('checked', $(this).prop('checked'));update_download_button_state();"></th>
-					<th class="button-column-minimum">{% include 'pagination/pagination_column.html' with order_by='invoice_number' name='#' %}</th>
-					{% if "created_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='created_date' name='Created' %}</th>{% endif %}
-					{% if "month" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='start' name='Month' %}</th>{% endif %}
-					<th>{% include 'pagination/pagination_column.html' with order_by='project_details__project__name' name='Project' %}</th>
-					<th>{% include 'pagination/pagination_column.html' with order_by='project_details__project__account__name' name='Account' %}</th>
-					{% if "sent_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='last_sent_date' name='Sent' %}</th>{% endif %}
-					{% if "due_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='due_date' name='Due' %}</th>{% endif %}
-					{% if "review_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='reviewed_date' name='Reviewed' %}</th>{% endif %}
-					<th>{% include 'pagination/pagination_column.html' with order_by='total_amount' name='Total' %}</th>
-					{% for core_facility in core_facilities %}
-						<th>{% include 'pagination/pagination_column.html' with order_by='facility_total_'|concat:core_facility.id name=core_facility.name %}</th>
-					{% endfor %}
-					{% if display_general_facility %}<th>{% include 'pagination/pagination_column.html' with order_by='facility_total_general' name="General" %}</th>{% endif %}
-					{% if "tax" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='total_tax' name='Tax' %}</th>{% endif %}
-					{% if "outstanding" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='outstanding' name='Outstanding' %}</th>{% endif %}
-					{% if "actions" not in hide_columns %}<th class="button-column-minimum"></th>{% endif %}
-				</tr>
-			</thead>
-			<tbody>
-				{% for invoice in page %}
-					{% url 'view_invoice' invoice.id as view_invoice_url %}
-					{% with td_attribute="onclick=\"window.location.href = '"|concat:view_invoice_url|concat:"'\" style=\"cursor:pointer\"" %}
-						<tr>
-							<td class="text-center"><input type="checkbox" id="select_{{ invoice.id }}" name="selected_invoice_id[]" aria-label="{{ invoice.invoice_number }}" value="{{ invoice.id }}" onchange="update_download_button_state();"/></td>
-							<td style="white-space: nowrap"><label for="select_{{ invoice.id }}">{{ invoice.invoice_number }}</label></td>
-							{% if "created_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.created_date|date:"SHORT_DATETIME_FORMAT" }}</td>{% endif %}
-							{% if "month" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.start|date:"F Y" }}</td>{% endif %}
-							<td {{ td_attribute|safe }}>{{ invoice.project_details.project.name }}</td>
-							<td {{ td_attribute|safe }}>{{ invoice.project_details.project.account.name }}</td>
-							{% if "sent_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.last_sent_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
-							{% if "due_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.due_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
-							{% if "review_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.reviewed_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
-							<td {{ td_attribute|safe }} class="text-right">{{ invoice.total_amount_display }}</td>
-							{% for core_facility in core_facilities %}
-								<td {{ td_attribute|safe }} class="text-right">
-								{% with facility_subtotal=invoice.facility_subtotals|to_dict:"core_facility"|get_item:core_facility.name %}
-									{{ facility_subtotal.amount|default:0|display_amount:invoice.configuration }}
-								{% endwith %}
-								</td>
-							{% endfor %}
-							{% if display_general_facility %}
-								<td {{ td_attribute|safe }} class="text-right">
-									{% with general_subtotal=invoice.facility_subtotals|to_dict:"core_facility"|get_item:None %}
-										{{ general_subtotal.amount|default:0|display_amount:invoice.configuration }}
-									{% endwith %}
-								</td>
-							{% endif %}
-							{% if "tax" not in hide_columns %}<td {{ td_attribute|safe }} class="text-right">{{ invoice.total_tax|display_amount:invoice.configuration }}</td>{% endif %}
-							{% if "outstanding" not in hide_columns %}<td {{ td_attribute|safe }} class="text-right">{{ invoice.outstanding|display_amount:invoice.configuration }}</td>{% endif %}
-							{% if "actions" not in hide_columns %}
-								<td>
-									{% button size="xsmall" type="view" value="View" title="View invoice" url=view_invoice_url %}
-								</td>
-							{% endif %}
-						</tr>
-					{% endwith %}
-				{% endfor %}
-			</tbody>
-		</table>
-	</form>
+    <form id="selected-invoices" action="{% url 'zip_invoices' %}" method="post">
+        {% csrf_token %}
+        <table class="table table-bordered table-condensed table-striped table-hover thead-light">
+            <thead>
+                <tr>
+                    <th class="button-column-minimum">
+                        <input type="checkbox"
+                               onchange="$('#selected-invoices :checkbox').prop('checked', $(this).prop('checked'));update_download_button_state();">
+                    </th>
+                    <th class="button-column-minimum">
+                        {% include 'pagination/pagination_column.html' with order_by='invoice_number' name='#' %}
+                    </th>
+                    {% if "created_date" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='created_date' name='Created' %}</th>
+                    {% endif %}
+                    {% if "month" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='start' name='Month' %}</th>
+                    {% endif %}
+                    <th>
+                        {% include 'pagination/pagination_column.html' with order_by='project_details__project__name' name='Project' %}
+                    </th>
+                    <th>
+                        {% include 'pagination/pagination_column.html' with order_by='project_details__project__account__name' name='Account' %}
+                    </th>
+                    {% if "sent_date" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='last_sent_date' name='Sent' %}</th>
+                    {% endif %}
+                    {% if "due_date" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='due_date' name='Due' %}</th>
+                    {% endif %}
+                    {% if "review_date" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='reviewed_date' name='Reviewed' %}</th>
+                    {% endif %}
+                    <th>{% include 'pagination/pagination_column.html' with order_by='total_amount' name='Total' %}</th>
+                    {% for core_facility in core_facilities %}
+                        <th>
+                            {% include 'pagination/pagination_column.html' with order_by='facility_total_'|concat:core_facility.id name=core_facility.name %}
+                        </th>
+                    {% endfor %}
+                    {% if display_general_facility %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='facility_total_general' name="General" %}</th>
+                    {% endif %}
+                    {% if "tax" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='total_tax' name='Tax' %}</th>
+                    {% endif %}
+                    {% if "outstanding" not in hide_columns %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='outstanding' name='Outstanding' %}</th>
+                    {% endif %}
+                    {% if "actions" not in hide_columns %}<th class="button-column-minimum"></th>{% endif %}
+                </tr>
+            </thead>
+            <tbody>
+                {% for invoice in page %}
+                    {% url 'view_invoice' invoice.id as view_invoice_url %}
+                    {% with td_attribute="onclick=\"window.location.href = '"|concat:view_invoice_url|concat:"'\" style=\"cursor:pointer\"" %}
+                        <tr>
+                            <td class="text-center">
+                                <input type="checkbox"
+                                       id="select_{{ invoice.id }}"
+                                       name="selected_invoice_id[]"
+                                       aria-label="{{ invoice.invoice_number }}"
+                                       value="{{ invoice.id }}"
+                                       onchange="update_download_button_state();" />
+                            </td>
+                            <td style="white-space: nowrap">
+                                <label for="select_{{ invoice.id }}">{{ invoice.invoice_number }}</label>
+                            </td>
+                            {% if "created_date" not in hide_columns %}
+                                <td {{ td_attribute|safe }}>{{ invoice.created_date|date:"SHORT_DATETIME_FORMAT" }}
+                                </td>
+                            {% endif %}
+                            {% if "month" not in hide_columns %}
+                                <td {{ td_attribute|safe }}>{{ invoice.start|date:"F Y" }}
+                                </td>
+                            {% endif %}
+                            <td {{ td_attribute|safe }}>{{ invoice.project_details.project.name }}
+                            </td>
+                            <td {{ td_attribute|safe }}>{{ invoice.project_details.project.account.name }}
+                            </td>
+                            {% if "sent_date" not in hide_columns %}
+                                <td {{ td_attribute|safe }}>{{ invoice.last_sent_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}
+                                </td>
+                            {% endif %}
+                            {% if "due_date" not in hide_columns %}
+                                <td {{ td_attribute|safe }}>{{ invoice.due_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}
+                                </td>
+                            {% endif %}
+                            {% if "review_date" not in hide_columns %}
+                                <td {{ td_attribute|safe }}>{{ invoice.reviewed_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}
+                                </td>
+                            {% endif %}
+                            <td {{ td_attribute|safe }} class="text-right">{{ invoice.total_amount_display }}
+                            </td>
+                            {% for core_facility in core_facilities %}
+                                <td {{ td_attribute|safe }} class="text-right">
+                                    {% with facility_subtotal=invoice.facility_subtotals|to_dict:"core_facility"|get_item:core_facility.name %}
+                                        {{ facility_subtotal.amount|default:0|display_amount:invoice.configuration }}
+                                    {% endwith %}
+                                </td>
+                            {% endfor %}
+                            {% if display_general_facility %}
+                                <td {{ td_attribute|safe }} class="text-right">
+                                    {% with general_subtotal=invoice.facility_subtotals|to_dict:"core_facility"|get_item:None %}
+                                        {{ general_subtotal.amount|default:0|display_amount:invoice.configuration }}
+                                    {% endwith %}
+                                </td>
+                            {% endif %}
+                            {% if "tax" not in hide_columns %}
+                                <td {{ td_attribute|safe }} class="text-right">{{ invoice.total_tax|display_amount:invoice.configuration }}
+                                </td>
+                            {% endif %}
+                            {% if "outstanding" not in hide_columns %}
+                                <td {{ td_attribute|safe }} class="text-right">{{ invoice.outstanding|display_amount:invoice.configuration }}
+                                </td>
+                            {% endif %}
+                            {% if "actions" not in hide_columns %}
+                                <td>{% button size="xsmall" type="view" value="View" title="View invoice" url=view_invoice_url %}</td>
+                            {% endif %}
+                        </tr>
+                    {% endwith %}
+                {% endfor %}
+            </tbody>
+        </table>
+    </form>
 {% endblock %}
 {% block table_empty_content %}
-	<div style="margin-top: 35px">
-		<i>No invoices could be found.</i>
-	</div>
+    <div style="margin-top: 35px">
+        <i>No invoices could be found.</i>
+    </div>
 {% endblock %}
 {% block after_pagination %}
-	<script>
+    <script>
 		function update_download_button_state()
 		{
 			if ($("#selected-invoices input:checkbox:checked").length > 0)
 			{
 				$('#download_invoices').show();
 			}
 			else
@@ -202,9 +281,10 @@
 			window.location.href = "{% url 'view_invoice' 999 %}".replace('999', search_selection.id);
 		}
 		function on_load()
 		{
             $("#search").autocomplete('invoices', get_invoice, '{% url 'search_invoices' %}', true).focus();
 		}
 		window.addEventListener('load', on_load, true);
-	</script>
+	
+    </script>
 {% endblock %}
```

### html2text {}

```diff
@@ -12,15 +12,15 @@
 user.is_superuser %}
 {% csrf_token %}
 Month
 {% for month in month_list %}
 {{ month|date:"F, Y" }}
 {% endfor %}
 {% cap_discount_installed as cap_discount_installed %} {% if
-cap_discount_installed %}Account{% else %}Project{% endif %}
+cap_discount_installed %} Account {% else %} Project {% endif %}
 All
 {% regroup projects by account as projects_by_account %} {% for account in
 projects_by_account %}
 {{ account.grouper.name }}
 {% if not cap_discount_installed %} {# Don't allow single project invoice
 generation if we have account caps #} {% for project in account.list %}
 {{ project.name }}
@@ -54,16 +54,16 @@
 invoices').submit();$('#selected-invoices :checkbox').prop('checked',
 false);update_download_button_state();" %} Selected invoices:
 {% endif %} {% endblock %} {% block pagination_header %}
 {% regroup filter_month_list by year as filter_by_year %} {% if
 filter_month_list %}
 {% for year in filter_by_year %} {{ year.grouper }} {% endfor %} {% if
 filter_month %}
- _C_l_e_a_r
-{% endif %}
+_C_l_e_a_r
+ {% endif %}
 {% for year in filter_by_year %}
 {% for month in year.list %} _{_{_ _m_o_n_t_h_|_d_a_t_e_:_"_F_"_ _}_} {% endfor %}
 {% endfor %}
 {% endif %}
 {% include "pagination/pagination_selector.html" %}
 {% endblock %} {% block pagination_content %}
 {% csrf_token %}
```

## NEMO_billing/invoices/templates/invoices/usage.html

```diff
@@ -1,320 +1,409 @@
 {% extends 'usage/usage_base.html' %}
 {% load static %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 {% block extrahead %}
-	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
-	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
-	<link rel="stylesheet" type="text/css" href="{% static "invoices/invoices.css" %}"/>
-	<style>
+    <script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
+    <link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}" />
+    <link rel="stylesheet" type="text/css" href="{% static "invoices/invoices.css" %}" />
+    <style>
 	/* Change this so the button is placed correctly in our usage page */
 	.usage-charge-adjustment-button {
 		top: -7px !important;
 		right: -7px !important;
 	}
-	</style>
+	
+    </style>
 {% endblock %}
 {% block usage_content %}
-	<div style="margin-top:10px">
-		<ul class="nav nav-pills" id="tabs">
-			<li class="active"><a href="#usage" data-toggle="tab">Usage</a></li>
-			{% if billing_service %}<li><a href="{{ tab_url }}" data-toggle="tab">Billing Information</a></li>{% endif %}
-			{% if cap_discounts_url %}<li><a href="#cap_discount" onclick="$('#cap_discount').load('{{ cap_discounts_url }}')" data-toggle="tab">Cap information</a></li>{% endif %}
-			{% if project_prepayments_url %}<li><a href="#project_prepayments" onclick="$('#project_prepayments').load('{{ project_prepayments_url }}')" data-toggle="tab">Project funds</a></li>{% endif %}
-		</ul>
-	</div>
-
-	<div id="content" class="tab-content">
-		<div class="tab-pane active" id="usage">
-			<br/>
-			<div class="pull-left">
-				This data is provided for informational purposes and uses the <b>latest rates</b>.<br/>
-				Other adjustments/discounts <b>might not be included</b> in this information.
-				{% if "requests"|customization:"adjustment_requests_enabled" and adjustment_time_limit %}
-                    <br><br>Adjustment requests can be made for charges ending after {{ adjustment_time_limit.date }}.
+    <div style="margin-top:10px">
+        <ul class="nav nav-pills" id="tabs">
+            <li class="active">
+                <a href="#usage" data-toggle="tab">Usage</a>
+            </li>
+            {% if billing_service %}
+                <li>
+                    <a href="{{ tab_url }}" data-toggle="tab">Billing Information</a>
+                </li>
+            {% endif %}
+            {% if cap_discounts_url %}
+                <li>
+                    <a href="#cap_discount" onclick="$('#cap_discount').load('{{ cap_discounts_url }}')" data-toggle="tab">Cap information</a>
+                </li>
+            {% endif %}
+            {% if project_prepayments_url %}
+                <li>
+                    <a href="#project_prepayments"
+                       onclick="$('#project_prepayments').load('{{ project_prepayments_url }}')"
+                       data-toggle="tab">Project funds</a>
+                </li>
+            {% endif %}
+        </ul>
+    </div>
+    <div id="content" class="tab-content">
+        <div class="tab-pane active" id="usage">
+            <br />
+            <div class="pull-left">
+                This data is provided for informational purposes and uses the <b>latest rates</b>.
+                <br />
+                Other adjustments/discounts <b>might not be included</b> in this information.
+                {% if "requests"|customization:"adjustment_requests_enabled" and adjustment_time_limit %}
+                    <br>
+                    <br>
+                    Adjustment requests can be made for charges ending after {{ adjustment_time_limit.date }}.
                 {% endif %}
-			</div>
-			{% if no_charges %}
-				<div style="height: 15px;clear: both;"></div>
-				<h3>There was no usage between {{ start_date|date }} and {{ end_date|date }}.</h3>
-			{% else %}
-				{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-					<div class="pull-right">Total charges: <b>{{ total_charges }}</b>{% if pending_charges %} (includes {{ pending_charges }} pending){% endif %}</div>
-				{% endif %}
-			{% endif %}
-			{% with adj_reservation="requests"|customization:"adjustment_requests_missed_reservation_enabled" adj_tool_usage="requests"|customization:"adjustment_requests_tool_usage_enabled" adj_area_access="requests"|customization:"adjustment_requests_area_access_enabled" adj_staff_charge="requests"|customization:"adjustment_requests_staff_staff_charges_enabled" %}
-				<div style="height: 15px;clear: both;"></div>
-				{% regroup detailed_items by item_type as detailed_items_by_type %}
-				{% for detailed_item in detailed_items_by_type %}
-					{% if detailed_item.grouper.name == "MISSED_RESERVATION" %}
-						<h3>Missed reservations</h3>
-						{% for m in detailed_item.list %}
-							<div class="alert alert-danger table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ m.item.reservation_item }}{{ m.rate_time_name_add }}</span><br>
-									{% if project_autocomplete or selected_project %}Missed by {{ m.user }}<br>{% endif %}
-									{{ m.start }}<br>
-									Charged to project {{ m.project }}
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ m.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if adj_reservation == "enabled" %}
-										{% if not adjustment_time_limit or adjustment_time_limit <= m.end %}
-											{% if m.user == user or m.project in pi_projects %}
-												{% include "usage/adjustment_request_button.html" with charge=m.item %}
-											{% endif %}
-										{% endif %}
-									{% endif %}
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ m.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "CONSUMABLE" %}
-						<h3>Supplies and consumables</h3>
-						{% for c in detailed_item.list %}
-							<div class="alert alert-info table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ c.consumable }}{{ c.rate_time_name_add }}</span><br>
-									{% if project_autocomplete or selected_project %}<span style="font-weight:bold">For {{ c.item.customer }}</span><br>{% endif %}
-									Quantity {{ c.quantity }}<br>
-									Purchased from {{ c.item.merchant }}<br>
-									{{ c.start }}<br>
-									Charged to project {{ c.project }}
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ c.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ c.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "STAFF_CHARGE" %}
-						<h3>Staff charges</h3>
-						{% for s in detailed_item.list %}
-							{% if s.area %}
-								<div class="alert alert-warning table-display">
-									<div class="table-cell-display col-sm-7">
-										<span style="font-weight:bold">{{ s.area }}{{ s.rate_time_name_add }}</span><br>
-										<span style="font-weight:bold">Area accessed by {{ s.proxy_user }} {% if project_autocomplete or selected_project %}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}</span><br>
-										{{ s.start }}<br>
-										{{ s.end|default_if_none:"In progress" }}<br>
-										Charged to project {{ s.project }}
-									</div>
-									<div class="table-cell-display text-center col-sm-3">
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_rate|default_if_none:"" }}
-										{% endif %}
-									</div>
-									<div class="table-cell-display text-right col-sm-2">
-										{% if s.item.staff_charge and adj_staff_charge == "enabled" %}
-											{% if not adjustment_time_limit or adjustment_time_limit <= s.end %}
-												{% if s.item.staff_charge.staff_member == user and user.is_staff %}
-													{% include "usage/adjustment_request_button.html" with charge=s.item %}
-												{% endif %}
-											{% endif %}
-										{% endif %}
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_display_amount }}
-										{% endif %}
-									</div>
-								</div>
-							{% elif s.tool %}
-								<div class="alert alert-warning table-display">
-									<div class="table-cell-display col-sm-7">
-										<span style="font-weight:bold">{{ s.tool }}{{ s.rate_time_name_add }}</span><br>
-										<span style="font-weight:bold">Operated by {{ s.proxy_user }} {% if project_autocomplete or selected_project %}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}</span><br>
-										{{ s.start }}<br>
-										{{ s.end }}<br>
-										Charged to project {{ s.project }}
-									</div>
-									<div class="table-cell-display text-center col-sm-3">
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_rate|default_if_none:"" }}
-										{% endif %}
-									</div>
-									<div class="table-cell-display text-right col-sm-2">
-										{% if adj_staff_charge == "enabled" %}
-											{% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
-												{% if s.item.operator == user and user.is_staff and s.item.remote_work %}
-													{% include "usage/adjustment_request_button.html" with charge=s.item %}
-												{% endif %}
-											{% endif %}
-										{% endif %}
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_display_amount }}
-										{% endif %}
-									</div>
-								</div>
-							{% else %}
-								<div class="alert alert-info table-display">
-									<div class="table-cell-display col-sm-7">
-										<span style="font-weight:bold">Work performed by {{ s.proxy_user }} {% if project_autocomplete or selected_project %}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}{{ s.rate_time_name_add }}</span><br>
-										{% if s.item.note %}Charge note: {{ s.item.note|linebreaksbr }}<br>{% endif %}
-										{{ s.start }}<br>
-										{{ s.end }}<br>
-										Charged to project {{ s.project }}
-									</div>
-									<div class="table-cell-display text-center col-sm-3">
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_rate|default_if_none:"" }}
-										{% endif %}	
-									</div>
-									<div class="table-cell-display text-right col-sm-2">
-										{% if adj_staff_charge == "enabled" and s.item.staff_member == user and user.is_staff %}
-											{% if not adjustment_time_limit or adjustment_time_limit <= s.end %}
-												{% include "usage/adjustment_request_button.html" with charge=s.item %}
-											{% endif %}
-										{% endif %}
-										{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-											{{ s.billable_display_amount }}
-										{% endif %}
-									</div>
-								</div>
-							{% endif %}
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "TRAINING" %}
-						<h3>Training sessions</h3>
-						{% for t in detailed_item.list %}
-							<div class="alert alert-info table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ t.tool }}{{ t.rate_time_name_add }}</span><br>
-									{{ t.item.get_type_display }} training {% if project_autocomplete or selected_project %}for {{ t.user }} {% endif %}for {{ t.quantity }} minutes taught by <span style="font-weight:bold">{{ t.proxy_user }}</span>
-									{{ t.start }}<br>
-									Charged to project {{ t.project }}
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ t.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ t.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "AREA_ACCESS" %}
-						<h3>Area access</h3>
-						{% for a in detailed_item.list %}
-							<div class="alert {% if not a.item.staff_charge %}alert-info{% else %}alert-warning{% endif %} table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ a.area }}{{ a.rate_time_name_add }}</span><br>
-									{% if a.item.staff_charge %}<span style="font-weight:bold">Area accessed by {{ a.proxy_user }} {% if project_autocomplete or selected_project %}on behalf of {{ a.user }}{% else %}on your behalf{% endif %}</span><br>
-									{% else %}{% if project_autocomplete or selected_project %}<span style="font-weight:bold">Area accessed by {{ a.user }}</span><br>{% endif %}
-									{% endif %}
-									{{ a.start }}<br>
-									{{ a.end|default_if_none:"In progress" }}<br>
-									Charged to project {{ a.project }}
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ a.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if not a.staff_charge and adj_area_access == "enabled" %}
-										{% if not adjustment_time_limit or adjustment_time_limit <= a.end %}
-											{% if a.item.customer == user or a.project in pi_projects %}
-												{% include "usage/adjustment_request_button.html" with charge=a.item %}
-											{% endif %}
-										{% endif %}
-									{% elif a.item.staff_charge and adj_staff_charge == "enabled" %}
-										{% if not adjustment_time_limit or adjustment_time_limit <= a.end %}
-											{% if a.item.staff_charge.staff_member == user and user.is_staff %}
-												{% include "usage/adjustment_request_button.html" with charge=a.item %}
-											{% endif %}
-										{% endif %}
-									{% endif %}
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ a.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "TOOL_USAGE" %}
-						<h3>Tool usage</h3>
-						{% for u in detailed_item.list %}
-							<div class="alert {% if u.user == u.proxy_user %}alert-info{% else %}alert-warning{% endif %} table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ u.tool }}{{ u.rate_time_name_add }}</span><br>
-									{% if u.user != u.proxy_user %}<span style="font-weight:bold">Operated by {{ u.proxy_user }} {% if project_autocomplete or selected_project %}on behalf of {{ u.user }}{% else %}on your behalf{% endif %}</span><br>
-									{% else %}{% if project_autocomplete or selected_project %}<span style="font-weight:bold">Operated by {{ u.user }}</span><br>{% endif %}
-									{% endif %}
-									{{ u.start }}<br>
-									{{ u.end }}<br>
-									Charged to project {{ u.project }}
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ u.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if adj_tool_usage == "enabled" %}
-										{% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
-											{% if u.item.user == u.item.operator and u.item.user == user or u.project in pi_projects %}
-												{% include "usage/adjustment_request_button.html" with charge=u.item %}
-											{% endif %}
-										{% endif %}
-									{% endif %}
-									{% if adj_staff_charge == "enabled" %}
-										{% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
-											{% if u.item.operator == user and user.is_staff and u.item.remote_work %}
-												{% include "usage/adjustment_request_button.html" with charge=u.item %}
-											{% endif %}
-										{% endif %}
-									{% endif %}
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ u.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-					{% if detailed_item.grouper.name == "CUSTOM_CHARGE" %}
-						<h3>Custom charges</h3>
-						{% for c in detailed_item.list %}
-							<div class="alert alert-info alert-table table-display">
-								<div class="table-cell-display col-sm-7">
-									<span style="font-weight:bold">{{ c.item.name }}<br>
-									{% if project_autocomplete or selected_project %}For {{ c.user }}<br>{% endif %}</span>
-									{{ c.start }}<br>
-									Charged to project {{ c.project }}<br>
-								</div>
-								<div class="table-cell-display text-center col-sm-3">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ c.billable_rate|default_if_none:"" }}
-									{% endif %}
-								</div>
-								<div class="table-cell-display text-right col-sm-2">
-									{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
-										{{ c.billable_display_amount }}
-									{% endif %}
-								</div>
-							</div>
-						{% endfor %}
-					{% endif %}
-				{% endfor %}
-			</div>
-		{% endwith %}
-		<div class="tab-pane" id="cap_discount"></div>
-		<div class="tab-pane" id="project_prepayments" style="padding-top:20px"></div>
-	</div>
-{% endblock %}
+            </div>
+            {% if no_charges %}
+                <div style="height: 15px;clear: both;"></div>
+                <h3>There was no usage between {{ start_date|date }} and {{ end_date|date }}.</h3>
+            {% else %}
+                {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                    <div class="pull-right">
+                        Total charges: <b>{{ total_charges }}</b>
+                        {% if pending_charges %}(includes {{ pending_charges }} pending){% endif %}
+                    </div>
+                {% endif %}
+            {% endif %}
+            {% with adj_reservation="requests"|customization:"adjustment_requests_missed_reservation_enabled" adj_tool_usage="requests"|customization:"adjustment_requests_tool_usage_enabled" adj_area_access="requests"|customization:"adjustment_requests_area_access_enabled" adj_staff_charge="requests"|customization:"adjustment_requests_staff_staff_charges_enabled" %}
+                <div style="height: 15px;clear: both;"></div>
+                {% regroup detailed_items by item_type as detailed_items_by_type %}
+                {% for detailed_item in detailed_items_by_type %}
+                    {% if detailed_item.grouper.name == "MISSED_RESERVATION" %}
+                        <h3>Missed reservations</h3>
+                        {% for m in detailed_item.list %}
+                            <div class="alert alert-danger table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ m.item.reservation_item }}{{ m.rate_time_name_add }}</span>
+                                    <br>
+                                    {% if project_autocomplete or selected_project %}
+                                        Missed by {{ m.user }}
+                                        <br>
+                                    {% endif %}
+                                    {{ m.start }}
+                                    <br>
+                                    Charged to project {{ m.project }}
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ m.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if adj_reservation == "enabled" %}
+                                        {% if not adjustment_time_limit or adjustment_time_limit <= m.end %}
+                                            {% if m.user == user or m.project in pi_projects %}
+                                                {% include "usage/adjustment_request_button.html" with charge=m.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                    {% endif %}
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ m.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "CONSUMABLE" %}
+                        <h3>Supplies and consumables</h3>
+                        {% for c in detailed_item.list %}
+                            <div class="alert alert-info table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ c.consumable }}{{ c.rate_time_name_add }}</span>
+                                    <br>
+                                    {% if project_autocomplete or selected_project %}
+                                        <span style="font-weight:bold">For {{ c.item.customer }}</span>
+                                        <br>
+                                    {% endif %}
+                                    Quantity {{ c.quantity }}
+                                    <br>
+                                    Purchased from {{ c.item.merchant }}
+                                    <br>
+                                    {{ c.start }}
+                                    <br>
+                                    Charged to project {{ c.project }}
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ c.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ c.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "STAFF_CHARGE" %}
+                        <h3>Staff charges</h3>
+                        {% for s in detailed_item.list %}
+                            {% if s.area %}
+                                <div class="alert alert-warning table-display">
+                                    <div class="table-cell-display col-sm-7">
+                                        <span style="font-weight:bold">{{ s.area }}{{ s.rate_time_name_add }}</span>
+                                        <br>
+                                        <span style="font-weight:bold">Area accessed by {{ s.proxy_user }}
+                                            {% if project_autocomplete or selected_project %}
+                                                on behalf of {{ s.user }}
+                                            {% else %}
+                                                on your behalf
+                                            {% endif %}
+                                        </span>
+                                        <br>
+                                        {{ s.start }}
+                                        <br>
+                                        {{ s.end|default_if_none:"In progress" }}
+                                        <br>
+                                        Charged to project {{ s.project }}
+                                    </div>
+                                    <div class="table-cell-display text-center col-sm-3">
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                            {{ s.billable_rate|default_if_none:"" }}
+                                        {% endif %}
+                                    </div>
+                                    <div class="table-cell-display text-right col-sm-2">
+                                        {% if s.item.staff_charge and adj_staff_charge == "enabled" %}
+                                            {% if not adjustment_time_limit or adjustment_time_limit <= s.end %}
+                                                {% if s.item.staff_charge.staff_member == user and user.is_staff %}
+                                                    {% include "usage/adjustment_request_button.html" with charge=s.item %}
+                                                {% endif %}
+                                            {% endif %}
+                                        {% endif %}
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ s.billable_display_amount }}{% endif %}
+                                    </div>
+                                </div>
+                            {% elif s.tool %}
+                                <div class="alert alert-warning table-display">
+                                    <div class="table-cell-display col-sm-7">
+                                        <span style="font-weight:bold">{{ s.tool }}{{ s.rate_time_name_add }}</span>
+                                        <br>
+                                        <span style="font-weight:bold">Operated by {{ s.proxy_user }}
+                                            {% if project_autocomplete or selected_project %}
+                                                on behalf of {{ s.user }}
+                                            {% else %}
+                                                on your behalf
+                                            {% endif %}
+                                        </span>
+                                        <br>
+                                        {{ s.start }}
+                                        <br>
+                                        {{ s.end }}
+                                        <br>
+                                        Charged to project {{ s.project }}
+                                    </div>
+                                    <div class="table-cell-display text-center col-sm-3">
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                            {{ s.billable_rate|default_if_none:"" }}
+                                        {% endif %}
+                                    </div>
+                                    <div class="table-cell-display text-right col-sm-2">
+                                        {% if adj_staff_charge == "enabled" %}
+                                            {% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
+                                                {% if s.item.operator == user and user.is_staff and s.item.remote_work %}
+                                                    {% include "usage/adjustment_request_button.html" with charge=s.item %}
+                                                {% endif %}
+                                            {% endif %}
+                                        {% endif %}
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ s.billable_display_amount }}{% endif %}
+                                    </div>
+                                </div>
+                            {% else %}
+                                <div class="alert alert-info table-display">
+                                    <div class="table-cell-display col-sm-7">
+                                        <span style="font-weight:bold">Work performed by {{ s.proxy_user }}
+                                            {% if project_autocomplete or selected_project %}
+                                                on behalf of {{ s.user }}
+                                            {% else %}
+                                                on your behalf
+                                            {% endif %}
+                                        {{ s.rate_time_name_add }}</span>
+                                        <br>
+                                        {% if s.item.note %}
+                                            Charge note: {{ s.item.note|linebreaksbr }}
+                                            <br>
+                                        {% endif %}
+                                        {{ s.start }}
+                                        <br>
+                                        {{ s.end }}
+                                        <br>
+                                        Charged to project {{ s.project }}
+                                    </div>
+                                    <div class="table-cell-display text-center col-sm-3">
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                            {{ s.billable_rate|default_if_none:"" }}
+                                        {% endif %}
+                                    </div>
+                                    <div class="table-cell-display text-right col-sm-2">
+                                        {% if adj_staff_charge == "enabled" and s.item.staff_member == user and user.is_staff %}
+                                            {% if not adjustment_time_limit or adjustment_time_limit <= s.end %}
+                                                {% include "usage/adjustment_request_button.html" with charge=s.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                        {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ s.billable_display_amount }}{% endif %}
+                                    </div>
+                                </div>
+                            {% endif %}
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "TRAINING" %}
+                        <h3>Training sessions</h3>
+                        {% for t in detailed_item.list %}
+                            <div class="alert alert-info table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ t.tool }}{{ t.rate_time_name_add }}</span>
+                                    <br>
+                                    {{ t.item.get_type_display }} training
+                                    {% if project_autocomplete or selected_project %}for {{ t.user }}{% endif %}
+                                    for {{ t.quantity }} minutes taught by <span style="font-weight:bold">{{ t.proxy_user }}</span>
+                                    {{ t.start }}
+                                    <br>
+                                    Charged to project {{ t.project }}
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ t.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ t.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "AREA_ACCESS" %}
+                        <h3>Area access</h3>
+                        {% for a in detailed_item.list %}
+                            <div class="alert {% if not a.item.staff_charge %}alert-info{% else %}alert-warning{% endif %} table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ a.area }}{{ a.rate_time_name_add }}</span>
+                                    <br>
+                                    {% if a.item.staff_charge %}
+                                        <span style="font-weight:bold">Area accessed by {{ a.proxy_user }}
+                                            {% if project_autocomplete or selected_project %}
+                                                on behalf of {{ a.user }}
+                                            {% else %}
+                                                on your behalf
+                                            {% endif %}
+                                        </span>
+                                        <br>
+                                    {% else %}
+                                        {% if project_autocomplete or selected_project %}
+                                            <span style="font-weight:bold">Area accessed by {{ a.user }}</span>
+                                            <br>
+                                        {% endif %}
+                                    {% endif %}
+                                    {{ a.start }}
+                                    <br>
+                                    {{ a.end|default_if_none:"In progress" }}
+                                    <br>
+                                    Charged to project {{ a.project }}
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ a.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if not a.staff_charge and adj_area_access == "enabled" %}
+                                        {% if not adjustment_time_limit or adjustment_time_limit <= a.end %}
+                                            {% if a.item.customer == user or a.project in pi_projects %}
+                                                {% include "usage/adjustment_request_button.html" with charge=a.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                    {% elif a.item.staff_charge and adj_staff_charge == "enabled" %}
+                                        {% if not adjustment_time_limit or adjustment_time_limit <= a.end %}
+                                            {% if a.item.staff_charge.staff_member == user and user.is_staff %}
+                                                {% include "usage/adjustment_request_button.html" with charge=a.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                    {% endif %}
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ a.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "TOOL_USAGE" %}
+                        <h3>Tool usage</h3>
+                        {% for u in detailed_item.list %}
+                            <div class="alert {% if u.user == u.proxy_user %}alert-info{% else %}alert-warning{% endif %} table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ u.tool }}{{ u.rate_time_name_add }}</span>
+                                    <br>
+                                    {% if u.user != u.proxy_user %}
+                                        <span style="font-weight:bold">Operated by {{ u.proxy_user }}
+                                            {% if project_autocomplete or selected_project %}
+                                                on behalf of {{ u.user }}
+                                            {% else %}
+                                                on your behalf
+                                            {% endif %}
+                                        </span>
+                                        <br>
+                                    {% else %}
+                                        {% if project_autocomplete or selected_project %}
+                                            <span style="font-weight:bold">Operated by {{ u.user }}</span>
+                                            <br>
+                                        {% endif %}
+                                    {% endif %}
+                                    {{ u.start }}
+                                    <br>
+                                    {{ u.end }}
+                                    <br>
+                                    Charged to project {{ u.project }}
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ u.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if adj_tool_usage == "enabled" %}
+                                        {% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
+                                            {% if u.item.user == u.item.operator and u.item.user == user or u.project in pi_projects %}
+                                                {% include "usage/adjustment_request_button.html" with charge=u.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                    {% endif %}
+                                    {% if adj_staff_charge == "enabled" %}
+                                        {% if not adjustment_time_limit or adjustment_time_limit <= u.end %}
+                                            {% if u.item.operator == user and user.is_staff and u.item.remote_work %}
+                                                {% include "usage/adjustment_request_button.html" with charge=u.item %}
+                                            {% endif %}
+                                        {% endif %}
+                                    {% endif %}
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ u.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                    {% if detailed_item.grouper.name == "CUSTOM_CHARGE" %}
+                        <h3>Custom charges</h3>
+                        {% for c in detailed_item.list %}
+                            <div class="alert alert-info alert-table table-display">
+                                <div class="table-cell-display col-sm-7">
+                                    <span style="font-weight:bold">{{ c.item.name }}
+                                        <br>
+                                        {% if project_autocomplete or selected_project %}
+                                            For {{ c.user }}
+                                            <br>
+                                        {% endif %}
+                                    </span>
+                                    {{ c.start }}
+                                    <br>
+                                    Charged to project {{ c.project }}
+                                    <br>
+                                </div>
+                                <div class="table-cell-display text-center col-sm-3">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}
+                                        {{ c.billable_rate|default_if_none:"" }}
+                                    {% endif %}
+                                </div>
+                                <div class="table-cell-display text-right col-sm-2">
+                                    {% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{{ c.billable_display_amount }}{% endif %}
+                                </div>
+                            </div>
+                        {% endfor %}
+                    {% endif %}
+                {% endfor %}
+            </div>
+        {% endwith %}
+        <div class="tab-pane" id="cap_discount"></div>
+        <div class="tab-pane" id="project_prepayments" style="padding-top:20px"></div>
+    </div>
+{% endblock %}
```

### html2text {}

```diff
@@ -1,12 +1,12 @@
 {% extends 'usage/usage_base.html' %} {% load static %} {% load
 custom_tags_and_filters %} {% load billing_tags %} {% block extrahead %}
 }">
-}"/>
-}"/>
+}" />
+}" />
 {% endblock %} {% block usage_content %}
     * _U_s_a_g_e
     * {% if billing_service %}
     * _B_i_l_l_i_n_g_ _I_n_f_o_r_m_a_t_i_o_n
     * {% endif %} {% if cap_discounts_url %}
     * _C_a_p_ _i_n_f_o_r_m_a_t_i_o_n
     * {% endif %} {% if project_prepayments_url %}
@@ -21,15 +21,15 @@
 Adjustment requests can be made for charges ending after {
 { adjustment_time_limit.date }}. {% endif %}
 {% if no_charges %}
 ******** TThheerree wwaass nnoo uussaaggee bbeettwweeeenn {{{{ ssttaarrtt__ddaattee||ddaattee }}}} aanndd {{{{ eenndd__ddaattee||ddaattee }}}}..
 ********
 {% else %} {% if not "billing_rates"|customization:"rates_usage_hide_charges"
 %}
-Total charges: {{{{ ttoottaall__cchhaarrggeess }}}}{% if pending_charges %} (includes {
+Total charges: {{{{ ttoottaall__cchhaarrggeess }}}} {% if pending_charges %}(includes {
 { pending_charges }} pending){% endif %}
 {% endif %} {% endif %} {% with adj_reservation="requests"|customization:
 "adjustment_requests_missed_reservation_enabled"
 adj_tool_usage="requests"|customization:
 "adjustment_requests_tool_usage_enabled"
 adj_area_access="requests"|customization:
 "adjustment_requests_area_access_enabled"
@@ -37,106 +37,107 @@
 "adjustment_requests_staff_staff_charges_enabled" %}
 {% regroup detailed_items by item_type as detailed_items_by_type %} {% for
 detailed_item in detailed_items_by_type %} {% if detailed_item.grouper.name ==
 "MISSED_RESERVATION" %}
 ******** MMiisssseedd rreesseerrvvaattiioonnss ********
 {% for m in detailed_item.list %}
 {{ m.item.reservation_item }}{{ m.rate_time_name_add }}
-{% if project_autocomplete or selected_project %}Missed by {{ m.user }}
+{% if project_autocomplete or selected_project %} Missed by {{ m.user }}
 {% endif %} {{ m.start }}
 Charged to project {{ m.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { m.billable_rate|default_if_none:"" }} {% endif %}
 {% if adj_reservation == "enabled" %} {% if not adjustment_time_limit or
 adjustment_time_limit <= m.end %} {% if m.user == user or m.project in
 pi_projects %} {% include "usage/adjustment_request_button.html" with
 charge=m.item %} {% endif %} {% endif %} {% endif %} {% if not
-"billing_rates"|customization:"rates_usage_hide_charges" %} {
-{ m.billable_display_amount }} {% endif %}
+"billing_rates"|customization:"rates_usage_hide_charges" %}{
+{ m.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% if detailed_item.grouper.name == "CONSUMABLE" %}
 ******** SSuupppplliieess aanndd ccoonnssuummaabblleess ********
 {% for c in detailed_item.list %}
 {{ c.consumable }}{{ c.rate_time_name_add }}
-{% if project_autocomplete or selected_project %}For {{ c.item.customer }}
+{% if project_autocomplete or selected_project %} For {{ c.item.customer }}
 {% endif %} Quantity {{ c.quantity }}
 Purchased from {{ c.item.merchant }}
 {{ c.start }}
 Charged to project {{ c.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { c.billable_rate|default_if_none:"" }} {% endif %}
-{% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
-{ c.billable_display_amount }} {% endif %}
+{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{
+{ c.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% if detailed_item.grouper.name == "STAFF_CHARGE" %}
 ******** SSttaaffff cchhaarrggeess ********
 {% for s in detailed_item.list %} {% if s.area %}
 {{ s.area }}{{ s.rate_time_name_add }}
 Area accessed by {{ s.proxy_user }} {% if project_autocomplete or
-selected_project %}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}
+selected_project %} on behalf of {{ s.user }} {% else %} on your behalf {%
+endif %}
 {{ s.start }}
 {{ s.end|default_if_none:"In progress" }}
 Charged to project {{ s.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { s.billable_rate|default_if_none:"" }} {% endif %}
 {% if s.item.staff_charge and adj_staff_charge == "enabled" %} {% if not
 adjustment_time_limit or adjustment_time_limit <= s.end %} {% if
 s.item.staff_charge.staff_member == user and user.is_staff %} {% include
 "usage/adjustment_request_button.html" with charge=s.item %} {% endif %} {%
 endif %} {% endif %} {% if not "billing_rates"|customization:
-"rates_usage_hide_charges" %} {{ s.billable_display_amount }} {% endif %}
+"rates_usage_hide_charges" %}{{ s.billable_display_amount }}{% endif %}
 {% elif s.tool %}
 {{ s.tool }}{{ s.rate_time_name_add }}
 Operated by {{ s.proxy_user }} {% if project_autocomplete or selected_project
-%}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}
+%} on behalf of {{ s.user }} {% else %} on your behalf {% endif %}
 {{ s.start }}
 {{ s.end }}
 Charged to project {{ s.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { s.billable_rate|default_if_none:"" }} {% endif %}
 {% if adj_staff_charge == "enabled" %} {% if not adjustment_time_limit or
 adjustment_time_limit <= u.end %} {% if s.item.operator == user and
 user.is_staff and s.item.remote_work %} {% include "usage/
 adjustment_request_button.html" with charge=s.item %} {% endif %} {% endif %}
 {% endif %} {% if not "billing_rates"|customization:"rates_usage_hide_charges"
-%} {{ s.billable_display_amount }} {% endif %}
+%}{{ s.billable_display_amount }}{% endif %}
 {% else %}
 Work performed by {{ s.proxy_user }} {% if project_autocomplete or
-selected_project %}on behalf of {{ s.user }}{% else %}on your behalf{% endif %}
-{{ s.rate_time_name_add }}
-{% if s.item.note %}Charge note: {{ s.item.note|linebreaksbr }}
+selected_project %} on behalf of {{ s.user }} {% else %} on your behalf {%
+endif %} {{ s.rate_time_name_add }}
+{% if s.item.note %} Charge note: {{ s.item.note|linebreaksbr }}
 {% endif %} {{ s.start }}
 {{ s.end }}
 Charged to project {{ s.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { s.billable_rate|default_if_none:"" }} {% endif %}
 {% if adj_staff_charge == "enabled" and s.item.staff_member == user and
 user.is_staff %} {% if not adjustment_time_limit or adjustment_time_limit <=
 s.end %} {% include "usage/adjustment_request_button.html" with charge=s.item
 %} {% endif %} {% endif %} {% if not "billing_rates"|customization:
-"rates_usage_hide_charges" %} {{ s.billable_display_amount }} {% endif %}
+"rates_usage_hide_charges" %}{{ s.billable_display_amount }}{% endif %}
 {% endif %} {% endfor %} {% endif %} {% if detailed_item.grouper.name ==
 "TRAINING" %}
 ******** TTrraaiinniinngg sseessssiioonnss ********
 {% for t in detailed_item.list %}
 {{ t.tool }}{{ t.rate_time_name_add }}
 {{ t.item.get_type_display }} training {% if project_autocomplete or
-selected_project %}for {{ t.user }} {% endif %}for {{ t.quantity }} minutes
+selected_project %}for {{ t.user }}{% endif %} for {{ t.quantity }} minutes
 taught by {{ t.proxy_user }} {{ t.start }}
 Charged to project {{ t.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { t.billable_rate|default_if_none:"" }} {% endif %}
-{% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
-{ t.billable_display_amount }} {% endif %}
+{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{
+{ t.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% if detailed_item.grouper.name == "AREA_ACCESS" %}
 ******** AArreeaa aacccceessss ********
 {% for a in detailed_item.list %}
 {{ a.area }}{{ a.rate_time_name_add }}
-{% if a.item.staff_charge %}Area accessed by {{ a.proxy_user }} {% if
-project_autocomplete or selected_project %}on behalf of {{ a.user }}{% else
-%}on your behalf{% endif %}
-{% else %}{% if project_autocomplete or selected_project %}Area accessed by {
+{% if a.item.staff_charge %} Area accessed by {{ a.proxy_user }} {% if
+project_autocomplete or selected_project %} on behalf of {{ a.user }} {% else
+%} on your behalf {% endif %}
+{% else %} {% if project_autocomplete or selected_project %} Area accessed by {
 { a.user }}
 {% endif %} {% endif %} {{ a.start }}
 {{ a.end|default_if_none:"In progress" }}
 Charged to project {{ a.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { a.billable_rate|default_if_none:"" }} {% endif %}
 {% if not a.staff_charge and adj_area_access == "enabled" %} {% if not
@@ -144,23 +145,23 @@
 a.item.customer == user or a.project in pi_projects %} {% include "usage/
 adjustment_request_button.html" with charge=a.item %} {% endif %} {% endif %}
 {% elif a.item.staff_charge and adj_staff_charge == "enabled" %} {% if not
 adjustment_time_limit or adjustment_time_limit <= a.end %} {% if
 a.item.staff_charge.staff_member == user and user.is_staff %} {% include
 "usage/adjustment_request_button.html" with charge=a.item %} {% endif %} {%
 endif %} {% endif %} {% if not "billing_rates"|customization:
-"rates_usage_hide_charges" %} {{ a.billable_display_amount }} {% endif %}
+"rates_usage_hide_charges" %}{{ a.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% if detailed_item.grouper.name == "TOOL_USAGE" %}
 ******** TTooooll uussaaggee ********
 {% for u in detailed_item.list %}
 {{ u.tool }}{{ u.rate_time_name_add }}
-{% if u.user != u.proxy_user %}Operated by {{ u.proxy_user }} {% if
-project_autocomplete or selected_project %}on behalf of {{ u.user }}{% else
-%}on your behalf{% endif %}
-{% else %}{% if project_autocomplete or selected_project %}Operated by {
+{% if u.user != u.proxy_user %} Operated by {{ u.proxy_user }} {% if
+project_autocomplete or selected_project %} on behalf of {{ u.user }} {% else
+%} on your behalf {% endif %}
+{% else %} {% if project_autocomplete or selected_project %} Operated by {
 { u.user }}
 {% endif %} {% endif %} {{ u.start }}
 {{ u.end }}
 Charged to project {{ u.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { u.billable_rate|default_if_none:"" }} {% endif %}
 {% if adj_tool_usage == "enabled" %} {% if not adjustment_time_limit or
@@ -168,22 +169,22 @@
 u.item.user == user or u.project in pi_projects %} {% include "usage/
 adjustment_request_button.html" with charge=u.item %} {% endif %} {% endif %}
 {% endif %} {% if adj_staff_charge == "enabled" %} {% if not
 adjustment_time_limit or adjustment_time_limit <= u.end %} {% if
 u.item.operator == user and user.is_staff and u.item.remote_work %} {% include
 "usage/adjustment_request_button.html" with charge=u.item %} {% endif %} {%
 endif %} {% endif %} {% if not "billing_rates"|customization:
-"rates_usage_hide_charges" %} {{ u.billable_display_amount }} {% endif %}
+"rates_usage_hide_charges" %}{{ u.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% if detailed_item.grouper.name == "CUSTOM_CHARGE" %}
 ******** CCuussttoomm cchhaarrggeess ********
 {% for c in detailed_item.list %}
 {{ c.item.name }}
-{% if project_autocomplete or selected_project %}For {{ c.user }}
+{% if project_autocomplete or selected_project %} For {{ c.user }}
 {% endif %} {{ c.start }}
 Charged to project {{ c.project }}
 {% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
 { c.billable_rate|default_if_none:"" }} {% endif %}
-{% if not "billing_rates"|customization:"rates_usage_hide_charges" %} {
-{ c.billable_display_amount }} {% endif %}
+{% if not "billing_rates"|customization:"rates_usage_hide_charges" %}{
+{ c.billable_display_amount }}{% endif %}
 {% endfor %} {% endif %} {% endfor %}
 {% endwith %}
 {% endblock %}
```

## NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html

```diff
@@ -1,49 +1,53 @@
 <html lang="en">
     <head>
         <meta charset="utf-8">
         <meta name="viewport" content="width=device-width, initial-scale=1">
     </head>
     <body>
         <!--[if mso]><table width="600" align="center"><tr><td><![endif]-->
-        <table align="center" style="width:100%; max-width:600px; font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
+        <table align="center"
+               style="width:100%;
+                      max-width:600px;
+                      font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
             <tr>
-                <td align="center" style="color: white; background: #5bc0de; margin: 0; padding: 50px 0;" bgcolor="#5bc0de">
-					<h1 style="max-width: 90%; margin: 0 auto; padding: 0;">
-					{% if not projects|length_is:1 %}
-						Projects expiring!
-					{% else %}
-						Project expiring in {{ projects.0.projectbillingdetails.expires_on|timeuntil:today }}!
-					{% endif %}
-					</h1>
-				</td>
+                <td align="center"
+                    style="color: white;
+                           background: #5bc0de;
+                           margin: 0;
+                           padding: 50px 0"
+                    bgcolor="#5bc0de">
+                    <h1 style="max-width: 90%; margin: 0 auto; padding: 0;">
+                        {% if not projects|length_is:1 %}
+                            Projects expiring!
+                        {% else %}
+                            Project expiring in {{ projects.0.projectbillingdetails.expires_on|timeuntil:today }}!
+                        {% endif %}
+                    </h1>
+                </td>
             </tr>
             <tr>
                 <td style="padding: 10px;">
                     <p>Dear PI,</p>
                     <p>
                         {% if not projects|length_is:1 %}
-							The following projects are set to expire soon:
-						{% else %}
-							Your project {{ projects.0.projectbillingdetails.name }} is set to expire on {{ projects.0.projectbillingdetails.expires_on }}.
-						{% endif %}
-                    </p>
-					{% if projects %}
-						{% regroup projects by projectbillingdetails.expires_on as projects_by_expiration %}
-						{% for project_by_expiration in projects_by_expiration %}
-							in {{ project_by_expiration.grouper|timeuntil:today }} ({{ project_by_expiration.grouper }}):
-							<ul>
-								{% for project in project_by_expiration.list %}
-									<li>{{ project.projectbillingdetails.name }}</li>
-								{% endfor %}
-							</ul>
-						{% endfor %}
-					{% endif %}
-                    <p>
-                        Please contact the facility accounting department to make sure you don't lose access to the facility.
+                            The following projects are set to expire soon:
+                        {% else %}
+                            Your project {{ projects.0.projectbillingdetails.name }} is set to expire on {{ projects.0.projectbillingdetails.expires_on }}.
+                        {% endif %}
                     </p>
+                    {% if projects %}
+                        {% regroup projects by projectbillingdetails.expires_on as projects_by_expiration %}
+                        {% for project_by_expiration in projects_by_expiration %}
+                            in {{ project_by_expiration.grouper|timeuntil:today }} ({{ project_by_expiration.grouper }}):
+                            <ul>
+                                {% for project in project_by_expiration.list %}<li>{{ project.projectbillingdetails.name }}</li>{% endfor %}
+                            </ul>
+                        {% endfor %}
+                    {% endif %}
+                    <p>Please contact the facility accounting department to make sure you don't lose access to the facility.</p>
                 </td>
             </tr>
         </table>
         <!--[if mso]></td></tr></table><![endif]-->
     </body>
-</html>
+</html>
```

## NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html

```diff
@@ -1,35 +1,36 @@
 <html lang="en">
-<head>
-	<meta charset="utf-8">
-	<meta name="viewport" content="width=device-width, initial-scale=1">
-</head>
-<body style="font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
-<!--[if mso]><table width="600" align="center"><tr><td><![endif]-->
-<table align="center" style="width:100%; max-width:600px">
-	<tr>
-		<td align="center" style="color: white; background: #5bc0de; margin: 0; padding: 50px 0;" bgcolor="#5bc0de">
-			<h1 style="max-width: 90%; margin: 0 auto; padding: 0;">
-				Invoice {{ invoice.invoice_number }}
-			</h1>
-		</td>
-	</tr>
-	<tr>
-		<td style="margin: 10px 10px 20px; padding: 10px;">
-			{% if invoice.project_details.contact_name %}
-			<h2>
-				Dear {{ invoice.project_details.contact_name }},
-			</h2>
-			{% endif %}
-			<p>
-				Your {{ invoice.configuration.merchant_name }} invoice for the period of <b>{{ invoice.start|date:'F jS, Y' }}</b> to <b>{{ invoice.end|date:'F jS, Y' }}</b> for your project {{ invoice.project_details.name }} is attached.<br>
-				<br>
-				The total amount of <b>{{ invoice.total_amount_display }}</b> is due on {{ invoice.due_date|date:'F jS, Y' }}.<br>
-				<br>
-				Please refer to the payment terms and conditions included in the invoice.
-			</p>
-		</td>
-	</tr>
-</table>
-<!--[if mso]></td></tr></table><![endif]-->
-</body>
+    <head>
+        <meta charset="utf-8">
+        <meta name="viewport" content="width=device-width, initial-scale=1">
+    </head>
+    <body style="font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
+        <!--[if mso]><table width="600" align="center"><tr><td><![endif]-->
+        <table align="center" style="width:100%; max-width:600px">
+            <tr>
+                <td align="center"
+                    style="color: white;
+                           background: #5bc0de;
+                           margin: 0;
+                           padding: 50px 0"
+                    bgcolor="#5bc0de">
+                    <h1 style="max-width: 90%; margin: 0 auto; padding: 0;">Invoice {{ invoice.invoice_number }}</h1>
+                </td>
+            </tr>
+            <tr>
+                <td style="margin: 10px 10px 20px; padding: 10px;">
+                    {% if invoice.project_details.contact_name %}<h2>Dear {{ invoice.project_details.contact_name }},</h2>{% endif %}
+                    <p>
+                        Your {{ invoice.configuration.merchant_name }} invoice for the period of <b>{{ invoice.start|date:'F jS, Y' }}</b> to <b>{{ invoice.end|date:'F jS, Y' }}</b> for your project {{ invoice.project_details.name }} is attached.
+                        <br>
+                        <br>
+                        The total amount of <b>{{ invoice.total_amount_display }}</b> is due on {{ invoice.due_date|date:'F jS, Y' }}.
+                        <br>
+                        <br>
+                        Please refer to the payment terms and conditions included in the invoice.
+                    </p>
+                </td>
+            </tr>
+        </table>
+        <!--[if mso]></td></tr></table><![endif]-->
+    </body>
 </html>
```

## NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html

```diff
@@ -1,35 +1,36 @@
 <html lang="en">
-<head>
-	<meta charset="utf-8">
-	<meta name="viewport" content="width=device-width, initial-scale=1">
-</head>
-<body style="font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
-<!--[if mso]><table width="600" align="center"><tr><td><![endif]-->
-<table align="center" style="width:100%; max-width:600px">
-	<tr>
-		<td align="center" style="color: white; background: #5bc0de; margin: 0; padding: 50px 0;" bgcolor="#5bc0de">
-			<h1 style="max-width: 90%; margin: 0 auto; padding: 0;">
-				Invoice {{ invoice.invoice_number }} past due!
-			</h1>
-		</td>
-	</tr>
-	<tr>
-		<td style="margin: 10px 10px 20px; padding: 10px;">
-			{% if invoice.project_details.contact_name %}
-			<h2>
-				Dear {{ invoice.project_details.contact_name }},
-			</h2>
-			{% endif %}
-			<p>
-				This is a reminder that your {{ invoice.configuration.merchant_name }} invoice for the period of <b>{{ invoice.start|date:'F jS, Y' }}</b> to <b>{{ invoice.end|date:'F jS, Y' }}</b> for your project {{ invoice.project_details.name }} is past due.<br>
-				<br>
-				The remaining amount of <b>{{ invoice.total_outstanding_display }}</b> is due immediately.<br>
-				<br>
-				Please refer to the payment terms and conditions included in the invoice.
-			</p>
-		</td>
-	</tr>
-</table>
-<!--[if mso]></td></tr></table><![endif]-->
-</body>
+    <head>
+        <meta charset="utf-8">
+        <meta name="viewport" content="width=device-width, initial-scale=1">
+    </head>
+    <body style="font-family: 'Avenir Next', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'">
+        <!--[if mso]><table width="600" align="center"><tr><td><![endif]-->
+        <table align="center" style="width:100%; max-width:600px">
+            <tr>
+                <td align="center"
+                    style="color: white;
+                           background: #5bc0de;
+                           margin: 0;
+                           padding: 50px 0"
+                    bgcolor="#5bc0de">
+                    <h1 style="max-width: 90%; margin: 0 auto; padding: 0;">Invoice {{ invoice.invoice_number }} past due!</h1>
+                </td>
+            </tr>
+            <tr>
+                <td style="margin: 10px 10px 20px; padding: 10px;">
+                    {% if invoice.project_details.contact_name %}<h2>Dear {{ invoice.project_details.contact_name }},</h2>{% endif %}
+                    <p>
+                        This is a reminder that your {{ invoice.configuration.merchant_name }} invoice for the period of <b>{{ invoice.start|date:'F jS, Y' }}</b> to <b>{{ invoice.end|date:'F jS, Y' }}</b> for your project {{ invoice.project_details.name }} is past due.
+                        <br>
+                        <br>
+                        The remaining amount of <b>{{ invoice.total_outstanding_display }}</b> is due immediately.
+                        <br>
+                        <br>
+                        Please refer to the payment terms and conditions included in the invoice.
+                    </p>
+                </td>
+            </tr>
+        </table>
+        <!--[if mso]></td></tr></table><![endif]-->
+    </body>
 </html>
```

## NEMO_billing/invoices/templates/invoices/project/edit_project.html

```diff
@@ -1,268 +1,357 @@
 {% extends 'base.html' %}
 {% load custom_tags_and_filters %}
-{% block title %}{% if form.instance.pk %}Edit{% else %}New{% endif %} project{% endblock %}
+{% block title %}
+    {% if form.instance.pk %}
+        Edit
+    {% else %}
+        New
+    {% endif %}
+    project
+{% endblock %}
 {% block extrahead %}
-	{% load static %}
-	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
-	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
+    {% load static %}
+    <script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
+    <link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}" />
 {% endblock %}
 {% block content %}
-	{% with edit=form.instance.pk %}
-		<h1 class="form-group">{% if edit %}Edit{% else %}New{% endif %} project</h1>
-		{% if form.errors %}
-			<div class="col-sm-12">
-				<div class="col-sm-6 alert alert-danger">
-					Oops! Something went wrong. Please correct the errors highlighted below.<br>
-					{{ form.non_field_errors }}
-				</div>
-			</div>
-		{% endif %}
-		<form id="project_form" method="post" action="{% if edit %}{% url 'invoices_edit_project' form.instance.id %}{% else %}{% url 'invoices_create_project' %}{% endif %}" class="form-horizontal" enctype="multipart/form-data">
-			{% csrf_token %}
-			<div class="form-group">
-				<label for="name" class="control-label col-sm-2"><b>Name</b></label>
-				<div class="col-sm-4">
-					<input type="text" name="name" id="name" maxlength="100" class="form-control" value="{{ form.name.value|default_if_none:'' }}" autofocus required>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form.name.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="account_search" class="control-label col-sm-2"><b>Account</b></label>
-				<div class="col-sm-4">
-					<input type="text" id="account_search" name="account" class="form-control" value="{{ form.account.value|default_if_none:"" }}" {% if form.account.value %}style="display:none"{% else %} required{% endif %}>
-					<input type="button" id="selected_account" class="btn btn-default" onclick="clear_account_selection()" value="{% if edit %}{{ form.instance.account }}{% else %}{{ form.cleaned_data.account|default_if_none:"" }}{% endif %}" style="{% if not form.account.value %}display:none{% endif %}">
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form.account.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="application_identifier" class="control-label col-sm-2"><b>{{ "projects_and_accounts"|customization:"project_application_identifier_name" }}</b></label>
-				<div class="col-sm-4">
-					<input type="text" name="application_identifier" id="application_identifier" maxlength="100" class="form-control" value="{{ form.application_identifier.value|default_if_none:'' }}" required>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form.application_identifier.errors|striptags }}
-				</div>
-			</div>
-			{% if form.fields.principal_investigators %}
-				<div class="form-group">
-					<label class="control-label col-sm-2" for="pi_search">PIs</label>
-					<div class="col-sm-4">
-						<input id="pi_search" type="text" autocomplete="off" class="form-control" placeholder="Add a principal investigator">
-					</div>
-				</div>
-				<div class="form-group">
-					<div id="pi-list" class="col-sm-offset-2 col-sm-4">
-						This project has no principal investigators.
-					</div>
-				</div>
-			{% endif %}
-			{% if form.fields.discipline.choices.queryset %}
-				<div class="form-group">
-					<label for="discipline" class="control-label col-sm-2">Discipline</label>
-					<div class="col-sm-4">
-						<select name="discipline" id="discipline" class="form-control">
-							{% for discipline_id, discipline_name in form.fields.discipline.choices %}
-								<option value="{{ discipline_id }}" {% if discipline_id == form.discipline.value|to_int %}selected{% endif %}>{{ discipline_name|default_if_none:'' }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.discipline.errors|striptags }}
-					</div>
-				</div>
-			{% endif %}
-			{% if rate_categories %}
-				<div class="form-group">
-					<label for="category" class="control-label col-sm-2"><b>Rate Category</b></label>
-					<div class="col-sm-4">
-						<select name="category" id="category" class="form-control" required>
-							<option disabled selected value="">&nbsp;</option>
-							{% for rate_category in rate_categories %}
-								<option value="{{ rate_category.id }}" {% if rate_category.id == form_details.category.value|to_int %}selected{% endif %}>{{ rate_category.name|default_if_none:'' }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form_details.category.errors|striptags }}
-					</div>
-				</div>
-			{% endif %}
-			{% if form_details.fields.institution.choices.queryset %}
-				<div class="form-group">
-					<label for="institution_search" class="control-label col-sm-2">Institution</label>
-					<div class="col-sm-4">
-						<input type="text" id="institution_search" name="institution" class="form-control" value="{{ form_details.institution.value|default_if_none:"" }}" {% if form_details.institution.value %}style="display:none"{% else %} required{% endif %} pattern="\S(.*\S)?" title="This field is required">
-						<input type="button" id="selected_institution" class="btn btn-default" onclick="clear_institution_selection()" value="{% if edit %}{{ form_details.instance.institution }}{% else %}{{ form_details.cleaned_data.institution|default_if_none:"" }}{% endif %}" style="{% if not form_details.institution.value %}display:none{% endif %}">
-					</div>
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form_details.institution.errors|striptags }}
-					</div>
-				</div>
-			{% endif %}
-			{% if form_details.fields.department.choices.queryset %}
-				<div class="form-group">
-					<label for="department" class="control-label col-sm-2">Department</label>
-					<div class="col-sm-4">
-						<select name="department" id="department" class="form-control">
-							{% for department_id, department_name in form_details.fields.department.choices %}
-								<option value="{{ department_id }}" {% if department_id == form_details.department.value|to_int %}selected{% endif %}>{{ department_name|default_if_none:'' }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form_details.department.errors|striptags }}
-					</div>
-				</div>
-			{% endif %}
-			{% if form_details.fields.staff_host.choices.queryset %}
-				<div class="form-group">
-					<label for="staff_host" class="control-label col-sm-2">Staff host</label>
-					<div class="col-sm-4">
-						<select name="staff_host" id="staff_host" class="form-control">
-							{% for staff_host_id, staff_host_name in form_details.fields.staff_host.choices %}
-								<option value="{{ staff_host_id }}" {% if staff_host_id == form_details.staff_host.value|to_int %}selected{% endif %}>{{ staff_host_name|default_if_none:'' }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form_details.staff_host.errors|striptags }}
-					</div>
-				</div>
-			{% endif %}
-			<div class="form-group">
-				<label for="project_name" class="control-label col-sm-2">Name for invoice</label>
-				<div class="col-sm-4">
-					<input type="text" name="project_name" id="project_name" class="form-control" value="{{ form_details.project_name.value|default_if_none:'' }}">
-					<div class="form-control-static"><small><i>{{ form_details.project_name.help_text }}</i></small></div>
-				</div>
-				<div class="col-sm-6">
-					<div class="form-control-static danger-highlight">{{ form_details.project_name.errors|striptags }}</div>
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="contact_name" class="control-label col-sm-2">Contact name</label>
-				<div class="col-sm-4">
-					<input type="text" name="contact_name" id="contact_name" class="form-control" value="{{ form_details.contact_name.value|default_if_none:'' }}">
-					<div class="form-control-static"><small><i>{{ form_details.contact_name.help_text }}</i></small></div>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form_details.contact_name.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="contact_email" class="control-label col-sm-2">Email</label>
-				<div class="col-sm-4">
-					<input type="text" name="contact_email" id="contact_email" class="form-control" value="{{ form_details.contact_email.value|default_if_none:'' }}">
-					<div class="form-control-static"><small><i>{{ form_details.contact_email.help_text }}</i></small></div>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form_details.contact_email.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="contact_phone" class="control-label col-sm-2">Phone number</label>
-				<div class="col-sm-4">
-					<input type="text" name="contact_phone" id="contact_phone" class="form-control" value="{{ form_details.contact_phone.value|default_if_none:'' }}">
-					<div class="form-control-static"><small><i>{{ form_details.contact_phone.help_text }}</i></small></div>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form_details.contact_phone.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="addressee" class="control-label col-sm-2">Addressee</label>
-				<div class="col-sm-4">
-					<textarea rows="6" name="addressee" id="addressee" class="form-control">{{ form_details.addressee.value|default_if_none:'' }}</textarea>
-					<div class="form-control-static"><small><i>Addressee details will be displayed on the invoice</i></small></div>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form_details.addressee.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="comments" class="control-label col-sm-2">Comments</label>
-				<div class="col-sm-4">
-					<textarea rows="6" name="comments" id="comments" class="form-control">{{ form_details.comments.value|default_if_none:'' }}</textarea>
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form_details.comments.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="start_date" class="control-label col-sm-2">Start date</label>
-				<div class="col-sm-4">
-					<input type="text" id="start_date" name="start_date" class="form-control" placeholder="Choose a date" value="{{ form.start_date.value|input_date_format }}">
-				</div>
-				<div class="col-sm-6 form-control-static danger-highlight">
-					{{ form.start_date.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<label for="expires_on" class="control-label col-sm-2">Expires on</label>
-				<div class="col-sm-2">
-					<input id="expires_on" name="expires_on" type="text" autocomplete="off" class="form-control" value="{{ form_details.expires_on.value|input_date_format }}">
-				</div>
-				<div class="col-sm-8 form-control-static danger-highlight">
-					{{ form_details.expires_on.errors|striptags }}
-				</div>
-			</div>
-			<div class="form-group">
-				<div class="col-sm-offset-2 col-sm-10">
-					<div class="checkbox">
-						<label>
-							<input type="checkbox" name="no_charge" {% if form_details.no_charge.value %}checked{% endif %}> No charge (invoices will not be generated for this project)
-						</label>
-					</div>
-				</div>
-			</div>
-			<div class="form-group">
-				<div class="col-sm-offset-2 col-sm-10">
-					<div class="checkbox">
-						<label>
-							<input type="checkbox" name="no_tax" {% if form_details.no_tax.value %}checked{% endif %}> Tax exempt
-						</label>
-					</div>
-				</div>
-			</div>
-			{% if form.instance.project_documents.all or allow_document_upload %}
-				<div class="form-group">
-					<span class="control-label col-sm-2">Documents</span>
-					<div class="col-sm-10">
-						{% for d in form.instance.project_documents.all %}
-							<div id="document_{{ d.id }}"><a href="javascript:mark_document_for_removal('{{ d.id }}')" class="grey hover-black" title="Remove {{ d.filename }}"><span class="glyphicon glyphicon-remove-circle"></span></a> <a href="{{ d.document.url }}" target="_blank" style="margin-right: 5px">{{ d.filename }}</a></div>
-						{% endfor %}
-					{% if allow_document_upload %}
-						<div style="padding-top: 10px">
-							<input id="fileupload" type="file" name="project_documents" multiple>
-						</div>
-					{% endif %}
-					</div>
-				</div>
-			{% endif %}
-			<div class="form-group">
-				<div class="col-sm-offset-2 col-sm-10">
-					<div class="checkbox">
-						<label>
-							<input type="checkbox" name="active" {% if form.active.value %}checked{% endif %}> Active
-						</label>
-					</div>
-				</div>
-			</div>
-			<div class="form-group">
-				<div class="col-sm-offset-2 col-sm-10">
-					{% button type="save" value=edit|yesno:"Save changes,Create new project" %}
-				</div>
-			</div>
-		</form>
-		<script>
+    {% with edit=form.instance.pk %}
+        <h1 class="form-group">
+            {% if edit %}
+                Edit
+            {% else %}
+                New
+            {% endif %}
+            project
+        </h1>
+        {% if form.errors %}
+            <div class="col-sm-12">
+                <div class="col-sm-6 alert alert-danger">
+                    Oops! Something went wrong. Please correct the errors highlighted below.
+                    <br>
+                    {{ form.non_field_errors }}
+                </div>
+            </div>
+        {% endif %}
+        <form id="project_form"
+              method="post"
+              action="{% if edit %}{% url 'invoices_edit_project' form.instance.id %}{% else %}{% url 'invoices_create_project' %}{% endif %}"
+              class="form-horizontal"
+              enctype="multipart/form-data">
+            {% csrf_token %}
+            <div class="form-group">
+                <label for="name" class="control-label col-sm-2">
+                    <b>Name</b>
+                </label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="name"
+                           id="name"
+                           maxlength="100"
+                           class="form-control"
+                           value="{{ form.name.value|default_if_none:'' }}"
+                           autofocus
+                           required>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form.name.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="account_search" class="control-label col-sm-2">
+                    <b>Account</b>
+                </label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           id="account_search"
+                           name="account"
+                           class="form-control"
+                           value="{{ form.account.value|default_if_none:"" }}"
+                           {% if form.account.value %}style="display:none"{% else %} required{% endif %}>
+                    <input type="button"
+                           id="selected_account"
+                           class="btn btn-default"
+                           onclick="clear_account_selection()"
+                           value="{% if edit %}{{ form.instance.account }}{% else %}{{ form.cleaned_data.account|default_if_none:"" }}{% endif %}"
+                           style="{% if not form.account.value %}display:none{% endif %}">
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form.account.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="application_identifier" class="control-label col-sm-2">
+                    <b>{{ "projects_and_accounts"|customization:"project_application_identifier_name" }}</b>
+                </label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="application_identifier"
+                           id="application_identifier"
+                           maxlength="100"
+                           class="form-control"
+                           value="{{ form.application_identifier.value|default_if_none:'' }}"
+                           required>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form.application_identifier.errors|striptags }}</div>
+            </div>
+            {% if form.fields.principal_investigators %}
+                <div class="form-group">
+                    <label class="control-label col-sm-2" for="pi_search">PIs</label>
+                    <div class="col-sm-4">
+                        <input id="pi_search"
+                               type="text"
+                               autocomplete="off"
+                               class="form-control"
+                               placeholder="Add a principal investigator">
+                    </div>
+                </div>
+                <div class="form-group">
+                    <div id="pi-list" class="col-sm-offset-2 col-sm-4">This project has no principal investigators.</div>
+                </div>
+            {% endif %}
+            {% if form.fields.discipline.choices.queryset %}
+                <div class="form-group">
+                    <label for="discipline" class="control-label col-sm-2">Discipline</label>
+                    <div class="col-sm-4">
+                        <select name="discipline" id="discipline" class="form-control">
+                            {% for discipline_id, discipline_name in form.fields.discipline.choices %}
+                                <option value="{{ discipline_id }}"
+                                        {% if discipline_id == form.discipline.value|to_int %}selected{% endif %}>
+                                    {{ discipline_name|default_if_none:'' }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.discipline.errors|striptags }}</div>
+                </div>
+            {% endif %}
+            {% if rate_categories %}
+                <div class="form-group">
+                    <label for="category" class="control-label col-sm-2">
+                        <b>Rate Category</b>
+                    </label>
+                    <div class="col-sm-4">
+                        <select name="category" id="category" class="form-control" required>
+                            <option disabled selected value="">&nbsp;</option>
+                            {% for rate_category in rate_categories %}
+                                <option value="{{ rate_category.id }}"
+                                        {% if rate_category.id == form_details.category.value|to_int %}selected{% endif %}>
+                                    {{ rate_category.name|default_if_none:'' }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.category.errors|striptags }}</div>
+                </div>
+            {% endif %}
+            {% if form_details.fields.institution.choices.queryset %}
+                <div class="form-group">
+                    <label for="institution_search" class="control-label col-sm-2">Institution</label>
+                    <div class="col-sm-4">
+                        <input type="text"
+                               id="institution_search"
+                               name="institution"
+                               class="form-control"
+                               value="{{ form_details.institution.value|default_if_none:"" }}"
+                               {% if form_details.institution.value %}style="display:none"{% else %} required{% endif %}
+                               pattern="\S(.*\S)?"
+                               title="This field is required">
+                        <input type="button"
+                               id="selected_institution"
+                               class="btn btn-default"
+                               onclick="clear_institution_selection()"
+                               value="{% if edit %}{{ form_details.instance.institution }}{% else %}{{ form_details.cleaned_data.institution|default_if_none:"" }}{% endif %}"
+                               style="{% if not form_details.institution.value %}display:none{% endif %}">
+                    </div>
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.institution.errors|striptags }}</div>
+                </div>
+            {% endif %}
+            {% if form_details.fields.department.choices.queryset %}
+                <div class="form-group">
+                    <label for="department" class="control-label col-sm-2">Department</label>
+                    <div class="col-sm-4">
+                        <select name="department" id="department" class="form-control">
+                            {% for department_id, department_name in form_details.fields.department.choices %}
+                                <option value="{{ department_id }}"
+                                        {% if department_id == form_details.department.value|to_int %}selected{% endif %}>
+                                    {{ department_name|default_if_none:'' }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.department.errors|striptags }}</div>
+                </div>
+            {% endif %}
+            {% if form_details.fields.staff_host.choices.queryset %}
+                <div class="form-group">
+                    <label for="staff_host" class="control-label col-sm-2">Staff host</label>
+                    <div class="col-sm-4">
+                        <select name="staff_host" id="staff_host" class="form-control">
+                            {% for staff_host_id, staff_host_name in form_details.fields.staff_host.choices %}
+                                <option value="{{ staff_host_id }}"
+                                        {% if staff_host_id == form_details.staff_host.value|to_int %}selected{% endif %}>
+                                    {{ staff_host_name|default_if_none:'' }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.staff_host.errors|striptags }}</div>
+                </div>
+            {% endif %}
+            <div class="form-group">
+                <label for="project_name" class="control-label col-sm-2">Name for invoice</label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="project_name"
+                           id="project_name"
+                           class="form-control"
+                           value="{{ form_details.project_name.value|default_if_none:'' }}">
+                    <div class="form-control-static">
+                        <small><i>{{ form_details.project_name.help_text }}</i></small>
+                    </div>
+                </div>
+                <div class="col-sm-6">
+                    <div class="form-control-static danger-highlight">{{ form_details.project_name.errors|striptags }}</div>
+                </div>
+            </div>
+            <div class="form-group">
+                <label for="contact_name" class="control-label col-sm-2">Contact name</label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="contact_name"
+                           id="contact_name"
+                           class="form-control"
+                           value="{{ form_details.contact_name.value|default_if_none:'' }}">
+                    <div class="form-control-static">
+                        <small><i>{{ form_details.contact_name.help_text }}</i></small>
+                    </div>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.contact_name.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="contact_email" class="control-label col-sm-2">Email</label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="contact_email"
+                           id="contact_email"
+                           class="form-control"
+                           value="{{ form_details.contact_email.value|default_if_none:'' }}">
+                    <div class="form-control-static">
+                        <small><i>{{ form_details.contact_email.help_text }}</i></small>
+                    </div>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.contact_email.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="contact_phone" class="control-label col-sm-2">Phone number</label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           name="contact_phone"
+                           id="contact_phone"
+                           class="form-control"
+                           value="{{ form_details.contact_phone.value|default_if_none:'' }}">
+                    <div class="form-control-static">
+                        <small><i>{{ form_details.contact_phone.help_text }}</i></small>
+                    </div>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.contact_phone.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="addressee" class="control-label col-sm-2">Addressee</label>
+                <div class="col-sm-4">
+                    <textarea rows="6" name="addressee" id="addressee" class="form-control">{{ form_details.addressee.value|default_if_none:'' }}</textarea>
+                    <div class="form-control-static">
+                        <small><i>Addressee details will be displayed on the invoice</i></small>
+                    </div>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.addressee.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="comments" class="control-label col-sm-2">Comments</label>
+                <div class="col-sm-4">
+                    <textarea rows="6" name="comments" id="comments" class="form-control">{{ form_details.comments.value|default_if_none:'' }}</textarea>
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form_details.comments.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="start_date" class="control-label col-sm-2">Start date</label>
+                <div class="col-sm-4">
+                    <input type="text"
+                           id="start_date"
+                           name="start_date"
+                           class="form-control"
+                           placeholder="Choose a date"
+                           value="{{ form.start_date.value|input_date_format }}">
+                </div>
+                <div class="col-sm-6 form-control-static danger-highlight">{{ form.start_date.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <label for="expires_on" class="control-label col-sm-2">Expires on</label>
+                <div class="col-sm-2">
+                    <input id="expires_on"
+                           name="expires_on"
+                           type="text"
+                           autocomplete="off"
+                           class="form-control"
+                           value="{{ form_details.expires_on.value|input_date_format }}">
+                </div>
+                <div class="col-sm-8 form-control-static danger-highlight">{{ form_details.expires_on.errors|striptags }}</div>
+            </div>
+            <div class="form-group">
+                <div class="col-sm-offset-2 col-sm-10">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox" name="no_charge" {% if form_details.no_charge.value %}checked{% endif %}>
+                            No charge (invoices will not be generated for this project)
+                        </label>
+                    </div>
+                </div>
+            </div>
+            <div class="form-group">
+                <div class="col-sm-offset-2 col-sm-10">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox" name="no_tax" {% if form_details.no_tax.value %}checked{% endif %}>
+                            Tax exempt
+                        </label>
+                    </div>
+                </div>
+            </div>
+            {% if form.instance.project_documents.all or allow_document_upload %}
+                <div class="form-group">
+                    <span class="control-label col-sm-2">Documents</span>
+                    <div class="col-sm-10">
+                        {% for d in form.instance.project_documents.all %}
+                            <div id="document_{{ d.id }}">
+                                <a href="javascript:mark_document_for_removal('{{ d.id }}')"
+                                   class="grey hover-black"
+                                   title="Remove {{ d.filename }}"><span class="glyphicon glyphicon-remove-circle"></span></a> <a href="{{ d.document.url }}" target="_blank" style="margin-right: 5px">{{ d.filename }}</a>
+                            </div>
+                        {% endfor %}
+                        {% if allow_document_upload %}
+                            <div style="padding-top: 10px">
+                                <input id="fileupload" type="file" name="project_documents" multiple>
+                            </div>
+                        {% endif %}
+                    </div>
+                </div>
+            {% endif %}
+            <div class="form-group">
+                <div class="col-sm-offset-2 col-sm-10">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox" name="active" {% if form.active.value %}checked{% endif %}>
+                            Active
+                        </label>
+                    </div>
+                </div>
+            </div>
+            <div class="form-group">
+                <div class="col-sm-offset-2 col-sm-10">
+                    {% button type="save" value=edit|yesno:"Save changes,Create new project" %}
+                </div>
+            </div>
+        </form>
+        <script>
 			function select_pi(jquery_event, search_selection, dataset_name)
 			{
                 add_to_list("#pi-list", "remove_pi", search_selection.id, search_selection.name, "remove", "principal_investigators");
 				$("#pi_search").typeahead('val', '');
 			}
 			function remove_pi(id)
 			{
@@ -302,10 +391,11 @@
 				$('#institution_search').autocomplete('institution', select_institution, {{ form_details.fields.institution.choices.queryset|json_search_base }});
                 {% for pi in form.principal_investigators.value %}
                     {% for user in user_list %}
                         {% if user.id == pi|to_int %}select_pi(null, {"id": "{{ user.id }}", "name": "{{ user }}"});{% endif %}
 					{% endfor %}
                 {% endfor %}
 			});
-		</script>
-	{% endwith %}
-{% endblock %}
+		
+        </script>
+    {% endwith %}
+{% endblock %}
```

### html2text {}

```diff
@@ -1,13 +1,13 @@
 {% extends 'base.html' %} {% load custom_tags_and_filters %} {% block title %}
-{% if form.instance.pk %}Edit{% else %}New{% endif %} project{% endblock %} {%
-block extrahead %} {% load static %}
+{% if form.instance.pk %} Edit {% else %} New {% endif %} project {% endblock
+%} {% block extrahead %} {% load static %}
 }">
-}"/> {% endblock %} {% block content %} {% with edit=form.instance.pk %}
-************ {{%% iiff eeddiitt %%}}EEddiitt{{%% eellssee %%}}NNeeww{{%% eennddiiff %%}} pprroojjeecctt ************
+}" /> {% endblock %} {% block content %} {% with edit=form.instance.pk %}
+************ {{%% iiff eeddiitt %%}} EEddiitt {{%% eellssee %%}} NNeeww {{%% eennddiiff %%}} pprroojjeecctt ************
 {% if form.errors %}
 Oops! Something went wrong. Please correct the errors highlighted below.
 {{ form.non_field_errors }}
 {% endif %}
 {% csrf_token %}
 NNaammee
 [{{ form.name.value|default_if_none:'' }}]
@@ -24,46 +24,46 @@
 {% if form.fields.principal_investigators %}
 PIs
 [                    ]
 This project has no principal investigators.
 {% endif %} {% if form.fields.discipline.choices.queryset %}
 Discipline
 {% for discipline_id, discipline_name in form.fields.discipline.choices %}
-% if discipline_id == form.discipline.value|to_int %}selected{% endif %}>{
+% if discipline_id == form.discipline.value|to_int %}selected{% endif %}> {
 { discipline_name|default_if_none:'' }}
 {% endfor %}
 {{ form.discipline.errors|striptags }}
 {% endif %} {% if rate_categories %}
 RRaattee CCaatteeggoorryy
 {% for rate_category in rate_categories %}
 % if rate_category.id == form_details.category.value|to_int %}selected{% endif
-%}>{{ rate_category.name|default_if_none:'' }}
+%}> {{ rate_category.name|default_if_none:'' }}
 {% endfor %}
 {{ form_details.category.errors|striptags }}
 {% endif %} {% if form_details.fields.institution.choices.queryset %}
 Institution
 }}" {% if form_details.institution.value %}style="display:none"{% else %}
 required{% endif %} pattern="\S(.*\S)?" title="This field is required">
 }}{% endif %}" style="{% if not form_details.institution.value %}display:none{%
 endif %}">
 {{ form_details.institution.errors|striptags }}
 {% endif %} {% if form_details.fields.department.choices.queryset %}
 Department
 {% for department_id, department_name in form_details.fields.department.choices
 %}
 % if department_id == form_details.department.value|to_int %}selected{% endif
-%}>{{ department_name|default_if_none:'' }}
+%}> {{ department_name|default_if_none:'' }}
 {% endfor %}
 {{ form_details.department.errors|striptags }}
 {% endif %} {% if form_details.fields.staff_host.choices.queryset %}
 Staff host
 {% for staff_host_id, staff_host_name in form_details.fields.staff_host.choices
 %}
 % if staff_host_id == form_details.staff_host.value|to_int %}selected{% endif
-%}>{{ staff_host_name|default_if_none:'' }}
+%}> {{ staff_host_name|default_if_none:'' }}
 {% endfor %}
 {{ form_details.staff_host.errors|striptags }}
 {% endif %}
 Name for invoice
 [{{ form_details.project_name.value|default_if_none:'' }}]
 {{ form_details.project_name.help_text }}
 {{ form_details.project_name.errors|striptags }}
```

## NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html

```diff
@@ -1,230 +1,296 @@
 00000000: 7b25 206c 6f61 6420 6375 7374 6f6d 5f74  {% load custom_t
 00000010: 6167 735f 616e 645f 6669 6c74 6572 7320  ags_and_filters 
 00000020: 257d 0a7b 2520 666f 7220 7072 6f6a 6563  %}.{% for projec
 00000030: 7420 696e 2070 726f 6a65 6374 7320 257d  t in projects %}
-00000040: 0a09 7b25 2077 6974 6820 6269 6c6c 696e  ..{% with billin
-00000050: 675f 6465 7461 696c 3d70 726f 6a65 6374  g_detail=project
-00000060: 2e70 726f 6a65 6374 6269 6c6c 696e 6764  .projectbillingd
-00000070: 6574 6169 6c73 2025 7d0a 0909 3c64 6976  etails %}...<div
-00000080: 2069 643d 2270 726f 6a65 6374 5f65 6469   id="project_edi
-00000090: 745f 6275 7474 6f6e 5f7b 7b20 7072 6f6a  t_button_{{ proj
-000000a0: 6563 742e 6964 207d 7d22 2073 7479 6c65  ect.id }}" style
-000000b0: 3d22 706f 7369 7469 6f6e 3a20 7265 6c61  ="position: rela
-000000c0: 7469 7665 3b20 6469 7370 6c61 793a 2069  tive; display: i
-000000d0: 6e6c 696e 653b 206d 6172 6769 6e2d 6c65  nline; margin-le
-000000e0: 6674 3a20 3130 7078 223e 0a09 0909 7b25  ft: 10px">....{%
-000000f0: 2075 726c 2027 696e 766f 6963 6573 5f65   url 'invoices_e
-00000100: 6469 745f 7072 6f6a 6563 7427 2070 726f  dit_project' pro
-00000110: 6a65 6374 2e69 6420 6173 2065 6469 745f  ject.id as edit_
-00000120: 7072 6f6a 6563 745f 7572 6c20 257d 0a09  project_url %}..
-00000130: 0909 7b25 2062 7574 746f 6e20 7479 7065  ..{% button type
-00000140: 3d22 6564 6974 2220 7369 7a65 3d22 7873  ="edit" size="xs
-00000150: 6d61 6c6c 2220 7374 796c 653d 2270 6f73  mall" style="pos
-00000160: 6974 696f 6e3a 2061 6273 6f6c 7574 6522  ition: absolute"
-00000170: 2076 616c 7565 3d22 4564 6974 2220 7572   value="Edit" ur
-00000180: 6c3d 6564 6974 5f70 726f 6a65 6374 5f75  l=edit_project_u
-00000190: 726c 2025 7d0a 0909 3c2f 6469 763e 0a09  rl %}...</div>..
-000001a0: 093c 6469 7620 6964 3d22 7072 6f6a 6563  .<div id="projec
-000001b0: 745f 7b7b 2070 726f 6a65 6374 2e69 6420  t_{{ project.id 
-000001c0: 7d7d 5f62 696c 6c69 6e67 5f64 6574 6169  }}_billing_detai
-000001d0: 6c73 2220 7374 796c 653d 2264 6973 706c  ls" style="displ
-000001e0: 6179 3a20 6e6f 6e65 223e 0a09 0909 7b25  ay: none">....{%
-000001f0: 2069 6620 6269 6c6c 696e 675f 6465 7461   if billing_deta
-00000200: 696c 2e70 726f 6a65 6374 5f6e 616d 6520  il.project_name 
-00000210: 616e 6420 6269 6c6c 696e 675f 6465 7461  and billing_deta
-00000220: 696c 2e70 726f 6a65 6374 5f6e 616d 6520  il.project_name 
-00000230: 213d 2062 696c 6c69 6e67 5f64 6574 6169  != billing_detai
-00000240: 6c2e 7072 6f6a 6563 742e 6e61 6d65 2025  l.project.name %
-00000250: 7d0a 0909 093c 6469 763e 0a09 0909 093c  }....<div>.....<
-00000260: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
-00000270: 7472 6f6c 2d6c 6162 656c 223e 4269 6c6c  trol-label">Bill
-00000280: 696e 6720 6e61 6d65 3a3c 2f6c 6162 656c  ing name:</label
-00000290: 3e0a 0909 0909 3c73 7061 6e20 636c 6173  >.....<span clas
-000002a0: 733d 2267 7265 7922 3e7b 7b20 6269 6c6c  s="grey">{{ bill
-000002b0: 696e 675f 6465 7461 696c 2e70 726f 6a65  ing_detail.proje
-000002c0: 6374 5f6e 616d 6520 7d7d 3c2f 7370 616e  ct_name }}</span
-000002d0: 3e0a 0909 093c 2f64 6976 3e0a 0909 097b  >....</div>....{
-000002e0: 2520 656e 6469 6620 257d 0a09 0909 7b25  % endif %}....{%
-000002f0: 2069 6620 6269 6c6c 696e 675f 6465 7461   if billing_deta
-00000300: 696c 2e65 7870 6972 6573 5f6f 6e20 257d  il.expires_on %}
-00000310: 0a09 0909 093c 6469 763e 0a09 0909 0909  .....<div>......
-00000320: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
-00000330: 6e74 726f 6c2d 6c61 6265 6c22 3e45 7870  ntrol-label">Exp
-00000340: 6972 6573 3a3c 2f6c 6162 656c 3e0a 0909  ires:</label>...
-00000350: 0909 093c 7370 616e 2063 6c61 7373 3d22  ...<span class="
-00000360: 6772 6579 223e 7b7b 2062 696c 6c69 6e67  grey">{{ billing
-00000370: 5f64 6574 6169 6c2e 6578 7069 7265 735f  _detail.expires_
-00000380: 6f6e 7c64 6174 6520 7d7d 3c2f 7370 616e  on|date }}</span
-00000390: 3e0a 0909 0909 3c2f 6469 763e 0a09 0909  >.....</div>....
-000003a0: 7b25 2065 6e64 6966 2025 7d0a 0909 097b  {% endif %}....{
-000003b0: 2520 6966 2072 6174 655f 6361 7465 676f  % if rate_catego
-000003c0: 7269 6573 2025 7d0a 0909 093c 6469 763e  ries %}....<div>
-000003d0: 0a09 0909 093c 6c61 6265 6c20 636c 6173  .....<label clas
-000003e0: 733d 2263 6f6e 7472 6f6c 2d6c 6162 656c  s="control-label
-000003f0: 223e 4361 7465 676f 7279 3a3c 2f6c 6162  ">Category:</lab
-00000400: 656c 3e0a 0909 0909 3c73 7061 6e20 636c  el>.....<span cl
-00000410: 6173 733d 2267 7265 7922 3e7b 7b20 6269  ass="grey">{{ bi
-00000420: 6c6c 696e 675f 6465 7461 696c 2e63 6174  lling_detail.cat
-00000430: 6567 6f72 7920 7d7d 3c2f 7370 616e 3e0a  egory }}</span>.
-00000440: 0909 093c 2f64 6976 3e0a 0909 097b 2520  ...</div>....{% 
-00000450: 656e 6469 6620 257d 0a09 0909 7b25 2069  endif %}....{% i
-00000460: 6620 6269 6c6c 696e 675f 6465 7461 696c  f billing_detail
-00000470: 2e69 6e73 7469 7475 7469 6f6e 2025 7d0a  .institution %}.
-00000480: 0909 093c 6469 763e 0a09 0909 093c 6c61  ...<div>.....<la
-00000490: 6265 6c20 636c 6173 733d 2263 6f6e 7472  bel class="contr
-000004a0: 6f6c 2d6c 6162 656c 223e 496e 7374 6974  ol-label">Instit
-000004b0: 7574 696f 6e3a 3c2f 6c61 6265 6c3e 0a09  ution:</label>..
-000004c0: 0909 093c 7370 616e 2063 6c61 7373 3d22  ...<span class="
-000004d0: 6772 6579 223e 7b7b 2062 696c 6c69 6e67  grey">{{ billing
-000004e0: 5f64 6574 6169 6c2e 696e 7374 6974 7574  _detail.institut
-000004f0: 696f 6e20 7d7d 3c2f 7370 616e 3e0a 0909  ion }}</span>...
-00000500: 093c 2f64 6976 3e0a 0909 097b 2520 656e  .</div>....{% en
-00000510: 6469 6620 257d 0a09 0909 7b25 2069 6620  dif %}....{% if 
-00000520: 6269 6c6c 696e 675f 6465 7461 696c 2e64  billing_detail.d
-00000530: 6570 6172 746d 656e 7420 257d 0a09 0909  epartment %}....
-00000540: 3c64 6976 3e0a 0909 0909 3c6c 6162 656c  <div>.....<label
-00000550: 2063 6c61 7373 3d22 636f 6e74 726f 6c2d   class="control-
-00000560: 6c61 6265 6c22 3e44 6570 6172 746d 656e  label">Departmen
-00000570: 743a 3c2f 6c61 6265 6c3e 0a09 0909 093c  t:</label>.....<
-00000580: 7370 616e 2063 6c61 7373 3d22 6772 6579  span class="grey
-00000590: 223e 7b7b 2062 696c 6c69 6e67 5f64 6574  ">{{ billing_det
-000005a0: 6169 6c2e 6465 7061 7274 6d65 6e74 207d  ail.department }
-000005b0: 7d3c 2f73 7061 6e3e 0a09 0909 3c2f 6469  }</span>....</di
-000005c0: 763e 0a09 0909 7b25 2065 6e64 6966 2025  v>....{% endif %
-000005d0: 7d0a 0909 097b 2520 6966 2062 696c 6c69  }....{% if billi
-000005e0: 6e67 5f64 6574 6169 6c2e 7374 6166 665f  ng_detail.staff_
-000005f0: 686f 7374 2025 7d0a 0909 093c 6469 763e  host %}....<div>
-00000600: 0a09 0909 093c 6c61 6265 6c20 636c 6173  .....<label clas
-00000610: 733d 2263 6f6e 7472 6f6c 2d6c 6162 656c  s="control-label
-00000620: 223e 5374 6166 6620 686f 7374 3a3c 2f6c  ">Staff host:</l
-00000630: 6162 656c 3e0a 0909 0909 3c73 7061 6e20  abel>.....<span 
-00000640: 636c 6173 733d 2267 7265 7922 3e7b 7b20  class="grey">{{ 
-00000650: 6269 6c6c 696e 675f 6465 7461 696c 2e73  billing_detail.s
-00000660: 7461 6666 5f68 6f73 7420 7d7d 3c2f 7370  taff_host }}</sp
-00000670: 616e 3e0a 0909 093c 2f64 6976 3e0a 0909  an>....</div>...
-00000680: 097b 2520 656e 6469 6620 257d 0a09 0909  .{% endif %}....
-00000690: 3c64 6976 3e0a 0909 0909 3c6c 6162 656c  <div>.....<label
-000006a0: 2063 6c61 7373 3d22 636f 6e74 726f 6c2d   class="control-
-000006b0: 6c61 6265 6c22 3e43 6f6e 7461 6374 3a3c  label">Contact:<
-000006c0: 2f6c 6162 656c 3e0a 0909 0909 3c73 7061  /label>.....<spa
-000006d0: 6e20 636c 6173 733d 2267 7265 7922 3e7b  n class="grey">{
-000006e0: 7b20 6269 6c6c 696e 675f 6465 7461 696c  { billing_detail
-000006f0: 2e63 6f6e 7461 6374 5f6e 616d 657c 6465  .contact_name|de
-00000700: 6661 756c 745f 6966 5f6e 6f6e 653a 2727  fault_if_none:''
-00000710: 207d 7d3c 2f73 7061 6e3e 0a09 0909 3c2f   }}</span>....</
-00000720: 6469 763e 0a09 0909 3c64 6976 3e0a 0909  div>....<div>...
-00000730: 0909 3c6c 6162 656c 2063 6c61 7373 3d22  ..<label class="
-00000740: 636f 6e74 726f 6c2d 6c61 6265 6c22 3e45  control-label">E
-00000750: 6d61 696c 3a3c 2f6c 6162 656c 3e0a 0909  mail:</label>...
-00000760: 0909 3c73 7061 6e20 636c 6173 733d 2267  ..<span class="g
-00000770: 7265 7922 3e7b 7b20 6269 6c6c 696e 675f  rey">{{ billing_
-00000780: 6465 7461 696c 2e63 6f6e 7461 6374 5f65  detail.contact_e
-00000790: 6d61 696c 7c6a 6f69 6e3a 272c 2027 207d  mail|join:', ' }
-000007a0: 7d3c 2f73 7061 6e3e 0a09 0909 3c2f 6469  }</span>....</di
-000007b0: 763e 0a09 0909 3c64 6976 3e0a 0909 0909  v>....<div>.....
-000007c0: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
-000007d0: 6e74 726f 6c2d 6c61 6265 6c22 3e50 686f  ntrol-label">Pho
-000007e0: 6e65 3a3c 2f6c 6162 656c 3e0a 0909 0909  ne:</label>.....
-000007f0: 3c73 7061 6e20 636c 6173 733d 2267 7265  <span class="gre
-00000800: 7922 3e7b 7b20 6269 6c6c 696e 675f 6465  y">{{ billing_de
-00000810: 7461 696c 2e63 6f6e 7461 6374 5f70 686f  tail.contact_pho
-00000820: 6e65 7c64 6566 6175 6c74 5f69 665f 6e6f  ne|default_if_no
-00000830: 6e65 3a27 2720 7d7d 3c2f 7370 616e 3e0a  ne:'' }}</span>.
-00000840: 0909 093c 2f64 6976 3e0a 0909 097b 2520  ...</div>....{% 
-00000850: 6966 2062 696c 6c69 6e67 5f64 6574 6169  if billing_detai
-00000860: 6c2e 6e6f 5f63 6861 7267 6520 257d 0a09  l.no_charge %}..
-00000870: 0909 3c64 6976 3e0a 0909 0909 3c6c 6162  ..<div>.....<lab
-00000880: 656c 2063 6c61 7373 3d22 636f 6e74 726f  el class="contro
-00000890: 6c2d 6c61 6265 6c22 3e4e 6f20 6368 6172  l-label">No char
-000008a0: 6765 3a3c 2f6c 6162 656c 3e0a 0909 0909  ge:</label>.....
-000008b0: 3c73 7061 6e20 636c 6173 733d 2267 7265  <span class="gre
-000008c0: 7922 3e49 6e76 6f69 6365 7320 7769 6c6c  y">Invoices will
-000008d0: 204e 4f54 2062 6520 6372 6561 7465 6420   NOT be created 
-000008e0: 666f 7220 7468 6973 2070 726f 6a65 6374  for this project
-000008f0: 3c2f 7370 616e 3e0a 0909 093c 2f64 6976  </span>....</div
-00000900: 3e0a 0909 097b 2520 656e 6469 6620 257d  >....{% endif %}
-00000910: 0a09 0909 7b25 2069 6620 6269 6c6c 696e  ....{% if billin
-00000920: 675f 6465 7461 696c 2e6e 6f5f 7461 7820  g_detail.no_tax 
-00000930: 257d 0a09 0909 3c64 6976 3e0a 0909 0909  %}....<div>.....
-00000940: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
-00000950: 6e74 726f 6c2d 6c61 6265 6c22 3e4e 6f20  ntrol-label">No 
-00000960: 7461 783a 3c2f 6c61 6265 6c3e 0a09 0909  tax:</label>....
-00000970: 093c 7370 616e 2063 6c61 7373 3d22 6772  .<span class="gr
-00000980: 6579 223e 5468 6973 2070 726f 6a65 6374  ey">This project
-00000990: 2069 7320 7461 7820 6578 656d 7074 3c2f   is tax exempt</
-000009a0: 7370 616e 3e0a 0909 093c 2f64 6976 3e0a  span>....</div>.
-000009b0: 0909 097b 2520 656e 6469 6620 257d 0a09  ...{% endif %}..
-000009c0: 0909 3c64 6976 3e0a 0909 0909 3c6c 6162  ..<div>.....<lab
-000009d0: 656c 2063 6c61 7373 3d22 636f 6e74 726f  el class="contro
-000009e0: 6c2d 6c61 6265 6c22 207b 2520 6966 2062  l-label" {% if b
-000009f0: 696c 6c69 6e67 5f64 6574 6169 6c2e 6164  illing_detail.ad
-00000a00: 7265 7373 6565 206f 7220 6e6f 7420 6269  ressee or not bi
-00000a10: 6c6c 696e 675f 6465 7461 696c 2e63 6f6d  lling_detail.com
-00000a20: 6d65 6e74 7320 257d 7374 796c 653d 226d  ments %}style="m
-00000a30: 6172 6769 6e2d 626f 7474 6f6d 3a20 3022  argin-bottom: 0"
-00000a40: 7b25 2065 6e64 6966 2025 7d3e 4164 6472  {% endif %}>Addr
-00000a50: 6573 7365 653a 3c2f 6c61 6265 6c3e 0a09  essee:</label>..
-00000a60: 0909 093c 6469 7620 636c 6173 733d 2267  ...<div class="g
-00000a70: 7265 7922 207b 2520 6966 2062 696c 6c69  rey" {% if billi
-00000a80: 6e67 5f64 6574 6169 6c2e 636f 6d6d 656e  ng_detail.commen
-00000a90: 7473 2025 7d73 7479 6c65 3d22 6d61 7267  ts %}style="marg
-00000aa0: 696e 2d62 6f74 746f 6d3a 2035 7078 227b  in-bottom: 5px"{
-00000ab0: 2520 656e 6469 6620 257d 3e7b 7b20 6269  % endif %}>{{ bi
-00000ac0: 6c6c 696e 675f 6465 7461 696c 2e61 6464  lling_detail.add
-00000ad0: 7265 7373 6565 7c64 6566 6175 6c74 5f69  ressee|default_i
-00000ae0: 665f 6e6f 6e65 3a27 277c 6c69 6e65 6272  f_none:''|linebr
-00000af0: 6561 6b73 6272 207d 7d3c 2f64 6976 3e0a  eaksbr }}</div>.
-00000b00: 0909 093c 2f64 6976 3e0a 0909 097b 2520  ...</div>....{% 
-00000b10: 6966 2062 696c 6c69 6e67 5f64 6574 6169  if billing_detai
-00000b20: 6c2e 636f 6d6d 656e 7473 2025 7d0a 0909  l.comments %}...
-00000b30: 0909 3c64 6976 3e0a 0909 0909 093c 6c61  ..<div>......<la
-00000b40: 6265 6c20 636c 6173 733d 2263 6f6e 7472  bel class="contr
-00000b50: 6f6c 2d6c 6162 656c 2220 7374 796c 653d  ol-label" style=
-00000b60: 226d 6172 6769 6e2d 626f 7474 6f6d 3a20  "margin-bottom: 
-00000b70: 3022 3e43 6f6d 6d65 6e74 733a 3c2f 6c61  0">Comments:</la
-00000b80: 6265 6c3e 0a09 0909 0909 3c64 6976 2063  bel>......<div c
-00000b90: 6c61 7373 3d22 6772 6579 223e 7b7b 2062  lass="grey">{{ b
-00000ba0: 696c 6c69 6e67 5f64 6574 6169 6c2e 636f  illing_detail.co
-00000bb0: 6d6d 656e 7473 7c6c 696e 6562 7265 616b  mments|linebreak
-00000bc0: 7362 7220 7d7d 3c2f 6469 763e 0a09 0909  sbr }}</div>....
-00000bd0: 093c 2f64 6976 3e0a 0909 097b 2520 656e  .</div>....{% en
-00000be0: 6469 6620 257d 0a09 093c 2f64 6976 3e0a  dif %}...</div>.
-00000bf0: 0909 3c73 6372 6970 743e 0a09 0909 6c65  ..<script>....le
-00000c00: 7420 6564 6974 5f62 7574 746f 6e5f 7b7b  t edit_button_{{
-00000c10: 2070 726f 6a65 6374 2e69 6420 7d7d 203d   project.id }} =
-00000c20: 2064 6f63 756d 656e 742e 6765 7445 6c65   document.getEle
-00000c30: 6d65 6e74 4279 4964 2827 7072 6f6a 6563  mentById('projec
-00000c40: 745f 6564 6974 5f62 7574 746f 6e5f 7b7b  t_edit_button_{{
-00000c50: 2070 726f 6a65 6374 2e69 6420 7d7d 2729   project.id }}')
-00000c60: 3b0a 0909 096c 6574 2070 726f 6a65 6374  ;....let project
-00000c70: 5f63 6865 7672 6f6e 5f7b 7b20 7072 6f6a  _chevron_{{ proj
-00000c80: 6563 742e 6964 207d 7d20 3d20 646f 6375  ect.id }} = docu
-00000c90: 6d65 6e74 2e67 6574 456c 656d 656e 7442  ment.getElementB
-00000ca0: 7949 6428 2770 726f 6a65 6374 5f7b 7b20  yId('project_{{ 
-00000cb0: 7072 6f6a 6563 742e 6964 207d 7d5f 6368  project.id }}_ch
-00000cc0: 6576 726f 6e27 293b 0a09 0909 7072 6f6a  evron');....proj
-00000cd0: 6563 745f 6368 6576 726f 6e5f 7b7b 2070  ect_chevron_{{ p
-00000ce0: 726f 6a65 6374 2e69 6420 7d7d 2e70 6172  roject.id }}.par
-00000cf0: 656e 744e 6f64 652e 7061 7265 6e74 4e6f  entNode.parentNo
-00000d00: 6465 2e69 6e73 6572 7442 6566 6f72 6528  de.insertBefore(
-00000d10: 6564 6974 5f62 7574 746f 6e5f 7b7b 2070  edit_button_{{ p
-00000d20: 726f 6a65 6374 2e69 6420 7d7d 2c20 6e75  roject.id }}, nu
-00000d30: 6c6c 293b 0a09 0909 6c65 7420 6269 6c6c  ll);....let bill
-00000d40: 696e 675f 6465 7461 696c 5f7b 7b20 7072  ing_detail_{{ pr
-00000d50: 6f6a 6563 742e 6964 207d 7d20 3d20 646f  oject.id }} = do
-00000d60: 6375 6d65 6e74 2e67 6574 456c 656d 656e  cument.getElemen
-00000d70: 7442 7949 6428 2770 726f 6a65 6374 5f7b  tById('project_{
-00000d80: 7b20 7072 6f6a 6563 742e 6964 207d 7d5f  { project.id }}_
-00000d90: 6269 6c6c 696e 675f 6465 7461 696c 7327  billing_details'
-00000da0: 293b 0a09 0909 2428 2723 7072 6f6a 6563  );....$('#projec
-00000db0: 745f 7b7b 2070 726f 6a65 6374 2e69 6420  t_{{ project.id 
-00000dc0: 7d7d 5f64 6574 6169 6c73 2064 6976 3a65  }}_details div:e
-00000dd0: 7128 3029 2729 2e61 6674 6572 2862 696c  q(0)').after(bil
-00000de0: 6c69 6e67 5f64 6574 6169 6c5f 7b7b 2070  ling_detail_{{ p
-00000df0: 726f 6a65 6374 2e69 6420 7d7d 293b 0a09  roject.id }});..
-00000e00: 0909 2428 6269 6c6c 696e 675f 6465 7461  ..$(billing_deta
-00000e10: 696c 5f7b 7b20 7072 6f6a 6563 742e 6964  il_{{ project.id
-00000e20: 207d 7d29 2e73 686f 7728 293b 0a09 093c   }}).show();...<
-00000e30: 2f73 6372 6970 743e 0a09 7b25 2065 6e64  /script>..{% end
-00000e40: 7769 7468 2025 7d0a 7b25 2065 6e64 666f  with %}.{% endfo
-00000e50: 7220 257d                                r %}
+00000040: 0a20 2020 207b 2520 7769 7468 2062 696c  .    {% with bil
+00000050: 6c69 6e67 5f64 6574 6169 6c3d 7072 6f6a  ling_detail=proj
+00000060: 6563 742e 7072 6f6a 6563 7462 696c 6c69  ect.projectbilli
+00000070: 6e67 6465 7461 696c 7320 257d 0a20 2020  ngdetails %}.   
+00000080: 2020 2020 203c 6469 7620 6964 3d22 7072       <div id="pr
+00000090: 6f6a 6563 745f 6564 6974 5f62 7574 746f  oject_edit_butto
+000000a0: 6e5f 7b7b 2070 726f 6a65 6374 2e69 6420  n_{{ project.id 
+000000b0: 7d7d 220a 2020 2020 2020 2020 2020 2020  }}".            
+000000c0: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
+000000d0: 3a20 7265 6c61 7469 7665 3b0a 2020 2020  : relative;.    
+000000e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000000f0: 6469 7370 6c61 793a 2069 6e6c 696e 653b  display: inline;
+00000100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000110: 2020 2020 206d 6172 6769 6e2d 6c65 6674       margin-left
+00000120: 3a20 3130 7078 223e 0a20 2020 2020 2020  : 10px">.       
+00000130: 2020 2020 207b 2520 7572 6c20 2769 6e76       {% url 'inv
+00000140: 6f69 6365 735f 6564 6974 5f70 726f 6a65  oices_edit_proje
+00000150: 6374 2720 7072 6f6a 6563 742e 6964 2061  ct' project.id a
+00000160: 7320 6564 6974 5f70 726f 6a65 6374 5f75  s edit_project_u
+00000170: 726c 2025 7d0a 2020 2020 2020 2020 2020  rl %}.          
+00000180: 2020 7b25 2062 7574 746f 6e20 7479 7065    {% button type
+00000190: 3d22 6564 6974 2220 7369 7a65 3d22 7873  ="edit" size="xs
+000001a0: 6d61 6c6c 2220 7374 796c 653d 2270 6f73  mall" style="pos
+000001b0: 6974 696f 6e3a 2061 6273 6f6c 7574 6522  ition: absolute"
+000001c0: 2076 616c 7565 3d22 4564 6974 2220 7572   value="Edit" ur
+000001d0: 6c3d 6564 6974 5f70 726f 6a65 6374 5f75  l=edit_project_u
+000001e0: 726c 2025 7d0a 2020 2020 2020 2020 3c2f  rl %}.        </
+000001f0: 6469 763e 0a20 2020 2020 2020 203c 6469  div>.        <di
+00000200: 7620 6964 3d22 7072 6f6a 6563 745f 7b7b  v id="project_{{
+00000210: 2070 726f 6a65 6374 2e69 6420 7d7d 5f62   project.id }}_b
+00000220: 696c 6c69 6e67 5f64 6574 6169 6c73 2220  illing_details" 
+00000230: 7374 796c 653d 2264 6973 706c 6179 3a20  style="display: 
+00000240: 6e6f 6e65 223e 0a20 2020 2020 2020 2020  none">.         
+00000250: 2020 207b 2520 6966 2062 696c 6c69 6e67     {% if billing
+00000260: 5f64 6574 6169 6c2e 7072 6f6a 6563 745f  _detail.project_
+00000270: 6e61 6d65 2061 6e64 2062 696c 6c69 6e67  name and billing
+00000280: 5f64 6574 6169 6c2e 7072 6f6a 6563 745f  _detail.project_
+00000290: 6e61 6d65 2021 3d20 6269 6c6c 696e 675f  name != billing_
+000002a0: 6465 7461 696c 2e70 726f 6a65 6374 2e6e  detail.project.n
+000002b0: 616d 6520 257d 0a20 2020 2020 2020 2020  ame %}.         
+000002c0: 2020 2020 2020 203c 6469 763e 0a20 2020         <div>.   
+000002d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000002e0: 203c 6c61 6265 6c20 636c 6173 733d 2263   <label class="c
+000002f0: 6f6e 7472 6f6c 2d6c 6162 656c 223e 4269  ontrol-label">Bi
+00000300: 6c6c 696e 6720 6e61 6d65 3a3c 2f6c 6162  lling name:</lab
+00000310: 656c 3e0a 2020 2020 2020 2020 2020 2020  el>.            
+00000320: 2020 2020 2020 2020 3c73 7061 6e20 636c          <span cl
+00000330: 6173 733d 2267 7265 7922 3e7b 7b20 6269  ass="grey">{{ bi
+00000340: 6c6c 696e 675f 6465 7461 696c 2e70 726f  lling_detail.pro
+00000350: 6a65 6374 5f6e 616d 6520 7d7d 3c2f 7370  ject_name }}</sp
+00000360: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
+00000370: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
+00000380: 2020 2020 2020 207b 2520 656e 6469 6620         {% endif 
+00000390: 257d 0a20 2020 2020 2020 2020 2020 207b  %}.            {
+000003a0: 2520 6966 2062 696c 6c69 6e67 5f64 6574  % if billing_det
+000003b0: 6169 6c2e 6578 7069 7265 735f 6f6e 2025  ail.expires_on %
+000003c0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000003d0: 2020 3c64 6976 3e0a 2020 2020 2020 2020    <div>.        
+000003e0: 2020 2020 2020 2020 2020 2020 3c6c 6162              <lab
+000003f0: 656c 2063 6c61 7373 3d22 636f 6e74 726f  el class="contro
+00000400: 6c2d 6c61 6265 6c22 3e45 7870 6972 6573  l-label">Expires
+00000410: 3a3c 2f6c 6162 656c 3e0a 2020 2020 2020  :</label>.      
+00000420: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+00000430: 7061 6e20 636c 6173 733d 2267 7265 7922  pan class="grey"
+00000440: 3e7b 7b20 6269 6c6c 696e 675f 6465 7461  >{{ billing_deta
+00000450: 696c 2e65 7870 6972 6573 5f6f 6e7c 6461  il.expires_on|da
+00000460: 7465 207d 7d3c 2f73 7061 6e3e 0a20 2020  te }}</span>.   
+00000470: 2020 2020 2020 2020 2020 2020 203c 2f64               </d
+00000480: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00000490: 7b25 2065 6e64 6966 2025 7d0a 2020 2020  {% endif %}.    
+000004a0: 2020 2020 2020 2020 7b25 2069 6620 7261          {% if ra
+000004b0: 7465 5f63 6174 6567 6f72 6965 7320 257d  te_categories %}
+000004c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000004d0: 203c 6469 763e 0a20 2020 2020 2020 2020   <div>.         
+000004e0: 2020 2020 2020 2020 2020 203c 6c61 6265             <labe
+000004f0: 6c20 636c 6173 733d 2263 6f6e 7472 6f6c  l class="control
+00000500: 2d6c 6162 656c 223e 4361 7465 676f 7279  -label">Category
+00000510: 3a3c 2f6c 6162 656c 3e0a 2020 2020 2020  :</label>.      
+00000520: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+00000530: 7061 6e20 636c 6173 733d 2267 7265 7922  pan class="grey"
+00000540: 3e7b 7b20 6269 6c6c 696e 675f 6465 7461  >{{ billing_deta
+00000550: 696c 2e63 6174 6567 6f72 7920 7d7d 3c2f  il.category }}</
+00000560: 7370 616e 3e0a 2020 2020 2020 2020 2020  span>.          
+00000570: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000580: 2020 2020 2020 2020 207b 2520 656e 6469           {% endi
+00000590: 6620 257d 0a20 2020 2020 2020 2020 2020  f %}.           
+000005a0: 207b 2520 6966 2062 696c 6c69 6e67 5f64   {% if billing_d
+000005b0: 6574 6169 6c2e 696e 7374 6974 7574 696f  etail.institutio
+000005c0: 6e20 257d 0a20 2020 2020 2020 2020 2020  n %}.           
+000005d0: 2020 2020 203c 6469 763e 0a20 2020 2020       <div>.     
+000005e0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000005f0: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
+00000600: 7472 6f6c 2d6c 6162 656c 223e 496e 7374  trol-label">Inst
+00000610: 6974 7574 696f 6e3a 3c2f 6c61 6265 6c3e  itution:</label>
+00000620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000630: 2020 2020 203c 7370 616e 2063 6c61 7373       <span class
+00000640: 3d22 6772 6579 223e 7b7b 2062 696c 6c69  ="grey">{{ billi
+00000650: 6e67 5f64 6574 6169 6c2e 696e 7374 6974  ng_detail.instit
+00000660: 7574 696f 6e20 7d7d 3c2f 7370 616e 3e0a  ution }}</span>.
+00000670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000680: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00000690: 2020 207b 2520 656e 6469 6620 257d 0a20     {% endif %}. 
+000006a0: 2020 2020 2020 2020 2020 207b 2520 6966             {% if
+000006b0: 2062 696c 6c69 6e67 5f64 6574 6169 6c2e   billing_detail.
+000006c0: 6465 7061 7274 6d65 6e74 2025 7d0a 2020  department %}.  
+000006d0: 2020 2020 2020 2020 2020 2020 2020 3c64                <d
+000006e0: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+000006f0: 2020 2020 2020 2020 3c6c 6162 656c 2063          <label c
+00000700: 6c61 7373 3d22 636f 6e74 726f 6c2d 6c61  lass="control-la
+00000710: 6265 6c22 3e44 6570 6172 746d 656e 743a  bel">Department:
+00000720: 3c2f 6c61 6265 6c3e 0a20 2020 2020 2020  </label>.       
+00000730: 2020 2020 2020 2020 2020 2020 203c 7370               <sp
+00000740: 616e 2063 6c61 7373 3d22 6772 6579 223e  an class="grey">
+00000750: 7b7b 2062 696c 6c69 6e67 5f64 6574 6169  {{ billing_detai
+00000760: 6c2e 6465 7061 7274 6d65 6e74 207d 7d3c  l.department }}<
+00000770: 2f73 7061 6e3e 0a20 2020 2020 2020 2020  /span>.         
+00000780: 2020 2020 2020 203c 2f64 6976 3e0a 2020         </div>.  
+00000790: 2020 2020 2020 2020 2020 7b25 2065 6e64            {% end
+000007a0: 6966 2025 7d0a 2020 2020 2020 2020 2020  if %}.          
+000007b0: 2020 7b25 2069 6620 6269 6c6c 696e 675f    {% if billing_
+000007c0: 6465 7461 696c 2e73 7461 6666 5f68 6f73  detail.staff_hos
+000007d0: 7420 257d 0a20 2020 2020 2020 2020 2020  t %}.           
+000007e0: 2020 2020 203c 6469 763e 0a20 2020 2020       <div>.     
+000007f0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00000800: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
+00000810: 7472 6f6c 2d6c 6162 656c 223e 5374 6166  trol-label">Staf
+00000820: 6620 686f 7374 3a3c 2f6c 6162 656c 3e0a  f host:</label>.
+00000830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000840: 2020 2020 3c73 7061 6e20 636c 6173 733d      <span class=
+00000850: 2267 7265 7922 3e7b 7b20 6269 6c6c 696e  "grey">{{ billin
+00000860: 675f 6465 7461 696c 2e73 7461 6666 5f68  g_detail.staff_h
+00000870: 6f73 7420 7d7d 3c2f 7370 616e 3e0a 2020  ost }}</span>.  
+00000880: 2020 2020 2020 2020 2020 2020 2020 3c2f                </
+00000890: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
+000008a0: 207b 2520 656e 6469 6620 257d 0a20 2020   {% endif %}.   
+000008b0: 2020 2020 2020 2020 203c 6469 763e 0a20           <div>. 
+000008c0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000008d0: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
+000008e0: 7472 6f6c 2d6c 6162 656c 223e 436f 6e74  trol-label">Cont
+000008f0: 6163 743a 3c2f 6c61 6265 6c3e 0a20 2020  act:</label>.   
+00000900: 2020 2020 2020 2020 2020 2020 203c 7370               <sp
+00000910: 616e 2063 6c61 7373 3d22 6772 6579 223e  an class="grey">
+00000920: 7b7b 2062 696c 6c69 6e67 5f64 6574 6169  {{ billing_detai
+00000930: 6c2e 636f 6e74 6163 745f 6e61 6d65 7c64  l.contact_name|d
+00000940: 6566 6175 6c74 5f69 665f 6e6f 6e65 3a27  efault_if_none:'
+00000950: 2720 7d7d 3c2f 7370 616e 3e0a 2020 2020  ' }}</span>.    
+00000960: 2020 2020 2020 2020 3c2f 6469 763e 0a20          </div>. 
+00000970: 2020 2020 2020 2020 2020 203c 6469 763e             <div>
+00000980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000990: 203c 6c61 6265 6c20 636c 6173 733d 2263   <label class="c
+000009a0: 6f6e 7472 6f6c 2d6c 6162 656c 223e 456d  ontrol-label">Em
+000009b0: 6169 6c3a 3c2f 6c61 6265 6c3e 0a20 2020  ail:</label>.   
+000009c0: 2020 2020 2020 2020 2020 2020 203c 7370               <sp
+000009d0: 616e 2063 6c61 7373 3d22 6772 6579 223e  an class="grey">
+000009e0: 7b7b 2062 696c 6c69 6e67 5f64 6574 6169  {{ billing_detai
+000009f0: 6c2e 636f 6e74 6163 745f 656d 6169 6c7c  l.contact_email|
+00000a00: 6a6f 696e 3a27 2c20 2720 7d7d 3c2f 7370  join:', ' }}</sp
+00000a10: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
+00000a20: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00000a30: 2020 203c 6469 763e 0a20 2020 2020 2020     <div>.       
+00000a40: 2020 2020 2020 2020 203c 6c61 6265 6c20           <label 
+00000a50: 636c 6173 733d 2263 6f6e 7472 6f6c 2d6c  class="control-l
+00000a60: 6162 656c 223e 5068 6f6e 653a 3c2f 6c61  abel">Phone:</la
+00000a70: 6265 6c3e 0a20 2020 2020 2020 2020 2020  bel>.           
+00000a80: 2020 2020 203c 7370 616e 2063 6c61 7373       <span class
+00000a90: 3d22 6772 6579 223e 7b7b 2062 696c 6c69  ="grey">{{ billi
+00000aa0: 6e67 5f64 6574 6169 6c2e 636f 6e74 6163  ng_detail.contac
+00000ab0: 745f 7068 6f6e 657c 6465 6661 756c 745f  t_phone|default_
+00000ac0: 6966 5f6e 6f6e 653a 2727 207d 7d3c 2f73  if_none:'' }}</s
+00000ad0: 7061 6e3e 0a20 2020 2020 2020 2020 2020  pan>.           
+00000ae0: 203c 2f64 6976 3e0a 2020 2020 2020 2020   </div>.        
+00000af0: 2020 2020 7b25 2069 6620 6269 6c6c 696e      {% if billin
+00000b00: 675f 6465 7461 696c 2e6e 6f5f 6368 6172  g_detail.no_char
+00000b10: 6765 2025 7d0a 2020 2020 2020 2020 2020  ge %}.          
+00000b20: 2020 2020 2020 3c64 6976 3e0a 2020 2020        <div>.    
+00000b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b40: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
+00000b50: 6e74 726f 6c2d 6c61 6265 6c22 3e4e 6f20  ntrol-label">No 
+00000b60: 6368 6172 6765 3a3c 2f6c 6162 656c 3e0a  charge:</label>.
+00000b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b80: 2020 2020 3c73 7061 6e20 636c 6173 733d      <span class=
+00000b90: 2267 7265 7922 3e49 6e76 6f69 6365 7320  "grey">Invoices 
+00000ba0: 7769 6c6c 204e 4f54 2062 6520 6372 6561  will NOT be crea
+00000bb0: 7465 6420 666f 7220 7468 6973 2070 726f  ted for this pro
+00000bc0: 6a65 6374 3c2f 7370 616e 3e0a 2020 2020  ject</span>.    
+00000bd0: 2020 2020 2020 2020 2020 2020 3c2f 6469              </di
+00000be0: 763e 0a20 2020 2020 2020 2020 2020 207b  v>.            {
+00000bf0: 2520 656e 6469 6620 257d 0a20 2020 2020  % endif %}.     
+00000c00: 2020 2020 2020 207b 2520 6966 2062 696c         {% if bil
+00000c10: 6c69 6e67 5f64 6574 6169 6c2e 6e6f 5f74  ling_detail.no_t
+00000c20: 6178 2025 7d0a 2020 2020 2020 2020 2020  ax %}.          
+00000c30: 2020 2020 2020 3c64 6976 3e0a 2020 2020        <div>.    
+00000c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c50: 3c6c 6162 656c 2063 6c61 7373 3d22 636f  <label class="co
+00000c60: 6e74 726f 6c2d 6c61 6265 6c22 3e4e 6f20  ntrol-label">No 
+00000c70: 7461 783a 3c2f 6c61 6265 6c3e 0a20 2020  tax:</label>.   
+00000c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c90: 203c 7370 616e 2063 6c61 7373 3d22 6772   <span class="gr
+00000ca0: 6579 223e 5468 6973 2070 726f 6a65 6374  ey">This project
+00000cb0: 2069 7320 7461 7820 6578 656d 7074 3c2f   is tax exempt</
+00000cc0: 7370 616e 3e0a 2020 2020 2020 2020 2020  span>.          
+00000cd0: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000ce0: 2020 2020 2020 2020 207b 2520 656e 6469           {% endi
+00000cf0: 6620 257d 0a20 2020 2020 2020 2020 2020  f %}.           
+00000d00: 203c 6469 763e 0a20 2020 2020 2020 2020   <div>.         
+00000d10: 2020 2020 2020 203c 6c61 6265 6c20 636c         <label cl
+00000d20: 6173 733d 2263 6f6e 7472 6f6c 2d6c 6162  ass="control-lab
+00000d30: 656c 220a 2020 2020 2020 2020 2020 2020  el".            
+00000d40: 2020 2020 2020 2020 2020 207b 2520 6966             {% if
+00000d50: 2062 696c 6c69 6e67 5f64 6574 6169 6c2e   billing_detail.
+00000d60: 6164 7265 7373 6565 206f 7220 6e6f 7420  adressee or not 
+00000d70: 6269 6c6c 696e 675f 6465 7461 696c 2e63  billing_detail.c
+00000d80: 6f6d 6d65 6e74 7320 257d 7374 796c 653d  omments %}style=
+00000d90: 226d 6172 6769 6e2d 626f 7474 6f6d 3a20  "margin-bottom: 
+00000da0: 3022 7b25 2065 6e64 6966 2025 7d3e 0a20  0"{% endif %}>. 
+00000db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000dc0: 2020 2041 6464 7265 7373 6565 3a0a 2020     Addressee:.  
+00000dd0: 2020 2020 2020 2020 2020 2020 2020 3c2f                </
+00000de0: 6c61 6265 6c3e 0a20 2020 2020 2020 2020  label>.         
+00000df0: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00000e00: 733d 2267 7265 7922 207b 2520 6966 2062  s="grey" {% if b
+00000e10: 696c 6c69 6e67 5f64 6574 6169 6c2e 636f  illing_detail.co
+00000e20: 6d6d 656e 7473 2025 7d73 7479 6c65 3d22  mments %}style="
+00000e30: 6d61 7267 696e 2d62 6f74 746f 6d3a 2035  margin-bottom: 5
+00000e40: 7078 227b 2520 656e 6469 6620 257d 3e0a  px"{% endif %}>.
+00000e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e60: 2020 2020 7b7b 2062 696c 6c69 6e67 5f64      {{ billing_d
+00000e70: 6574 6169 6c2e 6164 6472 6573 7365 657c  etail.addressee|
+00000e80: 6465 6661 756c 745f 6966 5f6e 6f6e 653a  default_if_none:
+00000e90: 2727 7c6c 696e 6562 7265 616b 7362 7220  ''|linebreaksbr 
+00000ea0: 7d7d 0a20 2020 2020 2020 2020 2020 2020  }}.             
+00000eb0: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00000ec0: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000ed0: 2020 2020 2020 2020 207b 2520 6966 2062           {% if b
+00000ee0: 696c 6c69 6e67 5f64 6574 6169 6c2e 636f  illing_detail.co
+00000ef0: 6d6d 656e 7473 2025 7d0a 2020 2020 2020  mments %}.      
+00000f00: 2020 2020 2020 2020 2020 3c64 6976 3e0a            <div>.
+00000f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000f20: 2020 2020 3c6c 6162 656c 2063 6c61 7373      <label class
+00000f30: 3d22 636f 6e74 726f 6c2d 6c61 6265 6c22  ="control-label"
+00000f40: 2073 7479 6c65 3d22 6d61 7267 696e 2d62   style="margin-b
+00000f50: 6f74 746f 6d3a 2030 223e 436f 6d6d 656e  ottom: 0">Commen
+00000f60: 7473 3a3c 2f6c 6162 656c 3e0a 2020 2020  ts:</label>.    
+00000f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000f80: 3c64 6976 2063 6c61 7373 3d22 6772 6579  <div class="grey
+00000f90: 223e 7b7b 2062 696c 6c69 6e67 5f64 6574  ">{{ billing_det
+00000fa0: 6169 6c2e 636f 6d6d 656e 7473 7c6c 696e  ail.comments|lin
+00000fb0: 6562 7265 616b 7362 7220 7d7d 3c2f 6469  ebreaksbr }}</di
+00000fc0: 763e 0a20 2020 2020 2020 2020 2020 2020  v>.             
+00000fd0: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00000fe0: 2020 2020 2020 7b25 2065 6e64 6966 2025        {% endif %
+00000ff0: 7d0a 2020 2020 2020 2020 3c2f 6469 763e  }.        </div>
+00001000: 0a20 2020 2020 2020 203c 7363 7269 7074  .        <script
+00001010: 3e0a 0909 096c 6574 2065 6469 745f 6275  >....let edit_bu
+00001020: 7474 6f6e 5f7b 7b20 7072 6f6a 6563 742e  tton_{{ project.
+00001030: 6964 207d 7d20 3d20 646f 6375 6d65 6e74  id }} = document
+00001040: 2e67 6574 456c 656d 656e 7442 7949 6428  .getElementById(
+00001050: 2770 726f 6a65 6374 5f65 6469 745f 6275  'project_edit_bu
+00001060: 7474 6f6e 5f7b 7b20 7072 6f6a 6563 742e  tton_{{ project.
+00001070: 6964 207d 7d27 293b 0a09 0909 6c65 7420  id }}');....let 
+00001080: 7072 6f6a 6563 745f 6368 6576 726f 6e5f  project_chevron_
+00001090: 7b7b 2070 726f 6a65 6374 2e69 6420 7d7d  {{ project.id }}
+000010a0: 203d 2064 6f63 756d 656e 742e 6765 7445   = document.getE
+000010b0: 6c65 6d65 6e74 4279 4964 2827 7072 6f6a  lementById('proj
+000010c0: 6563 745f 7b7b 2070 726f 6a65 6374 2e69  ect_{{ project.i
+000010d0: 6420 7d7d 5f63 6865 7672 6f6e 2729 3b0a  d }}_chevron');.
+000010e0: 0909 0970 726f 6a65 6374 5f63 6865 7672  ...project_chevr
+000010f0: 6f6e 5f7b 7b20 7072 6f6a 6563 742e 6964  on_{{ project.id
+00001100: 207d 7d2e 7061 7265 6e74 4e6f 6465 2e70   }}.parentNode.p
+00001110: 6172 656e 744e 6f64 652e 696e 7365 7274  arentNode.insert
+00001120: 4265 666f 7265 2865 6469 745f 6275 7474  Before(edit_butt
+00001130: 6f6e 5f7b 7b20 7072 6f6a 6563 742e 6964  on_{{ project.id
+00001140: 207d 7d2c 206e 756c 6c29 3b0a 0909 096c   }}, null);....l
+00001150: 6574 2062 696c 6c69 6e67 5f64 6574 6169  et billing_detai
+00001160: 6c5f 7b7b 2070 726f 6a65 6374 2e69 6420  l_{{ project.id 
+00001170: 7d7d 203d 2064 6f63 756d 656e 742e 6765  }} = document.ge
+00001180: 7445 6c65 6d65 6e74 4279 4964 2827 7072  tElementById('pr
+00001190: 6f6a 6563 745f 7b7b 2070 726f 6a65 6374  oject_{{ project
+000011a0: 2e69 6420 7d7d 5f62 696c 6c69 6e67 5f64  .id }}_billing_d
+000011b0: 6574 6169 6c73 2729 3b0a 0909 0924 2827  etails');....$('
+000011c0: 2370 726f 6a65 6374 5f7b 7b20 7072 6f6a  #project_{{ proj
+000011d0: 6563 742e 6964 207d 7d5f 6465 7461 696c  ect.id }}_detail
+000011e0: 7320 6469 763a 6571 2830 2927 292e 6166  s div:eq(0)').af
+000011f0: 7465 7228 6269 6c6c 696e 675f 6465 7461  ter(billing_deta
+00001200: 696c 5f7b 7b20 7072 6f6a 6563 742e 6964  il_{{ project.id
+00001210: 207d 7d29 3b0a 0909 0924 2862 696c 6c69   }});....$(billi
+00001220: 6e67 5f64 6574 6169 6c5f 7b7b 2070 726f  ng_detail_{{ pro
+00001230: 6a65 6374 2e69 6420 7d7d 292e 7368 6f77  ject.id }}).show
+00001240: 2829 3b0a 0909 0a20 2020 2020 2020 203c  ();....        <
+00001250: 2f73 6372 6970 743e 0a20 2020 207b 2520  /script>.    {% 
+00001260: 656e 6477 6974 6820 257d 0a7b 2520 656e  endwith %}.{% en
+00001270: 6466 6f72 2025 7d0a                      dfor %}.
```

## NEMO_billing/invoices/views/invoices.py

```diff
@@ -374,17 +374,17 @@
 def csv_invoice(request, invoice_id):
     invoice = get_object_or_404(Invoice, pk=invoice_id)
     try:
         invoice_renderer = CSVInvoiceRenderer()
         content = invoice_renderer.render_invoice(invoice)
         content.seek(0)
         response = HttpResponse(content.read(), content_type="text/csv")
-        response[
-            "Content-Disposition"
-        ] = f'attachment; filename="{invoice.filename(invoice_renderer.get_file_extension())}"'
+        response["Content-Disposition"] = (
+            f'attachment; filename="{invoice.filename(invoice_renderer.get_file_extension())}"'
+        )
         return response
     except InvoiceGenerationException as e:
         messages.error(request, e.msg)
         return HttpResponse()
 
 
 @accounting_or_manager_required
```

## NEMO_billing/invoices/views/project.py

```diff
@@ -125,24 +125,24 @@
 
 
 def send_project_expiration_reminders():
     accounting_email = BillingCustomization.get("billing_accounting_email_address")
     expiration_reminder_days = BillingCustomization.get("billing_project_expiration_reminder_days")
     if expiration_reminder_days:
         project_expiration_reminder_cc = BillingCustomization.get("billing_project_expiration_reminder_cc")
-        email_projects : Dict[str, Set[Project]] = defaultdict(set)
+        email_projects: Dict[str, Set[Project]] = defaultdict(set)
         ccs = [e for e in project_expiration_reminder_cc.split(",") if e]
         for remaining_days in [int(days) for days in expiration_reminder_days.split(",")]:
             expiration_date = date.today() + timedelta(days=remaining_days)
             for project in Project.objects.filter(active=True, projectbillingdetails__expires_on=expiration_date):
                 send_to = project.projectbillingdetails.email_to()
                 for email_pi in send_to:
                     email_projects[email_pi].add(project)
         for pi_email, projects in email_projects.items():
-            sorted_projects = sorted(projects, key=lambda x:x.projectbillingdetails.expires_on)
+            sorted_projects = sorted(projects, key=lambda x: x.projectbillingdetails.expires_on)
             render_and_send_email(
                 "invoices/email/billing_project_expiration_reminder_email",
                 {"projects": sorted_projects, "today": datetime.today().date()},
                 to=[pi_email],
                 from_email=accounting_email,
                 cc=ccs,
             )
```

## NEMO_billing/invoices/views/usage.py

```diff
@@ -108,25 +108,28 @@
             projects = Project.objects.filter(account=account)
             selection = account.name
         elif kind == "user":
             user = User.objects.get(id=identifier)
             projects = user.active_projects()
             selection = str(user)
 
+        customer_filter = Q()
+        user_filter = Q()
+        trainee_filter = Q()
         if projects:
-            customer_filter = Q(project__in=projects)
-            user_filter = Q(project__in=projects)
-            trainee_filter = Q(project__in=projects)
-            if user:
-                customer_filter = customer_filter & Q(customer=user)
-                user_filter = user_filter & Q(user=user)
-                trainee_filter = trainee_filter & Q(trainee=user)
-            detailed_items = sorted_billable_items(start, end, config, customer_filter, user_filter, trainee_filter)
-            if bool(request.GET.get("csv", False)):
-                return csv_export_response(detailed_items)
+            customer_filter = customer_filter & Q(project__in=projects)
+            user_filter = user_filter & Q(project__in=projects)
+            trainee_filter = trainee_filter & Q(project__in=projects)
+        if user:
+            customer_filter = customer_filter & Q(customer=user)
+            user_filter = user_filter & Q(user=user)
+            trainee_filter = trainee_filter & Q(trainee=user)
+        detailed_items = sorted_billable_items(start, end, config, customer_filter, user_filter, trainee_filter)
+        if bool(request.GET.get("csv", False)):
+            return csv_export_response(detailed_items)
     except Exception as e:
         logger.exception(e)
     total_charges = sum(item.billable_amount for item in detailed_items)
     dictionary = {
         "search_items": set(Account.objects.all())
         | set(Project.objects.all())
         | set(get_project_applications())
```

## NEMO_billing/migrations/0001_initial.py

```diff
@@ -1,53 +1,126 @@
 # Generated by Django 2.2.13 on 2021-03-02 20:17
 
+import django.db.models.deletion
 from django.conf import settings
 from django.db import migrations, models
-import django.db.models.deletion
 
 
 class Migration(migrations.Migration):
 
     initial = True
 
     dependencies = [
         migrations.swappable_dependency(settings.AUTH_USER_MODEL),
-        ('NEMO', '0027_version_3_8_0'),
+        ("NEMO", "0027_version_3_8_0"),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='CoreFacility',
+            name="CoreFacility",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The name of this core facility.', max_length=200, unique=True)),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The name of this core facility.", max_length=200, unique=True)),
             ],
             options={
-                'verbose_name_plural': 'Core facilities',
-                'ordering': ['name'],
+                "verbose_name_plural": "Core facilities",
+                "ordering": ["name"],
             },
         ),
         migrations.CreateModel(
-            name='CustomCharge',
+            name="CustomCharge",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The name of this custom charge.', max_length=255)),
-                ('additional_details', models.CharField(blank=True, help_text='Additional details for this charge.', max_length=255, null=True)),
-                ('date', models.DateTimeField(help_text='The date of the custom charge.')),
-                ('amount', models.DecimalField(decimal_places=2, max_digits=8, help_text='The amount of the charge. Use a negative amount for adjustments.')),
-                ('core_facility', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='NEMO_billing.CoreFacility')),
-                ('creator', models.ForeignKey(help_text='The person who created this charge.', on_delete=django.db.models.deletion.CASCADE, related_name='custom_charge_creator', to=settings.AUTH_USER_MODEL)),
-                ('customer', models.ForeignKey(help_text='The customer to charge.', on_delete=django.db.models.deletion.CASCADE, related_name='custom_charge_customer', to=settings.AUTH_USER_MODEL)),
-                ('project', models.ForeignKey(help_text='The project to bill for this charge.', on_delete=django.db.models.deletion.CASCADE, to='NEMO.Project')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The name of this custom charge.", max_length=255)),
+                (
+                    "additional_details",
+                    models.CharField(
+                        blank=True, help_text="Additional details for this charge.", max_length=255, null=True
+                    ),
+                ),
+                ("date", models.DateTimeField(help_text="The date of the custom charge.")),
+                (
+                    "amount",
+                    models.DecimalField(
+                        decimal_places=2,
+                        max_digits=8,
+                        help_text="The amount of the charge. Use a negative amount for adjustments.",
+                    ),
+                ),
+                (
+                    "core_facility",
+                    models.ForeignKey(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.SET_NULL,
+                        to="NEMO_billing.CoreFacility",
+                    ),
+                ),
+                (
+                    "creator",
+                    models.ForeignKey(
+                        help_text="The person who created this charge.",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        related_name="custom_charge_creator",
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                (
+                    "customer",
+                    models.ForeignKey(
+                        help_text="The customer to charge.",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        related_name="custom_charge_customer",
+                        to=settings.AUTH_USER_MODEL,
+                    ),
+                ),
+                (
+                    "project",
+                    models.ForeignKey(
+                        help_text="The project to bill for this charge.",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="NEMO.Project",
+                    ),
+                ),
             ],
         ),
         migrations.CreateModel(
-            name='CoreRelationship',
+            name="CoreRelationship",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('area', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='core_rel', to='NEMO.Area')),
-                ('consumable', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='core_rel', to='NEMO.Consumable')),
-                ('core_facility', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='NEMO_billing.CoreFacility')),
-                ('tool', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='core_rel', to='NEMO.Tool')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "area",
+                    models.OneToOneField(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        related_name="core_rel",
+                        to="NEMO.Area",
+                    ),
+                ),
+                (
+                    "consumable",
+                    models.OneToOneField(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        related_name="core_rel",
+                        to="NEMO.Consumable",
+                    ),
+                ),
+                (
+                    "core_facility",
+                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="NEMO_billing.CoreFacility"),
+                ),
+                (
+                    "tool",
+                    models.OneToOneField(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        related_name="core_rel",
+                        to="NEMO.Tool",
+                    ),
+                ),
             ],
         ),
     ]
```

## NEMO_billing/migrations/0002_version_1_2_0.py

```diff
@@ -1,20 +1,26 @@
 # Generated by Django 2.2.20 on 2021-04-22 12:21
 
-from django.db import migrations, models
 import django.db.models.deletion
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO', '0027_version_3_8_0'),
-        ('NEMO_billing', '0001_initial'),
+        ("NEMO", "0027_version_3_8_0"),
+        ("NEMO_billing", "0001_initial"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='corerelationship',
-            name='staff_charge',
-            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='core_rel', to='NEMO.StaffCharge'),
+            model_name="corerelationship",
+            name="staff_charge",
+            field=models.OneToOneField(
+                blank=True,
+                null=True,
+                on_delete=django.db.models.deletion.CASCADE,
+                related_name="core_rel",
+                to="NEMO.StaffCharge",
+            ),
         ),
     ]
```

## NEMO_billing/migrations/0003_version_2_0_0.py

```diff
@@ -2,17 +2,17 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0002_version_1_2_0'),
+        ("NEMO_billing", "0002_version_1_2_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='customcharge',
-            name='cap_eligible',
-            field=models.BooleanField(default=False, help_text='Check this box to make this charge count towards CAP'),
+            model_name="customcharge",
+            name="cap_eligible",
+            field=models.BooleanField(default=False, help_text="Check this box to make this charge count towards CAP"),
         ),
     ]
```

## NEMO_billing/migrations/0004_version_2_4_0.py

```diff
@@ -1,52 +1,329 @@
 # Generated by Django 3.2.19 on 2023-06-04 18:51
 
-from django.db import migrations, models
 import django.db.models.deletion
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0003_version_2_0_0'),
+        ("NEMO_billing", "0003_version_2_0_0"),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='Department',
+            name="Department",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The unique name for this item', max_length=200, unique=True)),
-                ('display_order', models.IntegerField(help_text='The display order is used to sort these items. The lowest value category is displayed first.')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The unique name for this item", max_length=200, unique=True)),
+                (
+                    "display_order",
+                    models.IntegerField(
+                        help_text="The display order is used to sort these items. The lowest value category is displayed first."
+                    ),
+                ),
             ],
             options={
-                'ordering': ['display_order', 'name'],
-                'abstract': False,
+                "ordering": ["display_order", "name"],
+                "abstract": False,
             },
         ),
         migrations.CreateModel(
-            name='InstitutionType',
+            name="InstitutionType",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The unique name for this item', max_length=200, unique=True)),
-                ('display_order', models.IntegerField(help_text='The display order is used to sort these items. The lowest value category is displayed first.')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The unique name for this item", max_length=200, unique=True)),
+                (
+                    "display_order",
+                    models.IntegerField(
+                        help_text="The display order is used to sort these items. The lowest value category is displayed first."
+                    ),
+                ),
             ],
             options={
-                'ordering': ['display_order', 'name'],
-                'abstract': False,
+                "ordering": ["display_order", "name"],
+                "abstract": False,
             },
         ),
         migrations.CreateModel(
-            name='Institution',
+            name="Institution",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The unique name for this institution', max_length=255, unique=True)),
-                ('state', models.CharField(blank=True, max_length=100, null=True)),
-                ('country', models.CharField(choices=[('AF', 'Afghanistan'), ('AL', 'Albania'), ('DZ', 'Algeria'), ('AD', 'Andorra'), ('AO', 'Angola'), ('AI', 'Anguilla'), ('AQ', 'Antarctica'), ('AG', 'Antigua & Barbuda'), ('AR', 'Argentina'), ('AM', 'Armenia'), ('AW', 'Aruba'), ('AU', 'Australia'), ('AT', 'Austria'), ('AZ', 'Azerbaijan'), ('BS', 'Bahamas'), ('BH', 'Bahrain'), ('BD', 'Bangladesh'), ('BB', 'Barbados'), ('BY', 'Belarus'), ('BE', 'Belgium'), ('BZ', 'Belize'), ('BJ', 'Benin'), ('BM', 'Bermuda'), ('BT', 'Bhutan'), ('BO', 'Bolivia'), ('BA', 'Bosnia & Herzegovina'), ('BW', 'Botswana'), ('BV', 'Bouvet Island'), ('BR', 'Brazil'), ('GB', 'Britain (UK)'), ('IO', 'British Indian Ocean Territory'), ('BN', 'Brunei'), ('BG', 'Bulgaria'), ('BF', 'Burkina Faso'), ('BI', 'Burundi'), ('KH', 'Cambodia'), ('CM', 'Cameroon'), ('CA', 'Canada'), ('CV', 'Cape Verde'), ('BQ', 'Caribbean NL'), ('KY', 'Cayman Islands'), ('CF', 'Central African Rep.'), ('TD', 'Chad'), ('CL', 'Chile'), ('CN', 'China'), ('CX', 'Christmas Island'), ('CC', 'Cocos (Keeling) Islands'), ('CO', 'Colombia'), ('KM', 'Comoros'), ('CD', 'Congo (Dem. Rep.)'), ('CG', 'Congo (Rep.)'), ('CK', 'Cook Islands'), ('CR', 'Costa Rica'), ('HR', 'Croatia'), ('CU', 'Cuba'), ('CW', 'Curaao'), ('CY', 'Cyprus'), ('CZ', 'Czech Republic'), ('CI', "Cte d'Ivoire"), ('DK', 'Denmark'), ('DJ', 'Djibouti'), ('DM', 'Dominica'), ('DO', 'Dominican Republic'), ('TL', 'East Timor'), ('EC', 'Ecuador'), ('EG', 'Egypt'), ('SV', 'El Salvador'), ('GQ', 'Equatorial Guinea'), ('ER', 'Eritrea'), ('EE', 'Estonia'), ('SZ', 'Eswatini (Swaziland)'), ('ET', 'Ethiopia'), ('FK', 'Falkland Islands'), ('FO', 'Faroe Islands'), ('FJ', 'Fiji'), ('FI', 'Finland'), ('FR', 'France'), ('GF', 'French Guiana'), ('PF', 'French Polynesia'), ('TF', 'French S. Terr.'), ('GA', 'Gabon'), ('GM', 'Gambia'), ('GE', 'Georgia'), ('DE', 'Germany'), ('GH', 'Ghana'), ('GI', 'Gibraltar'), ('GR', 'Greece'), ('GL', 'Greenland'), ('GD', 'Grenada'), ('GP', 'Guadeloupe'), ('GU', 'Guam'), ('GT', 'Guatemala'), ('GG', 'Guernsey'), ('GN', 'Guinea'), ('GW', 'Guinea-Bissau'), ('GY', 'Guyana'), ('HT', 'Haiti'), ('HM', 'Heard Island & McDonald Islands'), ('HN', 'Honduras'), ('HK', 'Hong Kong'), ('HU', 'Hungary'), ('IS', 'Iceland'), ('IN', 'India'), ('ID', 'Indonesia'), ('IR', 'Iran'), ('IQ', 'Iraq'), ('IE', 'Ireland'), ('IM', 'Isle of Man'), ('IL', 'Israel'), ('IT', 'Italy'), ('JM', 'Jamaica'), ('JP', 'Japan'), ('JE', 'Jersey'), ('JO', 'Jordan'), ('KZ', 'Kazakhstan'), ('KE', 'Kenya'), ('KI', 'Kiribati'), ('KP', 'Korea (North)'), ('KR', 'Korea (South)'), ('KW', 'Kuwait'), ('KG', 'Kyrgyzstan'), ('LA', 'Laos'), ('LV', 'Latvia'), ('LB', 'Lebanon'), ('LS', 'Lesotho'), ('LR', 'Liberia'), ('LY', 'Libya'), ('LI', 'Liechtenstein'), ('LT', 'Lithuania'), ('LU', 'Luxembourg'), ('MO', 'Macau'), ('MG', 'Madagascar'), ('MW', 'Malawi'), ('MY', 'Malaysia'), ('MV', 'Maldives'), ('ML', 'Mali'), ('MT', 'Malta'), ('MH', 'Marshall Islands'), ('MQ', 'Martinique'), ('MR', 'Mauritania'), ('MU', 'Mauritius'), ('YT', 'Mayotte'), ('MX', 'Mexico'), ('FM', 'Micronesia'), ('MD', 'Moldova'), ('MC', 'Monaco'), ('MN', 'Mongolia'), ('ME', 'Montenegro'), ('MS', 'Montserrat'), ('MA', 'Morocco'), ('MZ', 'Mozambique'), ('MM', 'Myanmar (Burma)'), ('NA', 'Namibia'), ('NR', 'Nauru'), ('NP', 'Nepal'), ('NL', 'Netherlands'), ('NC', 'New Caledonia'), ('NZ', 'New Zealand'), ('NI', 'Nicaragua'), ('NE', 'Niger'), ('NG', 'Nigeria'), ('NU', 'Niue'), ('NF', 'Norfolk Island'), ('MK', 'North Macedonia'), ('MP', 'Northern Mariana Islands'), ('NO', 'Norway'), ('OM', 'Oman'), ('PK', 'Pakistan'), ('PW', 'Palau'), ('PS', 'Palestine'), ('PA', 'Panama'), ('PG', 'Papua New Guinea'), ('PY', 'Paraguay'), ('PE', 'Peru'), ('PH', 'Philippines'), ('PN', 'Pitcairn'), ('PL', 'Poland'), ('PT', 'Portugal'), ('PR', 'Puerto Rico'), ('QA', 'Qatar'), ('RO', 'Romania'), ('RU', 'Russia'), ('RW', 'Rwanda'), ('RE', 'Runion'), ('AS', 'Samoa (American)'), ('WS', 'Samoa (western)'), ('SM', 'San Marino'), ('ST', 'Sao Tome & Principe'), ('SA', 'Saudi Arabia'), ('SN', 'Senegal'), ('RS', 'Serbia'), ('SC', 'Seychelles'), ('SL', 'Sierra Leone'), ('SG', 'Singapore'), ('SK', 'Slovakia'), ('SI', 'Slovenia'), ('SB', 'Solomon Islands'), ('SO', 'Somalia'), ('ZA', 'South Africa'), ('GS', 'South Georgia & the South Sandwich Islands'), ('SS', 'South Sudan'), ('ES', 'Spain'), ('LK', 'Sri Lanka'), ('BL', 'St Barthelemy'), ('SH', 'St Helena'), ('KN', 'St Kitts & Nevis'), ('LC', 'St Lucia'), ('SX', 'St Maarten (Dutch)'), ('MF', 'St Martin (French)'), ('PM', 'St Pierre & Miquelon'), ('VC', 'St Vincent'), ('SD', 'Sudan'), ('SR', 'Suriname'), ('SJ', 'Svalbard & Jan Mayen'), ('SE', 'Sweden'), ('CH', 'Switzerland'), ('SY', 'Syria'), ('TW', 'Taiwan'), ('TJ', 'Tajikistan'), ('TZ', 'Tanzania'), ('TH', 'Thailand'), ('TG', 'Togo'), ('TK', 'Tokelau'), ('TO', 'Tonga'), ('TT', 'Trinidad & Tobago'), ('TN', 'Tunisia'), ('TR', 'Turkey'), ('TM', 'Turkmenistan'), ('TC', 'Turks & Caicos Is'), ('TV', 'Tuvalu'), ('UM', 'US minor outlying islands'), ('UG', 'Uganda'), ('UA', 'Ukraine'), ('AE', 'United Arab Emirates'), ('US', 'United States'), ('UY', 'Uruguay'), ('UZ', 'Uzbekistan'), ('VU', 'Vanuatu'), ('VA', 'Vatican City'), ('VE', 'Venezuela'), ('VN', 'Vietnam'), ('VG', 'Virgin Islands (UK)'), ('VI', 'Virgin Islands (US)'), ('WF', 'Wallis & Futuna'), ('EH', 'Western Sahara'), ('YE', 'Yemen'), ('ZM', 'Zambia'), ('ZW', 'Zimbabwe'), ('AX', 'land Islands')], max_length=2)),
-                ('zip_code', models.CharField(blank=True, max_length=12, null=True)),
-                ('institution_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='NEMO_billing.institutiontype')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "name",
+                    models.CharField(help_text="The unique name for this institution", max_length=255, unique=True),
+                ),
+                ("state", models.CharField(blank=True, max_length=100, null=True)),
+                (
+                    "country",
+                    models.CharField(
+                        choices=[
+                            ("AF", "Afghanistan"),
+                            ("AL", "Albania"),
+                            ("DZ", "Algeria"),
+                            ("AD", "Andorra"),
+                            ("AO", "Angola"),
+                            ("AI", "Anguilla"),
+                            ("AQ", "Antarctica"),
+                            ("AG", "Antigua & Barbuda"),
+                            ("AR", "Argentina"),
+                            ("AM", "Armenia"),
+                            ("AW", "Aruba"),
+                            ("AU", "Australia"),
+                            ("AT", "Austria"),
+                            ("AZ", "Azerbaijan"),
+                            ("BS", "Bahamas"),
+                            ("BH", "Bahrain"),
+                            ("BD", "Bangladesh"),
+                            ("BB", "Barbados"),
+                            ("BY", "Belarus"),
+                            ("BE", "Belgium"),
+                            ("BZ", "Belize"),
+                            ("BJ", "Benin"),
+                            ("BM", "Bermuda"),
+                            ("BT", "Bhutan"),
+                            ("BO", "Bolivia"),
+                            ("BA", "Bosnia & Herzegovina"),
+                            ("BW", "Botswana"),
+                            ("BV", "Bouvet Island"),
+                            ("BR", "Brazil"),
+                            ("GB", "Britain (UK)"),
+                            ("IO", "British Indian Ocean Territory"),
+                            ("BN", "Brunei"),
+                            ("BG", "Bulgaria"),
+                            ("BF", "Burkina Faso"),
+                            ("BI", "Burundi"),
+                            ("KH", "Cambodia"),
+                            ("CM", "Cameroon"),
+                            ("CA", "Canada"),
+                            ("CV", "Cape Verde"),
+                            ("BQ", "Caribbean NL"),
+                            ("KY", "Cayman Islands"),
+                            ("CF", "Central African Rep."),
+                            ("TD", "Chad"),
+                            ("CL", "Chile"),
+                            ("CN", "China"),
+                            ("CX", "Christmas Island"),
+                            ("CC", "Cocos (Keeling) Islands"),
+                            ("CO", "Colombia"),
+                            ("KM", "Comoros"),
+                            ("CD", "Congo (Dem. Rep.)"),
+                            ("CG", "Congo (Rep.)"),
+                            ("CK", "Cook Islands"),
+                            ("CR", "Costa Rica"),
+                            ("HR", "Croatia"),
+                            ("CU", "Cuba"),
+                            ("CW", "Curaao"),
+                            ("CY", "Cyprus"),
+                            ("CZ", "Czech Republic"),
+                            ("CI", "Cte d'Ivoire"),
+                            ("DK", "Denmark"),
+                            ("DJ", "Djibouti"),
+                            ("DM", "Dominica"),
+                            ("DO", "Dominican Republic"),
+                            ("TL", "East Timor"),
+                            ("EC", "Ecuador"),
+                            ("EG", "Egypt"),
+                            ("SV", "El Salvador"),
+                            ("GQ", "Equatorial Guinea"),
+                            ("ER", "Eritrea"),
+                            ("EE", "Estonia"),
+                            ("SZ", "Eswatini (Swaziland)"),
+                            ("ET", "Ethiopia"),
+                            ("FK", "Falkland Islands"),
+                            ("FO", "Faroe Islands"),
+                            ("FJ", "Fiji"),
+                            ("FI", "Finland"),
+                            ("FR", "France"),
+                            ("GF", "French Guiana"),
+                            ("PF", "French Polynesia"),
+                            ("TF", "French S. Terr."),
+                            ("GA", "Gabon"),
+                            ("GM", "Gambia"),
+                            ("GE", "Georgia"),
+                            ("DE", "Germany"),
+                            ("GH", "Ghana"),
+                            ("GI", "Gibraltar"),
+                            ("GR", "Greece"),
+                            ("GL", "Greenland"),
+                            ("GD", "Grenada"),
+                            ("GP", "Guadeloupe"),
+                            ("GU", "Guam"),
+                            ("GT", "Guatemala"),
+                            ("GG", "Guernsey"),
+                            ("GN", "Guinea"),
+                            ("GW", "Guinea-Bissau"),
+                            ("GY", "Guyana"),
+                            ("HT", "Haiti"),
+                            ("HM", "Heard Island & McDonald Islands"),
+                            ("HN", "Honduras"),
+                            ("HK", "Hong Kong"),
+                            ("HU", "Hungary"),
+                            ("IS", "Iceland"),
+                            ("IN", "India"),
+                            ("ID", "Indonesia"),
+                            ("IR", "Iran"),
+                            ("IQ", "Iraq"),
+                            ("IE", "Ireland"),
+                            ("IM", "Isle of Man"),
+                            ("IL", "Israel"),
+                            ("IT", "Italy"),
+                            ("JM", "Jamaica"),
+                            ("JP", "Japan"),
+                            ("JE", "Jersey"),
+                            ("JO", "Jordan"),
+                            ("KZ", "Kazakhstan"),
+                            ("KE", "Kenya"),
+                            ("KI", "Kiribati"),
+                            ("KP", "Korea (North)"),
+                            ("KR", "Korea (South)"),
+                            ("KW", "Kuwait"),
+                            ("KG", "Kyrgyzstan"),
+                            ("LA", "Laos"),
+                            ("LV", "Latvia"),
+                            ("LB", "Lebanon"),
+                            ("LS", "Lesotho"),
+                            ("LR", "Liberia"),
+                            ("LY", "Libya"),
+                            ("LI", "Liechtenstein"),
+                            ("LT", "Lithuania"),
+                            ("LU", "Luxembourg"),
+                            ("MO", "Macau"),
+                            ("MG", "Madagascar"),
+                            ("MW", "Malawi"),
+                            ("MY", "Malaysia"),
+                            ("MV", "Maldives"),
+                            ("ML", "Mali"),
+                            ("MT", "Malta"),
+                            ("MH", "Marshall Islands"),
+                            ("MQ", "Martinique"),
+                            ("MR", "Mauritania"),
+                            ("MU", "Mauritius"),
+                            ("YT", "Mayotte"),
+                            ("MX", "Mexico"),
+                            ("FM", "Micronesia"),
+                            ("MD", "Moldova"),
+                            ("MC", "Monaco"),
+                            ("MN", "Mongolia"),
+                            ("ME", "Montenegro"),
+                            ("MS", "Montserrat"),
+                            ("MA", "Morocco"),
+                            ("MZ", "Mozambique"),
+                            ("MM", "Myanmar (Burma)"),
+                            ("NA", "Namibia"),
+                            ("NR", "Nauru"),
+                            ("NP", "Nepal"),
+                            ("NL", "Netherlands"),
+                            ("NC", "New Caledonia"),
+                            ("NZ", "New Zealand"),
+                            ("NI", "Nicaragua"),
+                            ("NE", "Niger"),
+                            ("NG", "Nigeria"),
+                            ("NU", "Niue"),
+                            ("NF", "Norfolk Island"),
+                            ("MK", "North Macedonia"),
+                            ("MP", "Northern Mariana Islands"),
+                            ("NO", "Norway"),
+                            ("OM", "Oman"),
+                            ("PK", "Pakistan"),
+                            ("PW", "Palau"),
+                            ("PS", "Palestine"),
+                            ("PA", "Panama"),
+                            ("PG", "Papua New Guinea"),
+                            ("PY", "Paraguay"),
+                            ("PE", "Peru"),
+                            ("PH", "Philippines"),
+                            ("PN", "Pitcairn"),
+                            ("PL", "Poland"),
+                            ("PT", "Portugal"),
+                            ("PR", "Puerto Rico"),
+                            ("QA", "Qatar"),
+                            ("RO", "Romania"),
+                            ("RU", "Russia"),
+                            ("RW", "Rwanda"),
+                            ("RE", "Runion"),
+                            ("AS", "Samoa (American)"),
+                            ("WS", "Samoa (western)"),
+                            ("SM", "San Marino"),
+                            ("ST", "Sao Tome & Principe"),
+                            ("SA", "Saudi Arabia"),
+                            ("SN", "Senegal"),
+                            ("RS", "Serbia"),
+                            ("SC", "Seychelles"),
+                            ("SL", "Sierra Leone"),
+                            ("SG", "Singapore"),
+                            ("SK", "Slovakia"),
+                            ("SI", "Slovenia"),
+                            ("SB", "Solomon Islands"),
+                            ("SO", "Somalia"),
+                            ("ZA", "South Africa"),
+                            ("GS", "South Georgia & the South Sandwich Islands"),
+                            ("SS", "South Sudan"),
+                            ("ES", "Spain"),
+                            ("LK", "Sri Lanka"),
+                            ("BL", "St Barthelemy"),
+                            ("SH", "St Helena"),
+                            ("KN", "St Kitts & Nevis"),
+                            ("LC", "St Lucia"),
+                            ("SX", "St Maarten (Dutch)"),
+                            ("MF", "St Martin (French)"),
+                            ("PM", "St Pierre & Miquelon"),
+                            ("VC", "St Vincent"),
+                            ("SD", "Sudan"),
+                            ("SR", "Suriname"),
+                            ("SJ", "Svalbard & Jan Mayen"),
+                            ("SE", "Sweden"),
+                            ("CH", "Switzerland"),
+                            ("SY", "Syria"),
+                            ("TW", "Taiwan"),
+                            ("TJ", "Tajikistan"),
+                            ("TZ", "Tanzania"),
+                            ("TH", "Thailand"),
+                            ("TG", "Togo"),
+                            ("TK", "Tokelau"),
+                            ("TO", "Tonga"),
+                            ("TT", "Trinidad & Tobago"),
+                            ("TN", "Tunisia"),
+                            ("TR", "Turkey"),
+                            ("TM", "Turkmenistan"),
+                            ("TC", "Turks & Caicos Is"),
+                            ("TV", "Tuvalu"),
+                            ("UM", "US minor outlying islands"),
+                            ("UG", "Uganda"),
+                            ("UA", "Ukraine"),
+                            ("AE", "United Arab Emirates"),
+                            ("US", "United States"),
+                            ("UY", "Uruguay"),
+                            ("UZ", "Uzbekistan"),
+                            ("VU", "Vanuatu"),
+                            ("VA", "Vatican City"),
+                            ("VE", "Venezuela"),
+                            ("VN", "Vietnam"),
+                            ("VG", "Virgin Islands (UK)"),
+                            ("VI", "Virgin Islands (US)"),
+                            ("WF", "Wallis & Futuna"),
+                            ("EH", "Western Sahara"),
+                            ("YE", "Yemen"),
+                            ("ZM", "Zambia"),
+                            ("ZW", "Zimbabwe"),
+                            ("AX", "land Islands"),
+                        ],
+                        max_length=2,
+                    ),
+                ),
+                ("zip_code", models.CharField(blank=True, max_length=12, null=True)),
+                (
+                    "institution_type",
+                    models.ForeignKey(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.SET_NULL,
+                        to="NEMO_billing.institutiontype",
+                    ),
+                ),
             ],
             options={
-                'abstract': False,
+                "abstract": False,
             },
         ),
     ]
```

## NEMO_billing/migrations/0005_version_2_5_6.py

```diff
@@ -2,16 +2,16 @@
 
 from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('NEMO_billing', '0004_version_2_4_0'),
+        ("NEMO_billing", "0004_version_2_4_0"),
     ]
 
     operations = [
         migrations.AlterModelOptions(
-            name='institution',
-            options={'ordering': ['name']},
+            name="institution",
+            options={"ordering": ["name"]},
         ),
     ]
```

## NEMO_billing/prepayments/policy.py

```diff
@@ -81,15 +81,15 @@
     def check_billing_to_project(
         self,
         project: Project,
         user: User,
         item: Union[Tool, Area, Consumable, StaffCharge] = None,
         charge: Union[UsageEvent, AreaAccessRecord, ConsumableWithdraw, StaffCharge, Reservation] = None,
         *args,
-        **kwargs
+        **kwargs,
     ):
         super().check_billing_to_project(project, user, item, charge, *args, **kwargs)
         if hasattr(project, "projectprepaymentdetail"):
             if isinstance(item, StaffCharge):
                 self.check_project_prepayment_charge(project, BillableItemType.STAFF_CHARGE)
             self.check_prepayment_allowed_for_core_facility(project, item)
             self.check_prepayment_status_for_project(project)
```

## NEMO_billing/prepayments/migrations/0001_initial.py

```diff
@@ -8,60 +8,173 @@
 
 
 class Migration(migrations.Migration):
 
     initial = True
 
     dependencies = [
-        ('NEMO', '0045_version_4_5_5'),
-        ('NEMO_billing', '0004_version_2_4_0'),
+        ("NEMO", "0045_version_4_5_5"),
+        ("NEMO_billing", "0004_version_2_4_0"),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='FundType',
+            name="FundType",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The unique name for this item', max_length=200, unique=True)),
-                ('display_order', models.IntegerField(help_text='The display order is used to sort these items. The lowest value category is displayed first.')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The unique name for this item", max_length=200, unique=True)),
+                (
+                    "display_order",
+                    models.IntegerField(
+                        help_text="The display order is used to sort these items. The lowest value category is displayed first."
+                    ),
+                ),
             ],
             options={
-                'ordering': ['display_order', 'name'],
-                'abstract': False,
+                "ordering": ["display_order", "name"],
+                "abstract": False,
             },
         ),
         migrations.CreateModel(
-            name='ProjectPrepaymentDetail',
+            name="ProjectPrepaymentDetail",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('charge_types', models.CharField(help_text='List of charge types allowed', max_length=100, validators=[django.core.validators.RegexValidator(re.compile('^\\d+(?:,\\d+)*\\Z'), code='invalid', message='Enter only digits separated by commas.')])),
-                ('balance_last_updated', models.DateField(blank=True)),
-                ('only_core_facilities', models.ManyToManyField(blank=True, help_text='Limit which core facilities are allowed for this project. Leave blank to allow them all', to='NEMO_billing.CoreFacility')),
-                ('configuration', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='invoices.invoiceconfiguration')),
-                ('project', models.OneToOneField(help_text='The project', on_delete=django.db.models.deletion.CASCADE, to='NEMO.project', verbose_name='Project')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "charge_types",
+                    models.CharField(
+                        help_text="List of charge types allowed",
+                        max_length=100,
+                        validators=[
+                            django.core.validators.RegexValidator(
+                                re.compile("^\\d+(?:,\\d+)*\\Z"),
+                                code="invalid",
+                                message="Enter only digits separated by commas.",
+                            )
+                        ],
+                    ),
+                ),
+                ("balance_last_updated", models.DateField(blank=True)),
+                (
+                    "only_core_facilities",
+                    models.ManyToManyField(
+                        blank=True,
+                        help_text="Limit which core facilities are allowed for this project. Leave blank to allow them all",
+                        to="NEMO_billing.CoreFacility",
+                    ),
+                ),
+                (
+                    "configuration",
+                    models.ForeignKey(
+                        blank=True,
+                        null=True,
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="invoices.invoiceconfiguration",
+                    ),
+                ),
+                (
+                    "project",
+                    models.OneToOneField(
+                        help_text="The project",
+                        on_delete=django.db.models.deletion.CASCADE,
+                        to="NEMO.project",
+                        verbose_name="Project",
+                    ),
+                ),
             ],
             options={
-                'ordering': ['project'],
+                "ordering": ["project"],
             },
         ),
         migrations.CreateModel(
-            name='Fund',
+            name="Fund",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('reference', models.CharField(blank=True, max_length=255, null=True)),
-                ('amount', models.DecimalField(decimal_places=2, max_digits=14)),
-                ('start_month', models.PositiveIntegerField(choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')])),
-                ('start_year', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1900), django.core.validators.MaxValueValidator(9999)])),
-                ('expiration_month', models.PositiveIntegerField(blank=True, choices=[(1, 'JANUARY'), (2, 'FEBRUARY'), (3, 'MARCH'), (4, 'APRIL'), (5, 'MAY'), (6, 'JUNE'), (7, 'JULY'), (8, 'AUGUST'), (9, 'SEPTEMBER'), (10, 'OCTOBER'), (11, 'NOVEMBER'), (12, 'DECEMBER')], null=True)),
-                ('expiration_year', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1900), django.core.validators.MaxValueValidator(9999)])),
-                ('balance', models.DecimalField(blank=True, decimal_places=2, max_digits=14)),
-                ('balance_warning_percent', models.PositiveIntegerField(blank=True, help_text='Send a warning email when the balance is below this percent.', null=True, validators=[django.core.validators.MaxValueValidator(100)])),
-                ('balance_warning_sent', models.DateTimeField(blank=True, null=True)),
-                ('note', models.CharField(blank=True, max_length=255, null=True)),
-                ('fund_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='prepayments.fundtype')),
-                ('project_prepayment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='prepayments.projectprepaymentdetail')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("reference", models.CharField(blank=True, max_length=255, null=True)),
+                ("amount", models.DecimalField(decimal_places=2, max_digits=14)),
+                (
+                    "start_month",
+                    models.PositiveIntegerField(
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ]
+                    ),
+                ),
+                (
+                    "start_year",
+                    models.PositiveIntegerField(
+                        validators=[
+                            django.core.validators.MinValueValidator(1900),
+                            django.core.validators.MaxValueValidator(9999),
+                        ]
+                    ),
+                ),
+                (
+                    "expiration_month",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        choices=[
+                            (1, "JANUARY"),
+                            (2, "FEBRUARY"),
+                            (3, "MARCH"),
+                            (4, "APRIL"),
+                            (5, "MAY"),
+                            (6, "JUNE"),
+                            (7, "JULY"),
+                            (8, "AUGUST"),
+                            (9, "SEPTEMBER"),
+                            (10, "OCTOBER"),
+                            (11, "NOVEMBER"),
+                            (12, "DECEMBER"),
+                        ],
+                        null=True,
+                    ),
+                ),
+                (
+                    "expiration_year",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        null=True,
+                        validators=[
+                            django.core.validators.MinValueValidator(1900),
+                            django.core.validators.MaxValueValidator(9999),
+                        ],
+                    ),
+                ),
+                ("balance", models.DecimalField(blank=True, decimal_places=2, max_digits=14)),
+                (
+                    "balance_warning_percent",
+                    models.PositiveIntegerField(
+                        blank=True,
+                        help_text="Send a warning email when the balance is below this percent.",
+                        null=True,
+                        validators=[django.core.validators.MaxValueValidator(100)],
+                    ),
+                ),
+                ("balance_warning_sent", models.DateTimeField(blank=True, null=True)),
+                ("note", models.CharField(blank=True, max_length=255, null=True)),
+                (
+                    "fund_type",
+                    models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to="prepayments.fundtype"),
+                ),
+                (
+                    "project_prepayment",
+                    models.ForeignKey(
+                        on_delete=django.db.models.deletion.CASCADE, to="prepayments.projectprepaymentdetail"
+                    ),
+                ),
             ],
             options={
-                'abstract': False,
+                "abstract": False,
             },
         ),
     ]
```

## NEMO_billing/prepayments/migrations/0002_projectprepaymentdetail_overdraft_amount_allowed.py

```diff
@@ -2,17 +2,21 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('prepayments', '0001_initial'),
+        ("prepayments", "0001_initial"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='projectprepaymentdetail',
-            name='overdraft_amount_allowed',
-            field=models.PositiveIntegerField(blank=True, help_text='When set, this is the overdraft amount allowed for the project. Only works when there is at least one active fund with a positive balance.', null=True),
+            model_name="projectprepaymentdetail",
+            name="overdraft_amount_allowed",
+            field=models.PositiveIntegerField(
+                blank=True,
+                help_text="When set, this is the overdraft amount allowed for the project. Only works when there is at least one active fund with a positive balance.",
+                null=True,
+            ),
         ),
     ]
```

## NEMO_billing/prepayments/templates/prepayments/prepaid_project_status.html

```diff
@@ -1,20 +1,23 @@
 {% extends 'billing/cap_and_prepaid_base.html' %}
 {% load custom_tags_and_filters %}
 {% block title %}Prepaid project status{% endblock %}
 {% block tab_title %}Prepaid project status{% endblock %}
 {% block before_pagination %}
-	<form class="form-inline" action="{% url 'prepaid_project_status' %}" method="get">
-		<input type="hidden" name="o" value="{{ request.GET.o }}">
-		<label for="start" style="padding: 10px 10px 10px 0">Since</label>
-		<select name="start" id="start" class="form-control" style="margin-right: 5px;text-align-last:center">
-			{% for month in month_list %}
-				<option value="{{ month.date|input_date_format }}" {% if month|date:"F, Y" == start.date|date:"F, Y" %}selected{% endif %}>{{ month|date:"F, Y" }}</option>
-			{% endfor %}
-		</select>
-		{% button type="save" value="Update" %}
-	</form>
+    <form class="form-inline" action="{% url 'prepaid_project_status' %}" method="get">
+        <input type="hidden" name="o" value="{{ request.GET.o }}">
+        <label for="start" style="padding: 10px 10px 10px 0">Since</label>
+        <select name="start" id="start" class="form-control" style="margin-right: 5px;text-align-last:center">
+            {% for month in month_list %}
+                <option value="{{ month.date|input_date_format }}"
+                        {% if month|date:"F, Y" == start.date|date:"F, Y" %}selected{% endif %}>
+                    {{ month|date:"F, Y" }}
+                </option>
+            {% endfor %}
+        </select>
+        {% button type="save" value="Update" %}
+    </form>
 {% endblock %}
 {% block pagination_content %}
-	{% include 'prepayments/prepaid_project_status_table.html' %}
+    {% include 'prepayments/prepaid_project_status_table.html' %}
 {% endblock %}
-{% block table_empty_content %}There are no prepaid projects set{% endblock %}
+{% block table_empty_content %}There are no prepaid projects set{% endblock %}
```

## NEMO_billing/prepayments/templates/prepayments/prepaid_project_status_table.html

```diff
@@ -1,90 +1,109 @@
 {% load custom_tags_and_filters %}
 <table class="table table-bordered table-striped table-align-middle thead-light">
-	<thead>
-		<tr>
-			{% with request_start=request.GET.start request_end=request.GET.end %}
-				{% with extra_params='start='|concat:request_start|concat:'&end='|concat:request_end %}
-					<th>{% include 'pagination/pagination_column.html' with order_by="project" name='Project' %}</th>
-					<th>{% include 'pagination/pagination_column.html' with order_by="project__institution" name='Institution' %}</th>
-					<th>Allowed charges</th>
-					{% if core_facilities_exist %}<th>{% include 'pagination/pagination_column.html' with order_by="only_core_facilities" name='Allowed facilities' %}</th>{% endif %}
-					<th class="text-right">Total active funds</th>
-					<th>{% include 'pagination/pagination_column.html' with order_by="balance_last_updated" name='Updated' %}</th>
-					<th>Balance</th>
-					<th class="text-right">Charges since</th>
-					<th class="text-right">Current balance</th>
-					<th class="text-right button-column-minimum">Charges</th>
-				{% endwith %}
-			{% endwith %}
-		</tr>
-	</thead>
-	<tbody>
-		{% for prepaid_project in page %}
-			<tr>
-				{% if prepaid_project.charges %}
-					<td id="chevron_{{ prepaid_project.id }}" data-toggle="collapse" data-target=".prepaid_project_{{ prepaid_project.id }}" onclick="toggle_details($('#chevron_{{ prepaid_project.id }}'))">
-						<span class="glyphicon glyphicon-chevron-right pull-left chevron"></span>
-						{{ prepaid_project.project }}
-					</td>
-				{% else %}
-					<td>{{ prepaid_project.project }}</td>
-				{% endif %}
-				<td>{{ prepaid_project.project.institution }}</td>
-				<td>{{ prepaid_project.get_charge_types_display }}</td>
-				{% if core_facilities_exist %}<td>{{ prepaid_project.get_only_core_facilities_display }}</td>{% endif %}
-				<td class="text-right">{{ prepaid_project.total_funds|floatformat:2 }}</td>
-				<td class="text-center">{{ prepaid_project.balance_last_updated|date:"SHORT_DATE_FORMAT" }}</td>
-				<td class="text-right">{{ prepaid_project.balance|floatformat:2 }}</td>
-				<td class="text-right">{{ prepaid_project.total_charges_amount|floatformat:2 }}</td>
-				<td class="text-right">{{ prepaid_project.total_funds_left|floatformat:2 }}</td>
-				<td class="text-right">
-					{% if prepaid_project.charges %}
-						<button class="btn btn-sm btn-primary" type="button" onclick="toggle_details($('#chevron_{{ prepaid_project.id }}'))" title="See charges" aria-label="See charges" data-toggle="collapse" data-target=".prepaid_project_{{ prepaid_project.id }}">
-							<i class="glyphicon glyphicon-list"></i> See charges
-						</button>
-					{% endif %}
-				</td>
-			</tr>
-			{% if prepaid_project.charges %}
-				<tr class="collapse prepaid_project_{{ prepaid_project.id }}">
-					<td colspan="{% if core_facilities_exist %}9{% else %}8{% endif %}" style="padding: 0">
-						<table class="table table-bordered table-align-middle table-condensed" style="margin: 0">
-							<thead>
-								<tr>
-									<th class="alert-info">User</th>
-									<th class="alert-info">Item</th>
-									<th class="alert-info">Date</th>
-									<th class="alert-info">Duration</th>
-									<th class="alert-info text-right">Amount</th>
-								</tr>
-							</thead>
-							{% for charge in prepaid_project.charges %}
-								<tr>
-									<td>{{ charge.user }}</td>
-									<td>{{ charge.name }}</td>
-									<td>{{ charge.start|date:"SHORT_DATETIME_FORMAT" }}</td>
-									<td>{{ charge.display_quantity }}</td>
-									<td class="text-right">{{ charge.amount|floatformat:2 }}</td>
-								</tr>
-							{% endfor %}
-							<tr>
-								<td colspan="4" class="text-right">{% if prepaid_project.taxes_amount %}Subtotal{% else %}Total{% endif %}</td>
-								<td class="text-right">{{ prepaid_project.charges_amount|floatformat:2 }}</td>
-							</tr>
-							{% if prepaid_project.taxes_amount %}
-								<tr>
-									<td colspan="4" class="text-right">Taxes</td>
-									<td class="text-right">{{ prepaid_project.taxes_amount|floatformat:2 }}</td>
-								</tr>
-								<tr>
-									<td colspan="4" class="text-right">Total</td>
-									<td class="text-right">{{ prepaid_project.total_charges_amount|floatformat:2 }}</td>
-								</tr>
-							{% endif %}
-						</table>
-					</td>
-				</tr>
-			{% endif %}
-		{% endfor %}
-	</tbody>
-</table>
+    <thead>
+        <tr>
+            {% with request_start=request.GET.start request_end=request.GET.end %}
+                {% with extra_params='start='|concat:request_start|concat:'&end='|concat:request_end %}
+                    <th>{% include 'pagination/pagination_column.html' with order_by="project" name='Project' %}</th>
+                    <th>{% include 'pagination/pagination_column.html' with order_by="project__institution" name='Institution' %}</th>
+                    <th>Allowed charges</th>
+                    {% if core_facilities_exist %}
+                        <th>
+                            {% include 'pagination/pagination_column.html' with order_by="only_core_facilities" name='Allowed facilities' %}
+                        </th>
+                    {% endif %}
+                    <th class="text-right">Total active funds</th>
+                    <th>{% include 'pagination/pagination_column.html' with order_by="balance_last_updated" name='Updated' %}</th>
+                    <th>Balance</th>
+                    <th class="text-right">Charges since</th>
+                    <th class="text-right">Current balance</th>
+                    <th class="text-right button-column-minimum">Charges</th>
+                {% endwith %}
+            {% endwith %}
+        </tr>
+    </thead>
+    <tbody>
+        {% for prepaid_project in page %}
+            <tr>
+                {% if prepaid_project.charges %}
+                    <td id="chevron_{{ prepaid_project.id }}"
+                        data-toggle="collapse"
+                        data-target=".prepaid_project_{{ prepaid_project.id }}"
+                        onclick="toggle_details($('#chevron_{{ prepaid_project.id }}'))">
+                        <span class="glyphicon glyphicon-chevron-right pull-left chevron"></span>
+                        {{ prepaid_project.project }}
+                    </td>
+                {% else %}
+                    <td>{{ prepaid_project.project }}</td>
+                {% endif %}
+                <td>{{ prepaid_project.project.institution }}</td>
+                <td>{{ prepaid_project.get_charge_types_display }}</td>
+                {% if core_facilities_exist %}<td>{{ prepaid_project.get_only_core_facilities_display }}</td>{% endif %}
+                <td class="text-right">{{ prepaid_project.total_funds|floatformat:2 }}</td>
+                <td class="text-center">{{ prepaid_project.balance_last_updated|date:"SHORT_DATE_FORMAT" }}</td>
+                <td class="text-right">{{ prepaid_project.balance|floatformat:2 }}</td>
+                <td class="text-right">{{ prepaid_project.total_charges_amount|floatformat:2 }}</td>
+                <td class="text-right">{{ prepaid_project.total_funds_left|floatformat:2 }}</td>
+                <td class="text-right">
+                    {% if prepaid_project.charges %}
+                        <button class="btn btn-sm btn-primary"
+                                type="button"
+                                onclick="toggle_details($('#chevron_{{ prepaid_project.id }}'))"
+                                title="See charges"
+                                aria-label="See charges"
+                                data-toggle="collapse"
+                                data-target=".prepaid_project_{{ prepaid_project.id }}">
+                            <i class="glyphicon glyphicon-list"></i> See charges
+                        </button>
+                    {% endif %}
+                </td>
+            </tr>
+            {% if prepaid_project.charges %}
+                <tr class="collapse prepaid_project_{{ prepaid_project.id }}">
+                    <td colspan="{% if core_facilities_exist %}9{% else %}8{% endif %}" style="padding: 0">
+                        <table class="table table-bordered table-align-middle table-condensed" style="margin: 0">
+                            <thead>
+                                <tr>
+                                    <th class="alert-info">User</th>
+                                    <th class="alert-info">Item</th>
+                                    <th class="alert-info">Date</th>
+                                    <th class="alert-info">Duration</th>
+                                    <th class="alert-info text-right">Amount</th>
+                                </tr>
+                            </thead>
+                            {% for charge in prepaid_project.charges %}
+                                <tr>
+                                    <td>{{ charge.user }}</td>
+                                    <td>{{ charge.name }}</td>
+                                    <td>{{ charge.start|date:"SHORT_DATETIME_FORMAT" }}</td>
+                                    <td>{{ charge.display_quantity }}</td>
+                                    <td class="text-right">{{ charge.amount|floatformat:2 }}</td>
+                                </tr>
+                            {% endfor %}
+                            <tr>
+                                <td colspan="4" class="text-right">
+                                    {% if prepaid_project.taxes_amount %}
+                                        Subtotal
+                                    {% else %}
+                                        Total
+                                    {% endif %}
+                                </td>
+                                <td class="text-right">{{ prepaid_project.charges_amount|floatformat:2 }}</td>
+                            </tr>
+                            {% if prepaid_project.taxes_amount %}
+                                <tr>
+                                    <td colspan="4" class="text-right">Taxes</td>
+                                    <td class="text-right">{{ prepaid_project.taxes_amount|floatformat:2 }}</td>
+                                </tr>
+                                <tr>
+                                    <td colspan="4" class="text-right">Total</td>
+                                    <td class="text-right">{{ prepaid_project.total_charges_amount|floatformat:2 }}</td>
+                                </tr>
+                            {% endif %}
+                        </table>
+                    </td>
+                </tr>
+            {% endif %}
+        {% endfor %}
+    </tbody>
+</table>
```

### html2text {}

```diff
@@ -8,14 +8,14 @@
                                                                                                                                                           prepaid_project.project.institution prepaid_project.get_charge_types_display prepaid_project.get_only_core_facilities_display prepaid_project.total_funds|floatformat: prepaid_project.balance_last_updated|date: prepaid_project.balance|floatformat: prepaid_project.total_charges_amount|floatformat: prepaid_project.total_funds_left|floatformat: %} See charges {% endif
                                                                                                                                                           }}                                  }}                                       }}                                               2 }}                                     "SHORT_DATE_FORMAT" }}                     2 }}                                 2 }}                                              2 }}                                          %}
 UUsseerr        IItteemm        DDaattee                    DDuurraattiioonn                AAmmoouunntt
 {           {           {{ charge.start|date:   {
 {           {           "SHORT_DATETIME_FORMAT" {                       {{ charge.amount|floatformat:2 }}
 charge.user charge.name }}                      charge.display_quantity
 }}          }}                                  }}
-{% if prepaid_project.taxes_amount %}Subtotal{% else %}Total{% endif %} {{ prepaid_project.charges_amount|floatformat:
-                                                                        2 }}
+{% if prepaid_project.taxes_amount %} Subtotal {% else %} Total {%      {{ prepaid_project.charges_amount|floatformat:
+endif %}                                                                2 }}
 Taxes                                                                   {{ prepaid_project.taxes_amount|floatformat:2 }}
                                                                         {
 Total                                                                   {
                                                                         prepaid_project.total_charges_amount|floatformat:
                                                                         2 }}
```

## NEMO_billing/rates/apps.py

 * *Ordering differences only*

```diff
@@ -15,8 +15,8 @@
     default_auto_field = "django.db.models.AutoField"
 
     def ready(self):
         # Remove the rates customization coming from regular NEMO since we have our own
         from NEMO.views.customization import CustomizationBase
 
         if "rates" in CustomizationBase._instances:
-            del CustomizationBase._instances["rates"]
+            del CustomizationBase._instances["rates"]
```

## NEMO_billing/rates/models.py

```diff
@@ -419,19 +419,15 @@
 
     def display_category_time(self):
         category = self.category.name if self.category else None
         rate_time = self.time.name if self.time else None
         cat_time = (
             [category, rate_time]
             if category and rate_time
-            else [category]
-            if category
-            else [rate_time]
-            if rate_time
-            else []
+            else [category] if category else [rate_time] if rate_time else []
         )
         return f" ({'/'.join(cat_time)})" if cat_time else ""
 
     def __str__(self):
         item_name = f"{self.get_item()} " if self.get_item() else ""
         category = f" ({self.category})" if self.category else ""
         rate_time = f", {self.time}" if self.time else ""
```

## NEMO_billing/rates/migrations/0001_initial.py

```diff
@@ -1,20 +1,23 @@
 # Generated by Django 2.2.13 on 2021-03-01 16:49
 
-from django.conf import settings
-from django.db import migrations, models
 import django.db.models.deletion
 import mptt.fields
+from django.conf import settings
+from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     initial = True
 
-    dependencies = [("NEMO", "0027_version_3_8_0"), migrations.swappable_dependency(settings.AUTH_USER_MODEL),]
+    dependencies = [
+        ("NEMO", "0027_version_3_8_0"),
+        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+    ]
 
     def create_rate_types(apps, schema_editor):
         RateTypeModel = apps.get_model("rates", "RateType")
         if not RateTypeModel.objects.exists():
             RateTypeModel.objects.create(type="TOOL_USAGE", category_specific=True, item_specific=True)
             RateTypeModel.objects.create(type="TOOL_TRAINING_INDIVIDUAL", category_specific=True, item_specific=True)
             RateTypeModel.objects.create(type="TOOL_TRAINING_GROUP", category_specific=True, item_specific=True)
@@ -22,54 +25,132 @@
             RateTypeModel.objects.create(type="AREA_USAGE", category_specific=True, item_specific=True)
             RateTypeModel.objects.create(type="AREA_MISSED_RESERVATION", category_specific=False, item_specific=False)
             RateTypeModel.objects.create(type="CONSUMABLE", category_specific=False, item_specific=True)
             RateTypeModel.objects.create(type="STAFF_CHARGE", category_specific=True, item_specific=False)
 
     operations = [
         migrations.CreateModel(
-            name='RateCategory',
+            name="RateCategory",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(help_text='The name of this rate category', max_length=200)),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(help_text="The name of this rate category", max_length=200)),
             ],
             options={
-                'verbose_name': 'Rate category',
-                'verbose_name_plural': 'Rate categories',
+                "verbose_name": "Rate category",
+                "verbose_name_plural": "Rate categories",
             },
         ),
         migrations.CreateModel(
-            name='RateType',
+            name="RateType",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('type', models.CharField(choices=[('Tool', (('TOOL_USAGE', 'Tool usage'), ('TOOL_TRAINING_INDIVIDUAL', 'Tool individual training'), ('TOOL_TRAINING_GROUP', 'Tool group training'), ('TOOL_MISSED_RESERVATION', 'Tool missed reservation'))), ('Area', (('AREA_USAGE', 'Area usage'), ('AREA_MISSED_RESERVATION', 'Area missed reservation'))), ('CONSUMABLE', 'Consumable/Supply'), ('STAFF_CHARGE', 'Staff charge')], max_length=100)),
-                ('category_specific', models.BooleanField(default=False, help_text='Check this box to make this rate type category specific (i.e. you will need to enter a rate for each category)')),
-                ('item_specific', models.BooleanField(default=False, help_text='Check this box to make this rate type item specific (i.e. you will need to enter a rate for each item)')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "type",
+                    models.CharField(
+                        choices=[
+                            (
+                                "Tool",
+                                (
+                                    ("TOOL_USAGE", "Tool usage"),
+                                    ("TOOL_TRAINING_INDIVIDUAL", "Tool individual training"),
+                                    ("TOOL_TRAINING_GROUP", "Tool group training"),
+                                    ("TOOL_MISSED_RESERVATION", "Tool missed reservation"),
+                                ),
+                            ),
+                            (
+                                "Area",
+                                (("AREA_USAGE", "Area usage"), ("AREA_MISSED_RESERVATION", "Area missed reservation")),
+                            ),
+                            ("CONSUMABLE", "Consumable/Supply"),
+                            ("STAFF_CHARGE", "Staff charge"),
+                        ],
+                        max_length=100,
+                    ),
+                ),
+                (
+                    "category_specific",
+                    models.BooleanField(
+                        default=False,
+                        help_text="Check this box to make this rate type category specific (i.e. you will need to enter a rate for each category)",
+                    ),
+                ),
+                (
+                    "item_specific",
+                    models.BooleanField(
+                        default=False,
+                        help_text="Check this box to make this rate type item specific (i.e. you will need to enter a rate for each item)",
+                    ),
+                ),
             ],
         ),
         migrations.CreateModel(
-            name='RateLog',
+            name="RateLog",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('object_id', models.PositiveIntegerField(null=True)),
-                ('action', models.IntegerField(choices=[(0, 'Add'), (1, 'Delete'), (2, 'Update')])),
-                ('date', models.DateTimeField(auto_now_add=True)),
-                ('details', models.TextField(blank=True, null=True)),
-                ('content_type', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='contenttypes.ContentType')),
-                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("object_id", models.PositiveIntegerField(null=True)),
+                ("action", models.IntegerField(choices=[(0, "Add"), (1, "Delete"), (2, "Update")])),
+                ("date", models.DateTimeField(auto_now_add=True)),
+                ("details", models.TextField(blank=True, null=True)),
+                (
+                    "content_type",
+                    models.ForeignKey(
+                        null=True, on_delete=django.db.models.deletion.SET_NULL, to="contenttypes.ContentType"
+                    ),
+                ),
+                ("user", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
             ],
         ),
         migrations.CreateModel(
-            name='Rate',
+            name="Rate",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('amount', models.DecimalField(decimal_places=2, max_digits=8, help_text="The rate per hour if this isn't a flat rate")),
-                ('flat', models.BooleanField(default=False, help_text='Check this box to make this a flat rate (independent of time)')),
-                ('minimum_charge', models.DecimalField(decimal_places=2, max_digits=8, blank=True, help_text='The minimum charge for this rate', null=True)),
-                ('area', mptt.fields.TreeForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='NEMO.Area')),
-                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='rates.RateCategory')),
-                ('consumable', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='NEMO.Consumable')),
-                ('tool', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='NEMO.Tool')),
-                ('type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='rates.RateType')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "amount",
+                    models.DecimalField(
+                        decimal_places=2, max_digits=8, help_text="The rate per hour if this isn't a flat rate"
+                    ),
+                ),
+                (
+                    "flat",
+                    models.BooleanField(
+                        default=False, help_text="Check this box to make this a flat rate (independent of time)"
+                    ),
+                ),
+                (
+                    "minimum_charge",
+                    models.DecimalField(
+                        decimal_places=2,
+                        max_digits=8,
+                        blank=True,
+                        help_text="The minimum charge for this rate",
+                        null=True,
+                    ),
+                ),
+                (
+                    "area",
+                    mptt.fields.TreeForeignKey(
+                        blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="NEMO.Area"
+                    ),
+                ),
+                (
+                    "category",
+                    models.ForeignKey(
+                        blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="rates.RateCategory"
+                    ),
+                ),
+                (
+                    "consumable",
+                    models.ForeignKey(
+                        blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="NEMO.Consumable"
+                    ),
+                ),
+                (
+                    "tool",
+                    models.ForeignKey(
+                        blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="NEMO.Tool"
+                    ),
+                ),
+                ("type", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="rates.RateType")),
             ],
         ),
         migrations.RunPython(create_rate_types),
     ]
```

## NEMO_billing/rates/migrations/0002_version_1_15_0.py

```diff
@@ -2,18 +2,20 @@
 
 from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('rates', '0001_initial'),
+        ("rates", "0001_initial"),
     ]
 
     def update_missed_reservation_rates(apps, schema_editor):
         RateModel = apps.get_model("rates", "Rate")
         # we previously assumed missed reservation rates were flat. make it explicit now
-        RateModel.objects.filter(type__type__in=["AREA_MISSED_RESERVATION", "TOOL_MISSED_RESERVATION"]).update(flat=True)
+        RateModel.objects.filter(type__type__in=["AREA_MISSED_RESERVATION", "TOOL_MISSED_RESERVATION"]).update(
+            flat=True
+        )
 
     operations = [
         migrations.RunPython(update_missed_reservation_rates),
     ]
```

## NEMO_billing/rates/migrations/0003_version_1_17_0.py

```diff
@@ -3,45 +3,61 @@
 import django.db.models.deletion
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('rates', '0002_version_1_15_0'),
+        ("rates", "0002_version_1_15_0"),
     ]
 
     operations = [
         migrations.CreateModel(
-            name='RateTime',
+            name="RateTime",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('name', models.CharField(max_length=255, unique=True)),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                ("name", models.CharField(max_length=255, unique=True)),
             ],
         ),
         migrations.CreateModel(
-            name='DailySchedule',
+            name="DailySchedule",
             fields=[
-                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('weekday', models.IntegerField(verbose_name="start day", choices=[(0, 'Monday'), (1, 'Tuesday'), (2, 'Wednesday'), (3, 'Thursday'), (4, 'Friday'), (5, 'Saturday'), (6, 'Sunday')])),
-                ('start_time', models.TimeField(blank=True, null=True, help_text='The start time')),
-                ('end_time', models.TimeField(blank=True, null=True, help_text='The end time')),
-                ('rate_time', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='rates.RateTime')),
+                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
+                (
+                    "weekday",
+                    models.IntegerField(
+                        verbose_name="start day",
+                        choices=[
+                            (0, "Monday"),
+                            (1, "Tuesday"),
+                            (2, "Wednesday"),
+                            (3, "Thursday"),
+                            (4, "Friday"),
+                            (5, "Saturday"),
+                            (6, "Sunday"),
+                        ],
+                    ),
+                ),
+                ("start_time", models.TimeField(blank=True, null=True, help_text="The start time")),
+                ("end_time", models.TimeField(blank=True, null=True, help_text="The end time")),
+                ("rate_time", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="rates.RateTime")),
             ],
-            options={'ordering': ('weekday', 'start_time')},
+            options={"ordering": ("weekday", "start_time")},
         ),
         migrations.AddField(
-            model_name='rate',
-            name='time',
-            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='rates.RateTime'),
+            model_name="rate",
+            name="time",
+            field=models.ForeignKey(
+                blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to="rates.RateTime"
+            ),
         ),
         migrations.AddField(
-            model_name='rate',
-            name='deleted',
-            field=models.BooleanField(default=False, help_text='Indicates that this rate was deleted'),
+            model_name="rate",
+            name="deleted",
+            field=models.BooleanField(default=False, help_text="Indicates that this rate was deleted"),
         ),
         migrations.AlterField(
-            model_name='ratecategory',
-            name='name',
-            field=models.CharField(help_text='The name of this rate category', max_length=200, unique=True),
+            model_name="ratecategory",
+            name="name",
+            field=models.CharField(help_text="The name of this rate category", max_length=200, unique=True),
         ),
     ]
```

## NEMO_billing/rates/migrations/0004_version_2_0_0.py

```diff
@@ -2,16 +2,16 @@
 
 from django.db import migrations
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('rates', '0003_version_1_17_0'),
+        ("rates", "0003_version_1_17_0"),
     ]
 
     operations = [
         migrations.AlterModelOptions(
-            name='ratecategory',
-            options={'ordering': ['name'], 'verbose_name': 'Rate category', 'verbose_name_plural': 'Rate categories'},
+            name="ratecategory",
+            options={"ordering": ["name"], "verbose_name": "Rate category", "verbose_name_plural": "Rate categories"},
         ),
     ]
```

## NEMO_billing/rates/migrations/0005_version_2_3_0.py

```diff
@@ -2,17 +2,19 @@
 
 from django.db import migrations, models
 
 
 class Migration(migrations.Migration):
 
     dependencies = [
-        ('rates', '0004_version_2_0_0'),
+        ("rates", "0004_version_2_0_0"),
     ]
 
     operations = [
         migrations.AddField(
-            model_name='rate',
-            name='daily',
-            field=models.BooleanField(default=False, help_text='Check this box to only charge once per day for this item'),
+            model_name="rate",
+            name="daily",
+            field=models.BooleanField(
+                default=False, help_text="Check this box to only charge once per day for this item"
+            ),
         ),
     ]
```

## NEMO_billing/rates/templates/customizations/customizations_billing_rates.html

```diff
@@ -1,119 +1,211 @@
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 <div class="panel-body">
     <h3 class="customization-section-title" id="rate">Rates settings</h3>
     <form method="POST" action="{% url 'customize' 'billing_rates' %}" class="form-horizontal">
         {% csrf_token %}
         <div class="form-group">
-			<label class="control-label col-lg-3 col-md-4">Allow blank rate</label>
+            <label class="control-label col-lg-3 col-md-4">Allow blank rate</label>
             <div class="col-lg-9 col-md-8">
                 <div class="checkbox">
-                    <label><input type="checkbox" name="allow_blank_rate" {% if allow_blank_rate %}checked{% endif %} value="enabled">Allow blank rates for categories</label><br/>
+                    <label>
+                        <input type="checkbox" name="allow_blank_rate" {% if allow_blank_rate %}checked{% endif %} value="enabled">
+                        Allow blank rates for categories
+                    </label>
+                    <br />
                 </div>
             </div>
-			{% cap_discount_installed as cap_discount_installed %}
-			{% if cap_discount_installed %}
-				<label class="control-label col-lg-3 col-md-4">Daily rate</label>
-				<div class="col-lg-9 col-md-8">
-					<div class="radio">
-						<label><input type="radio" name="rates_daily_per_account" {% if not rates_daily_per_account %}checked{% endif %} value="">By project</label>
-						<label><input type="radio" name="rates_daily_per_account" {% if rates_daily_per_account %}checked{% endif %} value="enabled">By account</label>
-					</div>
-				</div>
-			{% endif %}
+            {% cap_discount_installed as cap_discount_installed %}
+            {% if cap_discount_installed %}
+                <label class="control-label col-lg-3 col-md-4">Daily rate</label>
+                <div class="col-lg-9 col-md-8">
+                    <div class="radio">
+                        <label>
+                            <input type="radio"
+                                   name="rates_daily_per_account"
+                                   {% if not rates_daily_per_account %}checked{% endif %}
+                                   value="">
+                            By project
+                        </label>
+                        <label>
+                            <input type="radio"
+                                   name="rates_daily_per_account"
+                                   {% if rates_daily_per_account %}checked{% endif %}
+                                   value="enabled">
+                            By account
+                        </label>
+                    </div>
+                </div>
+            {% endif %}
         </div>
         <div class="customization-separation" style="margin-bottom: 15px"></div>
-		<h3 class="customization-section-title" id="rate">Rates display</h3>
-		<div class="form-group">
-			<label class="control-label col-lg-3 col-md-4">Tool control</label>
-			<div class="col-lg-9 col-md-8">
-				<div class="checkbox">
-					<label><input type="checkbox" name="rates_hide_table" {% if rates_hide_table %}checked{% endif %} value="enabled">Hide rates table</label><br/>
-					<label><input type="checkbox" name="rates_expand_table" {% if rates_expand_table %}checked{% endif %} value="enabled">Expand rates table</label><br/>
-					<label><input type="checkbox" name="rates_show_all_categories" {% if rates_show_all_categories %}checked{% endif %} value="enabled">Check this box to show rates for all rate categories (otherwise only rate categories matching the user's projects are shown)</label><br/>
-				</div>
-			</div>
-			<label class="control-label col-lg-3 col-md-4">Consumable rates</label>
-			<div class="col-lg-9 col-md-8">
-				<div class="checkbox">
-					<label><input type="checkbox" name="rates_hide_consumable_rates" {% if rates_hide_consumable_rates %}checked{% endif %} value="enabled">Hide consumable rates</label><br/>
-				</div>
-			</div>
-			<label class="control-label col-lg-3 col-md-4">Usage charges</label>
-			<div class="col-lg-9 col-md-8">
-				<div class="checkbox">
-					<label><input type="checkbox" name="rates_usage_hide_charges" {% if rates_usage_hide_charges %}checked{% endif %} value="enabled">Hide charges amount in My Usage</label><br/>
-				</div>
-			</div>
-		</div>
+        <h3 class="customization-section-title" id="rate">Rates display</h3>
+        <div class="form-group">
+            <label class="control-label col-lg-3 col-md-4">Tool control</label>
+            <div class="col-lg-9 col-md-8">
+                <div class="checkbox">
+                    <label>
+                        <input type="checkbox" name="rates_hide_table" {% if rates_hide_table %}checked{% endif %} value="enabled">
+                        Hide rates table
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="rates_expand_table"
+                               {% if rates_expand_table %}checked{% endif %}
+                               value="enabled">
+                        Expand rates table
+                    </label>
+                    <br />
+                    <label>
+                        <input type="checkbox"
+                               name="rates_show_all_categories"
+                               {% if rates_show_all_categories %}checked{% endif %}
+                               value="enabled">
+                        Check this box to show rates for all rate categories (otherwise only rate categories matching the user's projects are shown)
+                    </label>
+                    <br />
+                </div>
+            </div>
+            <label class="control-label col-lg-3 col-md-4">Consumable rates</label>
+            <div class="col-lg-9 col-md-8">
+                <div class="checkbox">
+                    <label>
+                        <input type="checkbox"
+                               name="rates_hide_consumable_rates"
+                               {% if rates_hide_consumable_rates %}checked{% endif %}
+                               value="enabled">
+                        Hide consumable rates
+                    </label>
+                    <br />
+                </div>
+            </div>
+            <label class="control-label col-lg-3 col-md-4">Usage charges</label>
+            <div class="col-lg-9 col-md-8">
+                <div class="checkbox">
+                    <label>
+                        <input type="checkbox"
+                               name="rates_usage_hide_charges"
+                               {% if rates_usage_hide_charges %}checked{% endif %}
+                               value="enabled">
+                        Hide charges amount in My Usage
+                    </label>
+                    <br />
+                </div>
+            </div>
+        </div>
         <div class="customization-separation" style="margin-bottom: 15px"></div>
         <h3 class="customization-section-title">Rate list page settings</h3>
-		<div class="form-group">
-			<div class="col-md-offset-1 col-md-9 help-block light-grey">
-				If enabled, the rate list is available at <a target="_blank" href="{% url 'rate_list' %}">{% absolute_url 'rate_list' %}</a>
-			</div>
-		</div>
+        <div class="form-group">
+            <div class="col-md-offset-1 col-md-9 help-block light-grey">
+                If enabled, the rate list is available at <a target="_blank" href="{% url 'rate_list' %}">{% absolute_url 'rate_list' %}</a>
+            </div>
+        </div>
         <div class="form-group">
             <label class="control-label col-lg-3 col-md-4">View permissions</label>
             <div class="col-lg-9 col-md-8 radio">
-                <label><input type="radio" name="rates_rate_list_page_access" {% if not rates_rate_list_page_access %}checked{% endif %} value="">Rate list page is disabled for all users</label>
-			</div>
+                <label>
+                    <input type="radio"
+                           name="rates_rate_list_page_access"
+                           {% if not rates_rate_list_page_access %}checked{% endif %}
+                           value="">
+                    Rate list page is disabled for all users
+                </label>
+            </div>
             <div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 radio">
-                <label><input type="radio" name="rates_rate_list_page_access" {% if rates_rate_list_page_access == "auth"  %}checked{% endif %} value="auth">Rate list page is enabled for authenticated users</label>
-			</div>
+                <label>
+                    <input type="radio"
+                           name="rates_rate_list_page_access"
+                           {% if rates_rate_list_page_access == "auth" %}checked{% endif %}
+                           value="auth">
+                    Rate list page is enabled for authenticated users
+                </label>
+            </div>
             <div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 radio">
-                <label><input type="radio" name="rates_rate_list_page_access" {% if rates_rate_list_page_access == "public"  %}checked{% endif %} value="public">Rate list page is enabled for public users</label>
-			</div>
+                <label>
+                    <input type="radio"
+                           name="rates_rate_list_page_access"
+                           {% if rates_rate_list_page_access == "public" %}checked{% endif %}
+                           value="public">
+                    Rate list page is enabled for public users
+                </label>
+            </div>
         </div>
         <div class="form-group{% if errors.rates_rate_list_page_show_types %} has-error{% endif %}">
             <label class="control-label col-lg-3 col-md-4">Show rate types</label>
             {% for rate_type in rate_types %}
-            <div class="{% if forloop.counter != 1 %}col-lg-offset-3 col-md-offset-4 {% endif %}col-lg-9 col-md-8">
-                <div class="checkbox">
-                    <label><input type="checkbox" name="rates_rate_list_page_show_types_list" {% if not rates_rate_list_page_show_types or rate_type.id|stringformat:"i" in rates_rate_list_page_show_types  %}checked{% endif %} value="{{rate_type.id}}">{{rate_type}}</label><br/>
+                <div class="{% if forloop.counter != 1 %}col-lg-offset-3 col-md-offset-4 {% endif %}col-lg-9 col-md-8">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox"
+                                   name="rates_rate_list_page_show_types_list"
+                                   {% if not rates_rate_list_page_show_types or rate_type.id|stringformat:"i" in rates_rate_list_page_show_types %}checked{% endif %}
+                                   value="{{ rate_type.id }}">
+                            {{ rate_type }}
+                        </label>
+                        <br />
+                    </div>
                 </div>
-			</div>
             {% endfor %}
             {% if errors.rates_rate_list_page_show_types %}
-				<div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 help-block light-grey">
+                <div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 help-block light-grey">
                     {{ errors.rates_rate_list_page_show_types.error }}
-            	</div>
-			{% endif %}
+                </div>
+            {% endif %}
         </div>
         <div class="form-group{% if errors.rates_rate_list_page_show_categories %} has-error{% endif %}">
             <label class="control-label col-lg-3 col-md-4">Show rate categories</label>
             {% for rate_category in rate_categories %}
-            <div class="{% if forloop.counter != 1 %}col-lg-offset-3 col-md-offset-4 {% endif %}col-lg-9 col-md-8">
-                <div class="checkbox">
-                    <label><input type="checkbox" name="rates_rate_list_page_show_categories_list" {% if not rates_rate_list_page_show_categories or rate_category.id|stringformat:"i" in rates_rate_list_page_show_categories  %}checked{% endif %} value="{{rate_category.id}}">{{rate_category.name}}</label><br/>
+                <div class="{% if forloop.counter != 1 %}col-lg-offset-3 col-md-offset-4 {% endif %}col-lg-9 col-md-8">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox"
+                                   name="rates_rate_list_page_show_categories_list"
+                                   {% if not rates_rate_list_page_show_categories or rate_category.id|stringformat:"i" in rates_rate_list_page_show_categories %}checked{% endif %}
+                                   value="{{ rate_category.id }}">
+                            {{ rate_category.name }}
+                        </label>
+                        <br />
+                    </div>
                 </div>
-			</div>
             {% endfor %}
             {% if errors.rates_rate_list_page_show_categories %}
-				<div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 help-block light-grey">
+                <div class="col-lg-offset-3 col-md-offset-4 col-lg-9 col-md-8 help-block light-grey">
                     {{ errors.rates_rate_list_page_show_categories.error }}
-            	</div>
-			{% endif %}
+                </div>
+            {% endif %}
         </div>
         <div class="form-group">
             <label class="control-label col-lg-3 col-md-4">Show zero rates</label>
             <div class="col-lg-9 col-md-8">
                 <div class="checkbox">
-                    <label><input type="checkbox" name="rates_rate_list_show_zero_rates" {% if rates_rate_list_show_zero_rates == "enabled" %}checked{% endif %} value="enabled">Check this box to show rates that are zero</label><br/>
+                    <label>
+                        <input type="checkbox"
+                               name="rates_rate_list_show_zero_rates"
+                               {% if rates_rate_list_show_zero_rates == "enabled" %}checked{% endif %}
+                               value="enabled">
+                        Check this box to show rates that are zero
+                    </label>
+                    <br />
                 </div>
-			</div>
+            </div>
         </div>
         <div class="form-group">
             <label class="control-label col-lg-3 col-md-4">Show facilities</label>
             <div class="col-lg-9 col-md-8">
                 <div class="checkbox">
-                    <label><input type="checkbox" name="rates_rate_list_show_facilities" {% if rates_rate_list_show_facilities == "enabled" %}checked{% endif %} value="enabled">Check this box to show and group rates by Core Facility</label><br/>
+                    <label>
+                        <input type="checkbox"
+                               name="rates_rate_list_show_facilities"
+                               {% if rates_rate_list_show_facilities == "enabled" %}checked{% endif %}
+                               value="enabled">
+                        Check this box to show and group rates by Core Facility
+                    </label>
+                    <br />
                 </div>
-			</div>
+            </div>
         </div>
         <div class="customization-separation" style="margin-bottom: 15px"></div>
-        <div class="text-center">
-            {% button type="save" value="Save settings" %}
-        </div>
+        <div class="text-center">{% button type="save" value="Save settings" %}</div>
     </form>
-</div>
+</div>
```

## NEMO_billing/rates/templates/rates/base.html

```diff
@@ -1,5 +1,5 @@
 {% extends 'base.html' %}
 {% block extrahead %}
-{% load static %}
-	<link rel="stylesheet" type="text/css" href="{% static "rates/rates.css" %}"/>
-{% endblock %}
+    {% load static %}
+    <link rel="stylesheet" type="text/css" href="{% static "rates/rates.css" %}" />
+{% endblock %}
```

## NEMO_billing/rates/templates/rates/rate.html

```diff
@@ -1,378 +1,460 @@
 00000000: 7b25 2065 7874 656e 6473 2027 7261 7465  {% extends 'rate
 00000010: 732f 6261 7365 2e68 746d 6c27 2025 7d0a  s/base.html' %}.
 00000020: 7b25 206c 6f61 6420 6375 7374 6f6d 5f74  {% load custom_t
 00000030: 6167 735f 616e 645f 6669 6c74 6572 7320  ags_and_filters 
 00000040: 257d 0a7b 2520 626c 6f63 6b20 7469 746c  %}.{% block titl
 00000050: 6520 257d 5261 7465 7b25 2065 6e64 626c  e %}Rate{% endbl
 00000060: 6f63 6b20 257d 0a7b 2520 626c 6f63 6b20  ock %}.{% block 
-00000070: 636f 6e74 656e 7420 257d 0a09 3c68 313e  content %}..<h1>
-00000080: 7b25 2069 6620 6974 656d 2025 7d7b 7b20  {% if item %}{{ 
-00000090: 6974 656d 207d 7d7b 2520 656c 6966 2066  item }}{% elif f
-000000a0: 6f72 6d73 2025 7d7b 7b20 666f 726d 732e  orms %}{{ forms.
-000000b0: 302e 696e 7374 616e 6365 2e74 7970 6520  0.instance.type 
-000000c0: 7d7d 7b25 2065 6c73 6520 257d 4372 6561  }}{% else %}Crea
-000000d0: 7465 7b25 2065 6e64 6966 2025 7d20 7261  te{% endif %} ra
-000000e0: 7465 3c2f 6831 3e0a 093c 703e 3c62 723e  te</h1>..<p><br>
-000000f0: 3c73 7061 6e20 636c 6173 733d 2270 7269  <span class="pri
-00000100: 6d61 7279 2d68 6967 686c 6967 6874 2067  mary-highlight g
-00000110: 6c79 7068 6963 6f6e 2067 6c79 7068 6963  lyphicon glyphic
-00000120: 6f6e 2d69 6e66 6f2d 7369 676e 223e 3c2f  on-info-sign"></
-00000130: 7370 616e 3e20 5468 6520 7261 7465 7320  span> The rates 
-00000140: 666f 7220 746f 6f6c 2075 7361 6765 2026  for tool usage &
-00000150: 2074 7261 696e 696e 672c 2061 7265 6120   training, area 
-00000160: 6163 6365 7373 2061 6e64 2073 7461 6666  access and staff
-00000170: 2063 6861 7267 6573 2061 7265 2074 6f20   charges are to 
-00000180: 6265 2065 7870 7265 7373 6564 203c 7374  be expressed <st
-00000190: 726f 6e67 3e70 6572 2068 6f75 723c 2f73  rong>per hour</s
-000001a0: 7472 6f6e 673e 2e3c 2f70 3e0a 093c 666f  trong>.</p>..<fo
-000001b0: 726d 2069 643d 2272 6174 655f 666f 726d  rm id="rate_form
-000001c0: 2220 6d65 7468 6f64 3d22 706f 7374 2220  " method="post" 
-000001d0: 636c 6173 733d 2266 6f72 6d2d 686f 7269  class="form-hori
-000001e0: 7a6f 6e74 616c 2220 6163 7469 6f6e 3d22  zontal" action="
-000001f0: 7b25 2069 6620 6974 656d 2025 7d7b 2520  {% if item %}{% 
-00000200: 7572 6c20 2763 7265 6174 655f 7261 7465  url 'create_rate
-00000210: 2720 7261 7465 5f74 7970 655f 6368 6f69  ' rate_type_choi
-00000220: 6365 2069 7465 6d2e 6964 2025 7d7b 2520  ce item.id %}{% 
-00000230: 656c 7365 2025 7d7b 2520 7572 6c20 2763  else %}{% url 'c
-00000240: 7265 6174 655f 7261 7465 2720 7261 7465  reate_rate' rate
-00000250: 5f74 7970 655f 6368 6f69 6365 2025 7d7b  _type_choice %}{
-00000260: 2520 656e 6469 6620 257d 2220 7374 796c  % endif %}" styl
-00000270: 653d 226d 6172 6769 6e2d 746f 703a 2032  e="margin-top: 2
-00000280: 3570 7822 3e0a 0909 7b25 2063 7372 665f  5px">...{% csrf_
-00000290: 746f 6b65 6e20 257d 0a09 097b 2520 6966  token %}...{% if
-000002a0: 206e 6f74 2066 6f72 6d73 2025 7d0a 0909   not forms %}...
-000002b0: 093c 6469 7620 636c 6173 733d 2266 6f72  .<div class="for
-000002c0: 6d2d 6772 6f75 7022 3e0a 0909 0909 3c6c  m-group">.....<l
-000002d0: 6162 656c 2063 6c61 7373 3d22 636f 6e74  abel class="cont
-000002e0: 726f 6c2d 6c61 6265 6c20 636f 6c2d 736d  rol-label col-sm
-000002f0: 2d32 2220 666f 723d 2272 6174 655f 7479  -2" for="rate_ty
-00000300: 7065 223e 3c73 7472 6f6e 673e 5261 7465  pe"><strong>Rate
-00000310: 2074 7970 653c 2f73 7472 6f6e 673e 3c2f   type</strong></
-00000320: 6c61 6265 6c3e 0a09 0909 093c 6469 7620  label>.....<div 
-00000330: 636c 6173 733d 2263 6f6c 2d73 6d2d 3422  class="col-sm-4"
-00000340: 3e0a 0909 0909 093c 7365 6c65 6374 2069  >......<select i
-00000350: 643d 2272 6174 655f 7479 7065 2220 6e61  d="rate_type" na
-00000360: 6d65 3d22 7261 7465 5f74 7970 6522 2063  me="rate_type" c
-00000370: 6c61 7373 3d22 666f 726d 2d63 6f6e 7472  lass="form-contr
-00000380: 6f6c 2220 6f6e 6368 616e 6765 3d22 7261  ol" onchange="ra
-00000390: 7465 5f74 7970 655f 7365 6c65 6374 696f  te_type_selectio
-000003a0: 6e28 7468 6973 2e76 616c 7565 2922 3e0a  n(this.value)">.
-000003b0: 0909 0909 0909 3c6f 7074 696f 6e20 7661  ......<option va
-000003c0: 6c75 653d 2222 3e53 656c 6563 7420 7261  lue="">Select ra
-000003d0: 7465 2074 7970 653c 2f6f 7074 696f 6e3e  te type</option>
-000003e0: 0a09 0909 0909 097b 2520 666f 7220 7661  .......{% for va
-000003f0: 6c75 652c 2064 6973 706c 6179 2069 6e20  lue, display in 
-00000400: 7261 7465 5f74 7970 655f 6368 6f69 6365  rate_type_choice
-00000410: 7320 257d 0a09 0909 0909 0909 3c6f 7074  s %}........<opt
-00000420: 696f 6e20 7661 6c75 653d 227b 7b20 7661  ion value="{{ va
-00000430: 6c75 6520 7d7d 2220 7b25 2069 6620 7661  lue }}" {% if va
-00000440: 6c75 6520 3d3d 2072 6174 655f 7479 7065  lue == rate_type
-00000450: 5f63 686f 6963 6520 257d 7365 6c65 6374  _choice %}select
-00000460: 6564 7b25 2065 6e64 6966 2025 7d3e 7b7b  ed{% endif %}>{{
-00000470: 2064 6973 706c 6179 207d 7d3c 2f6f 7074   display }}</opt
-00000480: 696f 6e3e 0a09 0909 0909 097b 2520 656e  ion>.......{% en
-00000490: 6466 6f72 2025 7d0a 0909 0909 093c 2f73  dfor %}......</s
-000004a0: 656c 6563 743e 0a09 0909 093c 2f64 6976  elect>.....</div
-000004b0: 3e0a 0909 093c 2f64 6976 3e0a 0909 093c  >....</div>....<
-000004c0: 6469 7620 6964 3d22 746f 6f6c 5f73 656c  div id="tool_sel
-000004d0: 6563 7422 2063 6c61 7373 3d22 666f 726d  ect" class="form
-000004e0: 2d67 726f 7570 2069 7465 6d5f 7365 6c65  -group item_sele
-000004f0: 6374 2220 7374 796c 653d 2264 6973 706c  ct" style="displ
-00000500: 6179 3a20 6e6f 6e65 223e 0a09 0909 093c  ay: none">.....<
-00000510: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
-00000520: 7472 6f6c 2d6c 6162 656c 2063 6f6c 2d73  trol-label col-s
-00000530: 6d2d 3222 2066 6f72 3d22 746f 6f6c 223e  m-2" for="tool">
-00000540: 3c73 7472 6f6e 673e 546f 6f6c 3c2f 7374  <strong>Tool</st
-00000550: 726f 6e67 3e3c 2f6c 6162 656c 3e0a 0909  rong></label>...
-00000560: 0909 3c64 6976 2063 6c61 7373 3d22 636f  ..<div class="co
-00000570: 6c2d 736d 2d34 223e 0a09 0909 0909 3c73  l-sm-4">......<s
-00000580: 656c 6563 7420 6964 3d22 746f 6f6c 2220  elect id="tool" 
-00000590: 6e61 6d65 3d22 746f 6f6c 2220 636c 6173  name="tool" clas
-000005a0: 733d 2266 6f72 6d2d 636f 6e74 726f 6c22  s="form-control"
-000005b0: 206f 6e63 6861 6e67 653d 2272 6174 655f   onchange="rate_
-000005c0: 7479 7065 5f73 656c 6563 7469 6f6e 2827  type_selection('
-000005d0: 546f 6f6c 272c 2074 6869 732e 7661 6c75  Tool', this.valu
-000005e0: 6529 223e 0a09 0909 0909 093c 6f70 7469  e)">.......<opti
-000005f0: 6f6e 2064 6973 6162 6c65 6420 7365 6c65  on disabled sele
-00000600: 6374 6564 3e43 686f 6f73 6520 6120 746f  cted>Choose a to
-00000610: 6f6c 3c2f 6f70 7469 6f6e 3e0a 0909 0909  ol</option>.....
-00000620: 0909 7b25 2072 6567 726f 7570 2074 6f6f  ..{% regroup too
-00000630: 6c73 2062 7920 6361 7465 676f 7279 2061  ls by category a
-00000640: 7320 746f 6f6c 5f63 6174 6567 6f72 6965  s tool_categorie
-00000650: 7320 257d 0a09 0909 0909 097b 2520 666f  s %}.......{% fo
-00000660: 7220 6361 7465 676f 7279 2069 6e20 746f  r category in to
-00000670: 6f6c 5f63 6174 6567 6f72 6965 7320 257d  ol_categories %}
-00000680: 0a09 0909 0909 0909 7b25 2069 6620 746f  ........{% if to
-00000690: 6f6c 5f63 6174 6567 6f72 6965 737c 6c65  ol_categories|le
-000006a0: 6e67 7468 203e 2031 206f 7220 6361 7465  ngth > 1 or cate
-000006b0: 676f 7279 2e67 726f 7570 6572 2025 7d0a  gory.grouper %}.
-000006c0: 0909 0909 0909 093c 6f70 7467 726f 7570  .......<optgroup
-000006d0: 206c 6162 656c 3d22 7b7b 2063 6174 6567   label="{{ categ
-000006e0: 6f72 792e 6772 6f75 7065 727c 6465 6661  ory.grouper|defa
-000006f0: 756c 745f 6966 5f6e 6f6e 653a 2755 6e63  ult_if_none:'Unc
-00000700: 6174 6567 6f72 697a 6564 2720 7d7d 223e  ategorized' }}">
-00000710: 0a09 0909 0909 0909 7b25 2065 6e64 6966  ........{% endif
-00000720: 2025 7d0a 0909 0909 0909 097b 2520 666f   %}........{% fo
-00000730: 7220 6974 656d 2069 6e20 6361 7465 676f  r item in catego
-00000740: 7279 2e6c 6973 7420 257d 0a09 0909 0909  ry.list %}......
-00000750: 0909 093c 6f70 7469 6f6e 2076 616c 7565  ...<option value
-00000760: 3d22 7b7b 2069 7465 6d2e 6964 207d 7d22  ="{{ item.id }}"
-00000770: 3e7b 7b20 6974 656d 2e6e 616d 6520 7d7d  >{{ item.name }}
-00000780: 3c2f 6f70 7469 6f6e 3e0a 0909 0909 0909  </option>.......
-00000790: 097b 2520 656e 6466 6f72 2025 7d0a 0909  .{% endfor %}...
-000007a0: 0909 0909 097b 2520 6966 2074 6f6f 6c5f  .....{% if tool_
-000007b0: 6361 7465 676f 7269 6573 7c6c 656e 6774  categories|lengt
-000007c0: 6820 3e20 3120 6f72 2063 6174 6567 6f72  h > 1 or categor
-000007d0: 792e 6772 6f75 7065 7220 257d 0a09 0909  y.grouper %}....
-000007e0: 0909 0909 3c2f 6f70 7467 726f 7570 3e0a  ....</optgroup>.
-000007f0: 0909 0909 0909 097b 2520 656e 6469 6620  .......{% endif 
-00000800: 257d 0a09 0909 0909 097b 2520 656e 6466  %}.......{% endf
-00000810: 6f72 2025 7d0a 0909 0909 093c 2f73 656c  or %}......</sel
-00000820: 6563 743e 0a09 0909 093c 2f64 6976 3e0a  ect>.....</div>.
-00000830: 0909 093c 2f64 6976 3e0a 0909 093c 6469  ...</div>....<di
-00000840: 7620 6964 3d22 6172 6561 5f73 656c 6563  v id="area_selec
-00000850: 7422 2063 6c61 7373 3d22 666f 726d 2d67  t" class="form-g
-00000860: 726f 7570 2069 7465 6d5f 7365 6c65 6374  roup item_select
-00000870: 2220 7374 796c 653d 2264 6973 706c 6179  " style="display
-00000880: 3a20 6e6f 6e65 223e 0a09 0909 093c 6c61  : none">.....<la
-00000890: 6265 6c20 636c 6173 733d 2263 6f6e 7472  bel class="contr
-000008a0: 6f6c 2d6c 6162 656c 2063 6f6c 2d73 6d2d  ol-label col-sm-
-000008b0: 3222 2066 6f72 3d22 6172 6561 223e 3c73  2" for="area"><s
-000008c0: 7472 6f6e 673e 4172 6561 3c2f 7374 726f  trong>Area</stro
-000008d0: 6e67 3e3c 2f6c 6162 656c 3e0a 0909 0909  ng></label>.....
-000008e0: 3c64 6976 2063 6c61 7373 3d22 636f 6c2d  <div class="col-
-000008f0: 736d 2d34 223e 0a09 0909 0909 3c73 656c  sm-4">......<sel
-00000900: 6563 7420 6964 3d22 6172 6561 2220 6e61  ect id="area" na
-00000910: 6d65 3d22 6172 6561 2220 636c 6173 733d  me="area" class=
-00000920: 2266 6f72 6d2d 636f 6e74 726f 6c22 206f  "form-control" o
-00000930: 6e63 6861 6e67 653d 2272 6174 655f 7479  nchange="rate_ty
-00000940: 7065 5f73 656c 6563 7469 6f6e 2827 4172  pe_selection('Ar
-00000950: 6561 272c 2074 6869 732e 7661 6c75 6529  ea', this.value)
-00000960: 223e 0a09 0909 0909 093c 6f70 7469 6f6e  ">.......<option
-00000970: 2064 6973 6162 6c65 6420 7365 6c65 6374   disabled select
-00000980: 6564 3e43 686f 6f73 6520 616e 2061 7265  ed>Choose an are
-00000990: 613c 2f6f 7074 696f 6e3e 0a09 0909 0909  a</option>......
-000009a0: 097b 2520 6966 2061 7265 6173 7c6c 656e  .{% if areas|len
-000009b0: 6774 6820 3d3d 2031 2025 7d0a 0909 0909  gth == 1 %}.....
-000009c0: 0909 093c 6f70 7469 6f6e 2076 616c 7565  ...<option value
-000009d0: 3d22 7b7b 2061 7265 6173 2e30 2e69 6420  ="{{ areas.0.id 
-000009e0: 7d7d 223e 7b7b 2061 7265 6173 2e30 207d  }}">{{ areas.0 }
-000009f0: 7d3c 2f6f 7074 696f 6e3e 0a09 0909 0909  }</option>......
-00000a00: 097b 2520 656c 6966 2061 7265 6173 2025  .{% elif areas %
-00000a10: 7d0a 0909 0909 0909 093c 6f70 7469 6f6e  }........<option
-00000a20: 2064 6973 6162 6c65 6420 7365 6c65 6374   disabled select
-00000a30: 6564 2076 616c 7565 3d22 223e 4368 6f6f  ed value="">Choo
-00000a40: 7365 2061 6e20 6172 6561 3c2f 6f70 7469  se an area</opti
-00000a50: 6f6e 3e0a 0909 0909 0909 097b 2520 666f  on>........{% fo
-00000a60: 7220 6172 6561 2069 6e20 6172 6561 7320  r area in areas 
-00000a70: 257d 0a09 0909 0909 0909 093c 6f70 7469  %}.........<opti
-00000a80: 6f6e 2076 616c 7565 3d22 7b7b 2061 7265  on value="{{ are
-00000a90: 612e 6964 207d 7d22 3e7b 7b20 6172 6561  a.id }}">{{ area
-00000aa0: 2e6e 616d 6520 7d7d 3c2f 6f70 7469 6f6e  .name }}</option
-00000ab0: 3e0a 0909 0909 0909 097b 2520 656e 6466  >........{% endf
-00000ac0: 6f72 2025 7d0a 0909 0909 0909 7b25 2065  or %}.......{% e
-00000ad0: 6e64 6966 2025 7d0a 0909 0909 093c 2f73  ndif %}......</s
-00000ae0: 656c 6563 743e 0a09 0909 093c 2f64 6976  elect>.....</div
-00000af0: 3e0a 0909 093c 2f64 6976 3e0a 0909 093c  >....</div>....<
-00000b00: 6469 7620 6964 3d22 636f 6e73 756d 6162  div id="consumab
-00000b10: 6c65 5f73 656c 6563 7422 2063 6c61 7373  le_select" class
-00000b20: 3d22 666f 726d 2d67 726f 7570 2069 7465  ="form-group ite
-00000b30: 6d5f 7365 6c65 6374 2220 7374 796c 653d  m_select" style=
-00000b40: 2264 6973 706c 6179 3a20 6e6f 6e65 223e  "display: none">
-00000b50: 0a09 0909 093c 6c61 6265 6c20 636c 6173  .....<label clas
-00000b60: 733d 2263 6f6e 7472 6f6c 2d6c 6162 656c  s="control-label
-00000b70: 2063 6f6c 2d73 6d2d 3222 2066 6f72 3d22   col-sm-2" for="
-00000b80: 636f 6e73 756d 6162 6c65 223e 3c73 7472  consumable"><str
-00000b90: 6f6e 673e 5375 7070 6c79 3c2f 7374 726f  ong>Supply</stro
-00000ba0: 6e67 3e3c 2f6c 6162 656c 3e0a 0909 0909  ng></label>.....
-00000bb0: 3c64 6976 2063 6c61 7373 3d22 636f 6c2d  <div class="col-
-00000bc0: 736d 2d34 223e 0a09 0909 0909 3c73 656c  sm-4">......<sel
-00000bd0: 6563 7420 6964 3d22 636f 6e73 756d 6162  ect id="consumab
-00000be0: 6c65 2220 6e61 6d65 3d22 636f 6e73 756d  le" name="consum
-00000bf0: 6162 6c65 2220 636c 6173 733d 2266 6f72  able" class="for
-00000c00: 6d2d 636f 6e74 726f 6c22 206f 6e63 6861  m-control" oncha
-00000c10: 6e67 653d 2272 6174 655f 7479 7065 5f73  nge="rate_type_s
-00000c20: 656c 6563 7469 6f6e 2827 434f 4e53 554d  election('CONSUM
-00000c30: 4142 4c45 272c 2074 6869 732e 7661 6c75  ABLE', this.valu
-00000c40: 6529 223e 0a09 0909 0909 093c 6f70 7469  e)">.......<opti
-00000c50: 6f6e 2064 6973 6162 6c65 6420 7365 6c65  on disabled sele
-00000c60: 6374 6564 2076 616c 7565 3d22 223e 4368  cted value="">Ch
-00000c70: 6f6f 7365 2061 2073 7570 706c 793c 2f6f  oose a supply</o
-00000c80: 7074 696f 6e3e 0a09 0909 0909 097b 2520  ption>.......{% 
-00000c90: 7265 6772 6f75 7020 636f 6e73 756d 6162  regroup consumab
-00000ca0: 6c65 7320 6279 2063 6174 6567 6f72 7920  les by category 
-00000cb0: 6173 2063 6f6e 7375 6d61 626c 655f 6361  as consumable_ca
-00000cc0: 7465 676f 7269 6573 2025 7d0a 0909 0909  tegories %}.....
-00000cd0: 0909 7b25 2066 6f72 2063 6174 6567 6f72  ..{% for categor
-00000ce0: 7920 696e 2063 6f6e 7375 6d61 626c 655f  y in consumable_
-00000cf0: 6361 7465 676f 7269 6573 2025 7d0a 0909  categories %}...
-00000d00: 0909 0909 097b 2520 6966 2063 6f6e 7375  .....{% if consu
-00000d10: 6d61 626c 655f 6361 7465 676f 7269 6573  mable_categories
-00000d20: 7c6c 656e 6774 6820 3e20 3120 6f72 2063  |length > 1 or c
-00000d30: 6174 6567 6f72 792e 6772 6f75 7065 7220  ategory.grouper 
-00000d40: 257d 0a09 0909 0909 0909 3c6f 7074 6772  %}........<optgr
-00000d50: 6f75 7020 6c61 6265 6c3d 227b 7b20 6361  oup label="{{ ca
-00000d60: 7465 676f 7279 2e67 726f 7570 6572 7c64  tegory.grouper|d
-00000d70: 6566 6175 6c74 5f69 665f 6e6f 6e65 3a22  efault_if_none:"
-00000d80: 556e 6361 7465 676f 7269 7a65 6422 207d  Uncategorized" }
-00000d90: 7d22 3e0a 0909 0909 0909 097b 2520 656e  }">........{% en
-00000da0: 6469 6620 257d 0a09 0909 0909 0909 7b25  dif %}........{%
-00000db0: 2066 6f72 2069 7465 6d20 696e 2063 6174   for item in cat
-00000dc0: 6567 6f72 792e 6c69 7374 2025 7d0a 0909  egory.list %}...
-00000dd0: 0909 0909 0909 3c6f 7074 696f 6e20 7661  ......<option va
-00000de0: 6c75 653d 227b 7b20 6974 656d 2e69 6420  lue="{{ item.id 
-00000df0: 7d7d 223e 7b7b 2069 7465 6d2e 6e61 6d65  }}">{{ item.name
-00000e00: 207d 7d3c 2f6f 7074 696f 6e3e 0a09 0909   }}</option>....
-00000e10: 0909 0909 7b25 2065 6e64 666f 7220 257d  ....{% endfor %}
-00000e20: 0a09 0909 0909 0909 7b25 2069 6620 636f  ........{% if co
-00000e30: 6e73 756d 6162 6c65 5f63 6174 6567 6f72  nsumable_categor
-00000e40: 6965 737c 6c65 6e67 7468 203e 2031 206f  ies|length > 1 o
-00000e50: 7220 6361 7465 676f 7279 2e67 726f 7570  r category.group
-00000e60: 6572 2025 7d0a 0909 0909 0909 093c 2f6f  er %}........</o
-00000e70: 7074 6772 6f75 703e 0a09 0909 0909 0909  ptgroup>........
-00000e80: 7b25 2065 6e64 6966 2025 7d0a 0909 0909  {% endif %}.....
-00000e90: 0909 7b25 2065 6e64 666f 7220 257d 0a09  ..{% endfor %}..
-00000ea0: 0909 0909 3c2f 7365 6c65 6374 3e0a 0909  ....</select>...
-00000eb0: 0909 3c2f 6469 763e 0a09 0909 3c2f 6469  ..</div>....</di
-00000ec0: 763e 0a09 097b 2520 656c 7365 2025 7d0a  v>...{% else %}.
-00000ed0: 0909 097b 2520 666f 7220 7261 7465 5f66  ...{% for rate_f
-00000ee0: 6f72 6d20 696e 2066 6f72 6d73 2025 7d0a  orm in forms %}.
-00000ef0: 0909 0909 7b25 2069 6e63 6c75 6465 2022  ....{% include "
-00000f00: 7261 7465 732f 7261 7465 5f66 6f72 6d5f  rates/rate_form_
-00000f10: 6465 7461 696c 732e 6874 6d6c 2220 7769  details.html" wi
-00000f20: 7468 2072 6174 655f 666f 726d 3d72 6174  th rate_form=rat
-00000f30: 655f 666f 726d 2025 7d0a 0909 097b 2520  e_form %}....{% 
-00000f40: 656e 6466 6f72 2025 7d0a 0909 093c 6469  endfor %}....<di
-00000f50: 7620 636c 6173 733d 2263 6f6c 2d73 6d2d  v class="col-sm-
-00000f60: 3620 7465 7874 2d72 6967 6874 223e 0a09  6 text-right">..
-00000f70: 0909 097b 2520 6275 7474 6f6e 2074 7970  ...{% button typ
-00000f80: 653d 2273 6176 6522 2076 616c 7565 3d22  e="save" value="
-00000f90: 436f 6e66 6972 6d22 2025 7d0a 0909 093c  Confirm" %}....<
-00000fa0: 2f64 6976 3e0a 0909 7b25 2065 6e64 6966  /div>...{% endif
-00000fb0: 2025 7d0a 093c 2f66 6f72 6d3e 0a09 3c73   %}..</form>..<s
-00000fc0: 6372 6970 743e 0a09 6675 6e63 7469 6f6e  cript>..function
-00000fd0: 2072 6174 655f 7479 7065 5f73 656c 6563   rate_type_selec
-00000fe0: 7469 6f6e 2872 6174 655f 7479 7065 2c20  tion(rate_type, 
-00000ff0: 6964 290a 2020 2020 7b0a 2020 2020 2020  id).    {.      
-00001000: 2020 6966 2028 7261 7465 5f74 7970 6529    if (rate_type)
-00001010: 0a20 2020 2020 2020 207b 0a09 0909 6966  .        {....if
-00001020: 2028 6964 290a 0909 097b 0a09 0909 0977   (id)....{.....w
-00001030: 696e 646f 772e 6c6f 6361 7469 6f6e 203d  indow.location =
-00001040: 2027 7b25 2075 726c 2027 6372 6561 7465   '{% url 'create
-00001050: 5f72 6174 6527 2027 746f 6f6c 2720 2739  _rate' 'tool' '9
-00001060: 3939 3927 2025 7d27 2e72 6570 6c61 6365  999' %}'.replace
-00001070: 2827 746f 6f6c 272c 2072 6174 655f 7479  ('tool', rate_ty
-00001080: 7065 292e 7265 706c 6163 6528 2739 3939  pe).replace('999
-00001090: 3927 2c20 6964 293b 0a09 0909 7d0a 0909  9', id);....}...
-000010a0: 0965 6c73 6520 6966 2028 7261 7465 5f74  .else if (rate_t
-000010b0: 7970 652e 746f 4c6f 7765 7243 6173 6528  ype.toLowerCase(
-000010c0: 2920 213d 3d20 2774 6f6f 6c27 2026 2620  ) !== 'tool' && 
-000010d0: 7261 7465 5f74 7970 652e 746f 4c6f 7765  rate_type.toLowe
-000010e0: 7243 6173 6528 2920 213d 3d20 2761 7265  rCase() !== 'are
-000010f0: 6127 2026 2620 7261 7465 5f74 7970 652e  a' && rate_type.
-00001100: 746f 4c6f 7765 7243 6173 6528 2920 213d  toLowerCase() !=
-00001110: 3d20 2763 6f6e 7375 6d61 626c 6527 290a  = 'consumable').
-00001120: 0909 097b 0a09 0909 0977 696e 646f 772e  ...{.....window.
-00001130: 6c6f 6361 7469 6f6e 203d 2027 7b25 2075  location = '{% u
-00001140: 726c 2027 6372 6561 7465 5f72 6174 6527  rl 'create_rate'
-00001150: 2027 746f 6f6c 2720 257d 272e 7265 706c   'tool' %}'.repl
-00001160: 6163 6528 2774 6f6f 6c27 2c20 7261 7465  ace('tool', rate
-00001170: 5f74 7970 6529 3b0a 0909 097d 0a09 0909  _type);....}....
-00001180: 656c 7365 0a09 0909 7b0a 2020 2020 2020  else....{.      
-00001190: 2020 2020 2020 2020 2020 2428 272e 6974            $('.it
-000011a0: 656d 5f73 656c 6563 7427 292e 6869 6465  em_select').hide
-000011b0: 2829 3b0a 0909 0909 2428 2723 272b 7261  ();.....$('#'+ra
-000011c0: 7465 5f74 7970 652e 746f 4c6f 7765 7243  te_type.toLowerC
-000011d0: 6173 6528 292b 225f 7365 6c65 6374 2229  ase()+"_select")
-000011e0: 2e73 686f 7728 293b 0a09 0909 7d0a 2020  .show();....}.  
-000011f0: 2020 2020 2020 7d0a 097d 0a20 2020 2066        }..}.    f
-00001200: 756e 6374 696f 6e20 6164 645f 7261 7465  unction add_rate
-00001210: 5f66 6f72 6d28 666f 726d 5f6e 756d 6265  _form(form_numbe
-00001220: 7229 0a20 2020 207b 0a20 2020 2020 2020  r).    {.       
-00001230: 207b 2320 4669 6775 7265 206f 7574 2074   {# Figure out t
-00001240: 6865 206d 6178 2066 6f72 6d20 6e75 6d62  he max form numb
-00001250: 6572 2074 6f20 7365 6e64 2069 7420 237d  er to send it #}
-00001260: 0a20 2020 2020 2020 206c 6574 2066 6f72  .        let for
-00001270: 6d5f 6e75 6d62 6572 5f69 6e70 7574 7320  m_number_inputs 
-00001280: 3d20 646f 6375 6d65 6e74 2e71 7565 7279  = document.query
-00001290: 5365 6c65 6374 6f72 416c 6c28 2769 6e70  SelectorAll('inp
-000012a0: 7574 5b6e 616d 653d 2266 6f72 6d5f 6e75  ut[name="form_nu
-000012b0: 6d62 6572 735b 5d22 5d27 293b 0a20 2020  mbers[]"]');.   
-000012c0: 2020 2020 206c 6574 206d 6178 5f66 6f72       let max_for
-000012d0: 6d5f 6e75 6d62 6572 203d 2030 3b0a 2020  m_number = 0;.  
-000012e0: 2020 2020 2020 666f 7220 286c 6574 2069        for (let i
-000012f0: 3d30 3b20 6920 3c20 666f 726d 5f6e 756d  =0; i < form_num
-00001300: 6265 725f 696e 7075 7473 2e6c 656e 6774  ber_inputs.lengt
-00001310: 683b 2069 2b2b 290a 2020 2020 2020 2020  h; i++).        
-00001320: 7b0a 2020 2020 2020 2020 2020 2020 6d61  {.            ma
-00001330: 785f 666f 726d 5f6e 756d 6265 7220 3d20  x_form_number = 
-00001340: 4d61 7468 2e6d 6178 286d 6178 5f66 6f72  Math.max(max_for
-00001350: 6d5f 6e75 6d62 6572 2c20 7061 7273 6549  m_number, parseI
-00001360: 6e74 2866 6f72 6d5f 6e75 6d62 6572 5f69  nt(form_number_i
-00001370: 6e70 7574 735b 695d 2e76 616c 7565 2929  nputs[i].value))
-00001380: 3b0a 0909 7d0a 2020 2020 2020 2020 6c65  ;...}.        le
-00001390: 7420 7261 7465 5f66 6f72 6d5f 7572 6c20  t rate_form_url 
-000013a0: 3d20 277b 2520 7572 6c20 276e 6577 5f74  = '{% url 'new_t
-000013b0: 696d 655f 7261 7465 5f66 6f72 6d27 2025  ime_rate_form' %
-000013c0: 7d3f 273b 0a20 2020 2020 2020 2072 6174  }?';.        rat
-000013d0: 655f 666f 726d 5f75 726c 202b 3d20 2726  e_form_url += '&
-000013e0: 636f 756e 743d 2720 2b20 286d 6178 5f66  count=' + (max_f
-000013f0: 6f72 6d5f 6e75 6d62 6572 202b 2031 293b  orm_number + 1);
-00001400: 0a20 2020 2020 2020 2066 6f72 2028 6c65  .        for (le
-00001410: 7420 6669 656c 6420 6f66 205b 2774 7970  t field of ['typ
-00001420: 6527 2c20 2763 6174 6567 6f72 7927 2c20  e', 'category', 
-00001430: 2774 6f6f 6c27 2c20 2761 7265 6127 2c20  'tool', 'area', 
-00001440: 2763 6f6e 7375 6d61 626c 6527 5d29 0a20  'consumable']). 
-00001450: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00001460: 2020 2020 206c 6574 2069 6e70 7574 5f6e       let input_n
-00001470: 616d 6520 3d20 666f 726d 5f6e 756d 6265  ame = form_numbe
-00001480: 7220 2b20 225f 2220 2b20 6669 656c 643b  r + "_" + field;
-00001490: 0a09 0909 7261 7465 5f66 6f72 6d5f 7572  ....rate_form_ur
-000014a0: 6c20 2b3d 2027 2627 202b 2066 6965 6c64  l += '&' + field
-000014b0: 202b 2027 3d27 202b 2024 2827 696e 7075   + '=' + $('inpu
-000014c0: 745b 6e61 6d65 3d22 272b 696e 7075 745f  t[name="'+input_
-000014d0: 6e61 6d65 2b27 225d 2729 2e76 616c 2829  name+'"]').val()
-000014e0: 3b0a 2020 2020 2020 2020 7d0a 2020 2020  ;.        }.    
-000014f0: 2020 2020 242e 6765 7428 7261 7465 5f66      $.get(rate_f
-00001500: 6f72 6d5f 7572 6c2c 2066 756e 6374 696f  orm_url, functio
-00001510: 6e20 2863 6f6e 7465 6e74 290a 2020 2020  n (content).    
-00001520: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00001530: 2020 2428 2723 272b 666f 726d 5f6e 756d    $('#'+form_num
-00001540: 6265 722b 275f 666f 726d 2729 2e61 6674  ber+'_form').aft
-00001550: 6572 2863 6f6e 7465 6e74 293b 0a20 2020  er(content);.   
-00001560: 2020 2020 207d 0a20 2020 2020 2020 2029       }.        )
-00001570: 3b0a 097d 0a20 2020 2066 756e 6374 696f  ;..}.    functio
-00001580: 6e20 6465 6c65 7465 5f72 6174 655f 666f  n delete_rate_fo
-00001590: 726d 2866 6f72 6d5f 6e75 6d62 6572 2c20  rm(form_number, 
-000015a0: 7261 7465 5f69 6429 0a20 2020 207b 0a20  rate_id).    {. 
-000015b0: 2020 2020 2020 206c 6574 2073 7563 6365         let succe
-000015c0: 7373 5f63 616c 6c62 6163 6b20 3d20 6675  ss_callback = fu
-000015d0: 6e63 7469 6f6e 2028 2920 7b20 2428 2723  nction () { $('#
-000015e0: 272b 666f 726d 5f6e 756d 6265 722b 275f  '+form_number+'_
-000015f0: 666f 726d 2729 2e72 656d 6f76 6528 293b  form').remove();
-00001600: 207d 0a20 2020 2020 2020 2069 6620 2872   }.        if (r
-00001610: 6174 655f 6964 290a 2020 2020 2020 2020  ate_id).        
-00001620: 7b0a 2020 2020 2020 2020 2020 2020 6966  {.            if
-00001630: 2028 636f 6e66 6972 6d28 2241 7265 2079   (confirm("Are y
-00001640: 6f75 2073 7572 6520 796f 7520 7761 6e74  ou sure you want
-00001650: 2074 6f20 6465 6c65 7465 2074 6869 7320   to delete this 
-00001660: 7261 7465 3f20 5468 6973 2063 616e 6e6f  rate? This canno
-00001670: 7420 6265 2075 6e64 6f6e 652e 2229 290a  t be undone.")).
-00001680: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00001690: 2020 2020 2020 2020 2020 0961 6a61 785f            .ajax_
-000016a0: 6765 7428 277b 2520 7572 6c20 2764 656c  get('{% url 'del
-000016b0: 6574 655f 7261 7465 5f74 696d 6527 2027  ete_rate_time' '
-000016c0: 3939 3939 2720 257d 272e 7265 706c 6163  9999' %}'.replac
-000016d0: 6528 2739 3939 3927 2c20 7261 7465 5f69  e('9999', rate_i
-000016e0: 6429 2c20 756e 6465 6669 6e65 642c 2073  d), undefined, s
-000016f0: 7563 6365 7373 5f63 616c 6c62 6163 6b2c  uccess_callback,
-00001700: 2061 6a61 785f 6661 696c 7572 655f 6361   ajax_failure_ca
-00001710: 6c6c 6261 636b 2827 4572 726f 7220 6465  llback('Error de
-00001720: 6c65 7469 6e67 2072 6174 6527 2929 3b0a  leting rate'));.
-00001730: 2020 2020 2020 2020 2020 2020 7d0a 0909              }...
-00001740: 7d0a 2020 2020 2020 2020 656c 7365 0a20  }.        else. 
-00001750: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00001760: 2020 2020 2073 7563 6365 7373 5f63 616c       success_cal
-00001770: 6c62 6163 6b28 293b 0a20 2020 2020 2020  lback();.       
-00001780: 207d 0a09 7d0a 093c 2f73 6372 6970 743e   }..}..</script>
-00001790: 0a7b 2520 656e 6462 6c6f 636b 2025 7d    .{% endblock %}
+00000070: 636f 6e74 656e 7420 257d 0a20 2020 203c  content %}.    <
+00000080: 6831 3e0a 2020 2020 2020 2020 7b25 2069  h1>.        {% i
+00000090: 6620 6974 656d 2025 7d0a 2020 2020 2020  f item %}.      
+000000a0: 2020 2020 2020 7b7b 2069 7465 6d20 7d7d        {{ item }}
+000000b0: 0a20 2020 2020 2020 207b 2520 656c 6966  .        {% elif
+000000c0: 2066 6f72 6d73 2025 7d0a 2020 2020 2020   forms %}.      
+000000d0: 2020 2020 2020 7b7b 2066 6f72 6d73 2e30        {{ forms.0
+000000e0: 2e69 6e73 7461 6e63 652e 7479 7065 207d  .instance.type }
+000000f0: 7d0a 2020 2020 2020 2020 7b25 2065 6c73  }.        {% els
+00000100: 6520 257d 0a20 2020 2020 2020 2020 2020  e %}.           
+00000110: 2043 7265 6174 650a 2020 2020 2020 2020   Create.        
+00000120: 7b25 2065 6e64 6966 2025 7d0a 2020 2020  {% endif %}.    
+00000130: 2020 2020 7261 7465 0a20 2020 203c 2f68      rate.    </h
+00000140: 313e 0a20 2020 203c 703e 0a20 2020 2020  1>.    <p>.     
+00000150: 2020 203c 6272 3e0a 2020 2020 2020 2020     <br>.        
+00000160: 3c73 7061 6e20 636c 6173 733d 2270 7269  <span class="pri
+00000170: 6d61 7279 2d68 6967 686c 6967 6874 2067  mary-highlight g
+00000180: 6c79 7068 6963 6f6e 2067 6c79 7068 6963  lyphicon glyphic
+00000190: 6f6e 2d69 6e66 6f2d 7369 676e 223e 3c2f  on-info-sign"></
+000001a0: 7370 616e 3e20 5468 6520 7261 7465 7320  span> The rates 
+000001b0: 666f 7220 746f 6f6c 2075 7361 6765 2026  for tool usage &
+000001c0: 2074 7261 696e 696e 672c 2061 7265 6120   training, area 
+000001d0: 6163 6365 7373 2061 6e64 2073 7461 6666  access and staff
+000001e0: 2063 6861 7267 6573 2061 7265 2074 6f20   charges are to 
+000001f0: 6265 2065 7870 7265 7373 6564 203c 7374  be expressed <st
+00000200: 726f 6e67 3e70 6572 2068 6f75 723c 2f73  rong>per hour</s
+00000210: 7472 6f6e 673e 2e0a 2020 2020 3c2f 703e  trong>..    </p>
+00000220: 0a20 2020 203c 666f 726d 2069 643d 2272  .    <form id="r
+00000230: 6174 655f 666f 726d 220a 2020 2020 2020  ate_form".      
+00000240: 2020 2020 6d65 7468 6f64 3d22 706f 7374      method="post
+00000250: 220a 2020 2020 2020 2020 2020 636c 6173  ".          clas
+00000260: 733d 2266 6f72 6d2d 686f 7269 7a6f 6e74  s="form-horizont
+00000270: 616c 220a 2020 2020 2020 2020 2020 6163  al".          ac
+00000280: 7469 6f6e 3d22 7b25 2069 6620 6974 656d  tion="{% if item
+00000290: 2025 7d7b 2520 7572 6c20 2763 7265 6174   %}{% url 'creat
+000002a0: 655f 7261 7465 2720 7261 7465 5f74 7970  e_rate' rate_typ
+000002b0: 655f 6368 6f69 6365 2069 7465 6d2e 6964  e_choice item.id
+000002c0: 2025 7d7b 2520 656c 7365 2025 7d7b 2520   %}{% else %}{% 
+000002d0: 7572 6c20 2763 7265 6174 655f 7261 7465  url 'create_rate
+000002e0: 2720 7261 7465 5f74 7970 655f 6368 6f69  ' rate_type_choi
+000002f0: 6365 2025 7d7b 2520 656e 6469 6620 257d  ce %}{% endif %}
+00000300: 220a 2020 2020 2020 2020 2020 7374 796c  ".          styl
+00000310: 653d 226d 6172 6769 6e2d 746f 703a 2032  e="margin-top: 2
+00000320: 3570 7822 3e0a 2020 2020 2020 2020 7b25  5px">.        {%
+00000330: 2063 7372 665f 746f 6b65 6e20 257d 0a20   csrf_token %}. 
+00000340: 2020 2020 2020 207b 2520 6966 206e 6f74         {% if not
+00000350: 2066 6f72 6d73 2025 7d0a 2020 2020 2020   forms %}.      
+00000360: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
+00000370: 3d22 666f 726d 2d67 726f 7570 223e 0a20  ="form-group">. 
+00000380: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00000390: 6c61 6265 6c20 636c 6173 733d 2263 6f6e  label class="con
+000003a0: 7472 6f6c 2d6c 6162 656c 2063 6f6c 2d73  trol-label col-s
+000003b0: 6d2d 3222 2066 6f72 3d22 7261 7465 5f74  m-2" for="rate_t
+000003c0: 7970 6522 3e0a 2020 2020 2020 2020 2020  ype">.          
+000003d0: 2020 2020 2020 2020 2020 3c73 7472 6f6e            <stron
+000003e0: 673e 5261 7465 2074 7970 653c 2f73 7472  g>Rate type</str
+000003f0: 6f6e 673e 0a20 2020 2020 2020 2020 2020  ong>.           
+00000400: 2020 2020 203c 2f6c 6162 656c 3e0a 2020       </label>.  
+00000410: 2020 2020 2020 2020 2020 2020 2020 3c64                <d
+00000420: 6976 2063 6c61 7373 3d22 636f 6c2d 736d  iv class="col-sm
+00000430: 2d34 223e 0a20 2020 2020 2020 2020 2020  -4">.           
+00000440: 2020 2020 2020 2020 203c 7365 6c65 6374           <select
+00000450: 2069 643d 2272 6174 655f 7479 7065 2220   id="rate_type" 
+00000460: 6e61 6d65 3d22 7261 7465 5f74 7970 6522  name="rate_type"
+00000470: 2063 6c61 7373 3d22 666f 726d 2d63 6f6e   class="form-con
+00000480: 7472 6f6c 2220 6f6e 6368 616e 6765 3d22  trol" onchange="
+00000490: 7261 7465 5f74 7970 655f 7365 6c65 6374  rate_type_select
+000004a0: 696f 6e28 7468 6973 2e76 616c 7565 2922  ion(this.value)"
+000004b0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+000004c0: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
+000004d0: 6e20 7661 6c75 653d 2222 3e53 656c 6563  n value="">Selec
+000004e0: 7420 7261 7465 2074 7970 653c 2f6f 7074  t rate type</opt
+000004f0: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00000500: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000510: 666f 7220 7661 6c75 652c 2064 6973 706c  for value, displ
+00000520: 6179 2069 6e20 7261 7465 5f74 7970 655f  ay in rate_type_
+00000530: 6368 6f69 6365 7320 257d 0a20 2020 2020  choices %}.     
+00000540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000550: 2020 2020 2020 203c 6f70 7469 6f6e 2076         <option v
+00000560: 616c 7565 3d22 7b7b 2076 616c 7565 207d  alue="{{ value }
+00000570: 7d22 207b 2520 6966 2076 616c 7565 203d  }" {% if value =
+00000580: 3d20 7261 7465 5f74 7970 655f 6368 6f69  = rate_type_choi
+00000590: 6365 2025 7d73 656c 6563 7465 647b 2520  ce %}selected{% 
+000005a0: 656e 6469 6620 257d 3e7b 7b20 6469 7370  endif %}>{{ disp
+000005b0: 6c61 7920 7d7d 3c2f 6f70 7469 6f6e 3e0a  lay }}</option>.
+000005c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000005d0: 2020 2020 2020 2020 7b25 2065 6e64 666f          {% endfo
+000005e0: 7220 257d 0a20 2020 2020 2020 2020 2020  r %}.           
+000005f0: 2020 2020 2020 2020 203c 2f73 656c 6563           </selec
+00000600: 743e 0a20 2020 2020 2020 2020 2020 2020  t>.             
+00000610: 2020 203c 2f64 6976 3e0a 2020 2020 2020     </div>.      
+00000620: 2020 2020 2020 3c2f 6469 763e 0a20 2020        </div>.   
+00000630: 2020 2020 2020 2020 203c 6469 7620 6964           <div id
+00000640: 3d22 746f 6f6c 5f73 656c 6563 7422 2063  ="tool_select" c
+00000650: 6c61 7373 3d22 666f 726d 2d67 726f 7570  lass="form-group
+00000660: 2069 7465 6d5f 7365 6c65 6374 2220 7374   item_select" st
+00000670: 796c 653d 2264 6973 706c 6179 3a20 6e6f  yle="display: no
+00000680: 6e65 223e 0a20 2020 2020 2020 2020 2020  ne">.           
+00000690: 2020 2020 203c 6c61 6265 6c20 636c 6173       <label clas
+000006a0: 733d 2263 6f6e 7472 6f6c 2d6c 6162 656c  s="control-label
+000006b0: 2063 6f6c 2d73 6d2d 3222 2066 6f72 3d22   col-sm-2" for="
+000006c0: 746f 6f6c 223e 0a20 2020 2020 2020 2020  tool">.         
+000006d0: 2020 2020 2020 2020 2020 203c 7374 726f             <stro
+000006e0: 6e67 3e54 6f6f 6c3c 2f73 7472 6f6e 673e  ng>Tool</strong>
+000006f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000700: 203c 2f6c 6162 656c 3e0a 2020 2020 2020   </label>.      
+00000710: 2020 2020 2020 2020 2020 3c64 6976 2063            <div c
+00000720: 6c61 7373 3d22 636f 6c2d 736d 2d34 223e  lass="col-sm-4">
+00000730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000740: 2020 2020 203c 7365 6c65 6374 2069 643d       <select id=
+00000750: 2274 6f6f 6c22 206e 616d 653d 2274 6f6f  "tool" name="too
+00000760: 6c22 2063 6c61 7373 3d22 666f 726d 2d63  l" class="form-c
+00000770: 6f6e 7472 6f6c 2220 6f6e 6368 616e 6765  ontrol" onchange
+00000780: 3d22 7261 7465 5f74 7970 655f 7365 6c65  ="rate_type_sele
+00000790: 6374 696f 6e28 2754 6f6f 6c27 2c20 7468  ction('Tool', th
+000007a0: 6973 2e76 616c 7565 2922 3e0a 2020 2020  is.value)">.    
+000007b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000007c0: 2020 2020 3c6f 7074 696f 6e20 6469 7361      <option disa
+000007d0: 626c 6564 2073 656c 6563 7465 643e 4368  bled selected>Ch
+000007e0: 6f6f 7365 2061 2074 6f6f 6c3c 2f6f 7074  oose a tool</opt
+000007f0: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00000800: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000810: 7265 6772 6f75 7020 746f 6f6c 7320 6279  regroup tools by
+00000820: 2063 6174 6567 6f72 7920 6173 2074 6f6f   category as too
+00000830: 6c5f 6361 7465 676f 7269 6573 2025 7d0a  l_categories %}.
+00000840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000850: 2020 2020 2020 2020 7b25 2066 6f72 2063          {% for c
+00000860: 6174 6567 6f72 7920 696e 2074 6f6f 6c5f  ategory in tool_
+00000870: 6361 7465 676f 7269 6573 2025 7d0a 2020  categories %}.  
+00000880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000890: 2020 2020 2020 2020 2020 7b25 2069 6620            {% if 
+000008a0: 746f 6f6c 5f63 6174 6567 6f72 6965 737c  tool_categories|
+000008b0: 6c65 6e67 7468 203e 2031 206f 7220 6361  length > 1 or ca
+000008c0: 7465 676f 7279 2e67 726f 7570 6572 2025  tegory.grouper %
+000008d0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000008e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000008f0: 2020 3c6f 7074 6772 6f75 7020 6c61 6265    <optgroup labe
+00000900: 6c3d 227b 7b20 6361 7465 676f 7279 2e67  l="{{ category.g
+00000910: 726f 7570 6572 7c64 6566 6175 6c74 5f69  rouper|default_i
+00000920: 665f 6e6f 6e65 3a27 556e 6361 7465 676f  f_none:'Uncatego
+00000930: 7269 7a65 6427 207d 7d22 3e0a 2020 2020  rized' }}">.    
+00000940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000950: 2020 2020 2020 2020 2020 2020 7b25 2065              {% e
+00000960: 6e64 6966 2025 7d0a 2020 2020 2020 2020  ndif %}.        
+00000970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000980: 2020 2020 2020 2020 7b25 2066 6f72 2069          {% for i
+00000990: 7465 6d20 696e 2063 6174 6567 6f72 792e  tem in category.
+000009a0: 6c69 7374 2025 7d3c 6f70 7469 6f6e 2076  list %}<option v
+000009b0: 616c 7565 3d22 7b7b 2069 7465 6d2e 6964  alue="{{ item.id
+000009c0: 207d 7d22 3e7b 7b20 6974 656d 2e6e 616d   }}">{{ item.nam
+000009d0: 6520 7d7d 3c2f 6f70 7469 6f6e 3e7b 2520  e }}</option>{% 
+000009e0: 656e 6466 6f72 2025 7d0a 2020 2020 2020  endfor %}.      
+000009f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a00: 2020 2020 2020 2020 2020 7b25 2069 6620            {% if 
+00000a10: 746f 6f6c 5f63 6174 6567 6f72 6965 737c  tool_categories|
+00000a20: 6c65 6e67 7468 203e 2031 206f 7220 6361  length > 1 or ca
+00000a30: 7465 676f 7279 2e67 726f 7570 6572 2025  tegory.grouper %
+00000a40: 7d3c 2f6f 7074 6772 6f75 703e 7b25 2065  }</optgroup>{% e
+00000a50: 6e64 6966 2025 7d0a 2020 2020 2020 2020  ndif %}.        
+00000a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a70: 7b25 2065 6e64 666f 7220 257d 0a20 2020  {% endfor %}.   
+00000a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000a90: 203c 2f73 656c 6563 743e 0a20 2020 2020   </select>.     
+00000aa0: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
+00000ab0: 3e0a 2020 2020 2020 2020 2020 2020 3c2f  >.            </
+00000ac0: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
+00000ad0: 203c 6469 7620 6964 3d22 6172 6561 5f73   <div id="area_s
+00000ae0: 656c 6563 7422 2063 6c61 7373 3d22 666f  elect" class="fo
+00000af0: 726d 2d67 726f 7570 2069 7465 6d5f 7365  rm-group item_se
+00000b00: 6c65 6374 2220 7374 796c 653d 2264 6973  lect" style="dis
+00000b10: 706c 6179 3a20 6e6f 6e65 223e 0a20 2020  play: none">.   
+00000b20: 2020 2020 2020 2020 2020 2020 203c 6c61               <la
+00000b30: 6265 6c20 636c 6173 733d 2263 6f6e 7472  bel class="contr
+00000b40: 6f6c 2d6c 6162 656c 2063 6f6c 2d73 6d2d  ol-label col-sm-
+00000b50: 3222 2066 6f72 3d22 6172 6561 223e 0a20  2" for="area">. 
+00000b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b70: 2020 203c 7374 726f 6e67 3e41 7265 613c     <strong>Area<
+00000b80: 2f73 7472 6f6e 673e 0a20 2020 2020 2020  /strong>.       
+00000b90: 2020 2020 2020 2020 203c 2f6c 6162 656c           </label
+00000ba0: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00000bb0: 2020 3c64 6976 2063 6c61 7373 3d22 636f    <div class="co
+00000bc0: 6c2d 736d 2d34 223e 0a20 2020 2020 2020  l-sm-4">.       
+00000bd0: 2020 2020 2020 2020 2020 2020 203c 7365               <se
+00000be0: 6c65 6374 2069 643d 2261 7265 6122 206e  lect id="area" n
+00000bf0: 616d 653d 2261 7265 6122 2063 6c61 7373  ame="area" class
+00000c00: 3d22 666f 726d 2d63 6f6e 7472 6f6c 2220  ="form-control" 
+00000c10: 6f6e 6368 616e 6765 3d22 7261 7465 5f74  onchange="rate_t
+00000c20: 7970 655f 7365 6c65 6374 696f 6e28 2741  ype_selection('A
+00000c30: 7265 6127 2c20 7468 6973 2e76 616c 7565  rea', this.value
+00000c40: 2922 3e0a 2020 2020 2020 2020 2020 2020  )">.            
+00000c50: 2020 2020 2020 2020 2020 2020 3c6f 7074              <opt
+00000c60: 696f 6e20 6469 7361 626c 6564 2073 656c  ion disabled sel
+00000c70: 6563 7465 643e 4368 6f6f 7365 2061 6e20  ected>Choose an 
+00000c80: 6172 6561 3c2f 6f70 7469 6f6e 3e0a 2020  area</option>.  
+00000c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ca0: 2020 2020 2020 7b25 2069 6620 6172 6561        {% if area
+00000cb0: 737c 6c65 6e67 7468 203d 3d20 3120 257d  s|length == 1 %}
+00000cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000cd0: 2020 2020 2020 2020 2020 2020 203c 6f70               <op
+00000ce0: 7469 6f6e 2076 616c 7565 3d22 7b7b 2061  tion value="{{ a
+00000cf0: 7265 6173 2e30 2e69 6420 7d7d 223e 7b7b  reas.0.id }}">{{
+00000d00: 2061 7265 6173 2e30 207d 7d3c 2f6f 7074   areas.0 }}</opt
+00000d10: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00000d20: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00000d30: 656c 6966 2061 7265 6173 2025 7d0a 2020  elif areas %}.  
+00000d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000d50: 2020 2020 2020 2020 2020 3c6f 7074 696f            <optio
+00000d60: 6e20 6469 7361 626c 6564 2073 656c 6563  n disabled selec
+00000d70: 7465 6420 7661 6c75 653d 2222 3e43 686f  ted value="">Cho
+00000d80: 6f73 6520 616e 2061 7265 613c 2f6f 7074  ose an area</opt
+00000d90: 696f 6e3e 0a20 2020 2020 2020 2020 2020  ion>.           
+00000da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000db0: 207b 2520 666f 7220 6172 6561 2069 6e20   {% for area in 
+00000dc0: 6172 6561 7320 257d 3c6f 7074 696f 6e20  areas %}<option 
+00000dd0: 7661 6c75 653d 227b 7b20 6172 6561 2e69  value="{{ area.i
+00000de0: 6420 7d7d 223e 7b7b 2061 7265 612e 6e61  d }}">{{ area.na
+00000df0: 6d65 207d 7d3c 2f6f 7074 696f 6e3e 7b25  me }}</option>{%
+00000e00: 2065 6e64 666f 7220 257d 0a20 2020 2020   endfor %}.     
+00000e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e20: 2020 207b 2520 656e 6469 6620 257d 0a20     {% endif %}. 
+00000e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e40: 2020 203c 2f73 656c 6563 743e 0a20 2020     </select>.   
+00000e50: 2020 2020 2020 2020 2020 2020 203c 2f64               </d
+00000e60: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00000e70: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00000e80: 2020 203c 6469 7620 6964 3d22 636f 6e73     <div id="cons
+00000e90: 756d 6162 6c65 5f73 656c 6563 7422 2063  umable_select" c
+00000ea0: 6c61 7373 3d22 666f 726d 2d67 726f 7570  lass="form-group
+00000eb0: 2069 7465 6d5f 7365 6c65 6374 2220 7374   item_select" st
+00000ec0: 796c 653d 2264 6973 706c 6179 3a20 6e6f  yle="display: no
+00000ed0: 6e65 223e 0a20 2020 2020 2020 2020 2020  ne">.           
+00000ee0: 2020 2020 203c 6c61 6265 6c20 636c 6173       <label clas
+00000ef0: 733d 2263 6f6e 7472 6f6c 2d6c 6162 656c  s="control-label
+00000f00: 2063 6f6c 2d73 6d2d 3222 2066 6f72 3d22   col-sm-2" for="
+00000f10: 636f 6e73 756d 6162 6c65 223e 0a20 2020  consumable">.   
+00000f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000f30: 203c 7374 726f 6e67 3e53 7570 706c 793c   <strong>Supply<
+00000f40: 2f73 7472 6f6e 673e 0a20 2020 2020 2020  /strong>.       
+00000f50: 2020 2020 2020 2020 203c 2f6c 6162 656c           </label
+00000f60: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00000f70: 2020 3c64 6976 2063 6c61 7373 3d22 636f    <div class="co
+00000f80: 6c2d 736d 2d34 223e 0a20 2020 2020 2020  l-sm-4">.       
+00000f90: 2020 2020 2020 2020 2020 2020 203c 7365               <se
+00000fa0: 6c65 6374 2069 643d 2263 6f6e 7375 6d61  lect id="consuma
+00000fb0: 626c 6522 0a20 2020 2020 2020 2020 2020  ble".           
+00000fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000fd0: 206e 616d 653d 2263 6f6e 7375 6d61 626c   name="consumabl
+00000fe0: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
+00000ff0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00001000: 6c61 7373 3d22 666f 726d 2d63 6f6e 7472  lass="form-contr
+00001010: 6f6c 220a 2020 2020 2020 2020 2020 2020  ol".            
+00001020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001030: 6f6e 6368 616e 6765 3d22 7261 7465 5f74  onchange="rate_t
+00001040: 7970 655f 7365 6c65 6374 696f 6e28 2743  ype_selection('C
+00001050: 4f4e 5355 4d41 424c 4527 2c20 7468 6973  ONSUMABLE', this
+00001060: 2e76 616c 7565 2922 3e0a 2020 2020 2020  .value)">.      
+00001070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001080: 2020 3c6f 7074 696f 6e20 6469 7361 626c    <option disabl
+00001090: 6564 2073 656c 6563 7465 6420 7661 6c75  ed selected valu
+000010a0: 653d 2222 3e43 686f 6f73 6520 6120 7375  e="">Choose a su
+000010b0: 7070 6c79 3c2f 6f70 7469 6f6e 3e0a 2020  pply</option>.  
+000010c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000010d0: 2020 2020 2020 7b25 2072 6567 726f 7570        {% regroup
+000010e0: 2063 6f6e 7375 6d61 626c 6573 2062 7920   consumables by 
+000010f0: 6361 7465 676f 7279 2061 7320 636f 6e73  category as cons
+00001100: 756d 6162 6c65 5f63 6174 6567 6f72 6965  umable_categorie
+00001110: 7320 257d 0a20 2020 2020 2020 2020 2020  s %}.           
+00001120: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00001130: 666f 7220 6361 7465 676f 7279 2069 6e20  for category in 
+00001140: 636f 6e73 756d 6162 6c65 5f63 6174 6567  consumable_categ
+00001150: 6f72 6965 7320 257d 0a20 2020 2020 2020  ories %}.       
+00001160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001170: 2020 2020 207b 2520 6966 2063 6f6e 7375       {% if consu
+00001180: 6d61 626c 655f 6361 7465 676f 7269 6573  mable_categories
+00001190: 7c6c 656e 6774 6820 3e20 3120 6f72 2063  |length > 1 or c
+000011a0: 6174 6567 6f72 792e 6772 6f75 7065 7220  ategory.grouper 
+000011b0: 257d 0a20 2020 2020 2020 2020 2020 2020  %}.             
+000011c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011d0: 2020 203c 6f70 7467 726f 7570 206c 6162     <optgroup lab
+000011e0: 656c 3d22 7b7b 2063 6174 6567 6f72 792e  el="{{ category.
+000011f0: 6772 6f75 7065 727c 6465 6661 756c 745f  grouper|default_
+00001200: 6966 5f6e 6f6e 653a 2255 6e63 6174 6567  if_none:"Uncateg
+00001210: 6f72 697a 6564 2220 7d7d 223e 0a20 2020  orized" }}">.   
+00001220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001230: 2020 2020 2020 2020 2020 2020 207b 2520               {% 
+00001240: 656e 6469 6620 257d 0a20 2020 2020 2020  endif %}.       
+00001250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001260: 2020 2020 2020 2020 207b 2520 666f 7220           {% for 
+00001270: 6974 656d 2069 6e20 6361 7465 676f 7279  item in category
+00001280: 2e6c 6973 7420 257d 3c6f 7074 696f 6e20  .list %}<option 
+00001290: 7661 6c75 653d 227b 7b20 6974 656d 2e69  value="{{ item.i
+000012a0: 6420 7d7d 223e 7b7b 2069 7465 6d2e 6e61  d }}">{{ item.na
+000012b0: 6d65 207d 7d3c 2f6f 7074 696f 6e3e 7b25  me }}</option>{%
+000012c0: 2065 6e64 666f 7220 257d 0a20 2020 2020   endfor %}.     
+000012d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012e0: 2020 2020 2020 2020 2020 207b 2520 6966             {% if
+000012f0: 2063 6f6e 7375 6d61 626c 655f 6361 7465   consumable_cate
+00001300: 676f 7269 6573 7c6c 656e 6774 6820 3e20  gories|length > 
+00001310: 3120 6f72 2063 6174 6567 6f72 792e 6772  1 or category.gr
+00001320: 6f75 7065 7220 257d 3c2f 6f70 7467 726f  ouper %}</optgro
+00001330: 7570 3e7b 2520 656e 6469 6620 257d 0a20  up>{% endif %}. 
+00001340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001350: 2020 2020 2020 207b 2520 656e 6466 6f72         {% endfor
+00001360: 2025 7d0a 2020 2020 2020 2020 2020 2020   %}.            
+00001370: 2020 2020 2020 2020 3c2f 7365 6c65 6374          </select
+00001380: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
+00001390: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+000013a0: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
+000013b0: 2020 2020 7b25 2065 6c73 6520 257d 0a20      {% else %}. 
+000013c0: 2020 2020 2020 2020 2020 207b 2520 666f             {% fo
+000013d0: 7220 7261 7465 5f66 6f72 6d20 696e 2066  r rate_form in f
+000013e0: 6f72 6d73 2025 7d0a 2020 2020 2020 2020  orms %}.        
+000013f0: 2020 2020 2020 2020 7b25 2069 6e63 6c75          {% inclu
+00001400: 6465 2022 7261 7465 732f 7261 7465 5f66  de "rates/rate_f
+00001410: 6f72 6d5f 6465 7461 696c 732e 6874 6d6c  orm_details.html
+00001420: 2220 7769 7468 2072 6174 655f 666f 726d  " with rate_form
+00001430: 3d72 6174 655f 666f 726d 2025 7d0a 2020  =rate_form %}.  
+00001440: 2020 2020 2020 2020 2020 7b25 2065 6e64            {% end
+00001450: 666f 7220 257d 0a20 2020 2020 2020 2020  for %}.         
+00001460: 2020 203c 6469 7620 636c 6173 733d 2263     <div class="c
+00001470: 6f6c 2d73 6d2d 3620 7465 7874 2d72 6967  ol-sm-6 text-rig
+00001480: 6874 223e 7b25 2062 7574 746f 6e20 7479  ht">{% button ty
+00001490: 7065 3d22 7361 7665 2220 7661 6c75 653d  pe="save" value=
+000014a0: 2243 6f6e 6669 726d 2220 257d 3c2f 6469  "Confirm" %}</di
+000014b0: 763e 0a20 2020 2020 2020 207b 2520 656e  v>.        {% en
+000014c0: 6469 6620 257d 0a20 2020 203c 2f66 6f72  dif %}.    </for
+000014d0: 6d3e 0a20 2020 203c 7363 7269 7074 3e0a  m>.    <script>.
+000014e0: 0966 756e 6374 696f 6e20 7261 7465 5f74  .function rate_t
+000014f0: 7970 655f 7365 6c65 6374 696f 6e28 7261  ype_selection(ra
+00001500: 7465 5f74 7970 652c 2069 6429 0a20 2020  te_type, id).   
+00001510: 207b 0a20 2020 2020 2020 2069 6620 2872   {.        if (r
+00001520: 6174 655f 7479 7065 290a 2020 2020 2020  ate_type).      
+00001530: 2020 7b0a 0909 0969 6620 2869 6429 0a09    {....if (id)..
+00001540: 0909 7b0a 0909 0909 7769 6e64 6f77 2e6c  ..{.....window.l
+00001550: 6f63 6174 696f 6e20 3d20 277b 2520 7572  ocation = '{% ur
+00001560: 6c20 2763 7265 6174 655f 7261 7465 2720  l 'create_rate' 
+00001570: 2774 6f6f 6c27 2027 3939 3939 2720 257d  'tool' '9999' %}
+00001580: 272e 7265 706c 6163 6528 2774 6f6f 6c27  '.replace('tool'
+00001590: 2c20 7261 7465 5f74 7970 6529 2e72 6570  , rate_type).rep
+000015a0: 6c61 6365 2827 3939 3939 272c 2069 6429  lace('9999', id)
+000015b0: 3b0a 0909 097d 0a09 0909 656c 7365 2069  ;....}....else i
+000015c0: 6620 2872 6174 655f 7479 7065 2e74 6f4c  f (rate_type.toL
+000015d0: 6f77 6572 4361 7365 2829 2021 3d3d 2027  owerCase() !== '
+000015e0: 746f 6f6c 2720 2626 2072 6174 655f 7479  tool' && rate_ty
+000015f0: 7065 2e74 6f4c 6f77 6572 4361 7365 2829  pe.toLowerCase()
+00001600: 2021 3d3d 2027 6172 6561 2720 2626 2072   !== 'area' && r
+00001610: 6174 655f 7479 7065 2e74 6f4c 6f77 6572  ate_type.toLower
+00001620: 4361 7365 2829 2021 3d3d 2027 636f 6e73  Case() !== 'cons
+00001630: 756d 6162 6c65 2729 0a09 0909 7b0a 0909  umable')....{...
+00001640: 0909 7769 6e64 6f77 2e6c 6f63 6174 696f  ..window.locatio
+00001650: 6e20 3d20 277b 2520 7572 6c20 2763 7265  n = '{% url 'cre
+00001660: 6174 655f 7261 7465 2720 2774 6f6f 6c27  ate_rate' 'tool'
+00001670: 2025 7d27 2e72 6570 6c61 6365 2827 746f   %}'.replace('to
+00001680: 6f6c 272c 2072 6174 655f 7479 7065 293b  ol', rate_type);
+00001690: 0a09 0909 7d0a 0909 0965 6c73 650a 0909  ....}....else...
+000016a0: 097b 0a20 2020 2020 2020 2020 2020 2020  .{.             
+000016b0: 2020 2024 2827 2e69 7465 6d5f 7365 6c65     $('.item_sele
+000016c0: 6374 2729 2e68 6964 6528 293b 0a09 0909  ct').hide();....
+000016d0: 0924 2827 2327 2b72 6174 655f 7479 7065  .$('#'+rate_type
+000016e0: 2e74 6f4c 6f77 6572 4361 7365 2829 2b22  .toLowerCase()+"
+000016f0: 5f73 656c 6563 7422 292e 7368 6f77 2829  _select").show()
+00001700: 3b0a 0909 097d 0a20 2020 2020 2020 207d  ;....}.        }
+00001710: 0a09 7d0a 2020 2020 6675 6e63 7469 6f6e  ..}.    function
+00001720: 2061 6464 5f72 6174 655f 666f 726d 2866   add_rate_form(f
+00001730: 6f72 6d5f 6e75 6d62 6572 290a 2020 2020  orm_number).    
+00001740: 7b0a 2020 2020 2020 2020 7b23 2046 6967  {.        {# Fig
+00001750: 7572 6520 6f75 7420 7468 6520 6d61 7820  ure out the max 
+00001760: 666f 726d 206e 756d 6265 7220 746f 2073  form number to s
+00001770: 656e 6420 6974 2023 7d0a 2020 2020 2020  end it #}.      
+00001780: 2020 6c65 7420 666f 726d 5f6e 756d 6265    let form_numbe
+00001790: 725f 696e 7075 7473 203d 2064 6f63 756d  r_inputs = docum
+000017a0: 656e 742e 7175 6572 7953 656c 6563 746f  ent.querySelecto
+000017b0: 7241 6c6c 2827 696e 7075 745b 6e61 6d65  rAll('input[name
+000017c0: 3d22 666f 726d 5f6e 756d 6265 7273 5b5d  ="form_numbers[]
+000017d0: 225d 2729 3b0a 2020 2020 2020 2020 6c65  "]');.        le
+000017e0: 7420 6d61 785f 666f 726d 5f6e 756d 6265  t max_form_numbe
+000017f0: 7220 3d20 303b 0a20 2020 2020 2020 2066  r = 0;.        f
+00001800: 6f72 2028 6c65 7420 693d 303b 2069 203c  or (let i=0; i <
+00001810: 2066 6f72 6d5f 6e75 6d62 6572 5f69 6e70   form_number_inp
+00001820: 7574 732e 6c65 6e67 7468 3b20 692b 2b29  uts.length; i++)
+00001830: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00001840: 2020 2020 2020 206d 6178 5f66 6f72 6d5f         max_form_
+00001850: 6e75 6d62 6572 203d 204d 6174 682e 6d61  number = Math.ma
+00001860: 7828 6d61 785f 666f 726d 5f6e 756d 6265  x(max_form_numbe
+00001870: 722c 2070 6172 7365 496e 7428 666f 726d  r, parseInt(form
+00001880: 5f6e 756d 6265 725f 696e 7075 7473 5b69  _number_inputs[i
+00001890: 5d2e 7661 6c75 6529 293b 0a09 097d 0a20  ].value));...}. 
+000018a0: 2020 2020 2020 206c 6574 2072 6174 655f         let rate_
+000018b0: 666f 726d 5f75 726c 203d 2027 7b25 2075  form_url = '{% u
+000018c0: 726c 2027 6e65 775f 7469 6d65 5f72 6174  rl 'new_time_rat
+000018d0: 655f 666f 726d 2720 257d 3f27 3b0a 2020  e_form' %}?';.  
+000018e0: 2020 2020 2020 7261 7465 5f66 6f72 6d5f        rate_form_
+000018f0: 7572 6c20 2b3d 2027 2663 6f75 6e74 3d27  url += '&count='
+00001900: 202b 2028 6d61 785f 666f 726d 5f6e 756d   + (max_form_num
+00001910: 6265 7220 2b20 3129 3b0a 2020 2020 2020  ber + 1);.      
+00001920: 2020 666f 7220 286c 6574 2066 6965 6c64    for (let field
+00001930: 206f 6620 5b27 7479 7065 272c 2027 6361   of ['type', 'ca
+00001940: 7465 676f 7279 272c 2027 746f 6f6c 272c  tegory', 'tool',
+00001950: 2027 6172 6561 272c 2027 636f 6e73 756d   'area', 'consum
+00001960: 6162 6c65 275d 290a 2020 2020 2020 2020  able']).        
+00001970: 7b0a 2020 2020 2020 2020 2020 2020 6c65  {.            le
+00001980: 7420 696e 7075 745f 6e61 6d65 203d 2066  t input_name = f
+00001990: 6f72 6d5f 6e75 6d62 6572 202b 2022 5f22  orm_number + "_"
+000019a0: 202b 2066 6965 6c64 3b0a 0909 0972 6174   + field;....rat
+000019b0: 655f 666f 726d 5f75 726c 202b 3d20 2726  e_form_url += '&
+000019c0: 2720 2b20 6669 656c 6420 2b20 273d 2720  ' + field + '=' 
+000019d0: 2b20 2428 2769 6e70 7574 5b6e 616d 653d  + $('input[name=
+000019e0: 2227 2b69 6e70 7574 5f6e 616d 652b 2722  "'+input_name+'"
+000019f0: 5d27 292e 7661 6c28 293b 0a20 2020 2020  ]').val();.     
+00001a00: 2020 207d 0a20 2020 2020 2020 2024 2e67     }.        $.g
+00001a10: 6574 2872 6174 655f 666f 726d 5f75 726c  et(rate_form_url
+00001a20: 2c20 6675 6e63 7469 6f6e 2028 636f 6e74  , function (cont
+00001a30: 656e 7429 0a20 2020 2020 2020 207b 0a20  ent).        {. 
+00001a40: 2020 2020 2020 2020 2020 2024 2827 2327             $('#'
+00001a50: 2b66 6f72 6d5f 6e75 6d62 6572 2b27 5f66  +form_number+'_f
+00001a60: 6f72 6d27 292e 6166 7465 7228 636f 6e74  orm').after(cont
+00001a70: 656e 7429 3b0a 2020 2020 2020 2020 7d0a  ent);.        }.
+00001a80: 2020 2020 2020 2020 293b 0a09 7d0a 2020          );..}.  
+00001a90: 2020 6675 6e63 7469 6f6e 2064 656c 6574    function delet
+00001aa0: 655f 7261 7465 5f66 6f72 6d28 666f 726d  e_rate_form(form
+00001ab0: 5f6e 756d 6265 722c 2072 6174 655f 6964  _number, rate_id
+00001ac0: 290a 2020 2020 7b0a 2020 2020 2020 2020  ).    {.        
+00001ad0: 6c65 7420 7375 6363 6573 735f 6361 6c6c  let success_call
+00001ae0: 6261 636b 203d 2066 756e 6374 696f 6e20  back = function 
+00001af0: 2829 207b 2024 2827 2327 2b66 6f72 6d5f  () { $('#'+form_
+00001b00: 6e75 6d62 6572 2b27 5f66 6f72 6d27 292e  number+'_form').
+00001b10: 7265 6d6f 7665 2829 3b20 7d0a 2020 2020  remove(); }.    
+00001b20: 2020 2020 6966 2028 7261 7465 5f69 6429      if (rate_id)
+00001b30: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00001b40: 2020 2020 2020 2069 6620 2863 6f6e 6669         if (confi
+00001b50: 726d 2822 4172 6520 796f 7520 7375 7265  rm("Are you sure
+00001b60: 2079 6f75 2077 616e 7420 746f 2064 656c   you want to del
+00001b70: 6574 6520 7468 6973 2072 6174 653f 2054  ete this rate? T
+00001b80: 6869 7320 6361 6e6e 6f74 2062 6520 756e  his cannot be un
+00001b90: 646f 6e65 2e22 2929 0a20 2020 2020 2020  done.")).       
+00001ba0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00001bb0: 2020 2009 616a 6178 5f67 6574 2827 7b25     .ajax_get('{%
+00001bc0: 2075 726c 2027 6465 6c65 7465 5f72 6174   url 'delete_rat
+00001bd0: 655f 7469 6d65 2720 2739 3939 3927 2025  e_time' '9999' %
+00001be0: 7d27 2e72 6570 6c61 6365 2827 3939 3939  }'.replace('9999
+00001bf0: 272c 2072 6174 655f 6964 292c 2075 6e64  ', rate_id), und
+00001c00: 6566 696e 6564 2c20 7375 6363 6573 735f  efined, success_
+00001c10: 6361 6c6c 6261 636b 2c20 616a 6178 5f66  callback, ajax_f
+00001c20: 6169 6c75 7265 5f63 616c 6c62 6163 6b28  ailure_callback(
+00001c30: 2745 7272 6f72 2064 656c 6574 696e 6720  'Error deleting 
+00001c40: 7261 7465 2729 293b 0a20 2020 2020 2020  rate'));.       
+00001c50: 2020 2020 207d 0a09 097d 0a20 2020 2020       }...}.     
+00001c60: 2020 2065 6c73 650a 2020 2020 2020 2020     else.        
+00001c70: 7b0a 2020 2020 2020 2020 2020 2020 7375  {.            su
+00001c80: 6363 6573 735f 6361 6c6c 6261 636b 2829  ccess_callback()
+00001c90: 3b0a 2020 2020 2020 2020 7d0a 097d 0a09  ;.        }..}..
+00001ca0: 0a20 2020 203c 2f73 6372 6970 743e 0a7b  .    </script>.{
+00001cb0: 2520 656e 6462 6c6f 636b 2025 7d0a       % endblock %}.
```

## NEMO_billing/rates/templates/rates/rate_form_details.html

```diff
@@ -1,102 +1,145 @@
 {% load custom_tags_and_filters %}
 {# Making this condition into number to use it more easily in the template #}
 {# This is equivalent to display_rate_time = rate_form.time.value or show_rate_time #}
 {% with form_has_time=rate_form.time.value|yesno:"1,0" show_time_var=show_rate_time|yesno:"1,0" %}
-	{% with display_rate_time=form_has_time|add:show_time_var %}
-		<div id="{{ rate_form.form_number }}_form">
-			<input type="hidden" name="form_numbers[]" value="{{ rate_form.form_number }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_id" value="{{ rate_form.instance.id|default_if_none:'' }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_type" value="{{ rate_form.instance.type.id }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_category" value="{{ rate_form.instance.category.id }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_tool" value="{{ rate_form.instance.tool.id }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_area" value="{{ rate_form.instance.area.id }}">
-			<input type="hidden" name="{{ rate_form.form_number }}_consumable" value="{{ rate_form.instance.consumable.id }}">
-			<div class="form-group">
-				<div class="h4 col-sm-6 {% if not display_rate_time %}tool-rate-section{% else %}text-right{% endif %}" style="padding-left: 0; padding-right: 0">
-					<div class="col-sm-12">
-						<span style="margin-right: 10px">
-							{% if not display_rate_time %}{{ rate_form.display_title }}{% else %}{{ rate_form.instance.time.name|default:"New time" }}{% endif %}
-						</span>
-						{% if rate_times and not display_rate_time and rate_form.instance.type.can_have_rate_time %}
-							<button title="Click to add a different rate time" type="button" onclick="add_rate_form('{{ rate_form.form_number }}');" class="btn-success btn btn-xs pull-right"><i style="margin-right: 5px" class="glyphicon-plus-sign glyphicon"></i>Add new time</button>
-						{% endif %}
-						{% if display_rate_time %}
-							<button title="Delete this rate time" type="button" onclick="delete_rate_form('{{ rate_form.form_number }}', '{{ rate_form.instance.id|default_if_none:'' }}');" class="btn-danger btn btn-xs pull-right"><span class="glyphicon-trash glyphicon"></span></button>
-						{% endif %}
-					</div>
-				</div>
-				{% if rate_form.non_field_errors %}
-					<div class="col-sm-6 form-control-static danger-highlight tool-rate-section" style="border-top: none">
-						{{ rate_form.non_field_errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			{% if display_rate_time %}
-				<div class="form-group">
-					<label class="control-label col-sm-2" for="{{ rate_form.form_number }}_time"><strong>Time</strong></label>
-					<div class="col-sm-4">
-						<select class="form-control" id="{{ rate_form.form_number }}_time" name="{{ rate_form.form_number }}_time" required>
-							<option value="" disabled selected></option>
-							{% for rate_time in rate_times %}
-								<option value="{{ rate_time.id }}" {% if rate_form.time.value|to_int == rate_time.id %}selected{% endif %}>{{ rate_time }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					{% if rate_form.time.errors %}
-						<div class="col-sm-6 form-control-static danger-highlight">
-							{{ rate_form.time.errors|striptags }}
-						</div>
-					{% endif %}
-				</div>
-			{% endif %}
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="{{ rate_form.form_number }}_amount"><strong>Amount</strong></label>
-				<div class="col-sm-4">
-					<input class="form-control" type="number" step=".01" id="{{ rate_form.form_number }}_amount" name="{{ rate_form.form_number }}_amount" value="{{ rate_form.amount.value }}">
-				</div>
-				{% if rate_form.amount.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ rate_form.amount.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-				<div class="col-sm-4 col-sm-offset-2">
-					<div class="checkbox">
-						<label><input type="checkbox" id="{{ rate_form.form_number }}_flat" name="{{ rate_form.form_number }}_flat" {% if rate_form.flat.value %}checked{% endif %}> Flat</label>
-					</div>
-				</div>
-				{% if rate_form.flat.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ rate_form.flat.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			{% if rate_form.instance.type.type == "TOOL_USAGE" or rate_form.instance.type.type == "AREA_USAGE" %}
-				<div class="form-group">
-					<div class="col-sm-4 col-sm-offset-2">
-						<div class="checkbox">
-							<label><input type="checkbox" id="{{ rate_form.form_number }}_daily" name="{{ rate_form.form_number }}_daily" {% if rate_form.daily.value %}checked{% endif %}> Daily rate</label>
-						</div>
-					</div>
-					{% if rate_form.daily.errors %}
-						<div class="col-sm-6 form-control-static danger-highlight">
-							{{ rate_form.daily.errors|striptags }}
-						</div>
-					{% endif %}
-				</div>
-			{% endif %}
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="{{ rate_form.form_number }}_minimum_charge">Minimum Charge</label>
-				<div class="col-sm-4">
-					<input class="form-control" type="number" step=".01" id="{{ rate_form.form_number }}_minimum_charge" name="{{ rate_form.form_number }}_minimum_charge" value="{{ rate_form.minimum_charge.value }}">
-				</div>
-				{% if rate_form.minimum_charge.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ rate_form.minimum_charge.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-		</div>
-	{% endwith %}
-{% endwith %}
+    {% with display_rate_time=form_has_time|add:show_time_var %}
+        <div id="{{ rate_form.form_number }}_form">
+            <input type="hidden" name="form_numbers[]" value="{{ rate_form.form_number }}">
+            <input type="hidden"
+                   name="{{ rate_form.form_number }}_id"
+                   value="{{ rate_form.instance.id|default_if_none:'' }}">
+            <input type="hidden" name="{{ rate_form.form_number }}_type" value="{{ rate_form.instance.type.id }}">
+            <input type="hidden"
+                   name="{{ rate_form.form_number }}_category"
+                   value="{{ rate_form.instance.category.id }}">
+            <input type="hidden" name="{{ rate_form.form_number }}_tool" value="{{ rate_form.instance.tool.id }}">
+            <input type="hidden" name="{{ rate_form.form_number }}_area" value="{{ rate_form.instance.area.id }}">
+            <input type="hidden"
+                   name="{{ rate_form.form_number }}_consumable"
+                   value="{{ rate_form.instance.consumable.id }}">
+            <div class="form-group">
+                <div class="h4 col-sm-6 {% if not display_rate_time %}tool-rate-section{% else %}text-right{% endif %}"
+                     style="padding-left: 0;
+                            padding-right: 0">
+                    <div class="col-sm-12">
+                        <span style="margin-right: 10px">
+                            {% if not display_rate_time %}
+                                {{ rate_form.display_title }}
+                            {% else %}
+                                {{ rate_form.instance.time.name|default:"New time" }}
+                            {% endif %}
+                        </span>
+                        {% if rate_times and not display_rate_time and rate_form.instance.type.can_have_rate_time %}
+                            <button title="Click to add a different rate time"
+                                    type="button"
+                                    onclick="add_rate_form('{{ rate_form.form_number }}');"
+                                    class="btn-success btn btn-xs pull-right">
+                                <i style="margin-right: 5px" class="glyphicon-plus-sign glyphicon"></i>Add new time
+                            </button>
+                        {% endif %}
+                        {% if display_rate_time %}
+                            <button title="Delete this rate time"
+                                    type="button"
+                                    onclick="delete_rate_form('{{ rate_form.form_number }}', '{{ rate_form.instance.id|default_if_none:'' }}');"
+                                    class="btn-danger btn btn-xs pull-right">
+                                <span class="glyphicon-trash glyphicon"></span>
+                            </button>
+                        {% endif %}
+                    </div>
+                </div>
+                {% if rate_form.non_field_errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight tool-rate-section" style="border-top: none">
+                        {{ rate_form.non_field_errors|striptags }}
+                    </div>
+                {% endif %}
+            </div>
+            {% if display_rate_time %}
+                <div class="form-group">
+                    <label class="control-label col-sm-2" for="{{ rate_form.form_number }}_time">
+                        <strong>Time</strong>
+                    </label>
+                    <div class="col-sm-4">
+                        <select class="form-control"
+                                id="{{ rate_form.form_number }}_time"
+                                name="{{ rate_form.form_number }}_time"
+                                required>
+                            <option value="" disabled selected></option>
+                            {% for rate_time in rate_times %}
+                                <option value="{{ rate_time.id }}" {% if rate_form.time.value|to_int == rate_time.id %}selected{% endif %}>
+                                    {{ rate_time }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    {% if rate_form.time.errors %}
+                        <div class="col-sm-6 form-control-static danger-highlight">{{ rate_form.time.errors|striptags }}</div>
+                    {% endif %}
+                </div>
+            {% endif %}
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="{{ rate_form.form_number }}_amount">
+                    <strong>Amount</strong>
+                </label>
+                <div class="col-sm-4">
+                    <input class="form-control"
+                           type="number"
+                           step=".01"
+                           id="{{ rate_form.form_number }}_amount"
+                           name="{{ rate_form.form_number }}_amount"
+                           value="{{ rate_form.amount.value }}">
+                </div>
+                {% if rate_form.amount.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ rate_form.amount.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            <div class="form-group">
+                <div class="col-sm-4 col-sm-offset-2">
+                    <div class="checkbox">
+                        <label>
+                            <input type="checkbox"
+                                   id="{{ rate_form.form_number }}_flat"
+                                   name="{{ rate_form.form_number }}_flat"
+                                   {% if rate_form.flat.value %}checked{% endif %}>
+                            Flat
+                        </label>
+                    </div>
+                </div>
+                {% if rate_form.flat.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ rate_form.flat.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            {% if rate_form.instance.type.type == "TOOL_USAGE" or rate_form.instance.type.type == "AREA_USAGE" %}
+                <div class="form-group">
+                    <div class="col-sm-4 col-sm-offset-2">
+                        <div class="checkbox">
+                            <label>
+                                <input type="checkbox"
+                                       id="{{ rate_form.form_number }}_daily"
+                                       name="{{ rate_form.form_number }}_daily"
+                                       {% if rate_form.daily.value %}checked{% endif %}>
+                                Daily rate
+                            </label>
+                        </div>
+                    </div>
+                    {% if rate_form.daily.errors %}
+                        <div class="col-sm-6 form-control-static danger-highlight">{{ rate_form.daily.errors|striptags }}</div>
+                    {% endif %}
+                </div>
+            {% endif %}
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="{{ rate_form.form_number }}_minimum_charge">Minimum Charge</label>
+                <div class="col-sm-4">
+                    <input class="form-control"
+                           type="number"
+                           step=".01"
+                           id="{{ rate_form.form_number }}_minimum_charge"
+                           name="{{ rate_form.form_number }}_minimum_charge"
+                           value="{{ rate_form.minimum_charge.value }}">
+                </div>
+                {% if rate_form.minimum_charge.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ rate_form.minimum_charge.errors|striptags }}</div>
+                {% endif %}
+            </div>
+        </div>
+    {% endwith %}
+{% endwith %}
```

## NEMO_billing/rates/templates/rates/rate_list.html

```diff
@@ -1,100 +1,116 @@
 {% load static %}
 {% load custom_tags_and_filters %}
 <!DOCTYPE html>
 <html lang="en">
-<head>
-	{# This meta-tag forcefully disables 'compatibility mode' in Internet Explorer because it causes rendering problems. #}
-	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
-	<meta charset="UTF-8">
-
-	{# jQuery #}
-    <script type="text/javascript" src="{% static "jquery.min.js" %}"></script>
-
-	{# Bootstrap #}
-    <script type="text/javascript" src="{% static "bootstrap/js/bootstrap.min.js" %}"></script>
-    <link rel="stylesheet" type="text/css" href="{% static "bootstrap/css/bootstrap.min.css" %}"/>
-    <link rel="stylesheet" type="text/css" href="{% static "bootstrap/css/bootstrap-theme.min.css" %}"/>
-
-	{# NEMO #}
-    <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon.ico' %}"/>
-	<script type="text/javascript" src="{% static "nemo.js" %}"></script>
-	<link rel="stylesheet" type="text/css" href="{% static "nemo.css" %}"/>
-	<style>
+    <head>
+        {# This meta-tag forcefully disables 'compatibility mode' in Internet Explorer because it causes rendering problems. #}
+        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
+        <meta charset="UTF-8">
+        {# jQuery #}
+        <script type="text/javascript" src="{% static "jquery.min.js" %}"></script>
+        {# Bootstrap #}
+        <script type="text/javascript" src="{% static "bootstrap/js/bootstrap.min.js" %}"></script>
+        <link rel="stylesheet" type="text/css" href="{% static "bootstrap/css/bootstrap.min.css" %}" />
+        <link rel="stylesheet" type="text/css" href="{% static "bootstrap/css/bootstrap-theme.min.css" %}" />
+        {# NEMO #}
+        <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon.ico' %}" />
+        <script type="text/javascript" src="{% static "nemo.js" %}"></script>
+        <link rel="stylesheet" type="text/css" href="{% static "nemo.css" %}" />
+        <style>
 		.primary-rate {
 			font-weight:700
 		}
-	</style>
-
-	<title>Rate List</title>
-</head>
-<body>
-	<div class="body-container">
-		<div class="container">
-			<div class="row">
-				<div class="col-xs-12">
-					<h1>{{ facility_name }} Rate List</h1>
-				</div>
-			</div>
-			<div class="row" style="margin-bottom: 40px">
-				<div class="col-sm-4">
-					<input id="search" type="text" placeholder="Search for a rate" class="form-control" autofocus>
-				</div>
-			</div>
-			<div class="pull-left">
-				<ul class="nav nav-pills nav-pills-spacer" id="tabs" style="border-bottom: none;">
-					{% if show_tools_type %}<li {% if rate_type|lower == 'tool' %}class="active"{% endif %}><a href="{% url 'rate_list' 'Tool' %}">Tools</a></li>{% endif %}
-					{% if show_areas_type %}<li {% if rate_type|lower == 'area' %}class="active"{% endif %}><a href="{% url 'rate_list' 'Area' %}">Areas</a></li>{% endif %}
-					{% if show_supplies_type %}<li {% if rate_type|lower == 'consumable' %}class="active"{% endif %}><a href="{% url 'rate_list' 'CONSUMABLE' %}">Supplies</a></li>{% endif %}
-					{% if show_other_type %}<li {% if rate_type|lower == 'other' %}class="active"{% endif %}><a href="{% url 'rate_list' 'other' %}">Other</a></li>{% endif %}
-				</ul>
-			</div>
-
-
-			{% regroup formatted_rates by facility as facility_list %}
-
-			{% for facility in facility_list %}
-
-			<div class="row">
-				<div class="col-xs-12">
-					{% if facility.grouper %}<h2>{{ facility.grouper }}</h2>{% else %}<br/>{% endif %}
-				</div>
-			</div>
-
-			<table class="table table-align-middle table-bordered table-condensed table-hover thead-light">
-				<thead>
-
-						<tr>
-							<th class="text-center col-md-4">{{ item_label }}</th>
-							{% if has_multiple_rate_types %}<th class="text-center col-md-2">Type</th>{% endif %}
-							{% if has_empty_category %}<th class="col-md-2"></th>{% endif %}
-							{% for category in rate_categories %}
-								<th class="text-center">{{ category }}</th>
-							{% endfor %}
-						</tr>
-
-				</thead>
-				<tbody class="table-to-filter">
-				{% for item_rate_type in facility.list %}
-						<tr {% if item_rate_type.is_first %}class="primary-rate"{% else %}class="collapse {{ item_rate_type.item_index }}_details"{% endif %}>
-							<td>{% if item_rate_type.is_first and item_rate_type.has_children %}<a onclick="toggle_rates(this)" class="pointer collapsed" data-toggle="collapse" data-target=".{{ item_rate_type.item_index }}_details"><span class="glyphicon pull-left chevron glyphicon-chevron-right"></span></a>{% endif %}{% if item_rate_type.is_first %}{{ item_rate_type.item|default_if_none:"" }}{% else %}<span style="display:none">{{ item_rate_type.item|default_if_none:"" }}</span>{% endif %}</td>
-							{% if has_multiple_rate_types %}<td>{{ item_rate_type.rate_type }}</td>{% endif %}
-							{% for rate in item_rate_type.rates %}
-								<td>{{rate|safe}}</td>
-							{% endfor %}
-						</tr>
-					{% endfor %}
-				</tbody>
-			</table>
-			{% endfor %}
-
-		</div>
-	</div>
-
-	<script>
+	
+        </style>
+        <title>Rate List</title>
+    </head>
+    <body>
+        <div class="body-container">
+            <div class="container">
+                <div class="row">
+                    <div class="col-xs-12">
+                        <h1>{{ facility_name }} Rate List</h1>
+                    </div>
+                </div>
+                <div class="row" style="margin-bottom: 40px">
+                    <div class="col-sm-4">
+                        <input id="search" type="text" placeholder="Search for a rate" class="form-control" autofocus>
+                    </div>
+                </div>
+                <div class="pull-left">
+                    <ul class="nav nav-pills nav-pills-spacer" id="tabs" style="border-bottom: none;">
+                        {% if show_tools_type %}
+                            <li {% if rate_type|lower == 'tool' %}class="active"{% endif %}>
+                                <a href="{% url 'rate_list' 'Tool' %}">Tools</a>
+                            </li>
+                        {% endif %}
+                        {% if show_areas_type %}
+                            <li {% if rate_type|lower == 'area' %}class="active"{% endif %}>
+                                <a href="{% url 'rate_list' 'Area' %}">Areas</a>
+                            </li>
+                        {% endif %}
+                        {% if show_supplies_type %}
+                            <li {% if rate_type|lower == 'consumable' %}class="active"{% endif %}>
+                                <a href="{% url 'rate_list' 'CONSUMABLE' %}">Supplies</a>
+                            </li>
+                        {% endif %}
+                        {% if show_other_type %}
+                            <li {% if rate_type|lower == 'other' %}class="active"{% endif %}>
+                                <a href="{% url 'rate_list' 'other' %}">Other</a>
+                            </li>
+                        {% endif %}
+                    </ul>
+                </div>
+                {% regroup formatted_rates by facility as facility_list %}
+                {% for facility in facility_list %}
+                    <div class="row">
+                        <div class="col-xs-12">
+                            {% if facility.grouper %}
+                                <h2>{{ facility.grouper }}</h2>
+                            {% else %}
+                                <br />
+                            {% endif %}
+                        </div>
+                    </div>
+                    <table class="table table-align-middle table-bordered table-condensed table-hover thead-light">
+                        <thead>
+                            <tr>
+                                <th class="text-center col-md-4">{{ item_label }}</th>
+                                {% if has_multiple_rate_types %}<th class="text-center col-md-2">Type</th>{% endif %}
+                                {% if has_empty_category %}<th class="col-md-2"></th>{% endif %}
+                                {% for category in rate_categories %}<th class="text-center">{{ category }}</th>{% endfor %}
+                            </tr>
+                        </thead>
+                        <tbody class="table-to-filter">
+                            {% for item_rate_type in facility.list %}
+                                <tr {% if item_rate_type.is_first %}class="primary-rate"{% else %}class="collapse {{ item_rate_type.item_index }}_details"{% endif %}>
+                                    <td>
+                                        {% if item_rate_type.is_first and item_rate_type.has_children %}
+                                            <a onclick="toggle_rates(this)"
+                                               class="pointer collapsed"
+                                               data-toggle="collapse"
+                                               data-target=".{{ item_rate_type.item_index }}_details"><span class="glyphicon pull-left chevron glyphicon-chevron-right"></span></a>
+                                        {% endif %}
+                                        {% if item_rate_type.is_first %}
+                                            {{ item_rate_type.item|default_if_none:"" }}
+                                        {% else %}
+                                            <span style="display:none">{{ item_rate_type.item|default_if_none:"" }}</span>
+                                        {% endif %}
+                                    </td>
+                                    {% if has_multiple_rate_types %}<td>{{ item_rate_type.rate_type }}</td>{% endif %}
+                                    {% for rate in item_rate_type.rates %}<td>{{ rate|safe }}</td>{% endfor %}
+                                </tr>
+                            {% endfor %}
+                        </tbody>
+                    </table>
+                {% endfor %}
+            </div>
+        </div>
+        <script>
 		$("#search").keyup(function ()
         {
             let rows = $(".table-to-filter").find("tr").hide();
             if (this.value.length)
             {
                 let data = this.value.split(" ");
                 $.each(data, function (i, v)
@@ -123,10 +139,11 @@
 			let toggleTarget = $(rateElement).data("target");
 
 			// remove display none inline style from search, conflicts with collapse UI
 			let rateRows = $(".table-to-filter").find(toggleTarget).css("display", "");
 
 			toggle_details(rateElement);
 		}
-	</script>
-</body>
-</html>
+	
+        </script>
+    </body>
+</html>
```

## NEMO_billing/rates/templates/rates/rates.html

```diff
@@ -1,88 +1,104 @@
 {% extends 'pagination/pagination_base.html' %}
 {% block extrahead %}
-	<style>
+    <style>
 		.container .pagination {
 			margin: initial;
 		}
 		.nav-tabs > li.active > a, .nav-tabs > li.active > a:hover {
 			background-color: #e9ecef;
 		}
-	</style>
+	
+    </style>
 {% endblock %}
 {% load custom_tags_and_filters %}
 {% block title %}Rates{% endblock %}
 {% block before_pagination %}
-	<div class="row">
-		<div class="col-xs-7">
-			<h1>Rates</h1>
-		</div>
-		<div class="col-sm-5 text-right">
-			<h1>{% button type="add" url="create_rate" value="New rate" %}</h1>
-		</div>
-	</div>
-	<div class="row" style="margin-bottom: 40px">
-		<div class="col-sm-4">
-			<input id="search" type="text" placeholder="Search for a rate" class="form-control" autofocus>
-		</div>
-	</div>
-
-	<div class="pull-left">
-		<ul class="nav nav-tabs" id="tabs" style="border-bottom: none;">
-			<li {% if rate_type|lower == 'tool' %}class="active"{% endif %}><a href="{% url 'rates' 'Tool' %}">Tools</a></li>
-			<li {% if rate_type|lower == 'area' %}class="active"{% endif %}><a href="{% url 'rates' 'Area' %}">Areas</a></li>
-			<li {% if rate_type|lower == 'consumable' %}class="active"{% endif %}><a href="{% url 'rates' 'CONSUMABLE' %}">Supplies</a></li>
-			<li {% if rate_type|lower == 'other' %}class="active"{% endif %}><a href="{% url 'rates' 'other' %}">Other</a></li>
-		</ul>
-	</div>
+    <div class="row">
+        <div class="col-xs-7">
+            <h1>Rates</h1>
+        </div>
+        <div class="col-sm-5 text-right">
+            <h1>{% button type="add" url="create_rate" value="New rate" %}</h1>
+        </div>
+    </div>
+    <div class="row" style="margin-bottom: 40px">
+        <div class="col-sm-4">
+            <input id="search" type="text" placeholder="Search for a rate" class="form-control" autofocus>
+        </div>
+    </div>
+    <div class="pull-left">
+        <ul class="nav nav-tabs" id="tabs" style="border-bottom: none;">
+            <li {% if rate_type|lower == 'tool' %}class="active"{% endif %}>
+                <a href="{% url 'rates' 'Tool' %}">Tools</a>
+            </li>
+            <li {% if rate_type|lower == 'area' %}class="active"{% endif %}>
+                <a href="{% url 'rates' 'Area' %}">Areas</a>
+            </li>
+            <li {% if rate_type|lower == 'consumable' %}class="active"{% endif %}>
+                <a href="{% url 'rates' 'CONSUMABLE' %}">Supplies</a>
+            </li>
+            <li {% if rate_type|lower == 'other' %}class="active"{% endif %}>
+                <a href="{% url 'rates' 'other' %}">Other</a>
+            </li>
+        </ul>
+    </div>
 {% endblock %}
 {% block pagination_content %}
-	{% with 'tool area consumable' as rate_type_list %}
-		<table class="table table-align-middle table-bordered table-condensed table-striped table-hover thead-light">
-			<thead>
-				<tr>
-					{% if rate_type|lower in rate_type_list.split %}
-						<th>{% include 'pagination/pagination_column.html' with order_by=rate_type|lower name=rate_type|lower|capfirst %}</th>
-					{% endif %}
-					{% if show_type %}<th>{% include 'pagination/pagination_column.html' with order_by='type' name='Type' %}</th>{% endif %}
-					{% if show_category %}<th>{% include 'pagination/pagination_column.html' with order_by='category' name='Category' %}</th>{% endif %}
-					{% if show_time %}<th>{% include 'pagination/pagination_column.html' with order_by='time' name='Time' %}</th>{% endif %}
-					<th>{% include 'pagination/pagination_column.html' with order_by='amount' name='Rate' %}</th>
-					<th class="button-column-minimum">{% include 'pagination/pagination_column.html' with order_by='flat' name='Flat Rate' %}</th>
-					<th>{% include 'pagination/pagination_column.html' with order_by='minimum_charge' name='Minimum Charge'%}</th>
-					<th class="text-center button-column-minimum"></th>
-				</tr>
-			</thead>
-			<tbody>
-				{% for rate in page %}
-					<tr>
-						{% if rate_type|lower in rate_type_list.split %}
-							<td>{{ rate.get_item|default_if_none:"" }}</td>
-						{% endif %}
-						{% if show_type %}<td>{{ rate.type }}</td>{% endif %}
-						{% if show_category %}<td>{{ rate.category|default_if_none:"" }}</td>{% endif %}
-						{% if show_time %}<td>{{ rate.time|default_if_none:"" }}</td>{% endif %}
-						<td>{{ rate.amount }}</td>
-						<td class="text-center"><span class="glyphicon {% if rate.flat %}glyphicon-ok success-highlight{% endif %}"></span></td>
-						<td>{{ rate.minimum_charge|default_if_none:'' }}</td>
-						<td>
-							{% if rate.get_item.id %}
-								{% url 'create_rate' rate.type.get_rate_group_type rate.get_item.id as edit_rate_url %}
-								{% button type="edit" size="small" url=edit_rate_url title="Edit rate" value="Edit" %}
-							{% else %}
-								{% url 'create_rate' rate.type.get_rate_group_type as edit_rate_url %}
-								{% button type="edit" size="small" url=edit_rate_url title="Edit rate" value="Edit" %}
-							{% endif %}
-						</td>
-					</tr>
-				{% endfor %}
-			</tbody>
-		</table>
-	{% endwith %}
-	<script>
+    {% with 'tool area consumable' as rate_type_list %}
+        <table class="table table-align-middle table-bordered table-condensed table-striped table-hover thead-light">
+            <thead>
+                <tr>
+                    {% if rate_type|lower in rate_type_list.split %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by=rate_type|lower name=rate_type|lower|capfirst %}</th>
+                    {% endif %}
+                    {% if show_type %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='type' name='Type' %}</th>
+                    {% endif %}
+                    {% if show_category %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='category' name='Category' %}</th>
+                    {% endif %}
+                    {% if show_time %}
+                        <th>{% include 'pagination/pagination_column.html' with order_by='time' name='Time' %}</th>
+                    {% endif %}
+                    <th>{% include 'pagination/pagination_column.html' with order_by='amount' name='Rate' %}</th>
+                    <th class="button-column-minimum">
+                        {% include 'pagination/pagination_column.html' with order_by='flat' name='Flat Rate' %}
+                    </th>
+                    <th>{% include 'pagination/pagination_column.html' with order_by='minimum_charge' name='Minimum Charge' %}</th>
+                    <th class="text-center button-column-minimum"></th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for rate in page %}
+                    <tr>
+                        {% if rate_type|lower in rate_type_list.split %}<td>{{ rate.get_item|default_if_none:"" }}</td>{% endif %}
+                        {% if show_type %}<td>{{ rate.type }}</td>{% endif %}
+                        {% if show_category %}<td>{{ rate.category|default_if_none:"" }}</td>{% endif %}
+                        {% if show_time %}<td>{{ rate.time|default_if_none:"" }}</td>{% endif %}
+                        <td>{{ rate.amount }}</td>
+                        <td class="text-center">
+                            <span class="glyphicon {% if rate.flat %}glyphicon-ok success-highlight{% endif %}"></span>
+                        </td>
+                        <td>{{ rate.minimum_charge|default_if_none:'' }}</td>
+                        <td>
+                            {% if rate.get_item.id %}
+                                {% url 'create_rate' rate.type.get_rate_group_type rate.get_item.id as edit_rate_url %}
+                                {% button type="edit" size="small" url=edit_rate_url title="Edit rate" value="Edit" %}
+                            {% else %}
+                                {% url 'create_rate' rate.type.get_rate_group_type as edit_rate_url %}
+                                {% button type="edit" size="small" url=edit_rate_url title="Edit rate" value="Edit" %}
+                            {% endif %}
+                        </td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% endwith %}
+    <script>
 		function get_rate(jquery_event, search_selection, dataset_name)
 		{
 			if (search_selection.id)
 			{
 				window.location.href = "{% url 'create_rate' 'tool' 999 %}".replace('tool', search_selection.type_value).replace('999', search_selection.id);
 			}
             else
@@ -91,14 +107,17 @@
             }
 		}
 		function on_load()
 		{
 			$("#search").autocomplete('users', get_rate, {{ search_rates }}).focus();
 		}
 		window.addEventListener('load', on_load, true);
-	</script>
+	
+    </script>
 {% endblock %}
 {% block table_empty_content %}
-	<table class="table table-bordered table-condensed table-striped table-hover thead-light">
-		<tr><th style="clear: both; padding: 15px; font-weight: initial">No rates of this type have been created yet.</th></tr>
-	</table>
-{% endblock %}
+    <table class="table table-bordered table-condensed table-striped table-hover thead-light">
+        <tr>
+            <th style="clear: both; padding: 15px; font-weight: initial">No rates of this type have been created yet.</th>
+        </tr>
+    </table>
+{% endblock %}
```

### html2text {}

```diff
@@ -1,23 +1,23 @@
 {% extends 'pagination/pagination_base.html' %} {% block extrahead %}
 {% endblock %} {% load custom_tags_and_filters %} {% block title %}Rates{%
 endblock %} {% block before_pagination %}
 ************ RRaatteess ************
 ************ {{%% bbuuttttoonn ttyyppee==""aadddd"" uurrll==""ccrreeaattee__rraattee"" vvaalluuee==""NNeeww rraattee"" %%}} ************
 [                    ]
-    * % if rate_type|lower == 'tool' %}class="active"{% endif %}>_T_o_o_l_s
-% if rate_type|lower == 'area' %}class="active"{% endif %}>_A_r_e_a_s
-% if rate_type|lower == 'consumable' %}class="active"{% endif %}>_S_u_p_p_l_i_e_s
-% if rate_type|lower == 'other' %}class="active"{% endif %}>_O_t_h_e_r
+    * % if rate_type|lower == 'tool' %}class="active"{% endif %}> _T_o_o_l_s
+% if rate_type|lower == 'area' %}class="active"{% endif %}> _A_r_e_a_s
+% if rate_type|lower == 'consumable' %}class="active"{% endif %}> _S_u_p_p_l_i_e_s
+% if rate_type|lower == 'other' %}class="active"{% endif %}> _O_t_h_e_r
 {% endblock %} {% block pagination_content %} {% with 'tool area consumable' as
 rate_type_list %}
 {{%% iinncclluuddee ''ppaaggiinnaattiioonn//        {{%% iinncclluuddee ''ppaaggiinnaattiioonn// {{%% iinncclluuddee ''ppaaggiinnaattiioonn//        {{%% iinncclluuddee ''ppaaggiinnaattiioonn//    {{%% iinncclluuddee ''ppaaggiinnaattiioonn// {{%% iinncclluuddee ''ppaaggiinnaattiioonn// {{%% iinncclluuddee ''ppaaggiinnaattiioonn//
 ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' wwiitthh   ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' wwiitthh   ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll''    ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' ppaaggiinnaattiioonn__ccoolluummnn..hhttmmll'' wwiitthh
 oorrddeerr__bbyy==rraattee__ttyyppee||lloowweerr       wwiitthh oorrddeerr__bbyy==''ttyyppee''    oorrddeerr__bbyy==''ccaatteeggoorryy''            wwiitthh oorrddeerr__bbyy==''ttiimmee''       wwiitthh oorrddeerr__bbyy==''aammoouunntt''  wwiitthh oorrddeerr__bbyy==''ffllaatt''    oorrddeerr__bbyy==''mmiinniimmuumm__cchhaarrggee''
-nnaammee==rraattee__ttyyppee||lloowweerr||ccaappffiirrsstt  nnaammee==''TTyyppee'' %%}}          nnaammee==''CCaatteeggoorryy'' %%}}             nnaammee==''TTiimmee'' %%}}             nnaammee==''RRaattee'' %%}}          nnaammee==''FFllaatt RRaattee'' %%}}     nnaammee==''MMiinniimmuumm CChhaarrggee''%%}}
+nnaammee==rraattee__ttyyppee||lloowweerr||ccaappffiirrsstt  nnaammee==''TTyyppee'' %%}}          nnaammee==''CCaatteeggoorryy'' %%}}             nnaammee==''TTiimmee'' %%}}             nnaammee==''RRaattee'' %%}}          nnaammee==''FFllaatt RRaattee'' %%}}     nnaammee==''MMiinniimmuumm CChhaarrggee'' %%}}
 %%}}
                                                                                                                                                                                                       {% if rate.get_item.id %} {%
                                                                                                                                                                                                       url 'create_rate'
                                                                                                                                                                                                       rate.type.get_rate_group_type
                                                                                                                                                                                                       rate.get_item.id as
                                                                                                                                                                                                       edit_rate_url %} {% button
 {                                                      {                              {                                                                          {                                    type="edit" size="small"
```

## NEMO_billing/templates/base/navbar.html

```diff
@@ -1,7 +1,7 @@
 {% extends 'base/navbar_base.html' %}
 {% load static %}
 {% load custom_tags_and_filters %}
 {% block navbar_admin %}
-	{{ block.super }}
-	{% include 'base/navbar_billing.html' %}
+    {{ block.super }}
+    {% include 'base/navbar_billing.html' %}
 {% endblock %}
```

## NEMO_billing/templates/base/navbar_billing.html

```diff
@@ -1,14 +1,14 @@
 {% load static %}
 {% load custom_tags_and_filters %}
 {% if user.is_any_part_of_staff %}
-	{% navigation_url 'custom_charges' 'Custom charges' user.is_user_office user.is_accounting_officer user.is_facility_manager user.is_superuser %}
-	{% navigation_url 'invoices' 'Invoices' user.is_user_office user.is_accounting_officer user.is_facility_manager user.is_superuser %}
-	{% navigation_url 'rates' 'Rates' user.is_accounting_officer user.is_facility_manager user.is_superuser %}
-	{% if "NEMO_billing.prepayments"|app_installed and "NEMO_billing.cap_discount"|app_installed %}
-		{% navigation_url 'prepaid_project_status' 'CAP and prepaid status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
-	{% elif "NEMO_billing.prepayments"|app_installed %}
-		{% navigation_url 'prepaid_project_status' 'Prepaid project status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
-	{% elif "NEMO_billing.cap_discount"|app_installed %}
-		{% navigation_url 'cap_discount_status' 'CAP status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
-	{% endif %}
+    {% navigation_url 'custom_charges' 'Custom charges' user.is_user_office user.is_accounting_officer user.is_facility_manager user.is_superuser %}
+    {% navigation_url 'invoices' 'Invoices' user.is_user_office user.is_accounting_officer user.is_facility_manager user.is_superuser %}
+    {% navigation_url 'rates' 'Rates' user.is_accounting_officer user.is_facility_manager user.is_superuser %}
+    {% if "NEMO_billing.prepayments"|app_installed and "NEMO_billing.cap_discount"|app_installed %}
+        {% navigation_url 'prepaid_project_status' 'CAP and prepaid status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
+    {% elif "NEMO_billing.prepayments"|app_installed %}
+        {% navigation_url 'prepaid_project_status' 'Prepaid project status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
+    {% elif "NEMO_billing.cap_discount"|app_installed %}
+        {% navigation_url 'cap_discount_status' 'CAP status' user.is_accounting_officer user.is_user_office user.is_facility_manager user.is_superuser %}
+    {% endif %}
 {% endif %}
```

## NEMO_billing/templates/billing/cap_and_prepaid_base.html

```diff
@@ -1,32 +1,36 @@
 {% extends 'pagination/pagination_base.html' %}
 {% block extrahead %}
-	<style>
+    <style>
 		.panel-body .pagination:last-of-type
         {
 			margin-bottom: 0;
 		}
-	</style>
+	
+    </style>
 {% endblock %}
 {% load custom_tags_and_filters %}
 {% block content %}
-	<h1 style="margin-top: 0; margin-bottom: 25px">{% block tab_title %}{% endblock %}</h1>
-	{% url 'prepaid_project_status' as prepaid_status_url %}
-	{% url 'cap_discount_status' as cap_discount_status_url %}
-	{% if prepaid_status_url and cap_discount_status_url %}
-		<ul class="nav nav-tabs">
-			<li class="nav-item{% if prepaid_status_url in request.path %} active{% endif %}">
-				<a class="nav-link" href="{{ prepaid_status_url }}">Prepaid status</a>
-			</li>
-			<li class="nav-item{% if cap_discount_status_url in request.path %} active{% endif %}">
-				<a class="nav-link" href="{{ cap_discount_status_url }}">CAP status</a>
-			</li>
-		</ul>
-		<div id="contract-panel-content" class="tab-content panel panel-default panel-tab-content info-tooltip-container">
-			<div class="panel-body">
-	{% endif %}
-				{{ block.super }}
-	{% if prepaid_status_url and cap_discount_status_url %}
-			</div>
-		</div>
-	{% endif %}
-{% endblock %}
+    <h1 style="margin-top: 0; margin-bottom: 25px">
+        {% block tab_title %}{% endblock %}
+    </h1>
+    {% url 'prepaid_project_status' as prepaid_status_url %}
+    {% url 'cap_discount_status' as cap_discount_status_url %}
+    {% if prepaid_status_url and cap_discount_status_url %}
+        <ul class="nav nav-tabs">
+            <li class="nav-item{% if prepaid_status_url in request.path %} active{% endif %}">
+                <a class="nav-link" href="{{ prepaid_status_url }}">Prepaid status</a>
+            </li>
+            <li class="nav-item{% if cap_discount_status_url in request.path %} active{% endif %}">
+                <a class="nav-link" href="{{ cap_discount_status_url }}">CAP status</a>
+            </li>
+        </ul>
+        <div id="contract-panel-content"
+             class="tab-content panel panel-default panel-tab-content info-tooltip-container">
+            <div class="panel-body">
+            {% endif %}
+            {{ block.super }}
+            {% if prepaid_status_url and cap_discount_status_url %}
+            </div>
+        </div>
+    {% endif %}
+{% endblock %}
```

## NEMO_billing/templates/billing/custom_charge.html

```diff
@@ -1,152 +1,220 @@
 {% extends "base.html" %}
 {% load static %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 {% block extrahead %}
-	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
-	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
+    <script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
+    <link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}" />
+{% endblock %}
+{% block title %}
+    {% if form.instance.pk %}
+        Edit
+    {% else %}
+        New
+    {% endif %}
+    Custom charge
 {% endblock %}
-{% block title %}{% if form.instance.pk %}Edit{% else %}New{% endif %} Custom charge{% endblock %}
 {% block content %}
-	{% with edit=form.instance.pk %}
-		<h1>{% if edit %}Edit{% else %}New{% endif %} custom charge</h1>
-		{% if form.errors %}
-			<div class="alert alert-danger">
-				Oops! Something went wrong. Please correct the errors highlighted below.<br>
-				{{ form.non_field_errors }}
-			</div>
-		{% endif %}
-		{% if not edit %}
-			<p>
-			Use this form to create a new custom charge.<br>
-			Set a negative amount in case of an adjustment.
-			</p>
-		{% endif %}
-		<form class="form-horizontal" action="{% if edit %}{% url 'edit_custom_charge' form.instance.pk %}{% else %}{% url 'create_custom_charge' %}{% endif %}" method="post" style="margin-top: 25px">
-			{% csrf_token %}
-			{% if edit %}<input type="hidden" value="{{ form.instance.id }}" name="custom_charge_id">{% endif %}
-			<input type="hidden" id="creator" name="creator" value="{{ request.user.id }}">
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="charge_name"><strong>Name</strong></label>
-				<div class="col-sm-4">
-					<input id="charge_name" name="name" type="text" autocomplete="off" class="form-control" value="{{ form.name.value|default_if_none:"" }}" autofocus required>
-				</div>
-				{% if form.name.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.name.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="description">Description</label>
-				<div class="col-sm-4">
-					<input id="description" name="additional_details" type="text" autocomplete="off" class="form-control" value="{{ form.additional_details.value|default_if_none:"" }}" autofocus>
-				</div>
-				{% if form.additional_details.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.additional_details.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="date"><strong>Date</strong></label>
-				<div class="col-sm-4">
-					<input id="date" name="date" class="form-control" type="text" placeholder="Charge date" value="{{ form.date.value|input_date_format }}" required>
-				</div>
-				{% if form.date.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.date.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="customer_search"><strong>Customer {{ form.instance.customer }}</strong></label>
-				<div class="col-sm-4">
-					<input id="customer_search" class="form-control" type="text" placeholder="Search for a customer" style="{% if form.customer.value %}display:none{% endif %}" {% if not form.customer.value %}required{% endif %}>
-					<input type="button" id="chosen_customer" class="btn btn-default" onclick="clear_customer(); return false" value="{% if edit %}{{ form.instance.customer }}{% else %}{{ form.cleaned_data.customer|default_if_none:"" }}{% endif %}" style="{% if not form.customer.value %}display:none{% endif %}">
-					<input type="hidden" id="customer" name="customer" value="{{ form.customer.value|default_if_none:"" }}">
-				</div>
-				{% if form.customer.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.customer.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="project"><strong>Project</strong></label>
-				<div class="col-sm-4">
-					<select id="project" name="project" class="form-control" {% if not projects %}disabled{% endif %} required>
-						{% if projects|length == 0 %}
-                            <option disabled selected value="">{% if form.customer.value %}No active projects!{% endif %}</option>
-						{% elif projects|length == 1 %}
-							<option value="{{ projects.0.id }}">{{ projects.0 }}</option>
-						{% elif projects %}
-							<option disabled selected value="">Choose a project to bill</option>
-							{% for project in projects %}
-								<option value="{{ project.id }}" {% if form.project.value|to_int == project.id %}selected{% endif %}>{{ project }}</option>
-							{% endfor %}
-						{% endif %}
-					</select>
-				</div>
-				{% if form.project.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.project.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			{% if core_facility_required or core_facilities %}
-				<div class="form-group">
-					<label class="control-label col-sm-2" for="core_facility">{% if core_facility_required %}<strong>Core Facility</strong>{% else %}Core Facility{% endif %}</label>
-					<div class="col-sm-4">
-						<select id="core_facility" name="core_facility" class="form-control" {% if core_facility_required %}required{% endif %}>
-							<option disabled selected value="">Select a core facility</option>
-							{% for core_facility in core_facilities %}
-								<option value="{{ core_facility.id }}" {% if form.core_facility.value|to_int == core_facility.id %}selected{% endif %}>{{ core_facility.name }}</option>
-							{% endfor %}
-						</select>
-					</div>
-					{% if form.core_facility.errors %}
-						<div class="col-sm-6 form-control-static danger-highlight">
-							{{ form.core_facility.errors|striptags }}
-						</div>
-					{% endif %}
-				</div>
-			{% endif %}
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="amount"><strong>Amount</strong></label>
-				<div class="col-sm-4">
-					<input id="amount" name="amount" type="number" step="0.01" autocomplete="off" class="form-control" value="{{ form.amount.value|default_if_none:0 }}" required>
-				</div>
-				{% if form.amount.errors %}
-					<div class="col-sm-6 form-control-static danger-highlight">
-						{{ form.amount.errors|striptags }}
-					</div>
-				{% endif %}
-			</div>
-			{% cap_discount_installed as cap_discount_installed %}
-			{% if cap_discount_installed %}
-				<div class="form-group">
-					<label class="control-label col-sm-2" for="cap_eligible">Cap eligible</label>
-					<div class="col-sm-4 checkbox">
-						<label><input id="cap_eligible" name="cap_eligible" type="checkbox" {% if form.cap_eligible.value %}checked{% endif %}> Check to make this charge count towards CAP</label>
-					</div>
-					{% if form.cap_eligible.errors %}
-						<div class="col-sm-6 form-control-static danger-highlight">
-							{{ form.cap_eligible.errors|striptags }}
-						</div>
-					{% endif %}
-				</div>
-			{% endif %}
-			<div class="col-sm-6 text-right">
-				{% button type="save" value="Confirm" %}
-			</div>
-		</form>
-
-		<script>
+    {% with edit=form.instance.pk %}
+        <h1>
+            {% if edit %}
+                Edit
+            {% else %}
+                New
+            {% endif %}
+            custom charge
+        </h1>
+        {% if form.errors %}
+            <div class="alert alert-danger">
+                Oops! Something went wrong. Please correct the errors highlighted below.
+                <br>
+                {{ form.non_field_errors }}
+            </div>
+        {% endif %}
+        {% if not edit %}
+            <p>
+                Use this form to create a new custom charge.
+                <br>
+                Set a negative amount in case of an adjustment.
+            </p>
+        {% endif %}
+        <form class="form-horizontal"
+              action="{% if edit %}{% url 'edit_custom_charge' form.instance.pk %}{% else %}{% url 'create_custom_charge' %}{% endif %}"
+              method="post"
+              style="margin-top: 25px">
+            {% csrf_token %}
+            {% if edit %}<input type="hidden" value="{{ form.instance.id }}" name="custom_charge_id">{% endif %}
+            <input type="hidden" id="creator" name="creator" value="{{ request.user.id }}">
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="charge_name">
+                    <strong>Name</strong>
+                </label>
+                <div class="col-sm-4">
+                    <input id="charge_name"
+                           name="name"
+                           type="text"
+                           autocomplete="off"
+                           class="form-control"
+                           value="{{ form.name.value|default_if_none:"" }}"
+                           autofocus
+                           required>
+                </div>
+                {% if form.name.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.name.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="description">Description</label>
+                <div class="col-sm-4">
+                    <input id="description"
+                           name="additional_details"
+                           type="text"
+                           autocomplete="off"
+                           class="form-control"
+                           value="{{ form.additional_details.value|default_if_none:"" }}"
+                           autofocus>
+                </div>
+                {% if form.additional_details.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.additional_details.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="date">
+                    <strong>Date</strong>
+                </label>
+                <div class="col-sm-4">
+                    <input id="date"
+                           name="date"
+                           class="form-control"
+                           type="text"
+                           placeholder="Charge date"
+                           value="{{ form.date.value|input_date_format }}"
+                           required>
+                </div>
+                {% if form.date.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.date.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="customer_search">
+                    <strong>Customer {{ form.instance.customer }}</strong>
+                </label>
+                <div class="col-sm-4">
+                    <input id="customer_search"
+                           class="form-control"
+                           type="text"
+                           placeholder="Search for a customer"
+                           style="{% if form.customer.value %}display:none{% endif %}"
+                           {% if not form.customer.value %}required{% endif %}>
+                    <input type="button"
+                           id="chosen_customer"
+                           class="btn btn-default"
+                           onclick="clear_customer(); return false"
+                           value="{% if edit %}{{ form.instance.customer }}{% else %}{{ form.cleaned_data.customer|default_if_none:"" }}{% endif %}"
+                           style="{% if not form.customer.value %}display:none{% endif %}">
+                    <input type="hidden" id="customer" name="customer" value="{{ form.customer.value|default_if_none:"" }}">
+                </div>
+                {% if form.customer.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.customer.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="project">
+                    <strong>Project</strong>
+                </label>
+                <div class="col-sm-4">
+                    <select id="project" name="project" class="form-control" {% if not projects %}disabled{% endif %} required>
+                        {% if projects|length == 0 %}
+                            <option disabled selected value="">
+                                {% if form.customer.value %}No active projects!{% endif %}
+                            </option>
+                        {% elif projects|length == 1 %}
+                            <option value="{{ projects.0.id }}">{{ projects.0 }}</option>
+                        {% elif projects %}
+                            <option disabled selected value="">Choose a project to bill</option>
+                            {% for project in projects %}
+                                <option value="{{ project.id }}" {% if form.project.value|to_int == project.id %}selected{% endif %}>
+                                    {{ project }}
+                                </option>
+                            {% endfor %}
+                        {% endif %}
+                    </select>
+                </div>
+                {% if form.project.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.project.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            {% if core_facility_required or core_facilities %}
+                <div class="form-group">
+                    <label class="control-label col-sm-2" for="core_facility">
+                        {% if core_facility_required %}
+                            <strong>Core Facility</strong>
+                        {% else %}
+                            Core Facility
+                        {% endif %}
+                    </label>
+                    <div class="col-sm-4">
+                        <select id="core_facility"
+                                name="core_facility"
+                                class="form-control"
+                                {% if core_facility_required %}required{% endif %}>
+                            <option disabled selected value="">Select a core facility</option>
+                            {% for core_facility in core_facilities %}
+                                <option value="{{ core_facility.id }}"
+                                        {% if form.core_facility.value|to_int == core_facility.id %}selected{% endif %}>
+                                    {{ core_facility.name }}
+                                </option>
+                            {% endfor %}
+                        </select>
+                    </div>
+                    {% if form.core_facility.errors %}
+                        <div class="col-sm-6 form-control-static danger-highlight">{{ form.core_facility.errors|striptags }}</div>
+                    {% endif %}
+                </div>
+            {% endif %}
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="amount">
+                    <strong>Amount</strong>
+                </label>
+                <div class="col-sm-4">
+                    <input id="amount"
+                           name="amount"
+                           type="number"
+                           step="0.01"
+                           autocomplete="off"
+                           class="form-control"
+                           value="{{ form.amount.value|default_if_none:0 }}"
+                           required>
+                </div>
+                {% if form.amount.errors %}
+                    <div class="col-sm-6 form-control-static danger-highlight">{{ form.amount.errors|striptags }}</div>
+                {% endif %}
+            </div>
+            {% cap_discount_installed as cap_discount_installed %}
+            {% if cap_discount_installed %}
+                <div class="form-group">
+                    <label class="control-label col-sm-2" for="cap_eligible">Cap eligible</label>
+                    <div class="col-sm-4 checkbox">
+                        <label>
+                            <input id="cap_eligible"
+                                   name="cap_eligible"
+                                   type="checkbox"
+                                   {% if form.cap_eligible.value %}checked{% endif %}>
+                            Check to make this charge count towards CAP
+                        </label>
+                    </div>
+                    {% if form.cap_eligible.errors %}
+                        <div class="col-sm-6 form-control-static danger-highlight">{{ form.cap_eligible.errors|striptags }}</div>
+                    {% endif %}
+                </div>
+            {% endif %}
+            <div class="col-sm-6 text-right">{% button type="save" value="Confirm" %}</div>
+        </form>
+        <script>
 		function clear_customer()
 		{
 			$("#chosen_customer").val('').hide();
 			$("#customer_search").typeahead('val', '').prop('required', true).show().focus();
 			$("#customer").val('');
 			$('#project').find('option').remove().end().attr('disabled', 'disabled');
 		}
@@ -160,35 +228,36 @@
 		function update_projects(response, status, xml_http_request)
 		{
 			let project_selector = $('#project');
 			project_selector.find('option').remove().end().removeAttr('disabled');
 			let projects = response['projects'];
 
 			if (projects.length === 0)
-				project_selector.append($('<option/>', {text: "No active projects!"})).attr('disabled', 'disabled');
+				project_selector.append($('<option />', {text: "No active projects!"})).attr('disabled', 'disabled');
 			else if (projects.length === 1)
-				project_selector.append($('<option/>', {value: response['projects'][0].id, text: response['projects'][0].name}));
+				project_selector.append($('<option />', {value: response['projects'][0].id, text: response['projects'][0].name}));
 			else
 			{
-				project_selector.append($('<option/>', {
+				project_selector.append($('<option />', {
 					text: "Choose a project to bill",
 					disabled: true,
 					selected: true,
 					value: ""
 				}));
 				$.each(projects, function(count, project)
 				{
-					project_selector.append($('<option/>', {value: project.id, text: project.name}));
+					project_selector.append($('<option />', {value: project.id, text: project.name}));
 				});
 			}
 		}
 		window.addEventListener('load', function()
 		{
 			$('#customer_search').autocomplete('customers', get_customer, {{ users|json_search_base }});
             let timepicker_properties = {
                 format: '{{ datetime_input_js_format }}', 'sideBySide': true
             };
 			$('#date').datetimepicker(timepicker_properties);
 		}, true);
-		</script>
-	{% endwith %}
-{% endblock %}
+		
+        </script>
+    {% endwith %}
+{% endblock %}
```

### html2text {}

```diff
@@ -1,14 +1,14 @@
 {% extends "base.html" %} {% load static %} {% load custom_tags_and_filters %}
 {% load billing_tags %} {% block extrahead %}
 }">
-}"/> {% endblock %} {% block title %}{% if form.instance.pk %}Edit{% else %}New
-{% endif %} Custom charge{% endblock %} {% block content %} {% with
+}" /> {% endblock %} {% block title %} {% if form.instance.pk %} Edit {% else
+%} New {% endif %} Custom charge {% endblock %} {% block content %} {% with
 edit=form.instance.pk %}
-************ {{%% iiff eeddiitt %%}}EEddiitt{{%% eellssee %%}}NNeeww{{%% eennddiiff %%}} ccuussttoomm cchhaarrggee ************
+************ {{%% iiff eeddiitt %%}} EEddiitt {{%% eellssee %%}} NNeeww {{%% eennddiiff %%}} ccuussttoomm cchhaarrggee ************
 {% if form.errors %}
 Oops! Something went wrong. Please correct the errors highlighted below.
 {{ form.non_field_errors }}
 {% endif %} {% if not edit %}
 Use this form to create a new custom charge.
 Set a negative amount in case of an adjustment.
 {% endif %}
@@ -39,22 +39,23 @@
 % if not projects %}disabled{% endif %} required> {% if projects|length == 0 %}
 {% if form.customer.value %}No active projects!{% endif %}
 {% elif projects|length == 1 %}
 {{ projects.0 }}
 {% elif projects %}
 Choose a project to bill
 {% for project in projects %}
-% if form.project.value|to_int == project.id %}selected{% endif %}>{{ project
+% if form.project.value|to_int == project.id %}selected{% endif %}> {{ project
 }}
 {% endfor %} {% endif %}
 {% if form.project.errors %}
 {{ form.project.errors|striptags }}
 {% endif %}
 {% if core_facility_required or core_facilities %}
-{% if core_facility_required %}CCoorree FFaacciilliittyy{% else %}Core Facility{% endif %}
+{% if core_facility_required %} CCoorree FFaacciilliittyy {% else %} Core Facility {% endif
+%}
 % if core_facility_required %}required{% endif %}>
 Select a core facility
 {% for core_facility in core_facilities %}
 % if form.core_facility.value|to_int == core_facility.id %}selected{% endif %}>
 {{ core_facility.name }}
 {% endfor %}
 {% if form.core_facility.errors %}
```

## NEMO_billing/templates/billing/custom_charges.html

```diff
@@ -1,44 +1,46 @@
 {% extends 'pagination/pagination_base.html' %}
 {% load custom_tags_and_filters %}
 {% block title %}Custom charges{% endblock %}
 {% block before_pagination %}
-	<div class="row">
-		<div class="col-xs-7">
-			<h1>Custom charges</h1>
-		</div>
-		<div class="col-sm-5 text-right">
-			<h1>{% button type="add" url="create_custom_charge" value="New custom charge" %}</h1>
-		</div>
-	</div>
+    <div class="row">
+        <div class="col-xs-7">
+            <h1>Custom charges</h1>
+        </div>
+        <div class="col-sm-5 text-right">
+            <h1>{% button type="add" url="create_custom_charge" value="New custom charge" %}</h1>
+        </div>
+    </div>
 {% endblock %}
 {% block pagination_content %}
-	<table class="table table-bordered table-striped table-condensed thead-light">
-		<thead>
-			<tr>
-				<th>{% include 'pagination/pagination_column.html' with order_by="name" name='Name' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="date" name='Date' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="project" name='Project' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="customer" name='Customer' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="amount" name='Amount' %}</th>
-				<th>{% include 'pagination/pagination_column.html' with order_by="creator" name='Created By' %}</th>
-				{% if core_facilities_exist %}<th>{% include 'pagination/pagination_column.html' with order_by="core_facility" name='Core Facility' %}</th>{% endif %}
-				<th>{% include 'pagination/pagination_column.html' with order_by="additional_details" name='Description' %}</th>
-			</tr>
-		</thead>
-		<tbody>
-			{% for custom_charge in page %}
-				<tr>
-					<td>{{ custom_charge.name }}</td>
-					<td>{{ custom_charge.date|date:"SHORT_DATETIME_FORMAT" }}</td>
-					<td>{{ custom_charge.project }}</td>
-					<td>{{ custom_charge.customer }}</td>
-					<td>{{ custom_charge.amount }}</td>
-					<td>{{ custom_charge.creator }}</td>
-					{% if core_facilities_exist %}<td>{{ custom_charge.core_facility|default_if_none:"" }}</td>{% endif %}
-					<td>{{ custom_charge.additional_details|default_if_none:"" }}</td>
-				</tr>
-			{% endfor %}
-		</tbody>
-	</table>
+    <table class="table table-bordered table-striped table-condensed thead-light">
+        <thead>
+            <tr>
+                <th>{% include 'pagination/pagination_column.html' with order_by="name" name='Name' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="date" name='Date' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="project" name='Project' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="customer" name='Customer' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="amount" name='Amount' %}</th>
+                <th>{% include 'pagination/pagination_column.html' with order_by="creator" name='Created By' %}</th>
+                {% if core_facilities_exist %}
+                    <th>{% include 'pagination/pagination_column.html' with order_by="core_facility" name='Core Facility' %}</th>
+                {% endif %}
+                <th>{% include 'pagination/pagination_column.html' with order_by="additional_details" name='Description' %}</th>
+            </tr>
+        </thead>
+        <tbody>
+            {% for custom_charge in page %}
+                <tr>
+                    <td>{{ custom_charge.name }}</td>
+                    <td>{{ custom_charge.date|date:"SHORT_DATETIME_FORMAT" }}</td>
+                    <td>{{ custom_charge.project }}</td>
+                    <td>{{ custom_charge.customer }}</td>
+                    <td>{{ custom_charge.amount }}</td>
+                    <td>{{ custom_charge.creator }}</td>
+                    {% if core_facilities_exist %}<td>{{ custom_charge.core_facility|default_if_none:"" }}</td>{% endif %}
+                    <td>{{ custom_charge.additional_details|default_if_none:"" }}</td>
+                </tr>
+            {% endfor %}
+        </tbody>
+    </table>
 {% endblock %}
-{% block table_empty_content %}No custom charges have been saved yet.{% endblock %}
+{% block table_empty_content %}No custom charges have been saved yet.{% endblock %}
```

## NEMO_billing/templates/staff_charges/choose_project.html

```diff
@@ -1,32 +1,35 @@
 {% extends 'staff_charges/staff_charges_base.html' %}
 {% load custom_tags_and_filters %}
 {% block staff_charges_content %}
-	<div class="col-sm-12">
-		<form action="{% url 'begin_staff_charge' %}" class="form-horizontal" method="post">
-			{% csrf_token %}
-			<div class="form-group">
-				Customer: {{ customer }}<br>
-				<input type="hidden" name="customer" value="{{ customer.id }}">
-				<input type="hidden" name="core_facility" value="{{ core_facility_id }}">
-			</div>
-			<div class="form-group">
-				{% if customer.active_project_count == 1 and customer.active_projects.0.allow_staff_charges %}
-					Staff time will be billed to the customer's only project, &quot;{{ customer.active_projects.0 }}&quot;
-					<input type="hidden" name="project" value="{{ customer.active_projects.0.id }}">
-				{% else %}
-					Which of the customer's projects would you like to bill?
-					<div class="radio">
-						{% for p in customer.active_projects %}
-							{% if p.allow_staff_charges %}
-								<label class="control-label"><input type="radio" name="project" value="{{ p.id }}" required> {% project_selection_display p %}</label><br>
-							{% endif %}
-						{% endfor %}
-					</div>
-				{% endif %}
-			</div>
-			<div class="form-group">
-                {% button type="save" value="Begin billing staff time" icon="glyphicon-time" %}
-			</div>
-		</form>
-	</div>
-{% endblock %}
+    <div class="col-sm-12">
+        <form action="{% url 'begin_staff_charge' %}" class="form-horizontal" method="post">
+            {% csrf_token %}
+            <div class="form-group">
+                Customer: {{ customer }}
+                <br>
+                <input type="hidden" name="customer" value="{{ customer.id }}">
+                <input type="hidden" name="core_facility" value="{{ core_facility_id }}">
+            </div>
+            <div class="form-group">
+                {% if customer.active_project_count == 1 and customer.active_projects.0.allow_staff_charges %}
+                    Staff time will be billed to the customer's only project, &quot;{{ customer.active_projects.0 }}&quot;
+                    <input type="hidden" name="project" value="{{ customer.active_projects.0.id }}">
+                {% else %}
+                    Which of the customer's projects would you like to bill?
+                    <div class="radio">
+                        {% for p in customer.active_projects %}
+                            {% if p.allow_staff_charges %}
+                                <label class="control-label">
+                                    <input type="radio" name="project" value="{{ p.id }}" required>
+                                    {% project_selection_display p %}
+                                </label>
+                                <br>
+                            {% endif %}
+                        {% endfor %}
+                    </div>
+                {% endif %}
+            </div>
+            <div class="form-group">{% button type="save" value="Begin billing staff time" icon="glyphicon-time" %}</div>
+        </form>
+    </div>
+{% endblock %}
```

## NEMO_billing/templates/staff_charges/new_custom_staff_charge.html

```diff
@@ -1,45 +1,53 @@
 {% extends 'staff_charges/staff_charges_base.html' %}
 {% load custom_tags_and_filters %}
 {% block staff_charges_content %}
-	<p>Use this form to charge a user for staff time and area access time when you are working on a project on their behalf. You may only work on one user project at a time for a customer.</p>
-	{% if error %}
-		<div class="alert alert-danger">
-			{{ error }}
-		</div>
-	{% endif %}
-	<form id="new_staff_charge" action="{% url 'staff_charges' %}" class="form-horizontal" method="get">
-		<div class="form-group">
-			<label for="customer_search" class="control-label col-sm-2"><strong>Customer</strong></label>
-			<div class="col-sm-4">
-				<input id="customer_search" type="text" class="form-control" placeholder="Search for a customer" required>
-				<input id="customer" name="customer" type="hidden">
-			</div>
-		</div>
-		{% if core_facility_required or core_facilities %}
-			<div class="form-group">
-				<label class="control-label col-sm-2" for="core_facility">{% if core_facility_required %}<strong>Core Facility</strong>{% else %}Core Facility{% endif %}</label>
-				<div class="col-sm-4">
-					<select id="core_facility" name="core_facility" class="form-control" {% if core_facility_required %}required{% endif %}>
-						<option disabled selected value="">Select a core facility</option>
-						{% for core_facility in core_facilities %}
-							<option value="{{ core_facility.id }}">{{ core_facility.name }}</option>
-						{% endfor %}
-					</select>
-				</div>
-			</div>
-		{% endif %}
-		<div class="form-group">
-			<div class="col-sm-6 text-right">
-				{% button type="save" value="Continue" icon="glyphicon-ok-circle" %}
-			</div>
-		</div>
-	</form>
-	<script>
+    <p>
+        Use this form to charge a user for staff time and area access time when you are working on a project on their behalf. You may only work on one user project at a time for a customer.
+    </p>
+    {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
+    <form id="new_staff_charge" action="{% url 'staff_charges' %}" class="form-horizontal" method="get">
+        <div class="form-group">
+            <label for="customer_search" class="control-label col-sm-2">
+                <strong>Customer</strong>
+            </label>
+            <div class="col-sm-4">
+                <input id="customer_search" type="text" class="form-control" placeholder="Search for a customer" required>
+                <input id="customer" name="customer" type="hidden">
+            </div>
+        </div>
+        {% if core_facility_required or core_facilities %}
+            <div class="form-group">
+                <label class="control-label col-sm-2" for="core_facility">
+                    {% if core_facility_required %}
+                        <strong>Core Facility</strong>
+                    {% else %}
+                        Core Facility
+                    {% endif %}
+                </label>
+                <div class="col-sm-4">
+                    <select id="core_facility"
+                            name="core_facility"
+                            class="form-control"
+                            {% if core_facility_required %}required{% endif %}>
+                        <option disabled selected value="">Select a core facility</option>
+                        {% for core_facility in core_facilities %}
+                            <option value="{{ core_facility.id }}">{{ core_facility.name }}</option>
+                        {% endfor %}
+                    </select>
+                </div>
+            </div>
+        {% endif %}
+        <div class="form-group">
+            <div class="col-sm-6 text-right">{% button type="save" value="Continue" icon="glyphicon-ok-circle" %}</div>
+        </div>
+    </form>
+    <script>
 		function select_user(jquery_event, search_selection, dataset_name)
 		{
 			$("#customer").val(search_selection.id);
 			$('#customer_search').prop("required", false);
 		}
 		$('#customer_search').autocomplete('users', select_user, {{ users|json_search_base }}).focus();
-	</script>
-{% endblock %}
+	
+    </script>
+{% endblock %}
```

### html2text {}

```diff
@@ -5,15 +5,16 @@
 a time for a customer.
 {% if error %}
 {{ error }}
 {% endif %}
 CCuussttoommeerr
 [                    ]
 {% if core_facility_required or core_facilities %}
-{% if core_facility_required %}CCoorree FFaacciilliittyy{% else %}Core Facility{% endif %}
+{% if core_facility_required %} CCoorree FFaacciilliittyy {% else %} Core Facility {% endif
+%}
 % if core_facility_required %}required{% endif %}>
 Select a core facility
 {% for core_facility in core_facilities %}
 {{ core_facility.name }}
 {% endfor %}
 {% endif %}
 {% button type="save" value="Continue" icon="glyphicon-ok-circle" %}
```

## NEMO_billing/tests/test_settings.py

```diff
@@ -8,23 +8,23 @@
 DATE_INPUT_FORMATS = ["%m/%d/%Y"]
 TIME_INPUT_FORMATS = ["%I:%M %p"]
 
 USE_I18N = False
 USE_L10N = False
 USE_TZ = True
 
-ROOT_URLCONF = 'NEMO.urls'
+ROOT_URLCONF = "NEMO.urls"
 ALLOW_CONDITIONAL_URLS = True
 
-STATIC_URL = '/static/'
-MEDIA_URL = '/media/'
+STATIC_URL = "/static/"
+MEDIA_URL = "/media/"
 
-LOGIN_URL = 'login'
-LOGIN_REDIRECT_URL = 'login'
-AUTHENTICATION_BACKENDS = ['NEMO.views.authentication.NginxKerberosAuthorizationHeaderAuthenticationBackend']
+LOGIN_URL = "login"
+LOGIN_REDIRECT_URL = "login"
+AUTHENTICATION_BACKENDS = ["NEMO.views.authentication.NginxKerberosAuthorizationHeaderAuthenticationBackend"]
 
 SECRET_KEY = "test"
 
 INSTALLED_APPS = [
     "django.contrib.auth",
     "django.contrib.contenttypes",
     "django.contrib.sessions",
@@ -77,16 +77,16 @@
         },
     },
 ]
 
 TIME_ZONE = "America/New_York"
 
 REST_FRAMEWORK = {
-	'DEFAULT_PERMISSION_CLASSES': ('NEMO.permissions.BillingAPI',),
-	'DEFAULT_FILTER_BACKENDS': ('django_filters.rest_framework.DjangoFilterBackend',),
+    "DEFAULT_PERMISSION_CLASSES": ("NEMO.permissions.BillingAPI",),
+    "DEFAULT_FILTER_BACKENDS": ("django_filters.rest_framework.DjangoFilterBackend",),
 }
 
 DATABASES = {
     "default": {
         "ENGINE": "django.db.backends.sqlite3",
         "NAME": "./test_nemo.db",
     }
```

## NEMO_billing/tests/test_urls.py

```diff
@@ -1,11 +1,11 @@
-from NEMO_billing.models import CoreFacility
 from django.test import TestCase
 from django.urls import reverse
 
+from NEMO_billing.models import CoreFacility
 from NEMO_billing.tests.test_utilities import basic_data
 
 
 class TestURLs(TestCase):
     def test_staff_charge(self):
         user, project, tool, area = basic_data()
         CoreFacility.objects.create(name="Test")
@@ -27,10 +27,10 @@
         self.client.force_login(user)
         response = self.client.get(reverse("billingdata-list"), follow=True)
         # Forbidden
         self.assertEqual(response.status_code, 403)
         # Make user admin
         user.is_superuser = True
         user.save()
-        response = self.client.get(reverse("billingdata-list")+"?start=01/01/2020&end=01/01/2099", follow=True)
+        response = self.client.get(reverse("billingdata-list") + "?start=01/01/2020&end=01/01/2099", follow=True)
         self.assertEqual(response.status_code, 200)
-        self.assertNotEqual(response.request["PATH_INFO"], "/")
+        self.assertNotEqual(response.request["PATH_INFO"], "/")
```

## NEMO_billing/tests/cap/test_cap_utilities.py

```diff
@@ -72,15 +72,17 @@
             project=project,
             consumable=consumable,
             quantity=1,
             date=end,
             merchant=staff,
         )
     if BillableItemType.STAFF_CHARGE in types:
-        UsageEvent.objects.create(user=user, operator=staff, remote_work=True, tool=tool, project=project, start=start, end=end)
+        UsageEvent.objects.create(
+            user=user, operator=staff, remote_work=True, tool=tool, project=project, start=start, end=end
+        )
     if BillableItemType.AREA_ACCESS in types:
         AreaAccessRecord.objects.create(area=area, customer=user, project=project, start=start, end=end)
     if BillableItemType.TRAINING in types:
         TrainingSession.objects.create(
             trainee=user,
             trainer=staff,
             tool=tool,
```

## Comparing `NEMO_billing-2.8.1.dist-info/LICENSE` & `NEMO_billing-2.9.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `NEMO_billing-2.8.1.dist-info/METADATA` & `NEMO_billing-2.9.0.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: NEMO-billing
-Version: 2.8.1
+Version: 2.9.0
 Summary: Install Billing plugin for NEMO
 Home-page: https://gitlab.com/nemo-community/atlantis-labs/nemo-billing
 Author: Atlantis Labs LLC
 Author-email: atlantis@atlantislabs.io
 License: MIT
 Keywords: NEMO
 Classifier: Development Status :: 4 - Beta
@@ -20,17 +20,17 @@
 License-File: LICENSE
 Requires-Dist: django
 Requires-Dist: reportlab ==4.0.9
 Requires-Dist: python-dateutil
 Requires-Dist: djangorestframework
 Requires-Dist: drf-excel
 Provides-Extra: nemo
-Requires-Dist: NEMO >=5.3.0 ; extra == 'nemo'
+Requires-Dist: NEMO >=5.5.0 ; extra == 'nemo'
 Provides-Extra: nemo-ce
-Requires-Dist: NEMO-CE >=2.3.0 ; extra == 'nemo-ce'
+Requires-Dist: NEMO-CE >=2.4.0 ; extra == 'nemo-ce'
 
 # NEMO billing
 
 This billing plugin for NEMO includes core facilities and custom charges/adjustments.
 It also includes sub-modules for adding rates and invoices.
 
 
@@ -53,14 +53,16 @@
     'NEMO',
     '...'
 ]
 ```
 
 ### NEMO Compatibility
 
+NEMO >= 5.5.0 ----> NEMO-Billing >= 2.9.0
+
 NEMO >= 5.3.0 ----> NEMO-Billing >= 2.8.0
 
 NEMO >= 4.7.0 ----> NEMO-Billing >= 2.7.0
 
 NEMO >= 4.6.4 ----> NEMO-Billing >= 2.6.13
 
 NEMO >= 4.6.0 ----> NEMO-Billing >= 2.5.8
```

## Comparing `NEMO_billing-2.8.1.dist-info/RECORD` & `NEMO_billing-2.9.0.dist-info/RECORD`

 * *Files 6% similar despite different names*

```diff
@@ -1,154 +1,154 @@
 NEMO_billing/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/admin.py,sha256=KrT3LSs1GBR_Ka22vcGigvfKYvLfQCQ4NL9VPS7OZNI,14452
 NEMO_billing/api.py,sha256=17woqDdYhTtAMGu9wx8zOCegtfSU6cnarKbMr9fLUIs,2638
 NEMO_billing/app_settings.py,sha256=jFpLL7MGspdYud_InbxiMN_8u5TYj7lubZDSb9Muvzk,285
 NEMO_billing/apps.py,sha256=5FpuGePoZ5KLQakfMeAFrImcKYAognKgpX6xojaFGmE,426
-NEMO_billing/exceptions.py,sha256=7QPSpX-yzxrchSJyo08JNQ0Oq7BhqDQYsdX2nqECZ_8,122
-NEMO_billing/models.py,sha256=7wbuPIuCn9UpDFHM1DM1usTxgROf-GFcXnd6ZHMhz5w,5784
+NEMO_billing/exceptions.py,sha256=pDAhDrdaQgock1oflAQz6Yp1HUNwp7qLC5Omjj9Uc3g,126
+NEMO_billing/models.py,sha256=GMqqsPj25d8GTDts8l59NEMEeaZcO8HyrzY4KVdg_BY,5786
 NEMO_billing/urls.py,sha256=MvbFQY8MXStkxW1r6A_ZWad2zYgjM4ADzMHhCieAD1U,1443
-NEMO_billing/utilities.py,sha256=bJ8Rib_bOGK5Z9JIIHiWy-bigxQFkaokH4phy2Nsato,3257
+NEMO_billing/utilities.py,sha256=eNSvJgEtlrpLiWAqfVjzwKxIgwE2Ci9zqheebhVERy8,3313
 NEMO_billing/views.py,sha256=aHq58PQA_LtRJAEpl_WhqoxNCUUTEumEUAr41092C2Q,6371
 NEMO_billing/cap_discount/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/cap_discount/admin.py,sha256=zrp0DoXt3_InEybRO1WmbtWpLqbegkZUUsiiNLBTjz8,5622
 NEMO_billing/cap_discount/app_settings.py,sha256=IEX-9f0PfxBuyfNVN0AAUjB6EX7S8WNhQCCjhoWQF2c,102
 NEMO_billing/cap_discount/apps.py,sha256=F1TsLrQW4tSz593Efiwu6_TkagWb0CCmBpPHpvTNPSI,444
 NEMO_billing/cap_discount/customization.py,sha256=HmMpI90MXbO44I8uCrVYSH35RSVfGstC-oN3FVkZp2w,2991
 NEMO_billing/cap_discount/exceptions.py,sha256=IGvQo-7iBf19v87KIMkiH6kW2QIMydOp4qQLctKisQY,892
 NEMO_billing/cap_discount/models.py,sha256=9BSY3jo3W_-zgYzMHUo5HTz4DvxEL4s154FjyH3TxIA,19861
 NEMO_billing/cap_discount/processors.py,sha256=XCZLIwjjaSj4xCoIfNVopxTajU51CUAAMvE7gt-qgWc,22141
-NEMO_billing/cap_discount/urls.py,sha256=HR9eI482le2fJuKEk0AfasZVsdSlEUnQ_PUfds1E7Qw,690
+NEMO_billing/cap_discount/urls.py,sha256=xvYQJbx6kY6IjPuXwXSoUoxgHF2NzPcznXpbGyHwRIg,721
 NEMO_billing/cap_discount/views.py,sha256=C3mnqMGZV_3F2Qmq3nq2Vl85Yc2sMUZfU--kUSkE830,4306
-NEMO_billing/cap_discount/migrations/0001_initial.py,sha256=DUzD7P1ojLrfj47u_a6ueopG1sL3Yjv9eEC46GGZrxQ,7568
-NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py,sha256=Ch6EXpvFjakBma6mRYLT6KRZQOanNWguVxxwX7jUqdo,1665
-NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py,sha256=JF7nMLzShWLyYGw8EPYxSgHHJZWRrXpiLAC9nRBVO2U,4815
-NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py,sha256=1OBmhbwn12Dqqm6Td6uhdy2mMMmr5ddO3beETRzYSG4,3163
-NEMO_billing/cap_discount/migrations/0005_cap_multi_core_facilities.py,sha256=QxR16AWlRwLkNQ-CjxkyY_hIzqpLZ0Isdwn5AQboIO4,3653
+NEMO_billing/cap_discount/migrations/0001_initial.py,sha256=TwiNrM8dSXK6oYsTR2c9hx2Kjl_d9F2X45f4nv-yYBU,13797
+NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py,sha256=F3-2NfFaumCxJWwtjjgh4T7tx372rpzVOlIE39Ln-Wk,1900
+NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py,sha256=QlepIbhmlV6rtAi7oQ-8dbp7ME7eXjxUUiQgfdm030Y,6220
+NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py,sha256=KwlfGpizN1he7i3WuBxt5xYkq1bdckhW_i3glDJTzik,3185
+NEMO_billing/cap_discount/migrations/0005_cap_multi_core_facilities.py,sha256=EmsnoR-PSaLD9G4sc1qmDE-uB9bXOt6SrRGMHd9qMJI,3977
 NEMO_billing/cap_discount/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html,sha256=l8s9LWMH5UqAonghVDGNf33O1OwAw7xwrhShehSuZ14,2383
-NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html,sha256=uUyAyi_2XYy_xYcHp--og5Wk-B0qIGGJ0kHy1pgvnDM,1772
-NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html,sha256=pcuUdIzoA3Bh-knK9LLE2U2L1RqODX0hTekCfL-XK5U,4097
+NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html,sha256=-HPe5Ne91Bi0F0WB1lBuOj-yemWVFGl72hOAW72uYPE,2945
+NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html,sha256=YHUE0jQPNFY1c7INVI3RwJ1QI7x4NIoKYc0ph8KZrsI,2071
+NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html,sha256=q-mw8XiC_KbKr5sPVJ7LNq5laFD4AmvDW-vHLdILHI8,5086
 NEMO_billing/invoices/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/admin.py,sha256=UZY1lKQojsZq47s_GJldQH0lA20zhGKjdfED_z4XhGs,11133
 NEMO_billing/invoices/api.py,sha256=yNxoWmUDIZg8CaIrDfKOAZASF_8X91HEkjJcsMZI1e8,10414
 NEMO_billing/invoices/app_settings.py,sha256=xCnFmkrrdKZR3Y10fP9goyBYEF6IgxRU822du8gQ9Io,176
 NEMO_billing/invoices/apps.py,sha256=GeE88lnFhWikhxJyY1sPECwrrQr2qk72tfn1QhTlQSs,445
 NEMO_billing/invoices/customization.py,sha256=Jv6ZDpD62YWru-HMVTJOZWaXTC1xdnCmbIzA1ZZgz7c,4496
 NEMO_billing/invoices/exceptions.py,sha256=vxqszGM-qTiHGuIXNjIK93Incg-cMpY8nHC89l92Imk,2642
-NEMO_billing/invoices/models.py,sha256=beZv5UNRB5f4-yOMm9hjD8lw3gGm9u73sYuow2WBvg0,24267
+NEMO_billing/invoices/models.py,sha256=e5y_kSI_llL1X-QG-ECmHiE4mAPfa4qx264o0XFFmgE,24296
 NEMO_billing/invoices/pdf_utilities.py,sha256=k9NKkO40tce4ALJl1LPMmy6JT7FnXcHmIG-08tYZYSA,12477
-NEMO_billing/invoices/processors.py,sha256=-Ck0r5dMYEjK1K2XYpso4rFY67-dLst2YPbcpRZhvZ8,30308
-NEMO_billing/invoices/renderers.py,sha256=W0qKeFSoit3bAyMFA-OQCPJrFm5HvnSgZwkCIwAmzes,26513
-NEMO_billing/invoices/urls.py,sha256=EJDQ6EGXMQQhjRpUm-eLUqbxyhywPVgEx-qdo5D243U,3489
-NEMO_billing/invoices/utilities.py,sha256=O-LG8UXwqcskr6KE572o4N4FfeKi-_gl869lwcKjA-4,4293
+NEMO_billing/invoices/processors.py,sha256=5Wp8QSqdEhRhuwXzMDlPgJ4l--TI1K6UULiYQ1_NLU0,30284
+NEMO_billing/invoices/renderers.py,sha256=5cyr_tlYh59J_YhXmLN8WgRpvrNBx3vf5GTkx6mKhlc,26585
+NEMO_billing/invoices/urls.py,sha256=VFknBOuI5ZZYq_GG8URG-gdDuGD3vFJOrSDq-PCcCjQ,3791
+NEMO_billing/invoices/utilities.py,sha256=mZ7GXBuqJdqAmBK-WCf_JGFfKHyBxjCAKnIKI2Kukik,4277
 NEMO_billing/invoices/management/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/management/commands/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py,sha256=vrJ7y-FHBPvufXCbcYQbOmNwBUsWSSAvdGlYdGX4lII,298
 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py,sha256=NirdsT3Saj_sZwCE2iZMHZgMDeXYvp8hL2srk-Z63mY,318
-NEMO_billing/invoices/migrations/0001_initial.py,sha256=9Jg9lZCVb_yksWR4x5dT-h4QQ3oelPx-KgeQ0ktNayc,9795
-NEMO_billing/invoices/migrations/0002_version_1_2_0.py,sha256=Rdo1o--uj5fRSYUZ-hk1Ir-UsSTBMfdqbTbBk8jNDvE,2794
-NEMO_billing/invoices/migrations/0003_version_1_4_0.py,sha256=xLvPGSmXUhDQ6ldwKWyeB13jdLU8Gywxr0pSQWIpuRE,1063
-NEMO_billing/invoices/migrations/0004_version_1_6_0.py,sha256=XpY-TXxRiKSmqm5XjO-M-6q5TlgHAXH4TxiA6eVaY6Y,467
-NEMO_billing/invoices/migrations/0005_version_1_6_1.py,sha256=bDdJ5TWTug_hyPmvDw2koOeuH95IRfmwBwgj3uhClOM,485
-NEMO_billing/invoices/migrations/0006_version_1_7_1.py,sha256=pn0XXRQb9IcYCTCQHnOyinoGkbwkbJRMKedcNmmAYk4,518
-NEMO_billing/invoices/migrations/0007_version_1_8_0.py,sha256=Fz-m4Ig4buUJU4QrOUDSFe4brS42qwPwuuXM3Oyz8dY,458
-NEMO_billing/invoices/migrations/0008_version_1_10_0.py,sha256=L_WSEK0zV60RgyKeUswKVNBcFALV4CxCrpQ0RY63i5U,437
-NEMO_billing/invoices/migrations/0009_version_1_23_0.py,sha256=OovlSCBav-NtlFw3EQ2ILuT_nmgOwpeu639Ly0hsmIU,1183
-NEMO_billing/invoices/migrations/0010_version_2_0_0.py,sha256=12oMKisB9Pdclkr85ASTIJJgX2GLeiXJ_Zkctg8RNhM,439
-NEMO_billing/invoices/migrations/0011_version_2_4_0.py,sha256=WrVVESctexdmPvqoH49HFLmWdPCFEcRDnZ-m0AAtjZU,1280
+NEMO_billing/invoices/migrations/0001_initial.py,sha256=2UOsEOI7E_vTRzJaPsES-vh9GbcthSn8kLcsuX-PGhU,13593
+NEMO_billing/invoices/migrations/0002_version_1_2_0.py,sha256=4dO9-0TGF2juMxoNavREJg9DiOcvibP34SrQuPAEgqM,3431
+NEMO_billing/invoices/migrations/0003_version_1_4_0.py,sha256=MKN01nbysK8fH7sDNl8eoraGNdgVIwxi1dOyeXP7btY,1123
+NEMO_billing/invoices/migrations/0004_version_1_6_0.py,sha256=vZNiSGD87FSfgJfyTE-jqmKNcT3lU059PUkTF-VaGgs,466
+NEMO_billing/invoices/migrations/0005_version_1_6_1.py,sha256=l_cJfBp1ZskerQrg-L3i56ddMywVj_C_W6R1Hm32QUA,485
+NEMO_billing/invoices/migrations/0006_version_1_7_1.py,sha256=OCg77c8Bd68scxcjUefQ-cECE-mgyP3K6Xdb66eH-k4,598
+NEMO_billing/invoices/migrations/0007_version_1_8_0.py,sha256=hO6FHmabBl9tKZuofJyrWFKZd7AijsjUXSyTsVCQGFY,458
+NEMO_billing/invoices/migrations/0008_version_1_10_0.py,sha256=slLh4qDX_H4NzMeagg8lxSrVJ8b4smg56q9vUqa02eg,437
+NEMO_billing/invoices/migrations/0009_version_1_23_0.py,sha256=QYIr1_u7zMxTlRVIV1I5VcAAPsE3zZTuE1bSNGEh_7I,1213
+NEMO_billing/invoices/migrations/0010_version_2_0_0.py,sha256=WaHlz_4d10katom49GdymjdczYkSQ7dbMhxlrR867c4,439
+NEMO_billing/invoices/migrations/0011_version_2_4_0.py,sha256=At24t971oagu6_cby5aardqTbtfxGIGQgKuvJ4zVIz4,1565
 NEMO_billing/invoices/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/static/invoices/invoices.css,sha256=9HC7rx65WIdIb2GzV2-H204cRKEhqI8tFnAzi6bCwk0,1072
-NEMO_billing/invoices/templates/customizations/customizations_billing.html,sha256=ZIuVb3hbwkOcdQHYnDNaSAINFojS--ZC7DAaUtWwxLA,5770
-NEMO_billing/invoices/templates/customizations/customizations_invoices.html,sha256=VmiFy_rPwJv12SxCxVwappV84A5k3SEySReuceEC_98,8934
-NEMO_billing/invoices/templates/invoices/base.html,sha256=GJQiq_yduxal8rnCPLyZsclw7w1G9UAgjSAvgCPf__I,212
-NEMO_billing/invoices/templates/invoices/invoice.html,sha256=30ydgzHT77c838gOqnlIDk2QBbpxApNvFFxLCUP9W6k,14099
-NEMO_billing/invoices/templates/invoices/invoice_details.html,sha256=Tu-dNX7kYZK-NqD8sbJMHDaBwFF36cz_jMUBRHWry8E,3375
-NEMO_billing/invoices/templates/invoices/invoices.html,sha256=2dFcfgdtJeYB37DLa6qodDsYg-717KHyEry4FrEsanE,13185
-NEMO_billing/invoices/templates/invoices/usage.html,sha256=YS7Dq_SRdi4uzU-ef_kgLaAJ0kzY4o_d2V9bSsduEK4,16199
-NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html,sha256=CqX4uFcmGbjP1ufkQaumvgmrqEmyaPa_n3f_JPWpBB0,2024
+NEMO_billing/invoices/templates/customizations/customizations_billing.html,sha256=MjkYZbVwKMVaS8Fp8ORK5c051Ezalocvyr87xjQ4khs,6615
+NEMO_billing/invoices/templates/customizations/customizations_invoices.html,sha256=hQ3uraGzao_lBmMJx31Od4Sqbd9w5BbSWMp-aztEbM4,11457
+NEMO_billing/invoices/templates/invoices/base.html,sha256=-yZF9Yfpo7Gy8HXYMKpOqcAazeuiyqSlnBXSD40TGjQ,222
+NEMO_billing/invoices/templates/invoices/invoice.html,sha256=3qdIKBf89zbx3WG_9ztUIF6romEouS0-_CeL2Aix78Q,20434
+NEMO_billing/invoices/templates/invoices/invoice_details.html,sha256=p9KmrgbAyEY0SF9k0z3xL_bvS4htlC0sffqL6DWqEcs,4715
+NEMO_billing/invoices/templates/invoices/invoices.html,sha256=q9jlKvLvLQG93cHQJm28eUozi_VaVrlOWJNH0liWjHM,17965
+NEMO_billing/invoices/templates/invoices/usage.html,sha256=Raox7ukh_Y-GMumDOIejQFeB1n3qRHCCXH16qCbiFdQ,26762
+NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html,sha256=vkLnC-nzP5UWQmQIibKL5NswuZGcLbnev-l_AM8HdWw,2531
 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt,sha256=ICFWe5LH0HOcF_BAo787st5QjfAkGM0vwVre5jvXjrk,302
-NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html,sha256=qxtmOrntin7s--ejgi0-ZExhMNtlFH5Ug9FDN8HlG1M,1330
-NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html,sha256=-7pEuk2HGcyKWrQVUq2g-rOJSijl5kHH0qVxy5RhDsU,1344
+NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html,sha256=e8oO6wNtXVqYyLD4eGXvkUc-Q9YmVGFBkQ1XqlBdLIY,1804
+NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html,sha256=q4d6z6CFi17yqNZmll7JD6T0Qfv5k5HsPwTN1HPeBS4,1818
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt,sha256=CppgdsErLEDyGWDSiupNBwDwYkcQ2yWGHDZIHbZLk84,155
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt,sha256=sqKu9kb_nGdwlwaaFtA_1SrlkDToiQC6DwVpMr79DuA,155
-NEMO_billing/invoices/templates/invoices/project/edit_project.html,sha256=cMdTprGSJsuixaVSkKYbRbJP2gW-L0Orbg4hdCLii5M,15409
-NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html,sha256=4Xn4EoEJd15QcH5M_rJ8nr22eUkvyUnPLdMphCWhYJQ,3668
+NEMO_billing/invoices/templates/invoices/project/edit_project.html,sha256=zijST6aLYWGD8jLos8XfomYv-dijxuqV4f7cn1I77GE,21260
+NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html,sha256=HxURnXRhJQxNFy4LzAR_gE9vO-ywHuc1MR1o7LhtBhw,4728
 NEMO_billing/invoices/views/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/invoices/views/invoices.py,sha256=YE6rohhEWBgtAgjPCdjNGBGOBzLztdfvzGXqKG6AfY4,20161
-NEMO_billing/invoices/views/project.py,sha256=PdPAq6Ce3AkbWr1kcjvDCInH8B5pffCj6QEObsngs6U,7175
-NEMO_billing/invoices/views/usage.py,sha256=7EZQ0x7HUC6k5quMTC4-iLhZog_zsot7rzRc7nI5G6s,11483
-NEMO_billing/migrations/0001_initial.py,sha256=8mX99RBacUkx98feI1gk4ipAncSoGxqHn7uVTShlGM0,3156
-NEMO_billing/migrations/0002_version_1_2_0.py,sha256=L9gAAPwTIPJoVJFgRHvxukVBbJ24i38E7pGWUcPF1Tw,573
-NEMO_billing/migrations/0003_version_2_0_0.py,sha256=bthjpfKPie-Rn0-DFChbJAFTixJhdcWtcMRmeM1hra4,466
-NEMO_billing/migrations/0004_version_2_4_0.py,sha256=w9yF3G7SxpC8Jl7pQzXZr5GgxNWf7j1gFfZwWc8Bmuo,7722
-NEMO_billing/migrations/0005_version_2_5_6.py,sha256=ZTRx9bfrX-CtMJqJ4Lf9_01sKI-M_kE3TRw5K2VeVFQ,351
+NEMO_billing/invoices/views/invoices.py,sha256=IoOqhQ0LlOzoVRUNH13UhFxpgk8mA8DqyYbRc3uknrM,20163
+NEMO_billing/invoices/views/project.py,sha256=52n0PLyA2c1RfDo-TSZ_eFuximt72PDW8crxNeEKDkQ,7175
+NEMO_billing/invoices/views/usage.py,sha256=pP6zvgxmzIQ4pL2FBE91nO5ZENGsvcUKa53mIOt25uE,11589
+NEMO_billing/migrations/0001_initial.py,sha256=IW6jbBMB8NJEyvWiZStxwHzlsbPCa2rZQLsO3GyLrEM,4768
+NEMO_billing/migrations/0002_version_1_2_0.py,sha256=dptsmjkZDaXBaMf3IPGZGnygh7I4xZdfO59kh_n21U8,668
+NEMO_billing/migrations/0003_version_2_0_0.py,sha256=RifUmHKxorLGxQWnrgDwPRIfYm68TsJUDhpMfRfxcww,466
+NEMO_billing/migrations/0004_version_2_4_0.py,sha256=FAJXmAbX9GJW7yi9WbVXLWi1d6VjmDD_otxZmZO3hBU,15298
+NEMO_billing/migrations/0005_version_2_5_6.py,sha256=iB4cn04vIz4T6t4LOpgEIkgvOcJMfKWigtTGv5YqkXE,351
 NEMO_billing/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/prepayments/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/prepayments/admin.py,sha256=KHCPynSFxRklpc_e-NNmxvo8pRRXmM0elNHv7Eev1qE,3045
 NEMO_billing/prepayments/api.py,sha256=iycJFhBLuAQcCXDC0j0dSCJ_QneNnh2jPS3fGZVXddk,1680
 NEMO_billing/prepayments/app_settings.py,sha256=o19SNbTs_CxC8qS3DeURjz8JTGAVXVIbGdANrpm75Qk,71
 NEMO_billing/prepayments/apps.py,sha256=7tZjsEtswtOj6g8UdDjXgo2yFzObYL4Gw2CG7MNPDY8,559
 NEMO_billing/prepayments/exceptions.py,sha256=GGPuuLWNuNaJy80Lo7E01A1zxJc1ar1bDuxCPLAy8w0,1876
 NEMO_billing/prepayments/models.py,sha256=wlHfMbYkxkUuZfNUIZ5n30Mk157IZkQHJhKcoQ5WVbA,18892
-NEMO_billing/prepayments/policy.py,sha256=AWhiANYUxtWCsyOGcWxHTfwdO6STjiMfSa_rFqO7q60,5492
+NEMO_billing/prepayments/policy.py,sha256=RyXL5Vhxk7vg4nhkO2h-tNV259IXAET4Ht3MiNwAAjU,5493
 NEMO_billing/prepayments/urls.py,sha256=jT6usdUSlp-JV3KiooEcvjvSFwcW82Ggjco4zW0fvMw,650
-NEMO_billing/prepayments/migrations/0001_initial.py,sha256=KLXLxa9hFghBCSR1ciXZ-7kW9WGAbsFWQW3YT1iKqIA,4314
-NEMO_billing/prepayments/migrations/0002_projectprepaymentdetail_overdraft_amount_allowed.py,sha256=6Ywc94pJgO8Ryv424B0Mhe9XIR2XHM2CrfoY9qnXr-4,584
+NEMO_billing/prepayments/migrations/0001_initial.py,sha256=qTJJNeedeXzAqOFftSfiB7HnJkINQSKOHFUMypyPC04,7016
+NEMO_billing/prepayments/migrations/0002_projectprepaymentdetail_overdraft_amount_allowed.py,sha256=RZ0_2loO0SbgSn6ahiHGWCqMwa30jfgrTKKEPz5lfPE,647
 NEMO_billing/prepayments/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/prepayments/templates/prepayments/prepaid_project_status.html,sha256=FcrU-DO-DmfNv1-yVEqYPbDpf8_wIWt4YhXVr1wGIWA,1021
-NEMO_billing/prepayments/templates/prepayments/prepaid_project_status_table.html,sha256=fQMdLAZjutGqH-d8pJYqhBnAYs6FkFX0pObWCx-PnFY,4344
+NEMO_billing/prepayments/templates/prepayments/prepaid_project_status.html,sha256=e_TFk5X5LtFBWUR2xBYBpP6gwuznSFgk1WCVxemlHlM,1153
+NEMO_billing/prepayments/templates/prepayments/prepaid_project_status_table.html,sha256=x440cMX1Kk43jnmHu9ygp2wz1nJqtzi4R1AhAxu5j7c,6399
 NEMO_billing/prepayments/views/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/prepayments/views/prepayments.py,sha256=44U7NZUQlHmEVfz7h-ggXt_Gx0-_bgpIIVuSv5IO4QU,4716
 NEMO_billing/rates/__init__.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
 NEMO_billing/rates/admin.py,sha256=PLyXJ4-y8kit8yLHbqawYz0g7dgg9Zkkn6f9qepcl3I,8271
 NEMO_billing/rates/api.py,sha256=cOycY3KCEY6DexNjxn0WQmVrBMQHviMqnTFzz7pE-qk,2318
 NEMO_billing/rates/app_settings.py,sha256=nf-9NKCMJb4lRJWKQwaKLd7Vu99udTDVW9rR4NR4FE4,151
-NEMO_billing/rates/apps.py,sha256=Lnb7XBu8KU0YvS8rdxJRpCawkapBmEiHvUzwTsLhPcI,715
+NEMO_billing/rates/apps.py,sha256=6c-lyyKIHeiqedh7ORlcBmhHKlpFEpZHLw2PTTsStaA,716
 NEMO_billing/rates/customization.py,sha256=gxuAw_K50RTn4JlTKTw7JOjLaLuH65Q5jq02FLwJc60,2768
 NEMO_billing/rates/model_diff.py,sha256=8IJZDf3694tpn3RAn0g2DyGXBjN0OSTLqpNTmWZtvKk,1913
-NEMO_billing/rates/models.py,sha256=-349L3JqK9mILyNeHsaoj4Aw0040DGGXl7zoQhWwob4,22906
+NEMO_billing/rates/models.py,sha256=6vLMTl-25AJg6LHu6efbwbp85JI_objE5LkD5zcFsJc,22858
 NEMO_billing/rates/rates_class.py,sha256=STPEXS_uHqJWNO81NCW1pRp8nV18VgzUZa5WguvJ2UI,5504
 NEMO_billing/rates/urls.py,sha256=63TGiWXQFtPOXw1lH6AGU-kW7ng-IMbCvwV9_6k3sHU,1115
 NEMO_billing/rates/views.py,sha256=0KispgwfYCoAz6jg5JC9zCZ43NE8jHVNR8RavjTvP5k,22155
-NEMO_billing/rates/migrations/0001_initial.py,sha256=Sz5S5PVnYxoOA4Iw4AJbg3Xg-iTwzRHCyMz7wEny5xI,5101
-NEMO_billing/rates/migrations/0002_version_1_15_0.py,sha256=A2HsKCJqRyi9iNcjricV2qa0KAE35KtH2oHirTHKQ8I,602
-NEMO_billing/rates/migrations/0003_version_1_17_0.py,sha256=SRBOrvrC_RXkuhPKYd3WPOdI1uDHK5KeMbQ3t-xR3Gk,1999
-NEMO_billing/rates/migrations/0004_version_2_0_0.py,sha256=XjDwJ0kIU1IWJWeMyXUMUWUlraamPpUd-eoakXtnGng,421
-NEMO_billing/rates/migrations/0005_version_2_3_0.py,sha256=ya7vUQdpqEOG79R8uH6UU76WYwK2QDDkMRcXGsu_EBQ,448
+NEMO_billing/rates/migrations/0001_initial.py,sha256=20319ylJPyB3JhGbz85XZvO_yxsXSHSSda3UF3RtjBs,6958
+NEMO_billing/rates/migrations/0002_version_1_15_0.py,sha256=npF6PM5fMHLcB9qqV3Nu1cEKp9yN__9AgdaoSNwVML8,624
+NEMO_billing/rates/migrations/0003_version_1_17_0.py,sha256=OPp2x9JTQqWVbaZTQ_n8lOsCnkDFp7J7g4Rx3o7mapU,2382
+NEMO_billing/rates/migrations/0004_version_2_0_0.py,sha256=P93VQT9ntY5Vq7lK0KbyXwkuAJHNLkNQMovg0v-gK5Y,421
+NEMO_billing/rates/migrations/0005_version_2_3_0.py,sha256=P1SmbMfTSlpqNd54prYQHc8Khy0zR8OzqV1FpYtVvNk,478
 NEMO_billing/rates/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/rates/static/rates/rates.css,sha256=PcSgA1klrSnF43In82rbVYkS3KUthQKOy9qP10dry0E,81
-NEMO_billing/rates/templates/customizations/customizations_billing_rates.html,sha256=pv8cQvraQgcZmTSoVNgFmV4snNTSbUsTFX4Yixo1Kt8,7476
-NEMO_billing/rates/templates/rates/base.html,sha256=v36mGGC10oJjSMScGg0WqUJzKOlJe1Bp3444noFGgIo,160
-NEMO_billing/rates/templates/rates/rate.html,sha256=jFEbwDE6oSQUWfm7Jhw97SnjtjxF7t5F5zM6Tnw2qGc,6047
-NEMO_billing/rates/templates/rates/rate_form_details.html,sha256=F7Im8Y5jBHTDSlnf4EuH-lHwxShFAlNlG53ZQx1vhDM,5591
-NEMO_billing/rates/templates/rates/rate_list.html,sha256=IeD2nkjKe68ugYQIbd5W_ZaUnihyIVUT2CvLNCWW2aw,5339
-NEMO_billing/rates/templates/rates/rates.html,sha256=7uRELddWPU37iwSWzIEFT4irJoS785IsfOk59cY0wzQ,4602
-NEMO_billing/templates/base/navbar.html,sha256=2MD4PEQrn0J4RKBFdeSuyQUcolGi-s_G4u4H5PacRCk,192
-NEMO_billing/templates/base/navbar_billing.html,sha256=8xcQXfhL7cV1mngX8Vku0IRMHGsIF7P8jnNs-OMt9SA,1179
-NEMO_billing/templates/billing/cap_and_prepaid_base.html,sha256=ykUs3YgBEBMAo7gU4ZzixBWyu3bw5XFAHgjJ5YlaehM,1162
-NEMO_billing/templates/billing/custom_charge.html,sha256=mLQX6GQtMaVbhKxqoepm-y-cokpDByaG_U5P-DNI58Q,8882
-NEMO_billing/templates/billing/custom_charges.html,sha256=isMdty7a1D576tjMQEDHE0wrnV68t8nFZbmN2WqJ2-M,2074
-NEMO_billing/templates/staff_charges/choose_project.html,sha256=NqMXJ9EUyHN2FkFQ4HDZ-CfabcchyUkLgZY6lhGIZ8s,1368
-NEMO_billing/templates/staff_charges/new_custom_staff_charge.html,sha256=q73pThu5W7XNPMtPax3fg39qGnE_OPPcjes3R9kfc9c,1979
+NEMO_billing/rates/templates/customizations/customizations_billing_rates.html,sha256=jfL7gmZpF84l4UUlzc9N2wNIw4ftal97MtfjhSOEZu0,10562
+NEMO_billing/rates/templates/rates/base.html,sha256=aWf0JjGOlgsVaE1-DuraT_T52SDZ7eoiqEE0Owp58xs,169
+NEMO_billing/rates/templates/rates/rate.html,sha256=otR-zzT_nHAUozjXOp9BP2LLlcNwguP2vhJDLsfcDz4,7358
+NEMO_billing/rates/templates/rates/rate_form_details.html,sha256=57oihYpvjnST1DaaKezsCRPlb6rV65ajLiXeGIvpevU,8244
+NEMO_billing/rates/templates/rates/rate_list.html,sha256=buy3PKz28jmBVJbs6eFT-PGcdIdZR5EzIK6cly5jWgM,7440
+NEMO_billing/rates/templates/rates/rates.html,sha256=WTjSb0JWCLu5se3SYn9VxT5GLq_Jd07qddc_dfM2ews,5731
+NEMO_billing/templates/base/navbar.html,sha256=c35_ZSg208rGZnYGsiORP-K6Hz4LqI-Eim0ZTscF3no,198
+NEMO_billing/templates/base/navbar_billing.html,sha256=YsSCTGAD4MUH36ZcBwQT0Kr1FtIteQ5krEDrqf8-Ctw,1218
+NEMO_billing/templates/billing/cap_and_prepaid_base.html,sha256=fmKg2xdpd3qqRLMMzErc0yNpYGdh05g-KK26HhKDjg0,1345
+NEMO_billing/templates/billing/custom_charge.html,sha256=xjuGX4goEL-QAwbsN4XyKqIT4TEldaO7dnEc9MYf_N4,12303
+NEMO_billing/templates/billing/custom_charges.html,sha256=sI533rkUCCs5IMEMiyA2Mh6r3bwJkt10D8Re4_1yjs4,2467
+NEMO_billing/templates/staff_charges/choose_project.html,sha256=R-aEFBxSwK99lBi0Gr2Kp_WxQzLA6OiN9cah-gswBBM,1825
+NEMO_billing/templates/staff_charges/new_custom_staff_charge.html,sha256=zP1sDBN5hadguCHNG_K6gvXG0BMsqNNfQLYDqzZMF3A,2492
 NEMO_billing/templatetags/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/templatetags/billing_tags.py,sha256=V4beFUAjiCRvl1dDIfIgM9iGhvoCl-OXoNcSW2Zw5_Y,1014
 NEMO_billing/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/tests/test_project_expiration.py,sha256=LpDJ716qRT0MqeC9Q_NBQNqABEnkslecmL8CHfSkXiI,2653
-NEMO_billing/tests/test_settings.py,sha256=2rjncQ_9NOKOT6HMUkznXVVWqCuNLFyCDSDTguSnE5U,3079
-NEMO_billing/tests/test_urls.py,sha256=ZT1Q-7KU38x5J5QdxFqWYaXCVj8SrhZQ0WzkFDVs7Q8,1472
+NEMO_billing/tests/test_settings.py,sha256=lj8dXOGiHTLDHvxC-1Zf65roeGP3Yvr1v-2xq8YiFBk,3085
+NEMO_billing/tests/test_urls.py,sha256=PkEFiYDsYtHBY4A1qx2_cCXymbatpWuXgkqLIw1Lcfw,1475
 NEMO_billing/tests/test_utilities.py,sha256=NFDLpizSngSpJf-yNb-TnEX1HyNKgY8x1E29PL8tSWA,1094
 NEMO_billing/tests/cap/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/tests/cap/test_cap_discount.py,sha256=WOT1Tsk7pwYDCI8SKHCPW_M-kUoA-5htShXb9gSZ5ME,20368
 NEMO_billing/tests/cap/test_cap_invoicing.py,sha256=7CKXSTEF5mCS17xMeHjSM5-3KnndwLJ2DJknWvrjN3w,32818
-NEMO_billing/tests/cap/test_cap_utilities.py,sha256=Sn2-L9pzSrYDhAVEk2D3outwcgQhBBhSNqKbbbkrnr8,4271
+NEMO_billing/tests/cap/test_cap_utilities.py,sha256=32sZao4DZuheIiP2cyXpvhccHDXX3KdXd5LPFYUYDyk,4293
 NEMO_billing/tests/prepayments/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/tests/prepayments/test_prepayments.py,sha256=Md7liTK7Vk2ijHKZDgsK5FkaXe1DQrkkTOzzGE2OEm8,16024
 NEMO_billing/tests/rates/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/tests/rates/test_rate_amount.py,sha256=ebFt4ewtTYgG43QMp8kMuwyuIRaBaK-A9UeqJqbiJGA,33260
 NEMO_billing/tests/rates/test_rate_time.py,sha256=HlFPppN2ArI2wtIOCiAbn4Vdi0soy0U0luKiw7v-Xek,20895
 NEMO_billing/tests/rates/test_rate_uniqueness.py,sha256=73HgpjHMVhjNVFQkET4LTmisI0sMbQXcbh6t1F2vH9Q,6164
 NEMO_billing/tests/rates/test_split_billables.py,sha256=BJxjVoiAG-85Ii731RoQ7d5iGzOIxk8lv4Vl46KAMnY,27008
-NEMO_billing-2.8.1.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
-NEMO_billing-2.8.1.dist-info/METADATA,sha256=BgHm3A7AX_iF3wBwBHYaHV0NDtINPxzII_ljcCoi0JM,6097
-NEMO_billing-2.8.1.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-NEMO_billing-2.8.1.dist-info/top_level.txt,sha256=oSVD1wly89TarvuLJtW0tkI41vVO_BaZ7EuxPtyp9qo,13
-NEMO_billing-2.8.1.dist-info/RECORD,,
+NEMO_billing-2.9.0.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
+NEMO_billing-2.9.0.dist-info/METADATA,sha256=HbV5Nk_tlurKkIntjsKzpzSsbLLlYdgUswOBpwYmDYg,6140
+NEMO_billing-2.9.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+NEMO_billing-2.9.0.dist-info/top_level.txt,sha256=oSVD1wly89TarvuLJtW0tkI41vVO_BaZ7EuxPtyp9qo,13
+NEMO_billing-2.9.0.dist-info/RECORD,,
```

